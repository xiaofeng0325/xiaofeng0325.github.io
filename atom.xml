<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>zm.blog</title>
  
  <subtitle>select * from learn</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zhangmiao.cc/"/>
  <updated>2019-08-19T10:14:04.569Z</updated>
  <id>https://zhangmiao.cc/</id>
  
  <author>
    <name>ZhangMiao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å¼€ç®±å³ç”¨çš„è‡ªå®šä¹‰Banner</title>
    <link href="https://zhangmiao.cc/posts/108df6b8.html"/>
    <id>https://zhangmiao.cc/posts/108df6b8.html</id>
    <published>2019-08-19T09:59:59.000Z</published>
    <updated>2019-08-19T10:14:04.569Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/640112319204sda.gif" alt></p><a id="more"></a><h2 id="è‡ªå®šä¹‰Bannerç”¨æ³•æ˜ç»†"><a href="#è‡ªå®šä¹‰Bannerç”¨æ³•æ˜ç»†" class="headerlink" title="è‡ªå®šä¹‰Bannerç”¨æ³•æ˜ç»†"></a>è‡ªå®šä¹‰Bannerç”¨æ³•æ˜ç»†</h2><p>æ”¯æŒXMLè‡ªå®šä¹‰å±æ€§ï¼š</p><ul><li><p>bv_viewHeightï¼šBannerè§†å›¾åŒºåŸŸçš„é«˜åº¦ï¼Œå°äºç­‰äº0æ—¶ä¸ºè¯¥å¸ƒå±€çš„é«˜åº¦</p></li><li><p>bv_viewCornerRadiusï¼šè§†å›¾åŒºåŸŸåœ†è§’çš„åŠå¾„</p></li><li><p>bv_itemViewWidthRatioï¼šæ ¹æ®è¯¥å¸ƒå±€å®½åº¦çš„ç™¾åˆ†æ¯”è®¾ç½®ItemViewçš„å®½åº¦</p></li><li><p>bv_itemViewMarginï¼šè®¾ç½®ItemViewä¹‹é—´çš„é—´è·</p></li><li><p>bv_intervalInMillisï¼šBannerè½®æ¢æ—¶é—´ï¼ˆåœ¨SMOOTHæ¨¡å¼ä¸‹ä¸ºBannerä»å³åŒ€é€Ÿåˆ°å·¦çš„æ—¶é—´ï¼‰</p></li><li><p>bv_pageHoldInMillisï¼šæ‰‹æŒ‡æ»‘åŠ¨åï¼Œé¡µé¢åœç•™çš„æ—¶é•¿ï¼ˆåªåœ¨SMOOTHæ¨¡å¼ä¸‹ç”Ÿæ•ˆï¼‰</p></li><li><p>bv_scrollModeï¼šè®¾ç½®Banneræ»šåŠ¨æ¨¡å¼</p></li><li><ul><li>INTERVALï¼šé—´éš”åˆ‡æ¢æ¨¡å¼</li><li>SMOOTHï¼šåŒ€é€Ÿæ»šåŠ¨æ¨¡å¼</li></ul></li><li><p>bv_itemViewAlignï¼šItemViewä¸çˆ¶WrapperViewçš„å¯¹é½æ–¹å¼ï¼ˆå†³å®šäº†itemViewMarginçš„ç•™ç™½ä½ç½®ï¼‰</p></li><li><ul><li>CENTER_HORIZONTALï¼šæ°´å¹³å±…ä¸­</li><li>ALIGN_PARENT_LEFTï¼šå±…å·¦å¯¹é½</li><li>ALIGN_PARENT_RIGHTï¼šå±…å³å¯¹é½</li></ul></li></ul><p>æš´éœ²çš„APIæœ‰ï¼š</p><ul><li>setBannerViewImpl(impl: IBannerView)ï¼šè®¾ç½®Bannerå¿…é¡»çš„å®ç°ç±»</li><li>startAutoScroll()ï¼šå¼€å§‹è‡ªåŠ¨æ»šåŠ¨ï¼ˆé¡µé¢æ•°é‡å°äº1æ—¶ä¸ä¼šæ»šåŠ¨ï¼‰</li><li>stopAutoScroll()ï¼šåœæ­¢è‡ªåŠ¨æ»šåŠ¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰é¡µé¢åˆ‡æ¢å›è°ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">OnPageChangeListener</span> </span>&#123;</span><br><span class="line">    <span class="function">fun <span class="title">onPageSelected</span><span class="params">(position: Int)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">interface IBannerViewBase </span>&#123;</span><br><span class="line">    <span class="function">fun <span class="title">getCount</span><span class="params">()</span>: Int</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    fun <span class="title">getItemView</span><span class="params">(context: Context)</span>: View</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    fun <span class="title">onBindView</span><span class="params">(itemView: View, position: Int)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment"> * BannerViewä¾èµ–çš„å¤–éƒ¨å®ç°</span></span></span><br><span class="line"><span class="function"><span class="comment"> */</span></span></span><br><span class="line"><span class="function">interface IBannerView : OnPageChangeListener, IBannerViewBase </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“countä¸º0æ—¶çš„é»˜è®¤view</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">fun <span class="title">getDefaultView</span><span class="params">(context: Context)</span>: View? </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤å…³é—­è‡ªåŠ¨æ»šåŠ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">fun <span class="title">isDefaultAutoScroll</span><span class="params">()</span>: Boolean </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">onPageSelected</span><span class="params">(position: Int)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æºç åœ°å€ï¼š</p><blockquote><p><a href="https://github.com/drawf/SourceSet/tree/master/app/src/main/java/me/erwa/sourceset/view/banner" target="_blank" rel="noopener">https://github.com/drawf/SourceSet/tree/master/app/src/main/java/me/erwa/sourceset/view/banner</a></p></blockquote><h2 id="æ€è€ƒåˆ†æ"><a href="#æ€è€ƒåˆ†æ" class="headerlink" title="æ€è€ƒåˆ†æ"></a>æ€è€ƒåˆ†æ</h2><p><strong>NOTEï¼š</strong>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬ä¸“æ³¨äºBannerViewçš„å°è£…ä¸å®ç°ï¼Œå…³äºæ›´åº•å±‚çš„PagerSnapHelperçš„åŸç†éƒ¨åˆ†ä¸åœ¨èŒƒå›´å†…ï¼Œä½†åœ¨æ–‡æœ«æˆ‘<strong>æ‹œè¯»çš„æ–‡ç« </strong>ä¸­è´´å‡ºäº†ä¸€ä»½é“¾æ¥ï¼Œå¤§å®¶å¯è‡ªè¡Œé£Ÿç”¨ã€‚</p><p>å‰è·¯æ¼«æ¼«ï¼Œæˆ‘ä»¬å…ˆæ¢³ç†ä¸‹éœ€æ±‚ï¼š</p><ol><li>è¦æ”¯æŒä¸¤ç§æ»šåŠ¨æ¨¡å¼ï¼Œé—´éš”åˆ‡æ¢ã€å¹³æ»‘æ»šåŠ¨</li><li>è¦æ”¯æŒè®¾ç½®è§†å›¾åŒºåŸŸåœ†è§’</li><li>è¦æ”¯æŒè®¾ç½®æ¡ç›®è§†å›¾åœ†è§’ï¼ˆItemViewï¼‰ï¼ˆè¯¥éœ€æ±‚æœ¬æ¬¡æœªåšå®ç°ï¼Œä¸‹æ–‡ä¼šè‡ªåŠ¨å¿½ç•¥è¯¥éœ€æ±‚ï¼‰</li><li>è¦æ”¯æŒæ— é™å¾ªç¯æ»šåŠ¨</li><li>è¦æ”¯æŒæ ¹æ®BannerViewçš„å®½çš„æ¯”å€¼è®¾ç½®ItemViewçš„å®½</li><li>è¦æ”¯æŒè®¾ç½®ItemViewä¹‹é—´çš„é—´è·</li><li>è¦æ”¯æŒè®¾ç½®æ»šåŠ¨é—´éš”ï¼ŒåŒ€é€Ÿæ¨¡å¼è¦æ”¯æŒè®¾ç½®æ»šåŠ¨ä¸€é¡µçš„æ—¶é—´</li><li>è¦æ”¯æŒè®¾ç½®åŒ€é€Ÿæ¨¡å¼ä¸‹ï¼Œæ‰‹æŒ‡æ»‘åŠ¨åï¼Œé¡µé¢åœç•™çš„æ—¶é•¿</li><li>è¦æ”¯æŒè®¾ç½®ItemViewä¸çˆ¶WrapperViewçš„å¯¹é½æ–¹å¼ï¼ˆå†³å®šäº†itemViewMarginçš„ç•™ç™½ä½ç½®ï¼‰</li><li>è¦æ”¯æŒè®¾ç½®é»˜è®¤æ˜¯å¦å¼€å¯æ»šåŠ¨</li><li>è¦æ”¯æŒè®¾ç½®æ•°æ®æºä¸ºç©ºæ—¶çš„é»˜è®¤View</li><li>è¦æ”¯æŒæ•°æ®æºåªæœ‰1å¼ banneræ—¶ï¼Œç¦æ­¢æ»šåŠ¨</li><li>è¦æš´éœ²APIæ§åˆ¶Bannerçš„è‡ªåŠ¨æ»šåŠ¨ä¸æš‚åœ</li><li>è¦æ”¯æŒè®¾ç½®æŒ‡ç¤ºå™¨ï¼ˆIndicatorï¼‰ï¼Œä¸”èƒ½çµæ´»æ§åˆ¶æŒ‡ç¤ºå™¨ä½ç½®ï¼Œä¸”ä¸BannerViewè§£è€¦</li></ol><p>ğŸ¤©è¿™ä¹ˆå¤šéœ€æ±‚ï¼Œä¸è¦æ€•ï¼Œæˆ‘ä»¬æ ¹æ®éœ€æ±‚æ¥ç†ä¸€éæ ¸å¿ƒæŠ€æœ¯ç‚¹ï¼š</p><ol><li><code>å¹³æ»‘æ»šåŠ¨æ¨¡å¼</code>å¯ä»¥ä½¿ç”¨RecyclerView+PagerSnapHelperå®ç°ï¼Œ<code>é—´éš”æ»šåŠ¨æ¨¡å¼</code>å¯ä»¥ç»§ç»­ä½¿ç”¨ViewPagerå®ç°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‰è€…æ–¹å¼å®ç°ã€‚ï¼ˆæœ¬æ–‡ç»Ÿä¸€ä½¿ç”¨RecyclerView+PagerSnapHelperæ–¹å¼ï¼Œä¸è¿‡ä»£ç ä¸­ä¹Ÿç•™å‡ºäº†æ¥å£ï¼Œå¯ç”¨ViewPageråšå®ç°ï¼‰</li><li>è®¾ç½®åœ†è§’è¿˜æ˜¯é‡‡ç”¨<code>Xfermode</code>åšè£å‰ªåˆæˆå³å¯ã€‚ï¼ˆè¯¥æ–¹å¼åœ¨ä¹‹å‰çš„æ–‡ç« <strong>ShadowLayout</strong>ä¸­ä½¿ç”¨è¿‡ï¼Œæ•…æœ¬æ–‡ä¸å†èµ˜è¿°ï¼‰</li><li>éœ€æ±‚[4]å°†adpterä¸­getItemCount()è¿”å›Int.MAX_VALUEï¼Œå†åœ¨ç»‘å®šViewæ—¶å€™ï¼Œç”¨å½“å‰çš„positionä¸çœŸå®countæ±‚ä½™æ•°ï¼Œä½œä¸ºçœŸå®çš„positionå»ç»‘å®šæ•°æ®ï¼Œå³å¯å®ç°ã€‚</li><li>éœ€æ±‚[4]åˆ°[13]ï¼Œéƒ½æ²¡æœ‰æŠ€æœ¯å¤æ‚åº¦ï¼Œä½†æœ‰ä¸šåŠ¡å¤æ‚åº¦ï¼Œåšå¸¸è§„å®ç°å³å¯ã€‚</li><li>éœ€æ±‚[14]å¯å®šä¹‰Indicatoræ¶‰åŠçš„æ¥å£åšä»£ç è§£è€¦ï¼Œå¹¶å°†BannerViewç»§æ‰¿RelativeLayoutï¼Œè¿™æ ·Indicatorä½œä¸ºå­Viewåœ¨xmlä¸­å¯çµæ´»æ§åˆ¶ä½ç½®ã€‚</li></ol><p>è¿™æ ·ä¸€æ¥ï¼Œå®ç°æˆ‘ä»¬æƒ³è¦çš„BannerViewåªæ˜¯è€å¿ƒ+æ—¶é—´çš„é—®é¢˜äº†ã€‚ä»¥ä¸‹ï¼Œæˆ‘ä¼šæŒ‘æœ¬æ¬¡å®ç°ä¸­é‡è¦çš„å‡ ç‚¹æ¥åšè¯´æ˜ï¼Œå¦‚ä¸‹ï¼š</p><ol><li>RecyclerView+PagerSnapHelperå®ç°çš„<strong>PagerRecyclerView</strong></li><li>ç”ŸæˆPagerViewå®ä¾‹çš„å·¥å‚<strong>PagerViewFactory</strong></li><li>Indicatorçš„è§£è€¦å®ç°</li></ol><h2 id="PagerRecyclerView"><a href="#PagerRecyclerView" class="headerlink" title="PagerRecyclerView"></a>PagerRecyclerView</h2><p>çœ‹åå­—ä¾¿çŸ¥è¿™æ˜¯ä¸€ä¸ªç”¨RecyclerViewå®ç°ViewPageråŠŸèƒ½çš„ç±»ï¼Œæ‰€ä»¥ç»§æ‰¿è‡ªRecyclerViewã€‚</p><p>å®ƒä½œä¸ºBannerViewçš„æ ¸å¿ƒåŠŸèƒ½å®ç°ç±»ï¼Œä¸ºäº†ä¸ä¸Šå±‚è§£è€¦ï¼ˆä¹Ÿå°±æ˜¯æ–¹ä¾¿åˆ‡æ¢ä¸ºå…¶å®ƒå®ç°ï¼Œæ¯”å¦‚ç”¨ViewPageråšå®ç°ï¼‰æ‰€ä»¥å®šä¹‰æ¥å£<code>IPagerViewInstance</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PagerViewåŠŸèƒ½å®ä¾‹éœ€å®ç°çš„æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IPagerViewInstance</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®è‡ªåŠ¨æ»šåŠ¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> intervalInMillis: Int åœ¨INTERVALæ¨¡å¼ä¸‹ä¸ºé¡µé¢åˆ‡æ¢é—´éš” åœ¨SMOOTHæ¨¡å¼ä¸‹ä¸ºæ»šåŠ¨ä¸€é¡µæ‰€éœ€æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">fun <span class="title">startAutoScroll</span><span class="params">(intervalInMillis: Int)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment">     * åœæ­¢è‡ªåŠ¨æ»šåŠ¨</span></span></span><br><span class="line"><span class="function"><span class="comment">     */</span></span></span><br><span class="line"><span class="function">    fun <span class="title">stopAutoScroll</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment">     * è·å–å½“å‰Itemçš„ä½ç½®ï¼ˆListçš„ç´¢å¼•ï¼‰</span></span></span><br><span class="line"><span class="function"><span class="comment">     */</span></span></span><br><span class="line"><span class="function">    fun <span class="title">getCurrentPosition</span><span class="params">()</span>: Int</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment">     * è·å–å½“å‰çœŸå®çš„Itemçš„ä½ç½®ï¼ˆListçš„ç´¢å¼•ï¼‰</span></span></span><br><span class="line"><span class="function"><span class="comment">     */</span></span></span><br><span class="line"><span class="function">    fun <span class="title">getRealCurrentPosition</span><span class="params">(realCount: Int)</span>: Int</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment">     * è®¾ç½®å¹³æ»‘æ¨¡å¼æ˜¯å¦å¼€å¯ï¼Œå¦åˆ™ä¸ºé—´éš”åˆ‡æ¢æ¨¡å¼</span></span></span><br><span class="line"><span class="function"><span class="comment">     */</span></span></span><br><span class="line"><span class="function">    fun <span class="title">setSmoothMode</span><span class="params">(enabled: Boolean)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment">     * è®¾ç½®é¡µé¢åœç•™æ—¶é•¿</span></span></span><br><span class="line"><span class="function"><span class="comment">     */</span></span></span><br><span class="line"><span class="function">    fun <span class="title">setPageHoldInMillis</span><span class="params">(pageHoldInMillis: Int)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment">     * è®¾ç½®é¡µé¢åˆ‡æ¢å›è°ƒ</span></span></span><br><span class="line"><span class="function"><span class="comment">     */</span></span></span><br><span class="line"><span class="function">    fun <span class="title">setOnPageChangeListener</span><span class="params">(listener: OnPageChangeListener)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment">     * é€šçŸ¥æ•°æ®åˆ·æ–°</span></span></span><br><span class="line"><span class="function"><span class="comment">     */</span></span></span><br><span class="line"><span class="function">    fun <span class="title">notifyDataSetChanged</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p>å…³äº<code>PagerSnapHelper</code>çš„ä½¿ç”¨æå…¶ç®€å•ï¼Œåªéœ€åˆ›å»ºå‡ºå®ä¾‹ï¼ŒattachToRecyclerViewä¸€ä¸‹ï¼Œå³å¯è®©RecyclerViewæ‘‡èº«ä¸€å˜æˆä¸ºViewPagerä¸€æ ·ã€‚ï¼ˆè¿™é‡Œå®åœ¨è®©äººæƒŠå¹ï¼ï¼æˆ‘ä»¬éƒ½åº”è¯¥è¿½æ±‚è¿™ç§APIçš„æè‡´è®¾è®¡ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ»‘åŠ¨åˆ°å…·ä½“ä½ç½®å¸®åŠ©å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> var mSnapHelper: PagerSnapHelper = PagerSnapHelper()</span><br><span class="line">... çœç•¥ä»£ç </span><br><span class="line">init &#123;</span><br><span class="line">    mSnapHelper.attachToRecyclerView(<span class="keyword">this</span>)</span><br><span class="line">    ... çœç•¥ä»£ç </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³äº<code>é—´éš”åˆ‡æ¢æ¨¡å¼ åŒ€é€Ÿæ»šåŠ¨æ¨¡å¼</code>çš„å®ç°ä¸»è¦æ˜¯åœ¨<code>startTimer()</code>æ–¹æ³•ä¸­ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºTimerçš„é—´éš”æ—¶é—´ä¸åŒã€å›è°ƒä¸­æ‰§è¡Œçš„æ–¹æ³•ä¸åŒã€‚å…¶ä¸­åŒ€é€Ÿæ¨¡å¼çš„Timeré—´éš”æ—¶é—´éœ€è¦ä½¿ç”¨<code>å¤–éƒ¨è®¾ç½®çš„æ»šåŠ¨ä¸€å±çš„æ—¶é—´ã€ä¸€å±çš„å®½åº¦ã€æ¯æ¬¡scrollByçš„è·ç¦»</code>è®¡ç®—è€Œæ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¼€å§‹å®šæ—¶å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> fun <span class="title">startTimer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mTimer?.cancel()</span><br><span class="line">    <span class="keyword">if</span> (mWidth &gt; <span class="number">0</span> &amp;&amp; mFlagStartTimer &amp;&amp; context != <span class="keyword">null</span> &amp;&amp; context is Activity) &#123;</span><br><span class="line">        mTimer = timer(initialDelay = mDelayedTime, period = mPeriodTime) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mScrollState == SCROLL_STATE_IDLE) &#123;</span><br><span class="line">                (context as Activity).runOnUiThread &#123;</span><br><span class="line">                    <span class="keyword">if</span> (mSmoothMode) &#123;</span><br><span class="line">                        scrollBy(DEFAULT_PERIOD_SCROLL_PIXEL, <span class="number">0</span>)</span><br><span class="line">                        triggerOnPageSelected()</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        smoothScrollToPosition(++mOldPosition)</span><br><span class="line">                        mPageChangeListener?.onPageSelected(mOldPosition)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">override fun <span class="title">onSizeChanged</span><span class="params">(w: Int, h: Int, oldw: Int, oldh: Int)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onSizeChanged(w, h, oldw, oldh)</span><br><span class="line">    mWidth = (w - paddingLeft - paddingRight).toFloat()</span><br><span class="line">    mHeight = (h - paddingTop - paddingBottom).toFloat()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¡ç®—åŒ€é€Ÿæ»šåŠ¨çš„æ—¶é—´é—´éš”</span></span><br><span class="line">    <span class="keyword">if</span> (mSmoothMode) &#123;</span><br><span class="line">        mPeriodTime = (mSmoothSpeed / (mWidth / DEFAULT_PERIOD_SCROLL_PIXEL)).toLong()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mTimer == <span class="keyword">null</span>) &#123;</span><br><span class="line">        startTimer()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é¡µé¢é€‰ä¸­</strong>æ˜¯æ ¹æ®PagerSnapHelperä¸­æä¾›çš„findSnapViewæ–¹æ³•ï¼Œå…ˆæ‰¾åˆ°Snapï¼ˆå°±æ˜¯å½“å‰çš„ç›®æ ‡Viewï¼‰ï¼Œå†æ‰¾å®ƒçš„ä½ç½®ï¼Œå½“ç„¶è¿˜éœ€ç”¨ä¸€ä¸ªå˜é‡è®°å½•ä¸€ä¸‹ï¼Œé˜²æ­¢å¤šæ¬¡è§¦å‘å›è°ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§¦å‘OnPageSelectedå›è°ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> fun <span class="title">triggerOnPageSelected</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    val layoutManager = getLinearLayoutManager()</span><br><span class="line">    val view = mSnapHelper.findSnapView(layoutManager)</span><br><span class="line">    <span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</span><br><span class="line">        val position = layoutManager.getPosition(view)</span><br><span class="line">        <span class="comment">//é˜²æ­¢åŒä¸€ä½ç½®å¤šæ¬¡è§¦å‘</span></span><br><span class="line">        <span class="keyword">if</span> (position != mOldPosition) &#123;</span><br><span class="line">            mOldPosition = position</span><br><span class="line">            mPageChangeListener?.onPageSelected(position)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªå€¼å¾—è¯´é“çš„ç‚¹æ˜¯åˆå§‹åŒ–æ—¶éœ€è¦çŸ«æ­£<strong>Snap</strong>çš„ä½ç½®ï¼Œå› ä¸º<strong>PagerSnapHelper</strong>æ‰‹æŒ‡æ»‘åŠ¨çš„æ—¶å€™æ‰å·¥ä½œè®©RecyclerViewæ»‘åŠ¨å‡ºViewPagerçš„æ„Ÿè§‰ï¼Œæ‰€ä»¥åˆå§‹åŒ–æ—¶ä¸çŸ«æ­£ä¼šå‘ç°é€‰ä¸­çš„é¡µé¢ä¸å±…ä¸­æ˜¾ç¤ºï¼Œè¿˜æ˜¯ä¸€ä¸ªRecyclerViewçš„æ ·å­ã€‚é‚£å¦‚ä½•çŸ«æ­£å‘¢ï¼Ÿè¿™é‡Œå»çœ‹äº†<strong>PagerSnapHelper</strong>å®ç°ï¼Œæ¬è¿‡æ¥ï¼Œç¨åŠ ä¿®æ”¹å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çŸ«æ­£é¦–æ¬¡åˆå§‹åŒ–æ—¶SnapViewçš„ä½ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> fun <span class="title">correctSnapViewPosition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    val layoutManager = getLinearLayoutManager()</span><br><span class="line">    val snapView = mSnapHelper.findSnapView(layoutManager)</span><br><span class="line">    <span class="keyword">if</span> (snapView != <span class="keyword">null</span>) &#123;</span><br><span class="line">        val snapDistance = mSnapHelper.calculateDistanceToFinalSnap(layoutManager, snapView)</span><br><span class="line">        <span class="keyword">if</span> (snapDistance != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (snapDistance[<span class="number">0</span>] != <span class="number">0</span> || snapDistance[<span class="number">1</span>] != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//æˆ‘ä»¬æŠŠæºç çš„smoothScrollByæ”¹ä¸ºscrollByï¼Œè¿™æ ·è§†è§‰ä¸Šè§‰å¯Ÿä¸å‡ºçŸ«æ­£è¿‡ç¨‹</span></span><br><span class="line">                scrollBy(snapDistance[<span class="number">0</span>], snapDistance[<span class="number">1</span>])</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//é¦–æ¬¡è§¦å‘å›è°ƒ</span></span><br><span class="line">            triggerOnPageSelected()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿™æ˜¯æºç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">snapToTargetExistingView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.mRecyclerView != <span class="keyword">null</span>) &#123;</span><br><span class="line">        LayoutManager layoutManager = <span class="keyword">this</span>.mRecyclerView.getLayoutManager();</span><br><span class="line">        <span class="keyword">if</span> (layoutManager != <span class="keyword">null</span>) &#123;</span><br><span class="line">            View snapView = <span class="keyword">this</span>.findSnapView(layoutManager);</span><br><span class="line">            <span class="keyword">if</span> (snapView != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span>[] snapDistance = <span class="keyword">this</span>.calculateDistanceToFinalSnap(layoutManager, snapView);</span><br><span class="line">                <span class="keyword">if</span> (snapDistance[<span class="number">0</span>] != <span class="number">0</span> || snapDistance[<span class="number">1</span>] != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.mRecyclerView.smoothScrollBy(snapDistance[<span class="number">0</span>], snapDistance[<span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ˜¯æˆ‘è®¤ä¸ºPagerRecyclerViewè¾ƒä¸ºå…³é”®çš„ç‚¹ï¼Œå…¶å®ƒéƒ¨åˆ†å‡ä¸ºä¸šåŠ¡é€»è¾‘çš„å¤„ç†ä¸å®ç°ï¼Œå¤§å®¶å¯æ‰“å¼€æºç è‡ªè¡Œé£Ÿç”¨ã€‚</p><h2 id="PagerViewFactory"><a href="#PagerViewFactory" class="headerlink" title="PagerViewFactory"></a>PagerViewFactory</h2><p>è¿™é‡Œé‡‡ç”¨äº†<strong>å·¥å‚æ–¹æ³•æ¨¡å¼</strong>æ¥åˆ›å»ºBanneråº•å±‚çš„æ ¸å¿ƒå®ç°ã€‚</p><p>é¦–å…ˆå®šä¹‰äº†BannerViewå®ä¾‹æ¥å£ï¼Œå®ƒå°†ä½œä¸ºå·¥å‚å®ä¾‹çš„æ„é€ æ–¹æ³•å‚æ•°ï¼Œç”¨äºåŒºåˆ†åˆ›å»ºåº•å±‚å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IBannerViewBase</span> </span>&#123;</span><br><span class="line">    <span class="function">fun <span class="title">getCount</span><span class="params">()</span>: Int</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    fun <span class="title">getItemView</span><span class="params">(context: Context)</span>: View</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    fun <span class="title">onBindView</span><span class="params">(itemView: View, position: Int)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment"> * å®šä¹‰BannerViewå®ä¾‹æ¥å£</span></span></span><br><span class="line"><span class="function"><span class="comment"> */</span></span></span><br><span class="line"><span class="function">interface IBannerViewInstance : IBannerViewBase </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">fun <span class="title">getContext</span><span class="params">()</span>: Context</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    fun <span class="title">isSmoothMode</span><span class="params">()</span>: Boolean</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    fun <span class="title">getItemViewWidth</span><span class="params">()</span>: Int</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    fun <span class="title">getItemViewMargin</span><span class="params">()</span>: Int</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    fun <span class="title">getItemViewAlign</span><span class="params">()</span>: Int</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p>å·¥å‚æœ‰ä¸ªgetPagerView()çš„æ–¹æ³•ï¼Œæ¥åˆ›å»ºBanneræ ¸å¿ƒå®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å·¥å‚æ ¹æ®å‚æ•°åˆ›å»ºå¯¹åº”PagerViewå®ä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">override fun <span class="title">getPagerView</span><span class="params">()</span>: IPagerViewInstance </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (bannerView.isSmoothMode()) &#123;</span><br><span class="line">        casePagerRecycler(<span class="keyword">true</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (intervalUseViewPager) &#123;</span><br><span class="line">            <span class="comment">//è¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦ç”¨ViewPageråšåº•å±‚å®ç°</span></span><br><span class="line">            <span class="keyword">throw</span> IllegalStateException(<span class="string">"è¿™é‡Œæœªä½¿ç”¨ViewPageråšåº•å±‚å®ç°"</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            casePagerRecycler(<span class="keyword">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯åˆ›å»ºäº†ä¹‹å‰å†™å¥½çš„PagerRecyclerViewï¼Œå…¶å®å°±æ˜¯åˆ›å»ºé…ç½®ä½¿ç”¨ä¸€ä¸ªRecyclerViewçš„è¿‡ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†PagerRecyclerView</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> fun <span class="title">casePagerRecycler</span><span class="params">(isSmoothMode: Boolean)</span>: IPagerViewInstance </span>&#123;</span><br><span class="line">    val recyclerView = PagerRecyclerView(bannerView.getContext())</span><br><span class="line">    recyclerView.layoutManager = LinearLayoutManager(bannerView.getContext(), LinearLayoutManager.HORIZONTAL, <span class="keyword">false</span>)</span><br><span class="line">    recyclerView.adapter = object : RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;() &#123;</span><br><span class="line">        <span class="function">override fun <span class="title">getItemCount</span><span class="params">()</span>: Int </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Int.MAX_VALUE</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">override fun <span class="title">onBindViewHolder</span><span class="params">(holder: RecyclerView.ViewHolder, position: Int)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!isActivityDestroyed(holder.itemView.context)) &#123;</span><br><span class="line">                val realPos = position % bannerView.getCount()</span><br><span class="line">                bannerView.onBindView(holder.itemView.findViewById(R.id.id_real_item_view), realPos)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">override fun <span class="title">onCreateViewHolder</span><span class="params">(parent: ViewGroup, viewType: Int)</span>: RecyclerView.ViewHolder </span>&#123;</span><br><span class="line">            val itemWrapper = LayoutInflater.from(parent.context).inflate(</span><br><span class="line">                R.layout.layout_banner_item_wrapper,</span><br><span class="line">                parent,</span><br><span class="line">                <span class="keyword">false</span></span><br><span class="line">            ) as RelativeLayout</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å¤„ç†ItemViewWrapperçš„å®½</span></span><br><span class="line">            itemWrapper.layoutParams.width = bannerView.getItemViewWidth() + bannerView.getItemViewMargin()</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å¤–éƒ¨å®é™…çš„ItemView</span></span><br><span class="line">            val itemView = bannerView.getItemView(parent.context)</span><br><span class="line">            itemView.id = R.id.id_real_item_view</span><br><span class="line">            val ivParams = RelativeLayout.LayoutParams(</span><br><span class="line">                bannerView.getItemViewWidth(),</span><br><span class="line">                ViewGroup.LayoutParams.MATCH_PARENT</span><br><span class="line">            )</span><br><span class="line">            ivParams.addRule(bannerView.getItemViewAlign())</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ·»åŠ ItemViewåˆ°Wrapper</span></span><br><span class="line">            itemWrapper.addView(itemView, ivParams)</span><br><span class="line">            <span class="keyword">return</span> object : RecyclerView.ViewHolder(itemWrapper) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–ä½ç½®</span></span><br><span class="line">    recyclerView.scrollToPosition(bannerView.getCount() * <span class="number">100</span>)</span><br><span class="line">    recyclerView.setSmoothMode(isSmoothMode)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> recyclerView</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Indicatorçš„è§£è€¦å®ç°"><a href="#Indicatorçš„è§£è€¦å®ç°" class="headerlink" title="Indicatorçš„è§£è€¦å®ç°"></a>Indicatorçš„è§£è€¦å®ç°</h2><p>è§£è€¦çš„æƒ¯ç”¨å¥—è·¯å°±æ˜¯æŠ½è±¡æ–¹æ³•å®šä¹‰æ¥å£ã€‚æ‰€ä»¥æˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ˜¯<strong>æŒ‡ç¤ºå™¨å®ä¾‹éœ€å®ç°çš„æ¥å£</strong>ï¼Œä¸€ä¸ªæ˜¯<strong>æŒ‡ç¤ºå™¨ä¾èµ–çš„å¤–éƒ¨å®ç°</strong>ã€‚æ‰€ä»¥ä½¿ç”¨è¿™ä¸¤ä¸ªæ¥å£ï¼Œå¯ä»¥è‡ªå®šä¹‰å®ç°æƒ³è¦çš„æ ·å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŒ‡ç¤ºå™¨å®ä¾‹éœ€å®ç°çš„æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IIndicatorInstance</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®å¤–éƒ¨å®ç°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">fun <span class="title">setIndicator</span><span class="params">(impl: IIndicator)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment">     * é‡æ–°å¸ƒå±€</span></span></span><br><span class="line"><span class="function"><span class="comment">     */</span></span></span><br><span class="line"><span class="function">    fun <span class="title">doRequestLayout</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment">     * é‡æ–°ç»˜åˆ¶</span></span></span><br><span class="line"><span class="function"><span class="comment">     */</span></span></span><br><span class="line"><span class="function">    fun <span class="title">doInvalidate</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment"> * æŒ‡ç¤ºå™¨ä¾èµ–çš„å¤–éƒ¨å®ç°</span></span></span><br><span class="line"><span class="function"><span class="comment"> */</span></span></span><br><span class="line"><span class="function">interface IIndicator </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–adapteræ€»æ•°ç›®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">fun <span class="title">getCount</span><span class="params">()</span>: Int</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment">     * è·å–å½“å‰é€‰ä¸­é¡µé¢çš„ç´¢å¼•</span></span></span><br><span class="line"><span class="function"><span class="comment">     */</span></span></span><br><span class="line"><span class="function">    fun <span class="title">getCurrentIndex</span><span class="params">()</span>: Int</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p>å¯¹äºæˆ‘ä»¬è¿™æ¬¡å®ç°çš„CrossBarIndicatorï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå¸¸è§„çš„è‡ªå®šä¹‰Viewï¼Œè¿™é‡Œå·²æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„å•¦ã€‚é‡ç‚¹è¦è¯´çš„æ˜¯éœ€æ±‚ä¸­æœ‰<strong>ä¸€æ¡ä¸”èƒ½çµæ´»æ§åˆ¶æŒ‡ç¤ºå™¨ä½ç½®</strong>ï¼Œå¦‚ä½•å®ç°å‘¢ï¼Ÿéœ€æ±‚åˆ†ææ—¶è¯´äº†ï¼Œæˆ‘ä»¬çš„BannerViewæ˜¯ä¸€ä¸ªRelativeLayoutï¼ŒIndicatorä½œä¸ºå…¶å­Viewå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ§åˆ¶å…¶ä½ç½®ã€‚</p><p>ç„¶åï¼Œçœ‹ä¸‹BannerViewä¸­çš„å…³é”®ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">override fun <span class="title">onFinishInflate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onFinishInflate()</span><br><span class="line">    findIndicator()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åœ¨å­Viewä¸­æ‰¾åˆ°æŒ‡ç¤ºå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> fun <span class="title">findIndicator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (i in <span class="number">0</span> until childCount) &#123;</span><br><span class="line">        val child = getChildAt(i)</span><br><span class="line">        <span class="keyword">if</span> (child is IIndicatorInstance) &#123;</span><br><span class="line">            <span class="comment">//å¸ƒå±€å¡«å……å®Œæ¯•æ—¶ï¼Œæ‰¾åˆ°å­Viewä¸­çš„Indicatorï¼Œå¹¶ä¿å­˜ä¸‹æ¥</span></span><br><span class="line">            mIndicator = child</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–view</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> fun <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mBannerViewImpl != <span class="keyword">null</span> &amp;&amp; mWidth &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        val bvImpl = mBannerViewImpl!!</span><br><span class="line">        removeAllViews()</span><br><span class="line"></span><br><span class="line">        ... çœç•¥ä»£ç </span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–æŒ‡ç¤ºå™¨</span></span><br><span class="line">        <span class="keyword">if</span> (mIndicator != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mIndicator?.setIndicator(object : IIndicator &#123;</span><br><span class="line"></span><br><span class="line">                <span class="function">override fun <span class="title">getCount</span><span class="params">()</span>: Int </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> bvImpl.getCount()</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="function">override fun <span class="title">getCurrentIndex</span><span class="params">()</span>: Int </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> mPagerViewInstance.getRealCurrentPosition(bvImpl.getCount())</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">//æŠŠæŒ‡ç¤ºå™¨å†æ·»åŠ å›å»</span></span><br><span class="line">            addView(mIndicator as View)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ–‡æœ«"><a href="#æ–‡æœ«" class="headerlink" title="æ–‡æœ«"></a>æ–‡æœ«</h2><p>åˆ°è¿™é‡Œæ•´ä½“è¦è¯´çš„å°±å®Œç»“äº†ï¼Œæ•´ä¸ªBannerViewçš„å®ç°ç»†èŠ‚ã€é€»è¾‘è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œä¸è¿‡å¤æ‚åº¦å€’æ²¡é‚£ä¹ˆé«˜ï¼Œå»ºè®®é£Ÿç”¨æºç ~ O(âˆ©_âˆ©)Oå“ˆå“ˆ~</p><p><strong>ä¸ªäººèƒ½åŠ›æœ‰é™ï¼Œå¦‚æœ‰ä¸æ­£ä¹‹å¤„æ¬¢è¿å¤§å®¶æ‰¹è¯„æŒ‡å‡ºï¼Œæˆ‘ä¼šè™šå¿ƒæ¥å—å¹¶ç¬¬ä¸€æ—¶é—´ä¿®æ”¹ï¼Œä»¥ä¸è¯¯å¯¼å¤§å®¶ã€‚</strong></p><h2 id="æ‹œè¯»çš„æ–‡ç« "><a href="#æ‹œè¯»çš„æ–‡ç« " class="headerlink" title="æ‹œè¯»çš„æ–‡ç« "></a><strong>æ‹œè¯»çš„æ–‡ç« </strong></h2><p>SnapHelperç¡¬æ ¸è®²è§£ï¼š</p><blockquote><p><a href="https://juejin.im/post/5cbe78ae5188250a6b183872" target="_blank" rel="noopener">https://juejin.im/post/5cbe78ae5188250a6b183872</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/640112319204sda.gif&quot; alt&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="View" scheme="https://zhangmiao.cc/categories/Android/View/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="View" scheme="https://zhangmiao.cc/tags/View/"/>
    
      <category term="Banner" scheme="https://zhangmiao.cc/tags/Banner/"/>
    
  </entry>
  
  <entry>
    <title>Android Contextç»†èŠ‚è§£æ</title>
    <link href="https://zhangmiao.cc/posts/b902250c.html"/>
    <id>https://zhangmiao.cc/posts/b902250c.html</id>
    <published>2019-08-19T09:37:48.000Z</published>
    <updated>2019-08-19T09:52:41.768Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Contextåˆ°åº•æ˜¯å•¥ï¼Ÿ"><a href="#Contextåˆ°åº•æ˜¯å•¥ï¼Ÿ" class="headerlink" title="Contextåˆ°åº•æ˜¯å•¥ï¼Ÿ"></a>Contextåˆ°åº•æ˜¯å•¥ï¼Ÿ</h2><p>Context æœ¬èº«æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒçš„å®ç°ç±»ä¸º ContextImplã€‚</p><p>å¦å¤–æœ‰å­ç±» ContextWrapper å’Œ ContextThemeWrapperï¼Œè¿™ä¸¤ä¸ªå­ç±»éƒ½æ˜¯ Context çš„ä»£ç†ç±»ï¼Œä¸»è¦åŒºåˆ«æ˜¯ ContextThemeWrapper æœ‰è‡ªå·±çš„ä¸»é¢˜èµ„æºã€‚</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190819173910.png" alt></p><p>ä¸€ä¸ª Context æ„å‘³ç€ä¸€ä¸ª<strong>åœºæ™¯</strong>ï¼Œä¸€ä¸ªåœºæ™¯å°±æ˜¯æˆ‘ä»¬å’Œè½¯ä»¶è¿›è¡Œ<strong>äº¤äº’çš„ä¸€ä¸ªè¿‡ç¨‹</strong>ã€‚</p><p>ä»å®‰å“ç¨‹åºçš„è§’åº¦æ¥çœ‹ï¼Œå…¶å®ä¸€ä¸ª Activity å°±æ˜¯ä¸€ä¸ª Context ï¼Œä¸€ä¸ª Service ä¹Ÿæ˜¯ä¸€ä¸ª Contextã€‚</p><a id="more"></a><h2 id="Contextæœ‰å•¥ä½œç”¨ï¼Ÿ"><a href="#Contextæœ‰å•¥ä½œç”¨ï¼Ÿ" class="headerlink" title="Contextæœ‰å•¥ä½œç”¨ï¼Ÿ"></a>Contextæœ‰å•¥ä½œç”¨ï¼Ÿ</h2><p>æœ‰å•¥ç”¨ï¼Ÿè¦çœ‹å®ƒèƒ½åšå•¥ï¼Œçœ‹çœ‹ä¸»è¦æä¾›äº†å“ªäº›æ¥å£äº†ã€‚</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190819174053.png" alt></p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190819174212.png" alt></p><p>è¿˜æŒºå¤šçš„ï¼Œçœ‹èµ·æ¥ç®¡å¾—æŒºå¤šï¼Œå››å¤§ç»„ä»¶éƒ½ç®¡ç€ï¼Œåƒä¸ª Application å¤§ç®¡å®¶ã€‚</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190819174304.png" alt></p><h2 id="ä¸€ä¸ªappé‡Œæœ‰å¤šå°‘ä¸ªContextï¼Ÿ"><a href="#ä¸€ä¸ªappé‡Œæœ‰å¤šå°‘ä¸ªContextï¼Ÿ" class="headerlink" title="ä¸€ä¸ªappé‡Œæœ‰å¤šå°‘ä¸ªContextï¼Ÿ"></a>ä¸€ä¸ªappé‡Œæœ‰å¤šå°‘ä¸ªContextï¼Ÿ</h2><p>å‰é¢è¯´å•¦ï¼Œä¸€ä¸ªActivityå°±æ˜¯ä¸€ä¸ªåœºæ™¯ï¼ˆContextï¼‰ï¼Œä¸€ä¸ªServiceä¹Ÿæ˜¯ä¸€ä¸ªåœºæ™¯ï¼Œæ‰€ä»¥ï¼Œåº”ç”¨ç¨‹åºä¸­æœ‰å¤šå°‘ä¸ªActivityæˆ–è€…Serviceå°±ä¼šæœ‰å¤šå°‘ä¸ªContextå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æœ‰å¤šå°‘ä¸ªåœºæ™¯ã€‚</p><h2 id="ContextImplå’ŒContextWrapperæœ‰å•¥åŒºåˆ«ï¼Ÿ"><a href="#ContextImplå’ŒContextWrapperæœ‰å•¥åŒºåˆ«ï¼Ÿ" class="headerlink" title="ContextImplå’ŒContextWrapperæœ‰å•¥åŒºåˆ«ï¼Ÿ"></a>ContextImplå’ŒContextWrapperæœ‰å•¥åŒºåˆ«ï¼Ÿ</h2><p>çœ‹ä¸‹ContextWrapperï¼š</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190819174343.png" alt></p><p>å†çœ‹ä¸‹ContextImplï¼š</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190819174949.png" alt></p><p>æ¯”è¾ƒä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190819174503.png" alt></p><p>ä¸åŒç»„ä»¶åˆ›å»ºContextImplçš„æ–¹å¼ï¼š</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190819174546.png" alt></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190819174608.png" alt></p><p>Contextç›¸å½“äºApplicationçš„å¤§ç®¡å®¶ï¼›</p><p>ContextWrapperã€ContextThemWrapperéƒ½æ˜¯Contextçš„ä»£ç†ç±»ï¼ŒContextImplæ˜¯Contextçš„ä¸»è¦å®ç°ç±»ï¼Œæ˜¯ä¸ªå®åŠ›æ´¾ï¼</p><p>å‚è€ƒ:</p><p><a href="https://juejin.im/post/5c1fab7d5188254eb05fbe48" target="_blank" rel="noopener">https://juejin.im/post/5c1fab7d5188254eb05fbe48</a></p><p><a href="https://juejin.im/post/5865bfa1128fe10057e57c63" target="_blank" rel="noopener">https://juejin.im/post/5865bfa1128fe10057e57c63</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Contextåˆ°åº•æ˜¯å•¥ï¼Ÿ&quot;&gt;&lt;a href=&quot;#Contextåˆ°åº•æ˜¯å•¥ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;Contextåˆ°åº•æ˜¯å•¥ï¼Ÿ&quot;&gt;&lt;/a&gt;Contextåˆ°åº•æ˜¯å•¥ï¼Ÿ&lt;/h2&gt;&lt;p&gt;Context æœ¬èº«æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒçš„å®ç°ç±»ä¸º ContextImplã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–æœ‰å­ç±» ContextWrapper å’Œ ContextThemeWrapperï¼Œè¿™ä¸¤ä¸ªå­ç±»éƒ½æ˜¯ Context çš„ä»£ç†ç±»ï¼Œä¸»è¦åŒºåˆ«æ˜¯ ContextThemeWrapper æœ‰è‡ªå·±çš„ä¸»é¢˜èµ„æºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190819173910.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ª Context æ„å‘³ç€ä¸€ä¸ª&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼Œä¸€ä¸ªåœºæ™¯å°±æ˜¯æˆ‘ä»¬å’Œè½¯ä»¶è¿›è¡Œ&lt;strong&gt;äº¤äº’çš„ä¸€ä¸ªè¿‡ç¨‹&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»å®‰å“ç¨‹åºçš„è§’åº¦æ¥çœ‹ï¼Œå…¶å®ä¸€ä¸ª Activity å°±æ˜¯ä¸€ä¸ª Context ï¼Œä¸€ä¸ª Service ä¹Ÿæ˜¯ä¸€ä¸ª Contextã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="Android Tips" scheme="https://zhangmiao.cc/categories/Android/Android-Tips/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="Android Tips" scheme="https://zhangmiao.cc/tags/Android-Tips/"/>
    
  </entry>
  
  <entry>
    <title>Android ä¸­ä¸œé˜¿æ‹‰ä¼¯è¯­é€‚é…</title>
    <link href="https://zhangmiao.cc/posts/c080be13.html"/>
    <id>https://zhangmiao.cc/posts/c080be13.html</id>
    <published>2019-08-17T13:44:25.000Z</published>
    <updated>2019-08-17T14:08:53.430Z</updated>
    
    <content type="html"><![CDATA[<h3 id="RTL-è¯­è¨€ç”±æ¥"><a href="#RTL-è¯­è¨€ç”±æ¥" class="headerlink" title="RTL è¯­è¨€ç”±æ¥"></a>RTL è¯­è¨€ç”±æ¥</h3><p>RTL æ˜¯ Right-to-left(ä»å³å‘å·¦) çš„ç¼©å†™ã€‚å…¶æ„ä¸ºäººä»¬ä¹¦å†™é˜…è¯»ä¹ æƒ¯æ˜¯ä»å³å‘å·¦ï¼Œæœå·¦ç»§ç»­çš„ï¼Œå¸¸è§çš„ RTL è¯­è¨€æœ‰é˜¿æ‹‰ä¼¯è¯­ï¼Œå¸Œä¼¯æ¥è¯­ç­‰ã€‚</p><p>çœ‹ä¸€ä¸‹å¯¹æ¯”ï¼š</p><table><thead><tr><th align="center">LTR</th><th align="center">RTL</th></tr></thead><tbody><tr><td align="center"><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190817215957.png" alt></td><td align="center"><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190817220045.png" alt></td></tr></tbody></table><p>é‚£ä¹ˆå¯¹äºè¿™ç§ä»å³åˆ°å·¦çš„ä¹ æƒ¯ï¼Œåœ¨ Android å¸ƒå±€ä¸­æœ‰æ²¡æœ‰æ”¯æŒå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯æœ‰çš„ï¼šä» Android 4.2 å³ SDK 17 å¼€å§‹ï¼Œæä¾›äº†å…¨é¢çš„æœ¬åœ°å¸ƒå±€æ”¯æŒï¼Œå…è®¸é•œåƒå¸ƒå±€ï¼Œå¯ä»¥åŒæ—¶æ”¯æŒ RTL å’Œ LTRã€‚</p><a id="more"></a><p>æ¥ä¸‹æ¥æˆ‘å°†ä»‹ç»å¦‚ä½•ä¸€æ­¥ä¸€æ­¥é€‚é…é˜¿æ‹‰ä¼¯è¯­ã€‚</p><h3 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><table><thead><tr><th>name</th><th>desc</th><th>chinese</th></tr></thead><tbody><tr><td>android:layoutDirection</td><td>attribute for setting the direction of a componentâ€™s layout</td><td>è®¾ç½®ç»„ä»¶çš„å¸ƒå±€æ’åˆ—æ–¹å‘</td></tr><tr><td>android:textDirection</td><td>attribute for setting the direction of a componentâ€™s text</td><td>è®¾ç½®ç»„ä»¶çš„æ–‡å­—æ’åˆ—æ–¹å‘</td></tr><tr><td>android:textAlignment</td><td>attribute for setting the alignment of a componentâ€™s text</td><td>è®¾ç½®æ–‡å­—çš„å¯¹é½æ–¹å¼</td></tr><tr><td>getLayoutDirectionFromLocale()</td><td>method for getting the Locale-specified direction</td><td>è·å–æŒ‡å®šåœ°åŒºçš„æƒ¯ç”¨å¸ƒå±€æ–¹å¼</td></tr></tbody></table><h3 id="å‰ææ¡ä»¶"><a href="#å‰ææ¡ä»¶" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h3><p>åœ¨ AndroidManifest.xml æ–‡ä»¶ä¸­ application èŠ‚ç‚¹æ·»åŠ æ”¯æŒä»å³åˆ°å·¦å¸ƒå±€æ–¹å¼ä»£ç </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">"true"</span> &gt;</span></span><br><span class="line">        ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ‡æ¢è¯­è¨€"><a href="#åˆ‡æ¢è¯­è¨€" class="headerlink" title="åˆ‡æ¢è¯­è¨€"></a>åˆ‡æ¢è¯­è¨€</h3><p>ç›¸å…³é“¾æ¥ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F2900023%2Fchange-language-programmatically-in-android" target="_blank" rel="noopener">change-language-programmatically-in-android</a><br> å¯¹åº”å›½å®¶è¯­è¨€ä»£ç : <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F7973023%2Fwhat-is-the-list-of-supported-languages-locales-on-android" target="_blank" rel="noopener">what-is-the-list-of-supported-languages-locales-on-android</a><br> ä¸‹é¢åˆ‡æ¢è¯­è¨€æ–¹å¼ updateConfiguration æ–¹æ³•åœ¨ Api 25 å·²ç»è¿‡æ—¶, æ–°çš„åˆ‡æ¢æ–¹å¼å®ä¾‹ <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FDroidKaigi%2Fconference-app-2017%2Fpull%2F315%2Ffiles" target="_blank" rel="noopener">åœ°å€</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String languageToLoad  = <span class="string">"ar"</span>; <span class="comment">// your language</span></span><br><span class="line">Resources res = getResources(); </span><br><span class="line">DisplayMetrics dm = res.getDisplayMetrics();</span><br><span class="line">Locale locale = <span class="keyword">new</span> Locale(languageToLoad); </span><br><span class="line">Locale.setDefault(locale);</span><br><span class="line">Configuration config = <span class="keyword">new</span> Configuration();</span><br><span class="line">config.locale = locale;</span><br><span class="line">res.updateConfiguration(conf, dm);</span><br></pre></td></tr></table></figure><h3 id="AS-ä¸€é”®é€‚é…"><a href="#AS-ä¸€é”®é€‚é…" class="headerlink" title="AS ä¸€é”®é€‚é…"></a>AS ä¸€é”®é€‚é…</h3><p>AS æ”¯æŒä¸€é”®é€‚é… RTLï¼Œä¸»è¦æ˜¯åœ¨åŸæ¥ Layout ä¸­è®¾ç½® Left å’Œ Right å±æ€§çš„è¡¥å……æ·»åŠ  Start å’Œ End å±æ€§ï¼ˆä½ ä»¬åœ¨å†™å¸ƒå±€çš„æ—¶å€™æ˜¯ä¸æ˜¯å¾ˆå°‘ç”¨åˆ° paddingStartã€marginStartï¼Ÿæ¥ä¸‹æ¥ä½ ä»¬å†™å¸ƒå±€çš„æ—¶å€™å¯ä¸èƒ½å†å·æ‡’äº†ï¼Œè¯¥åŠ çš„è¿˜æ˜¯å¾—åŠ ä¸Š)</p><p>Start å±æ€§åœ¨ LTR ä¸­å¯¹åº” Leftï¼Œåœ¨ RTL ä¸­å¯¹åº” Rightï¼Œåœ¨API 17å¼€å§‹æ”¯æŒï¼Œä¸ºäº†å…¼å®¹ä½ç‰ˆæœ¬ï¼Œéœ€è¦åŒæ—¶æœ‰ Left å’Œ Startã€‚ä»å¸‚åœºæ¥çœ‹ï¼ŒAndroid 4.2 ç³»ç»Ÿä»¥ä¸‹çš„æ‰‹æœºç”¨æˆ·å·²ç»ä¸å¤šäº†ï¼Œæˆ‘çš„å»ºè®®æ˜¯å¯ä»¥ä¸å…¼å®¹ï¼Œå…·ä½“è¿˜å¾—ä½ ä»¬çœ‹è‡ªå®¶äº§å“åœ¨ 4.2 ç³»ç»Ÿä»¥ä¸‹ç”¨æˆ·æ•°ã€‚</p><blockquote><p>Refactor &gt; Add RTL Support Where Possibleâ€¦</p></blockquote><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190817215036.png" alt></p><h3 id="åˆ©ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶"><a href="#åˆ©ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶" class="headerlink" title="åˆ©ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶"></a>åˆ©ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶</h3><table><thead><tr><th align="center">åç§°</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center"><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fznyang%2Fgradle-android-rtl" target="_blank" rel="noopener">gradle-android-rtl</a></td><td align="center">è‡ªåŠ¨ä¿®å¤å¸ƒå±€æ–‡ä»¶ä¸­æœªæ·»åŠ RTLæ”¯æŒçš„æ ‡ç­¾</td></tr></tbody></table><p>ä¸ AS æ’ä»¶çš„æ¯”è¾ƒï¼š</p><ul><li>æ€§èƒ½æ›´å¥½ã€‚åœ¨å¤„ç†å¤§æ‰¹é‡æ–‡ä»¶ä¿®æ”¹æ—¶ï¼Œç”¨ASå·¥å…·ä¼šå‡ºç°å¡é¡¿</li><li>æ”¯æŒpaddingæ ‡ç­¾çš„è¡¥é½</li></ul><h3 id="ä½¿ç”¨å…¨å±€æ ·å¼"><a href="#ä½¿ç”¨å…¨å±€æ ·å¼" class="headerlink" title="ä½¿ç”¨å…¨å±€æ ·å¼"></a>ä½¿ç”¨å…¨å±€æ ·å¼</h3><h4 id="EditText"><a href="#EditText" class="headerlink" title="EditText"></a>EditText</h4><p>å‘ç° EditText æ§ä»¶åŸºæœ¬éƒ½éœ€è¦è®¾ç½®ä¸‹é¢ä¸¤ä¸ªå±æ€§<br> ç›¸å…³é“¾æ¥ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F10903647%2Fset-a-consistent-style-to-all-edittext-for-e-g" target="_blank" rel="noopener">set-a-consistent-style-to-all-edittext-for-e-g</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android:textAlignment="viewStart"</span><br><span class="line">android:gravity="start"</span><br></pre></td></tr></table></figure><p>é‚£æˆ‘ä»¬å°±å¯ä»¥åœ¨ style.xml æ ·å¼ä¸­å…¨éƒ¨ EditText éƒ½è®¾ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">       ...</span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"editTextStyle"</span>&gt;</span>@style/EditTextStyle.Alignment<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined">       ...</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"EditTextStyle.Alignment"</span> <span class="attr">parent</span>=<span class="string">"@android:style/Widget.EditText"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textAlignment"</span>&gt;</span>viewStart<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:gravity"</span>&gt;</span>start<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textDirection"</span>&gt;</span>locale<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="TextView"><a href="#TextView" class="headerlink" title="TextView"></a>TextView</h4><p>å…¨å±€ç»™æ‰€æœ‰ TextView æ·»åŠ ä¸€ä¸ª RTL å±æ€§<br> ç›¸å…³é“¾æ¥:<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F3078081%2Fsetting-global-styles-for-views-in-android" target="_blank" rel="noopener">setting-global-styles-for-views-in-android</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">       ...</span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textViewStyle"</span>&gt;</span>@style/TextViewStyle.TextDirection<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined">       ...</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"TextViewStyle.TextDirection"</span> <span class="attr">parent</span>=<span class="string">"android:Widget.TextView"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textDirection"</span>&gt;</span>locale<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­æ˜¯å¦æ˜¯-RTL-å¸ƒå±€"><a href="#åˆ¤æ–­æ˜¯å¦æ˜¯-RTL-å¸ƒå±€" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æ˜¯ RTL å¸ƒå±€"></a>åˆ¤æ–­æ˜¯å¦æ˜¯ RTL å¸ƒå±€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TextUtilsCompat.getLayoutDirectionFromLocale(Locale.getDefault()) == LayoutDirection.RTL</span><br></pre></td></tr></table></figure><h3 id="å¯¹é›†åˆè¿›è¡Œå€’åºå¤„ç†"><a href="#å¯¹é›†åˆè¿›è¡Œå€’åºå¤„ç†" class="headerlink" title="å¯¹é›†åˆè¿›è¡Œå€’åºå¤„ç†"></a>å¯¹é›†åˆè¿›è¡Œå€’åºå¤„ç†</h3><p>åœ¨æŸäº›åœºåˆä¸‹, è¿™ä¸ªæ–¹æ³•å¾ˆæœ‰ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Collections.reverse(List&lt;?&gt; list);</span><br></pre></td></tr></table></figure><h3 id="ä»£ç åŠ¨æ€è®¾ç½®æ§ä»¶-setMargins"><a href="#ä»£ç åŠ¨æ€è®¾ç½®æ§ä»¶-setMargins" class="headerlink" title="ä»£ç åŠ¨æ€è®¾ç½®æ§ä»¶ setMargins"></a>ä»£ç åŠ¨æ€è®¾ç½®æ§ä»¶ setMargins</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FrameLayout.LayoutParams params = <span class="keyword">new</span> FrameLayout.LayoutParams(</span><br><span class="line">                ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT);</span><br><span class="line">params.setMargins(<span class="number">10</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>);</span><br><span class="line">params.setMarginEnd(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><h3 id="ViewPager"><a href="#ViewPager" class="headerlink" title="ViewPager"></a>ViewPager</h3><p>ç›¸å…³é“¾æ¥: <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F37196714%2Ftabs-swipe-direction-in-right-to-left-android-app" target="_blank" rel="noopener">tabs-swipe-direction-in-right-to-left-android-app</a></p><blockquote><p>Android å®˜æ–¹æ§ä»¶å¤§å¤šæ”¯æŒ RTLï¼ŒViewPager é™¤å¤–ï¼ŒGitHub ä¸Šé¢æœ‰äººå¯¹ ViewPager è¿›è¡Œä¿®æ”¹æ”¯æŒ RTL, <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fdiego-gomez-olvera%2FRtlViewPager" target="_blank" rel="noopener">åœ°å€</a></p></blockquote><h3 id="é€‚é…æ€»ç»“"><a href="#é€‚é…æ€»ç»“" class="headerlink" title="é€‚é…æ€»ç»“"></a>é€‚é…æ€»ç»“</h3><ol><li>æ¨ªå‘å¸ƒå±€ LinearLayout ï¼Œå¯ä»¥ä½¿ç”¨ FrameLayoutï¼Œæ§ä»¶éœ€è¦é å·¦æˆ–é å³å¯ä»¥ä½¿ç”¨ layout_gravity è®¾ç½®å¯¹åº”å±æ€§</li><li>åˆ‡æ¢é˜¿æ‹‰ä¼¯è¯­æ—¶ï¼Œç½‘æ ¼å¸ƒå±€ item ä¹‹é—´çš„è·ç¦»ä¼šå‡ºç°å¢å¤§é—®é¢˜ï¼Œå¤„ç†æ–¹æ³•æ˜¯ï¼šç½‘æ ¼åˆ†å‰²çº¿ ItemDecoration éœ€è¦åŠ å…¥è¯­è¨€æ¥åˆ¤æ–­ï¼Œè°ƒæ¢åŸæ¥è®¾ç½®å·¦å³çš„è¾¹è·å³å¯</li><li>ç¦æ­¢æ‰ä¹‹å‰çš„ä¾§æ»‘è¿”å›ï¼Œä»¥å…å‡ºç°å†²çª</li><li>ä¸€äº›æ–¹å‘å›¾æ ‡ï¼Œé‡æ–°åšä¸€ä¸ªç›¸å¯¹æ–¹å‘çš„æ”¾åˆ° mipmap-ldrtl-xxxhdpi åŒ…ä¸‹</li><li>åŠ¨ç”»ç¿»è½¬, æ”¾åœ¨ anim-ldrtl å°†å¯¹åº”çš„åŠ¨ç”»è¿›è¡Œåå‘å¤„ç†</li><li>å¸ƒå±€é‡Œå¦‚æœè®¾ç½®äº† paddingLeftã€drawableLeft ç­‰ç­‰è¿™äº›å±æ€§æ›´æ”¹ä¸ºä¸€ä¸ªæ”¯æŒ RTL çš„å±æ€§ paddingStartã€drawableStartï¼›ä½†æ˜¯æœ‰äº›åœ°æ–¹å¯ä»¥ä¸åŠ çš„ï¼Œä¾‹å¦‚ï¼šè´­ç‰©è½¦ä¸Šçš„æ•°é‡å¾½ç« ï¼ŒåŠ äº†ä¹‹åæ„Ÿè§‰æ€ªæ€ªçš„ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¸åŠ äº†</li><li>åˆ©ç”¨åœ¨ AS å³è¾¹çš„é¢„è§ˆå¸ƒå±€å·¥å…·ä¸­çš„è¯­è¨€åˆ‡æ¢å·¥å…·ï¼Œåˆ‡æ¢æˆé˜¿æ‹‰ä¼¯è¯­ï¼Œèƒ½å®æ—¶çœ‹åˆ°å¸ƒå±€çš„æ•ˆæœå›¾</li><li>EditText æ·»åŠ  android:layoutDirection=â€localeâ€ ï¼Œå¦‚æœå¤–é¢æœ‰ TextInputLayout çš„éœ€ç»™å®ƒè®¾ç½® android:textDirection=â€localeâ€ ï¼Œå¦‚æœè¾“å…¥ç±»å‹æ—¶å¯†ç æ—¶è¿˜éœ€æ·»åŠ ä¸€ä¸ªå±æ€§ android:textAlignment=â€viewStartâ€</li><li>TextView éœ€è¦åŠ ä¸Š android:textAlignment=â€viewStart æˆ– viewEndâ€ ä»¥åŠ android:textDirection=â€localeâ€</li><li>RecyclerView ç½‘ç»œå¸ƒå±€çš„å¯ä»¥è€ƒè™‘ä½¿ç”¨ StaggeredGridLayoutManager ï¼Œå¦‚æœæ•°é‡å¤ªå¤šçš„ç½‘æ ¼å¸ƒå±€ï¼Œä¸å¤ªå»ºè®®ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå‡ºç°æ»‘åŠ¨æ··ä¹±</li><li>é˜¿æ‹‰ä¼¯è¯­ç›®å½•ä¸‹çš„ String.xml æ–‡ä»¶, å‡ºç°å ä½ç¬¦ d% éœ€è¦æ³¨æ„æ”¹ä¸º %d, ä½†åˆå¹¶ä¸æ˜¯æ‰€æœ‰éƒ½æ”¹æˆè¿™æ ·, ç›®å‰æˆ‘å‘ç°å½“ä»£ç ä¸­ä½¿ç”¨äº† Toast å’Œ SpannableString å±æ€§çš„å°±éœ€è¦æ›´æ”¹ä¸º %d</li></ol><h3 id="å»ºè®®è®¡åˆ’"><a href="#å»ºè®®è®¡åˆ’" class="headerlink" title="å»ºè®®è®¡åˆ’"></a>å»ºè®®è®¡åˆ’</h3><ol><li>ä»åŸºç¡€ç±»å¼€å§‹å…¥æ‰‹ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯é˜¿æ‹‰ä¼¯è¯­ï¼Œå¦‚æœæ˜¯éœ€è¦å°†ç•Œé¢è®¾ç½®ä¸ºä»å³åˆ°å·¦çš„æ˜¾ç¤ºæ–¹å¼</li><li>åˆ†æ¨¡å—è¿›è¡Œé€‚é…</li><li>å¤æ‚çš„æ¨¡å—ï¼Œå¯ä»¥æ”¾åˆ° layout-ldrtl åŒ…ä¸‹ï¼Œå•ç‹¬åšä¸€ä¸ªå¸ƒå±€æ¥é€‚é…é˜¿æ‹‰ä¼¯è¯­ï¼Œä¾‹å¦‚è¯¦æƒ…é¡µ</li></ol><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fandroid-developers.googleblog.com%2F2013%2F03%2Fnative-rtl-support-in-android-42.html" target="_blank" rel="noopener">https://android-developers.googleblog.com/2013/03/native-rtl-support-in-android-42.html</a></li><li><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fmedium.com%2F%40zhangqichuan%2Frtl-support-in-android-898e11f31561" target="_blank" rel="noopener">https://medium.com/@zhangqichuan/rtl-support-in-android-898e11f31561</a></li><li><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fmobikul.com%2Fjust-few-steps-to-make-your-app-rtl-supportable%2F" target="_blank" rel="noopener">https://mobikul.com/just-few-steps-to-make-your-app-rtl-supportable/</a></li><li><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.robustastudio.com%2Ffeatured%2Fandroid-rtl-support%2F" target="_blank" rel="noopener">https://blog.robustastudio.com/featured/android-rtl-support/</a></li><li><a href="https://links.jianshu.com/go?to=http%3A%2F%2Fblog.csdn.net%2Ffigo0423%2Farticle%2Fdetails%2F50241363" target="_blank" rel="noopener">http://blog.csdn.net/figo0423/article/details/50241363</a></li><li><a href="https://links.jianshu.com/go?to=http%3A%2F%2Fblog.csdn.net%2Fwxx614817%2Farticle%2Fdetails%2F50586388" target="_blank" rel="noopener">http://blog.csdn.net/wxx614817/article/details/50586388</a></li><li><a href="https://links.jianshu.com/go?to=http%3A%2F%2Fjiajixin.cn%2F2016%2F10%2F08%2Fandroid_adapt_rtl%2F" target="_blank" rel="noopener">http://jiajixin.cn/2016/10/08/android_adapt_rtl/</a></li><li><a href="https://links.jianshu.com/go?to=http%3A%2F%2Fwww.apkbus.com%2Fblog-327085-57866.html" target="_blank" rel="noopener">http://www.apkbus.com/blog-327085-57866.html</a></li><li><a href="https://links.jianshu.com/go?to=http%3A%2F%2Fdroidyue.com%2Fblog%2F2014%2F07%2F07%2Fsupport-rtl-in-android%2Findex.html" target="_blank" rel="noopener">http://droidyue.com/blog/2014/07/07/support-rtl-in-android/index.html</a></li><li><a href="https://links.jianshu.com/go?to=http%3A%2F%2Fchuansong.me%2Fn%2F920084451521" target="_blank" rel="noopener">http://chuansong.me/n/920084451521</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;RTL-è¯­è¨€ç”±æ¥&quot;&gt;&lt;a href=&quot;#RTL-è¯­è¨€ç”±æ¥&quot; class=&quot;headerlink&quot; title=&quot;RTL è¯­è¨€ç”±æ¥&quot;&gt;&lt;/a&gt;RTL è¯­è¨€ç”±æ¥&lt;/h3&gt;&lt;p&gt;RTL æ˜¯ Right-to-left(ä»å³å‘å·¦) çš„ç¼©å†™ã€‚å…¶æ„ä¸ºäººä»¬ä¹¦å†™é˜…è¯»ä¹ æƒ¯æ˜¯ä»å³å‘å·¦ï¼Œæœå·¦ç»§ç»­çš„ï¼Œå¸¸è§çš„ RTL è¯­è¨€æœ‰é˜¿æ‹‰ä¼¯è¯­ï¼Œå¸Œä¼¯æ¥è¯­ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹ä¸€ä¸‹å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;LTR&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;RTL&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190817215957.png&quot; alt&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190817220045.png&quot; alt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;é‚£ä¹ˆå¯¹äºè¿™ç§ä»å³åˆ°å·¦çš„ä¹ æƒ¯ï¼Œåœ¨ Android å¸ƒå±€ä¸­æœ‰æ²¡æœ‰æ”¯æŒå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç­”æ¡ˆæ˜¯æœ‰çš„ï¼šä» Android 4.2 å³ SDK 17 å¼€å§‹ï¼Œæä¾›äº†å…¨é¢çš„æœ¬åœ°å¸ƒå±€æ”¯æŒï¼Œå…è®¸é•œåƒå¸ƒå±€ï¼Œå¯ä»¥åŒæ—¶æ”¯æŒ RTL å’Œ LTRã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="Android Tips" scheme="https://zhangmiao.cc/categories/Android/Android-Tips/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="é˜¿æ‹‰ä¼¯è¯­" scheme="https://zhangmiao.cc/tags/%E9%98%BF%E6%8B%89%E4%BC%AF%E8%AF%AD/"/>
    
  </entry>
  
  <entry>
    <title>è½»é‡çº§å­˜å‚¨æ¡†æ¶MMKV</title>
    <link href="https://zhangmiao.cc/posts/4770b281.html"/>
    <id>https://zhangmiao.cc/posts/4770b281.html</id>
    <published>2019-08-17T13:14:35.000Z</published>
    <updated>2019-08-17T14:21:21.931Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h2><p>APP çš„æ€§èƒ½ä¼˜åŒ–ä¹‹è·¯æ˜¯æ°¸æ— æ­¢å¢ƒçš„, è¿™é‡Œå­¦ä¹ ä¸€ä¸ª<strong>è…¾è®¯å¼€æºç”¨äºæå‡æœ¬åœ°å­˜å‚¨æ•ˆç‡çš„è½»é‡çº§å­˜å‚¨æ¡†æ¶</strong> <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FTencent%2FMMKV" target="_blank" rel="noopener">MMKV</a></p><p>ç›®å‰é¡¹ç›®ä¸­åœ¨è½»é‡çº§å­˜å‚¨ä¸Šä½¿ç”¨çš„æ˜¯ SharedPreferences, è™½ç„¶ SP å…¼å®¹æ€§æå¥½, ä½† SP çš„ä½æ€§èƒ½ä¸€ç›´è¢«è¯Ÿç—…, çº¿ä¸Šä¹Ÿå‡ºç°äº†ä¸€äº›å› ä¸º SP å¯¼è‡´çš„ ANR</p><p>ç½‘ä¸Šæœ‰å¾ˆå¤šé’ˆå¯¹ SP çš„ä¼˜åŒ–æ–¹æ¡ˆ, è¿™é‡Œç¬”è€…ä½¿ç”¨çš„æ˜¯é€šè¿‡ Hook SP åœ¨ Application ä¸­çš„åˆ›å»º, å°†å…¶æ›¿æ¢æˆè‡ªå®šä¹‰çš„ SP çš„æ–¹å¼æ¥å¢å¼ºæ€§èƒ½, ä½† SDK 28 ä»¥åç¦æ­¢åå°„ QueuedWork.getHandler æ¥å£, è¿™ä¸ªæ–¹å¼å°±å¤±æ•ˆäº†</p><p>å› æ­¤éœ€è¦ä¸€ç§æ›¿ä»£çš„è½»é‡çº§å­˜å‚¨æ–¹æ¡ˆ, MMKV ä¾¿æ˜¯è¿™æ ·çš„ä¸€ä¸ªæ¡†æ¶</p><h2 id="äºŒã€é›†æˆä¸æµ‹è¯•"><a href="#äºŒã€é›†æˆä¸æµ‹è¯•" class="headerlink" title="äºŒã€é›†æˆä¸æµ‹è¯•"></a>äºŒã€é›†æˆä¸æµ‹è¯•</h2><p>ä»¥ä¸‹ä»‹ç»ç®€å•çš„ä½¿ç”¨æ–¹å¼, æ›´å¤šè¯¦æƒ…è¯·æŸ¥çœ‹ <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FTencent%2FMMKV%2Fwiki%2Fandroid_setup_cn" target="_blank" rel="noopener">Wiki</a></p><h3 id="2-1-ä¾èµ–æ³¨å…¥"><a href="#2-1-ä¾èµ–æ³¨å…¥" class="headerlink" title="2.1 ä¾èµ–æ³¨å…¥"></a>2.1 ä¾èµ–æ³¨å…¥</h3><p>åœ¨ App æ¨¡å—çš„ build.gradle æ–‡ä»¶é‡Œæ·»åŠ :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation &apos;com.tencent:mmkv:1.0.22&apos;</span><br><span class="line">    // replace &quot;1.0.22&quot; with any available version</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="2-2-åˆå§‹åŒ–"><a href="#2-2-åˆå§‹åŒ–" class="headerlink" title="2.2 åˆå§‹åŒ–"></a>2.2 åˆå§‹åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®åˆå§‹åŒ–çš„æ ¹ç›®å½•</span></span><br><span class="line">String dir = getFilesDir().getAbsolutePath() + <span class="string">"/mmkv_2"</span>;</span><br><span class="line">String rootDir = MMKV.initialize(dir);</span><br><span class="line">Log.i(<span class="string">"MMKV"</span>, <span class="string">"mmkv root: "</span> + rootDir);</span><br></pre></td></tr></table></figure><h3 id="2-3-è·å–å®ä¾‹"><a href="#2-3-è·å–å®ä¾‹" class="headerlink" title="2.3 è·å–å®ä¾‹"></a>2.3 è·å–å®ä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–é»˜è®¤çš„å…¨å±€å®ä¾‹</span></span><br><span class="line">MMKV kv = MMKV.defaultMMKV();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ®ä¸šåŠ¡åŒºåˆ«å­˜å‚¨, é™„å¸¦ä¸€ä¸ªè‡ªå·±çš„ ID</span></span><br><span class="line">MMKV kv = MMKV.mmkvWithID(<span class="string">"MyID"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šè¿›ç¨‹åŒæ­¥æ”¯æŒ</span></span><br><span class="line">MMKV kv = MMKV.mmkvWithID(<span class="string">"MyID"</span>, MMKV.MULTI_PROCESS_MODE);</span><br></pre></td></tr></table></figure><h3 id="2-4-CURD"><a href="#2-4-CURD" class="headerlink" title="2.4 CURD"></a>2.4 CURD</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ /æ›´æ–°æ•°æ®</span></span><br><span class="line">kv.encode(key, value);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ•°æ®</span></span><br><span class="line"><span class="keyword">int</span> tmp = kv.decodeInt(key);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤æ•°æ®</span></span><br><span class="line">kv.removeValueForKey(key);</span><br></pre></td></tr></table></figure><h3 id="2-5-SP-çš„è¿ç§»"><a href="#2-5-SP-çš„è¿ç§»" class="headerlink" title="2.5 SP çš„è¿ç§»"></a>2.5 SP çš„è¿ç§»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">testImportSharedPreferences</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    MMKV mmkv = MMKV.mmkvWithID(<span class="string">"myData"</span>);</span><br><span class="line">    SharedPreferences old_man = getSharedPreferences(<span class="string">"myData"</span>, MODE_PRIVATE);</span><br><span class="line">    <span class="comment">// è¿ç§»æ—§æ•°æ®</span></span><br><span class="line">    mmkv.importFromSharedPreferences(old_man);</span><br><span class="line">    <span class="comment">// æ¸…ç©ºæ—§æ•°æ®</span></span><br><span class="line">    old_man.edit().clear().commit();</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-6-æ•°æ®æµ‹è¯•"><a href="#2-6-æ•°æ®æµ‹è¯•" class="headerlink" title="2.6 æ•°æ®æµ‹è¯•"></a>2.6 æ•°æ®æµ‹è¯•</h3><p>ä»¥ä¸‹æ˜¯ MMKVã€SharedPreferences å’Œ SQLite åŒæ­¥å†™å…¥ 1000 æ¡æ•°æ®çš„æµ‹è¯•ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MMKV</span></span><br><span class="line">MMKV: MMKV write <span class="keyword">int</span>: loop[<span class="number">1000</span>]: <span class="number">12</span> ms</span><br><span class="line">MMKV: MMKV read <span class="keyword">int</span>: loop[<span class="number">1000</span>]: <span class="number">3</span> ms</span><br><span class="line"></span><br><span class="line">MMKV: MMKV write String: loop[<span class="number">1000</span>]: <span class="number">7</span> ms</span><br><span class="line">MMKV: MMKV read String: loop[<span class="number">1000</span>]: <span class="number">4</span> ms</span><br><span class="line"></span><br><span class="line"><span class="comment">// SharedPreferences</span></span><br><span class="line">MMKV: SharedPreferences write <span class="keyword">int</span>: loop[<span class="number">1000</span>]: <span class="number">119</span> ms</span><br><span class="line">MMKV: SharedPreferences read <span class="keyword">int</span>: loop[<span class="number">1000</span>]: <span class="number">3</span> ms</span><br><span class="line"></span><br><span class="line">MMKV: SharedPreferences write String: loop[<span class="number">1000</span>]: <span class="number">187</span></span><br><span class="line">MMKV: SharedPreferences read String: loop[<span class="number">1000</span>]: <span class="number">2</span> ms</span><br><span class="line"></span><br><span class="line"><span class="comment">// SQLite</span></span><br><span class="line">MMKV: sqlite write <span class="keyword">int</span>: loop[<span class="number">1000</span>]: <span class="number">101</span> ms</span><br><span class="line">MMKV: sqlite read <span class="keyword">int</span>: loop[<span class="number">1000</span>]: <span class="number">136</span> ms</span><br><span class="line"></span><br><span class="line">MMKV: sqlite write String: loop[<span class="number">1000</span>]: <span class="number">29</span> ms</span><br><span class="line">MMKV: sqlite read String: loop[<span class="number">1000</span>]: <span class="number">93</span> ms</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° MMKV æ— è®ºæ˜¯å¯¹æ¯” SP è¿˜æ˜¯ SQLite, åœ¨æ€§èƒ½ä¸Šéƒ½æœ‰éå¸¸å¤§çš„ä¼˜åŠ¿, å®˜æ–¹æä¾›çš„æ•°æ®æµ‹è¯•ç»“æœå¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190817211812.png" alt></p><p>æ›´è¯¦ç»†çš„æ€§èƒ½æµ‹è¯•è§ <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FTencent%2FMMKV%2Fwiki%2Fandroid_benchmark_cn" target="_blank" rel="noopener">wiki</a></p><p>äº†è§£ MMKV çš„ä½¿ç”¨æ–¹å¼å’Œæµ‹è¯•ç»“æœ, è®©æˆ‘å¯¹å…¶å®ç°åŸç†äº§ç”Ÿäº†å¾ˆå¤§çš„å¥½å¥‡å¿ƒ, æ¥ä¸‹æ¥ä¾¿çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å°†æ€§èƒ½åšåˆ°è¿™ä¸ªåœ°æ­¥çš„, è¿™é‡Œå¯¹ä¸»è¦å¯¹ MMKV çš„åŸºæœ¬æ“ä½œè¿›è¡Œå‰–æ</p><ul><li>åˆå§‹åŒ–</li><li>å®ä¾‹åŒ–</li><li>encode</li><li>decode</li><li>è¿›ç¨‹è¯»å†™çš„åŒæ­¥</li></ul><p>æˆ‘ä»¬ä»åˆå§‹åŒ–çš„æµç¨‹å¼€å§‹åˆ†æ</p><h2 id="ä¸‰ã€åˆå§‹åŒ–"><a href="#ä¸‰ã€åˆå§‹åŒ–" class="headerlink" title="ä¸‰ã€åˆå§‹åŒ–"></a>ä¸‰ã€åˆå§‹åŒ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MMKV</span> <span class="keyword">implements</span> <span class="title">SharedPreferences</span>, <span class="title">SharedPreferences</span>.<span class="title">Editor</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// call on program start</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">initialize</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        String root = context.getFilesDir().getAbsolutePath() + <span class="string">"/mmkv"</span>;</span><br><span class="line">        <span class="keyword">return</span> initialize(root, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">private</span> String rootDir = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">initialize</span><span class="params">(String rootDir, LibLoader loader)</span> </span>&#123;</span><br><span class="line">        ...... <span class="comment">// çœç•¥åº“æ–‡ä»¶åŠ è½½å™¨ç›¸å…³ä»£ç </span></span><br><span class="line">        <span class="comment">// ä¿å­˜æ ¹ç›®å½•</span></span><br><span class="line">        MMKV.rootDir = rootDir;</span><br><span class="line">        <span class="comment">// Native å±‚åˆå§‹åŒ–</span></span><br><span class="line">        jniInitialize(MMKV.rootDir);</span><br><span class="line">        <span class="keyword">return</span> rootDir;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">jniInitialize</span><span class="params">(String rootDir)</span></span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MMKV çš„åˆå§‹åŒ–, ä¸»è¦æ˜¯å°†æ ¹ç›®å½•é€šè¿‡ jniInitialize ä¼ å…¥äº† Native å±‚, æ¥ä¸‹æ¥çœ‹çœ‹ Native çš„åˆå§‹åŒ–æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// native-bridge.cpp</span></span><br><span class="line">namespace mmkv &#123;</span><br><span class="line">    </span><br><span class="line"><span class="function">MMKV_JNI <span class="keyword">void</span> <span class="title">jniInitialize</span><span class="params">(JNIEnv *env, jobject obj, jstring rootDir)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!rootDir) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *kstr = env-&gt;GetStringUTFChars(rootDir, nullptr);</span><br><span class="line">    <span class="keyword">if</span> (kstr) &#123;</span><br><span class="line">        MMKV::initializeMMKV(kstr);</span><br><span class="line">        env-&gt;ReleaseStringUTFChars(rootDir, kstr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MMKV.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> unordered_map&lt;std::string, MMKV *&gt; *g_instanceDic;</span><br><span class="line"><span class="keyword">static</span> ThreadLock g_instanceLock;</span><br><span class="line"><span class="keyword">static</span> std::string g_rootDir;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.1 è·å–ä¸€ä¸ª unordered_map, ç±»ä¼¼äº Java ä¸­çš„ HashMap</span></span><br><span class="line">    g_instanceDic = <span class="keyword">new</span> unordered_map&lt;std::string, MMKV *&gt;;</span><br><span class="line">    <span class="comment">// 1.2 åˆå§‹åŒ–çº¿ç¨‹é”</span></span><br><span class="line">    g_instanceLock = ThreadLock();</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> MMKV::initializeMMKV(<span class="keyword">const</span> std::string &amp;rootDir) &#123;</span><br><span class="line">    <span class="comment">// ç”± Linux Thread äº’æ–¥é”å’Œæ¡ä»¶å˜é‡ä¿è¯ initialize å‡½æ•°åœ¨ä¸€ä¸ªè¿›ç¨‹å†…åªä¼šæ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">    <span class="comment">// https://blog.csdn.net/zhangxiao93/article/details/51910043</span></span><br><span class="line">    <span class="keyword">static</span> pthread_once_t once_control = PTHREAD_ONCE_INIT;</span><br><span class="line">    <span class="comment">// 1. è¿›è¡Œåˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">    pthread_once(&amp;once_control, initialize);</span><br><span class="line">    <span class="comment">// 2. å°†æ ¹ç›®å½•ä¿å­˜åˆ°å…¨å±€å˜é‡</span></span><br><span class="line">    g_rootDir = rootDir;</span><br><span class="line">    <span class="comment">// æ‹·è´å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">char</span> *path = strdup(g_rootDir.c_str());</span><br><span class="line">    <span class="keyword">if</span> (path) &#123;</span><br><span class="line">        <span class="comment">// 3. æ ¹æ®è·¯å¾„, ç”Ÿæˆç›®æ ‡åœ°å€çš„ç›®å½•</span></span><br><span class="line">        mkPath(path);</span><br><span class="line">        <span class="comment">// é‡Šæ”¾å†…å­˜</span></span><br><span class="line">        free(path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° initializeMMKV ä¸­ä¸»è¦ä»»åŠ¡æ˜¯åˆå§‹åŒ–æ•°æ®, ä»¥åŠåˆ›å»ºæ ¹ç›®å½•</p><ul><li>pthread_once_t: ç±»ä¼¼äº Java çš„å•ä¾‹, å…¶ initialize æ–¹æ³•åœ¨è¿›ç¨‹å†…åªä¼šæ‰§è¡Œä¸€æ¬¡ <ul><li>åˆ›å»º MMKV å¯¹è±¡çš„ç¼“å­˜æ•£åˆ—è¡¨ g_instanceDic</li><li>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹é” g_instanceLock</li></ul></li><li>mkPath: æ ¹æ®å­—ç¬¦ä¸²åˆ›å»ºæ–‡ä»¶ç›®å½•</li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªç›®å½•åˆ›å»ºçš„è¿‡ç¨‹</p><h3 id="3-1-ç›®å½•çš„åˆ›å»º"><a href="#3-1-ç›®å½•çš„åˆ›å»º" class="headerlink" title="3.1 ç›®å½•çš„åˆ›å»º"></a>3.1 ç›®å½•çš„åˆ›å»º</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MmapedFile.cpp</span></span><br><span class="line"><span class="function">bool <span class="title">mkPath</span><span class="params">(<span class="keyword">char</span> *path)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ stat ç»“æ„ä½“ç”¨äºæè¿°æ–‡ä»¶çš„å±æ€§</span></span><br><span class="line">    struct stat sb = &#123;&#125;;</span><br><span class="line">    bool done = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">// æŒ‡å‘å­—ç¬¦ä¸²èµ·å§‹åœ°å€</span></span><br><span class="line">    <span class="keyword">char</span> *slash = path;</span><br><span class="line">    <span class="keyword">while</span> (!done) &#123;</span><br><span class="line">        <span class="comment">// ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªé "/" çš„ä¸‹æ ‡å¤„</span></span><br><span class="line">        slash += strspn(slash, <span class="string">"/"</span>);</span><br><span class="line">        <span class="comment">// ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ª "/" ä¸‹æ ‡å‡ºå¤„</span></span><br><span class="line">        slash += strcspn(slash, <span class="string">"/"</span>);</span><br><span class="line"></span><br><span class="line">        done = (*slash == <span class="string">'\0'</span>);</span><br><span class="line">        *slash = <span class="string">'\0'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (stat(path, &amp;sb) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œåˆ›å»ºæ–‡ä»¶å¤¹çš„æ“ä½œ, C ä¸­æ—  mkdirs çš„æ“ä½œ, éœ€è¦ä¸€ä¸ªä¸€ä¸ªæ–‡ä»¶å¤¹çš„åˆ›å»º</span></span><br><span class="line">            <span class="keyword">if</span> (errno != ENOENT || mkdir(path, <span class="number">0777</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">                MMKVWarning(<span class="string">"%s : %s"</span>, path, strerror(errno));</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è‹¥éæ–‡ä»¶å¤¹, åˆ™è¯´æ˜ä¸ºéæ³•è·¯å¾„</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!S_ISDIR(sb.st_mode)) &#123;</span><br><span class="line">            MMKVWarning(<span class="string">"%s: %s"</span>, path, strerror(ENOTDIR));</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        *slash = <span class="string">'/'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ˜¯ Native å±‚åˆ›å»ºæ–‡ä»¶è·¯å¾„çš„é€šç”¨ä»£ç , é€»è¾‘å¾ˆæ¸…æ™°</p><p>å¥½çš„, æ–‡ä»¶ç›®å½•åˆ›å»ºå¥½äº†ä¹‹å, Native å±‚çš„åˆå§‹åŒ–æ“ä½œä¾¿ç»“æŸäº†, æ¥ä¸‹æ¥çœ‹çœ‹ MMKV å®ä¾‹æ„å»ºçš„è¿‡ç¨‹</p><h2 id="å››ã€å®ä¾‹åŒ–"><a href="#å››ã€å®ä¾‹åŒ–" class="headerlink" title="å››ã€å®ä¾‹åŒ–"></a>å››ã€å®ä¾‹åŒ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MMKV</span> <span class="keyword">implements</span> <span class="title">SharedPreferences</span>, <span class="title">SharedPreferences</span>.<span class="title">Editor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MMKV <span class="title">mmkvWithID</span><span class="params">(String mmapID, <span class="keyword">int</span> mode, String cryptKey, String relativePath)</span> </span>&#123;</span><br><span class="line">        ......</span><br><span class="line">        <span class="comment">// æ‰§è¡Œ Native åˆå§‹åŒ–, è·å–å¥æŸ„å€¼</span></span><br><span class="line">        <span class="keyword">long</span> handle = getMMKVWithID(mmapID, mode, cryptKey, relativePath);</span><br><span class="line">        <span class="keyword">if</span> (handle == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ„å»ºä¸€ä¸ª Java çš„å£³å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MMKV(handle);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">static</span> <span class="keyword">long</span></span><br><span class="line">    getMMKVWithID(String mmapID, <span class="keyword">int</span> mode, String cryptKey, String relativePath);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// jni</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> nativeHandle;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MMKV</span><span class="params">(<span class="keyword">long</span> handle)</span> </span>&#123;</span><br><span class="line">        nativeHandle = handle;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° MMKV å®ä¾‹æ„å»ºçš„ä¸»è¦é€»è¾‘é€šè¿‡ getMMKVWithID æ–¹æ³•å®ç°, çœ‹å®ƒå†…éƒ¨åšäº†ä»€ä¹ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// native-bridge.cpp</span></span><br><span class="line">namespace mmkv &#123;</span><br><span class="line"></span><br><span class="line"><span class="function">MMKV_JNI jlong <span class="title">getMMKVWithID</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    JNIEnv *env, jobject, jstring mmapID, jint mode, jstring cryptKey, jstring relativePath)</span> </span>&#123;</span><br><span class="line">    MMKV *kv = nullptr;</span><br><span class="line">    <span class="keyword">if</span> (!mmapID) &#123;</span><br><span class="line">        <span class="keyword">return</span> (jlong) kv;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–ç‹¬ç«‹å­˜å‚¨ id</span></span><br><span class="line">    string str = jstring2string(env, mmapID);</span><br><span class="line"></span><br><span class="line">    bool done = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (cryptKey) &#123;</span><br><span class="line">        <span class="comment">// è·å–ç§˜é’¥</span></span><br><span class="line">        string crypt = jstring2string(env, cryptKey);</span><br><span class="line">        <span class="keyword">if</span> (crypt.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (relativePath) &#123;</span><br><span class="line">                <span class="comment">// è·å–ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">                string path = jstring2string(env, relativePath);</span><br><span class="line">                <span class="comment">// é€šè¿‡ mmkvWithID å‡½æ•°è·å–ä¸€ä¸ª MMKV çš„å¯¹è±¡</span></span><br><span class="line">                kv = MMKV::mmkvWithID(str, DEFAULT_MMAP_SIZE, (MMKVMode) mode, &amp;crypt, &amp;path);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                kv = MMKV::mmkvWithID(str, DEFAULT_MMAP_SIZE, (MMKVMode) mode, &amp;crypt, nullptr);</span><br><span class="line">            &#125;</span><br><span class="line">            done = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// å¼ºè½¬æˆå¥æŸ„, è¿”å›åˆ° Java</span></span><br><span class="line">    <span class="keyword">return</span> (jlong) kv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æœ€ç»ˆé€šè¿‡  MMKV::mmkvWithID å‡½æ•°è·å–åˆ° MMKV çš„å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MMKV.cpp</span></span><br><span class="line">MMKV *MMKV::mmkvWithID(</span><br><span class="line">    <span class="keyword">const</span> std::string &amp;mmapID, <span class="keyword">int</span> size, MMKVMode mode, string *cryptKey, string *relativePath) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mmapID.empty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> nullptr;</span><br><span class="line">    &#125;</span><br><span class="line">    SCOPEDLOCK(g_instanceLock);</span><br><span class="line">    <span class="comment">// 1. é€šè¿‡ mmapID å’Œ relativePath, ç»„æˆæœ€ç»ˆçš„ mmap æ–‡ä»¶è·¯å¾„çš„ key</span></span><br><span class="line">    auto mmapKey = mmapedKVKey(mmapID, relativePath);</span><br><span class="line">    <span class="comment">// 2. ä»å…¨å±€ç¼“å­˜ä¸­æŸ¥æ‰¾</span></span><br><span class="line">    auto itr = g_instanceDic-&gt;find(mmapKey);</span><br><span class="line">    <span class="keyword">if</span> (itr != g_instanceDic-&gt;end()) &#123;</span><br><span class="line">        MMKV *kv = itr-&gt;second;</span><br><span class="line">        <span class="keyword">return</span> kv;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. åˆ›å»ºç¼“å­˜æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (relativePath) &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ® mappedKVPathWithID è·å– mmap çš„æœ€ç»ˆæ–‡ä»¶è·¯å¾„</span></span><br><span class="line">        <span class="comment">// mmapID ä½¿ç”¨ md5 åŠ å¯†</span></span><br><span class="line">        auto filePath = mappedKVPathWithID(mmapID, mode, relativePath);</span><br><span class="line">        <span class="comment">// ä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (!isFileExist(filePath)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!createFile(filePath)) &#123;</span><br><span class="line">                <span class="keyword">return</span> nullptr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. åˆ›å»ºå®ä¾‹å¯¹è±¡</span></span><br><span class="line">    auto kv = <span class="keyword">new</span> MMKV(mmapID, size, mode, cryptKey, relativePath);</span><br><span class="line">    <span class="comment">// 5. ç¼“å­˜è¿™ä¸ª mmapKey</span></span><br><span class="line">    (*g_instanceDic)[mmapKey] = kv;</span><br><span class="line">    <span class="keyword">return</span> kv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mmkvWithID å‡½æ•°çš„å®ç°æµç¨‹éå¸¸çš„æ¸…æ™°, è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸€ä¸‹å®ä¾‹å¯¹è±¡çš„åˆ›å»ºæµç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MMKV.cpp</span></span><br><span class="line">MMKV::MMKV(</span><br><span class="line">    <span class="keyword">const</span> std::string &amp;mmapID, <span class="keyword">int</span> size, MMKVMode mode, string *cryptKey, string *relativePath)</span><br><span class="line">    : m_mmapID(mmapedKVKey(mmapID, relativePath)) </span><br><span class="line">    <span class="comment">// æ‹¼è£…æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">    , m_path(mappedKVPathWithID(m_mmapID, mode, relativePath))</span><br><span class="line">    <span class="comment">// æ‹¼è£… .crc æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    , m_crcPath(crcPathWithID(m_mmapID, mode, relativePath))</span><br><span class="line">    <span class="comment">// 1. å°†æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜</span></span><br><span class="line">    , m_metaFile(m_crcPath, DEFAULT_MMAP_SIZE, (mode &amp; MMKV_ASHMEM) ? MMAP_ASHMEM : MMAP_FILE)</span><br><span class="line">    ......</span><br><span class="line">    , m_sharedProcessLock(&amp;m_fileLock, SharedLockType)</span><br><span class="line">    ......</span><br><span class="line">    , m_isAshmem((mode &amp; MMKV_ASHMEM) != <span class="number">0</span>) &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸º Ashmem è·¨è¿›ç¨‹åŒ¿åå…±äº«å†…å­˜</span></span><br><span class="line">    <span class="keyword">if</span> (m_isAshmem) &#123;</span><br><span class="line">        <span class="comment">// åˆ›å…±äº«å†…å­˜çš„æ–‡ä»¶</span></span><br><span class="line">        m_ashmemFile = <span class="keyword">new</span> MmapedFile(m_mmapID, static_cast&lt;size_t&gt;(size), MMAP_ASHMEM);</span><br><span class="line">        m_fd = m_ashmemFile-&gt;getFd();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        m_ashmemFile = nullptr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ ¹æ® cryptKey åˆ›å»º AES åŠ è§£å¯†çš„å¼•æ“</span></span><br><span class="line">    <span class="keyword">if</span> (cryptKey &amp;&amp; cryptKey-&gt;length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        m_crypter = <span class="keyword">new</span> AESCrypt((<span class="keyword">const</span> unsigned <span class="keyword">char</span> *) cryptKey-&gt;data(), cryptKey-&gt;length());</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// sensitive zone</span></span><br><span class="line">    &#123;</span><br><span class="line">        SCOPEDLOCK(m_sharedProcessLock);</span><br><span class="line">        <span class="comment">// 2. æ ¹æ® m_mmapID æ¥åŠ è½½æ–‡ä»¶ä¸­çš„æ•°æ®</span></span><br><span class="line">        loadFromFile();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä» MMKV çš„æ„é€ å‡½æ•°ä¸­çœ‹åˆ°å¾ˆå¤šæœ‰è¶£çš„ä¿¡æ¯, <strong>MMKV æ˜¯æ”¯æŒ Ashmem å…±äº«å†…å­˜çš„, è¿™æ„å‘³ç€å³ä½¿æ˜¯è·¨è¿›ç¨‹å¤§æ•°æ®çš„ä¼ è¾“, å®ƒä¹Ÿèƒ½å¤Ÿæä¾›å¾ˆå¥½çš„æ€§èƒ½æ”¯æŒ</strong></p><p>ä¸è¿‡è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸¤ä¸ªå…³é”®ç‚¹</p><ul><li>m_metaFile æ–‡ä»¶çš„æ˜ å°„</li><li>loadFromFile æ•°æ®çš„è½½å…¥</li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆçœ‹çœ‹, æ–‡ä»¶çš„æ˜ å°„</p><h3 id="4-1-æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜"><a href="#4-1-æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜" class="headerlink" title="4.1 æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜"></a>4.1 æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MmapedFile.cpp</span></span><br><span class="line">MmapedFile::MmapedFile(<span class="keyword">const</span> std::string &amp;path, size_t size, bool fileType)</span><br><span class="line">    : m_name(path), m_fd(-<span class="number">1</span>), m_segmentPtr(nullptr), m_segmentSize(<span class="number">0</span>), m_fileType(fileType) &#123;</span><br><span class="line">    <span class="comment">// ç”¨äºå†…å­˜æ˜ å°„çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (m_fileType == MMAP_FILE) &#123;</span><br><span class="line">        <span class="comment">// 1. æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line">        m_fd = open(m_name.c_str(), O_RDWR | O_CREAT, S_IRWXU);</span><br><span class="line">        <span class="keyword">if</span> (m_fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            MMKVError(<span class="string">"fail to open:%s, %s"</span>, m_name.c_str(), strerror(errno));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 2. åˆ›å»ºæ–‡ä»¶é”</span></span><br><span class="line">            <span class="function">FileLock <span class="title">fileLock</span><span class="params">(m_fd)</span></span>;</span><br><span class="line">            <span class="function">InterProcessLock <span class="title">lock</span><span class="params">(&amp;fileLock, ExclusiveLockType)</span></span>;</span><br><span class="line">            SCOPEDLOCK(lock);</span><br><span class="line">            <span class="comment">// è·å–æ–‡ä»¶çš„ä¿¡æ¯</span></span><br><span class="line">            struct stat st = &#123;&#125;;</span><br><span class="line">            <span class="keyword">if</span> (fstat(m_fd, &amp;st) != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// è·å–æ–‡ä»¶å¤§å°</span></span><br><span class="line">                m_segmentSize = static_cast&lt;size_t&gt;(st.st_size);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 3. éªŒè¯æ–‡ä»¶çš„å¤§å°æ˜¯å¦å°äºä¸€ä¸ªå†…å­˜é¡µ, ä¸€èˆ¬ä¸º 4kb</span></span><br><span class="line">            <span class="keyword">if</span> (m_segmentSize &lt; DEFAULT_MMAP_SIZE) &#123;</span><br><span class="line">                m_segmentSize = static_cast&lt;size_t&gt;(DEFAULT_MMAP_SIZE);</span><br><span class="line">                <span class="comment">// 3.1 é€šè¿‡ ftruncate å°†æ–‡ä»¶å¤§å°å¯¹å…¶åˆ°å†…å­˜é¡µ</span></span><br><span class="line">                <span class="comment">// 3.2 é€šè¿‡ zeroFillFile å°†æ–‡ä»¶å¯¹å…¶åçš„ç©ºç™½éƒ¨åˆ†ç”¨ 0 å¡«å……</span></span><br><span class="line">                <span class="keyword">if</span> (ftruncate(m_fd, m_segmentSize) != <span class="number">0</span> || !zeroFillFile(m_fd, <span class="number">0</span>, m_segmentSize)) &#123;</span><br><span class="line">                    <span class="comment">// è¯´æ˜æ–‡ä»¶æ‹“å±•å¤±è´¥äº†, ç§»é™¤è¿™ä¸ªæ–‡ä»¶</span></span><br><span class="line">                    close(m_fd);</span><br><span class="line">                    m_fd = -<span class="number">1</span>;</span><br><span class="line">                    removeFile(m_name);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 4. é€šè¿‡ mmap å°†æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜, è·å–å†…å­˜é¦–åœ°å€</span></span><br><span class="line">            m_segmentPtr =</span><br><span class="line">                (<span class="keyword">char</span> *) mmap(nullptr, m_segmentSize, PROT_READ | PROT_WRITE, MAP_SHARED, m_fd, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (m_segmentPtr == MAP_FAILED) &#123;</span><br><span class="line">                MMKVError(<span class="string">"fail to mmap [%s], %s"</span>, m_name.c_str(), strerror(errno));</span><br><span class="line">                close(m_fd);</span><br><span class="line">                m_fd = -<span class="number">1</span>;</span><br><span class="line">                m_segmentPtr = nullptr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç”¨äºå…±äº«å†…å­˜çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MmapedFile çš„æ„é€ å‡½æ•°å¤„ç†çš„äº‹åŠ¡å¦‚ä¸‹</p><ul><li>æ‰“å¼€æŒ‡å®šçš„æ–‡ä»¶</li><li>åˆ›å»ºè¿™ä¸ªæ–‡ä»¶é”</li><li>ä¿®æ­£æ–‡ä»¶å¤§å°, æœ€å°ä¸º 4kb <ul><li>å‰ 4kb ç”¨äºç»Ÿè®¡æ•°æ®æ€»å¤§å°</li></ul></li><li>é€šè¿‡ mmap å°†æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜</li></ul><p>å¥½çš„, é€šè¿‡ MmapedFile çš„æ„é€ å‡½æ•°, æˆ‘ä»¬ä¾¿èƒ½å¤Ÿè·å–åˆ°æ˜ å°„åçš„å†…å­˜é¦–åœ°å€äº†, æ“ä½œè¿™å—å†…å­˜æ—¶ Linux å†…æ ¸ä¼šè´Ÿè´£å°†å†…å­˜ä¸­çš„æ•°æ®åŒæ­¥åˆ°æ–‡ä»¶ä¸­</p><p>æ¯”èµ· SP çš„æ•°æ®åŒæ­¥, mmap æ˜¾ç„¶æ˜¯è¦ä¼˜é›…çš„å¤š, <strong>å³ä½¿è¿›ç¨‹æ„å¤–æ­»äº¡, ä¹Ÿèƒ½å¤Ÿé€šè¿‡ Linux å†…æ ¸çš„ä¿æŠ¤æœºåˆ¶, å°†è¿›è¡Œäº†æ–‡ä»¶æ˜ å°„çš„å†…å­˜æ•°æ®åˆ·å…¥åˆ°æ–‡ä»¶ä¸­, æå‡äº†æ•°æ®å†™å…¥çš„å¯é æ€§</strong></p><p>ç»“ä¸‹æ¥çœ‹çœ‹æ•°æ®çš„è½½å…¥</p><h3 id="4-2-æ•°æ®çš„è½½å…¥"><a href="#4-2-æ•°æ®çš„è½½å…¥" class="headerlink" title="4.2 æ•°æ®çš„è½½å…¥"></a>4.2 æ•°æ®çš„è½½å…¥</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">// MMKV.cpp</span><br><span class="line">void MMKV::loadFromFile() &#123;</span><br><span class="line">    </span><br><span class="line">    ......// å¿½ç•¥åŒ¿åå…±äº«å†…å­˜ç›¸å…³ä»£ç </span><br><span class="line">    </span><br><span class="line">    // è‹¥å·²ç»è¿›è¡Œäº†æ–‡ä»¶æ˜ å°„</span><br><span class="line">    if (m_metaFile.isFileValid()) &#123;</span><br><span class="line">        // åˆ™è·å–ç›¸å…³æ•°æ®</span><br><span class="line">        m_metaInfo.read(m_metaFile.getMemory());</span><br><span class="line">    &#125;</span><br><span class="line">    // è·å–æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">    m_fd = open(m_path.c_str(), O_RDWR | O_CREAT, S_IRWXU);</span><br><span class="line">    if (m_fd &lt; 0) &#123;</span><br><span class="line">        MMKVError(&quot;fail to open:%s, %s&quot;, m_path.c_str(), strerror(errno));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 1. è·å–æ–‡ä»¶å¤§å°</span><br><span class="line">        m_size = 0;</span><br><span class="line">        struct stat st = &#123;0&#125;;</span><br><span class="line">        if (fstat(m_fd, &amp;st) != -1) &#123;</span><br><span class="line">            m_size = static_cast&lt;size_t&gt;(st.st_size);</span><br><span class="line">        &#125;</span><br><span class="line">        // 1.1 å°†æ–‡ä»¶å¤§å°å¯¹å…¶åˆ°å†…å­˜é¡µçš„æ•´æ•°å€</span><br><span class="line">        if (m_size &lt; DEFAULT_MMAP_SIZE || (m_size % DEFAULT_MMAP_SIZE != 0)) &#123;</span><br><span class="line">            ......</span><br><span class="line">        &#125;</span><br><span class="line">        // 2. è·å–æ–‡ä»¶æ˜ å°„åçš„å†…å­˜åœ°å€</span><br><span class="line">        m_ptr = (char *) mmap(nullptr, m_size, PROT_READ | PROT_WRITE, MAP_SHARED, m_fd, 0);</span><br><span class="line">        if (m_ptr == MAP_FAILED) &#123;</span><br><span class="line">            ......</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 3. è¯»å–å†…å­˜æ–‡ä»¶çš„å‰ 32 ä½, è·å–å­˜å‚¨æ•°æ®çš„çœŸå®å¤§å°</span><br><span class="line">            memcpy(&amp;m_actualSize, m_ptr, Fixed32Size);</span><br><span class="line">            ......</span><br><span class="line">            bool loadFromFile = false, needFullWriteback = false;</span><br><span class="line">            if (m_actualSize &gt; 0) &#123;</span><br><span class="line">                // 4. éªŒè¯æ–‡ä»¶çš„é•¿åº¦</span><br><span class="line">                if (m_actualSize &lt; m_size &amp;&amp; m_actualSize + Fixed32Size &lt;= m_size) &#123;</span><br><span class="line">                    // 5. éªŒè¯æ–‡ä»¶ CRC çš„æ­£ç¡®æ€§</span><br><span class="line">                    if (checkFileCRCValid()) &#123;</span><br><span class="line">                        loadFromFile = true;</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        // è‹¥ä¸æ­£ç¡®, åˆ™å›è°ƒå¼‚å¸¸ CRC å¼‚å¸¸</span><br><span class="line">                        auto strategic = mmkv::onMMKVCRCCheckFail(m_mmapID);</span><br><span class="line">                        if (strategic == OnErrorRecover) &#123;</span><br><span class="line">                            loadFromFile = true;</span><br><span class="line">                            needFullWriteback = true;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // å›è°ƒæ–‡ä»¶é•¿åº¦å¼‚å¸¸</span><br><span class="line">                    auto strategic = mmkv::onMMKVFileLengthError(m_mmapID);</span><br><span class="line">                    if (strategic == OnErrorRecover) &#123;</span><br><span class="line">                        writeAcutalSize(m_size - Fixed32Size);</span><br><span class="line">                        loadFromFile = true;</span><br><span class="line">                        needFullWriteback = true;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            // 6. éœ€è¦ä»æ–‡ä»¶è·å–æ•°æ®</span><br><span class="line">            if (loadFromFile) &#123;</span><br><span class="line">                ......</span><br><span class="line">                // æ„å»ºè¾“å…¥ç¼“å­˜</span><br><span class="line">                MMBuffer inputBuffer(m_ptr + Fixed32Size, m_actualSize, MMBufferNoCopy);</span><br><span class="line">                if (m_crypter) &#123;</span><br><span class="line">                    // è§£å¯†è¾“å…¥ç¼“å†²ä¸­çš„æ•°æ®</span><br><span class="line">                    decryptBuffer(*m_crypter, inputBuffer);</span><br><span class="line">                &#125;</span><br><span class="line">                // ä»è¾“å…¥ç¼“å†²ä¸­å°†æ•°æ®è¯»å…¥ m_dic</span><br><span class="line">                m_dic.clear();</span><br><span class="line">                MiniPBCoder::decodeMap(m_dic, inputBuffer);</span><br><span class="line">                // æ„å»ºè¾“å‡ºæ•°æ®</span><br><span class="line">                m_output = new CodedOutputData(m_ptr + Fixed32Size + m_actualSize,</span><br><span class="line">                                               m_size - Fixed32Size - m_actualSize);</span><br><span class="line">                // è¿›è¡Œé‡æ•´å›å†™, å‰”é™¤é‡å¤çš„æ•°æ®</span><br><span class="line">                if (needFullWriteback) &#123;</span><br><span class="line">                    fullWriteback();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; </span><br><span class="line">            // 7. è¯´æ˜æ–‡ä»¶ä¸­æ²¡æœ‰æ•°æ®, æˆ–è€…æ ¡éªŒå¤±è´¥äº†</span><br><span class="line">            else &#123;</span><br><span class="line">                SCOPEDLOCK(m_exclusiveProcessLock);</span><br><span class="line">                // æ¸…ç©ºæ–‡ä»¶ä¸­çš„æ•°æ®</span><br><span class="line">                if (m_actualSize &gt; 0) &#123;</span><br><span class="line">                    writeAcutalSize(0);</span><br><span class="line">                &#125;</span><br><span class="line">                m_output = new CodedOutputData(m_ptr + Fixed32Size, m_size - Fixed32Size);</span><br><span class="line">                // é‡æ–°è®¡ç®— CRC</span><br><span class="line">                recaculateCRCDigest();</span><br><span class="line">            &#125;</span><br><span class="line">            ......</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    m_needLoadFromFile = false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½çš„, å¯ä»¥çœ‹åˆ° loadFromFile ä¸­å¯¹äº CRC éªŒè¯é€šè¿‡çš„æ–‡ä»¶, ä¼šå°†æ–‡ä»¶ä¸­çš„æ•°æ®è¯»å…¥åˆ° m_dic ä¸­ç¼“å­˜, å¦åˆ™åˆ™ä¼šæ¸…ç©ºæ–‡ä»¶</p><ul><li><p>å› æ­¤ç”¨æˆ·æ¶æ„ä¿®æ”¹æ–‡ä»¶ä¹‹å, ä¼šç ´å CRC çš„å€¼, è¿™ä¸ªå­˜å‚¨æ•°æ®ä¾¿ä¼šè¢«ä½œåºŸ, è¿™ä¸€ç‚¹è¦å°¤ä¸ºæ³¨æ„</p></li><li><p>ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®åˆ° m_dic ä¹‹å, ä¼šå°† mdic å›å†™åˆ°æ–‡ä»¶ä¸­</p><p>, å…¶é‡å†™çš„ç›®çš„æ˜¯ä¸ºäº†å‰”é™¤é‡å¤çš„æ•°æ® </p><ul><li>å…³äºä¸ºä»€ä¹ˆä¼šå‡ºç°é‡å¤çš„æ•°æ®, åœ¨åé¢ encode æ“ä½œä¸­å†åˆ†æ</li></ul></li></ul><h3 id="4-3-å›é¡¾"><a href="#4-3-å›é¡¾" class="headerlink" title="4.3 å›é¡¾"></a>4.3 å›é¡¾</h3><p>åˆ°è¿™é‡Œ MMKV å®ä¾‹çš„æ„å»ºå°±å®Œæˆäº†, æœ‰äº† m_dic è¿™ä¸ªå†…å­˜ç¼“å­˜, æˆ‘ä»¬è¿›è¡Œæ•°æ®æŸ¥è¯¢çš„æ•ˆç‡å°±å¤§å¤§æå‡äº†</p><p>ä»æœ€ç»ˆçš„ç»“æœæ¥çœ‹å®ƒä¸ SP æ˜¯ä¸€è‡´çš„, éƒ½æ˜¯åˆæ¬¡åŠ è½½æ—¶ä¼šå°†æ–‡ä»¶ä¸­æ‰€æœ‰çš„æ•°æ®åŠ è½½åˆ°æ•£åˆ—è¡¨ä¸­, ä¸è¿‡ MMKV å¤šäº†ä¸€æ­¥æ•°æ®å›å†™çš„æ“ä½œ, å› æ­¤å½“æ•°æ®é‡æ¯”è¾ƒå¤§æ—¶, å¯¹å®ä¾‹æ„å»ºçš„é€Ÿåº¦æœ‰ä¸€å®šçš„å½±å“</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// å†™å…¥ 1000 æ¡æ•°æ®ä¹‹å, MMVK å’Œ SharedPreferences å®ä¾‹åŒ–çš„æ—¶é—´å¯¹æ¯”</span><br><span class="line">E/TAG: create MMKV instance time is 4 ms</span><br><span class="line">E/TAG: create SharedPreferences instance time is 1 ms</span><br></pre></td></tr></table></figure><p>ä»ç»“æœä¸Šæ¥çœ‹, MMVK çš„ç¡®åœ¨å®ä¾‹æ„é€ é€Ÿåº¦ä¸Šæœ‰ä¸€å®šçš„åŠ£åŠ¿, ä¸è¿‡å¾—ç›Šäºæ˜¯å°† m_dic ä¸­çš„æ•°æ®å†™å…¥åˆ° mmap çš„å†…å­˜, å…¶çœŸæ­£è¿›è¡Œæ–‡ä»¶å†™å…¥çš„æ—¶æœºç”± Linux å†…æ ¸å†³å®š, å†åŠ ä¸Šæ–‡ä»¶çš„é¡µç¼“å­˜æœºåˆ¶, æ‰€ä»¥é€Ÿåº¦ä¸Šè™½æœ‰åŠ£åŠ¿, ä½†ä¸è‡³äºæ— æ³•æ¥å—</p><h2 id="äº”ã€encode"><a href="#äº”ã€encode" class="headerlink" title="äº”ã€encode"></a>äº”ã€encode</h2><p>å…³äº <strong>encode å³æ•°æ®çš„æ·»åŠ ä¸æ›´æ–°</strong>çš„æµç¨‹, è¿™é‡Œä»¥ encodeString ä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MMKV</span> <span class="keyword">implements</span> <span class="title">SharedPreferences</span>, <span class="title">SharedPreferences</span>.<span class="title">Editor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">encode</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> encodeString(nativeHandle, key, value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">encodeString</span><span class="params">(<span class="keyword">long</span> handle, String key, String value)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹ native å±‚çš„å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// native-bridge.cpp</span></span><br><span class="line">namespace mmkv &#123;</span><br><span class="line"></span><br><span class="line"><span class="function">MMKV_JNI jboolean <span class="title">encodeString</span><span class="params">(JNIEnv *env, jobject, jlong handle, jstring oKey, jstring oValue)</span> </span>&#123;</span><br><span class="line">    MMKV *kv = reinterpret_cast&lt;MMKV *&gt;(handle);</span><br><span class="line">    <span class="keyword">if</span> (kv &amp;&amp; oKey) &#123;</span><br><span class="line">        string key = jstring2string(env, oKey);</span><br><span class="line">        <span class="comment">// è‹¥æ˜¯ value é NULL</span></span><br><span class="line">        <span class="keyword">if</span> (oValue) &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡ setStringForKey å‡½æ•°, å°†æ•°æ®å­˜å…¥</span></span><br><span class="line">            string value = jstring2string(env, oValue);</span><br><span class="line">            <span class="keyword">return</span> (jboolean) kv-&gt;setStringForKey(value, key);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// è‹¥æ˜¯ value ä¸º NULL, åˆ™ç§»é™¤ key å¯¹åº”çš„ value å€¼</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            kv-&gt;removeValueForKey(key);</span><br><span class="line">            <span class="keyword">return</span> (jboolean) <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (jboolean) <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦åˆ†æä¸€ä¸‹ setStringForKey è¿™ä¸ªå‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MMKV.cpp</span></span><br><span class="line">bool MMKV::setStringForKey(<span class="keyword">const</span> std::string &amp;value, <span class="keyword">const</span> std::string &amp;key) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key.empty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1. å°†æ•°æ®ç¼–ç æˆ ProtocolBuffer</span></span><br><span class="line">    auto data = MiniPBCoder::encodeDataWithObject(value);</span><br><span class="line">    <span class="comment">// 2. æ›´æ–°é”®å€¼å¯¹</span></span><br><span class="line">    <span class="keyword">return</span> setDataForKey(std::move(data), key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦åˆ†ä¸ºä¸¤æ­¥æ“ä½œ</p><ul><li>æ•°æ®ç¼–ç </li><li>æ›´æ–°é”®å€¼å¯¹</li></ul><h3 id="5-1-æ•°æ®çš„ç¼–ç "><a href="#5-1-æ•°æ®çš„ç¼–ç " class="headerlink" title="5.1 æ•°æ®çš„ç¼–ç "></a>5.1 æ•°æ®çš„ç¼–ç </h3><p>MMKV é‡‡ç”¨çš„æ˜¯ ProtocolBuffer ç¼–ç æ–¹å¼, è¿™é‡Œå°±ä¸åšè¿‡å¤šä»‹ç»äº†, å…·ä½“è¯·æŸ¥çœ‹ <a href="https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fencoding" target="_blank" rel="noopener">Google å®˜æ–¹æ–‡æ¡£</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MiniPBCoder.cpp</span></span><br><span class="line">MMBuffer MiniPBCoder::getEncodeData(<span class="keyword">const</span> string &amp;str) &#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºç¼–ç æ¡ç›®çš„é›†åˆ</span></span><br><span class="line">    m_encodeItems = <span class="keyword">new</span> vector&lt;PBEncodeItem&gt;();</span><br><span class="line">    <span class="comment">// 2. ä¸ºé›†åˆå¡«å……æ•°æ®</span></span><br><span class="line">    size_t index = prepareObjectForEncode(str);</span><br><span class="line">    PBEncodeItem *oItem = (index &lt; m_encodeItems-&gt;size()) ? &amp;(*m_encodeItems)[index] : nullptr;</span><br><span class="line">    <span class="keyword">if</span> (oItem &amp;&amp; oItem-&gt;compiledSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 3. å¼€è¾Ÿä¸€ä¸ªå†…å­˜ç¼“å†²åŒº, ç”¨äºå­˜æ”¾ç¼–ç åçš„æ•°æ®</span></span><br><span class="line">        m_outputBuffer = <span class="keyword">new</span> MMBuffer(oItem-&gt;compiledSize);</span><br><span class="line">        <span class="comment">// 4. åˆ›å»ºä¸€ä¸ªç¼–ç æ“ä½œå¯¹è±¡</span></span><br><span class="line">        m_outputData = <span class="keyword">new</span> CodedOutputData(m_outputBuffer-&gt;getPtr(), m_outputBuffer-&gt;length());</span><br><span class="line">        <span class="comment">// æ‰§è¡Œ protocolbuffer ç¼–ç , å¹¶è¾“å‡ºåˆ°ç¼“å†²åŒº</span></span><br><span class="line">        writeRootObject();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°, é‡æ–°åˆ›å»ºå®ä¾‹è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> move(*m_outputBuffer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">size_t MiniPBCoder::prepareObjectForEncode(<span class="keyword">const</span> string &amp;str) &#123;</span><br><span class="line">    <span class="comment">// 2.1 åˆ›å»º PBEncodeItem å¯¹è±¡ç”¨æ¥æè¿°å¾…ç¼–ç çš„æ¡ç›®, å¹¶æ·»åŠ åˆ° vector é›†åˆ</span></span><br><span class="line">    m_encodeItems-&gt;push_back(PBEncodeItem());</span><br><span class="line">    <span class="comment">// 2.2 è·å– PBEncodeItem å¯¹è±¡</span></span><br><span class="line">    PBEncodeItem *encodeItem = &amp;(m_encodeItems-&gt;back());</span><br><span class="line">    <span class="comment">// 2.3 è®°å½•ç´¢å¼•ä½ç½®</span></span><br><span class="line">    size_t index = m_encodeItems-&gt;size() - <span class="number">1</span>;</span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="comment">// 2.4 å¡«å……ç¼–ç ç±»å‹</span></span><br><span class="line">        encodeItem-&gt;type = PBEncodeItemType_String;</span><br><span class="line">        <span class="comment">// 2.5 å¡«å……è¦ç¼–ç çš„æ•°æ®</span></span><br><span class="line">        encodeItem-&gt;value.strValue = &amp;str;</span><br><span class="line">        <span class="comment">// 2.6 å¡«å……æ•°æ®å¤§å°</span></span><br><span class="line">        encodeItem-&gt;valueSize = static_cast&lt;int32_t&gt;(str.size());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.7 è®¡ç®—ç¼–ç åçš„å¤§å°</span></span><br><span class="line">    encodeItem-&gt;compiledSize = pbRawVarint32Size(encodeItem-&gt;valueSize) + encodeItem-&gt;valueSize;</span><br><span class="line">    <span class="keyword">return</span> index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°, å†æœªè¿›è¡Œç¼–ç æ“ä½œä¹‹å‰, ç¼–ç åçš„æ•°æ®å¤§å°å°±å·²ç»ç¡®å®šå¥½äº†, å¹¶ä¸”å°†å®ƒä¿å­˜åœ¨äº† encodeItem-&gt;compiledSize ä¸­, æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹æ‰§è¡Œæ•°æ®ç¼–ç å¹¶è¾“å‡ºåˆ°ç¼“å†²åŒºçš„æ“ä½œæµç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MiniPBCoder.cpp</span></span><br><span class="line"><span class="keyword">void</span> MiniPBCoder::writeRootObject() &#123;</span><br><span class="line">    <span class="keyword">for</span> (size_t index = <span class="number">0</span>, total = m_encodeItems-&gt;size(); index &lt; total; index++) &#123;</span><br><span class="line">        PBEncodeItem *encodeItem = &amp;(*m_encodeItems)[index];</span><br><span class="line">        <span class="keyword">switch</span> (encodeItem-&gt;type) &#123;</span><br><span class="line">            <span class="comment">// ä¸»è¦å…³å¿ƒç¼–ç  String</span></span><br><span class="line">            <span class="keyword">case</span> PBEncodeItemType_String: &#123;</span><br><span class="line">                m_outputData-&gt;writeString(*(encodeItem-&gt;value.strValue));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ......</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CodedOutputData.cpp</span></span><br><span class="line"><span class="keyword">void</span> CodedOutputData::writeString(<span class="keyword">const</span> string &amp;value) &#123;</span><br><span class="line">    size_t numberOfBytes = value.size();</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// 1. æŒ‰ç…§ varint æ–¹å¼ç¼–ç å­—ç¬¦ä¸²é•¿åº¦, ä¼šæ”¹å˜ m_position çš„å€¼</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;writeRawVarint32((int32_t) numberOfBytes);</span><br><span class="line">    <span class="comment">// 2. å°†å­—ç¬¦ä¸²çš„æ•°æ®æ‹·è´åˆ°ç¼–ç å¥½çš„é•¿åº¦åé¢</span></span><br><span class="line">    memcpy(m_ptr + m_position, ((uint8_t *) value.data()), numberOfBytes);</span><br><span class="line">    <span class="comment">// æ›´æ–° position çš„å€¼</span></span><br><span class="line">    m_position += numberOfBytes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° CodedOutputData çš„ writeString ä¸­æŒ‰ç…§ protocol buffer è¿›è¡Œäº†å­—ç¬¦ä¸²çš„ç¼–ç æ“ä½œ</p><p>å…¶ä¸­ m_ptr æ˜¯ä¸Šé¢å¼€è¾Ÿçš„å†…å­˜ç¼“å†²åŒºçš„åœ°å€, ä¹Ÿå°±æ˜¯è¯´ writeString æ‰§è¡Œç»“æŸä¹‹å, æ•°æ®å°±å·²ç»è¢«å†™å…¥ç¼“å†²åŒºäº†</p><p>æœ‰äº†ç¼–ç å¥½çš„æ•°æ®ç¼“å†²åŒº, æ¥ä¸‹æ¥çœ‹çœ‹æ›´æ–°é”®å€¼å¯¹çš„æ“ä½œ</p><h3 id="5-2é”®å€¼å¯¹çš„æ›´æ–°"><a href="#5-2é”®å€¼å¯¹çš„æ›´æ–°" class="headerlink" title="5.2é”®å€¼å¯¹çš„æ›´æ–°"></a>5.2é”®å€¼å¯¹çš„æ›´æ–°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MMKV.cpp</span></span><br><span class="line">bool MMKV::setStringForKey(<span class="keyword">const</span> std::string &amp;value, <span class="keyword">const</span> std::string &amp;key) &#123;</span><br><span class="line">    <span class="comment">// ç¼–ç æ•°æ®è·å–å­˜æ”¾æ•°æ®çš„ç¼“å†²åŒº</span></span><br><span class="line">    auto data = MiniPBCoder::encodeDataWithObject(value);</span><br><span class="line">    <span class="comment">// æ›´æ–°é”®å€¼å¯¹</span></span><br><span class="line">    <span class="keyword">return</span> setDataForKey(std::move(data), key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bool MMKV::setDataForKey(MMBuffer &amp;&amp;data, <span class="keyword">const</span> std::string &amp;key) &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// å°†é”®å€¼å¯¹å†™å…¥ mmap æ–‡ä»¶æ˜ å°„çš„å†…å­˜ä¸­</span></span><br><span class="line">    auto ret = appendDataWithKey(data, key);</span><br><span class="line">    <span class="comment">// å†™å…¥æˆåŠŸ, æ›´æ–°æ•£åˆ—æ•°æ®</span></span><br><span class="line">    <span class="keyword">if</span> (ret) &#123;</span><br><span class="line">        m_dic[key] = std::move(data);</span><br><span class="line">        m_hasFullWriteback = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bool MMKV::appendDataWithKey(<span class="keyword">const</span> MMBuffer &amp;data, <span class="keyword">const</span> std::string &amp;key) &#123;</span><br><span class="line">    <span class="comment">// 1. è®¡ç®— key + value çš„ ProtocolBuffer ç¼–ç åçš„é•¿åº¦</span></span><br><span class="line">    size_t keyLength = key.length();</span><br><span class="line">    size_t size = keyLength + pbRawVarint32Size((int32_t) keyLength);</span><br><span class="line">    size += data.length() + pbRawVarint32Size((int32_t) data.length());</span><br><span class="line">    SCOPEDLOCK(m_exclusiveProcessLock);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. éªŒè¯æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—´, ä¸è¶³åˆ™è¿›è¡Œæ•°æ®é‡æ•´ä¸æ‰©å®¹æ“ä½œ</span></span><br><span class="line">    bool hasEnoughSize = ensureMemorySize(size);</span><br><span class="line">    <span class="keyword">if</span> (!hasEnoughSize || !isFileValid()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. æ›´æ–°æ–‡ä»¶å¤´çš„æ•°æ®æ€»å¤§å°</span></span><br><span class="line">    writeAcutalSize(m_actualSize + size);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. å°† key å’Œç¼–ç åçš„ value å†™å…¥åˆ°æ–‡ä»¶æ˜ å°„çš„å†…å­˜</span></span><br><span class="line">    m_output-&gt;writeString(key);</span><br><span class="line">    m_output-&gt;writeData(data);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5. è·å–æ–‡ä»¶æ˜ å°„å†…å­˜å½“å‰ &lt;key, value&gt; çš„èµ·å§‹ä½ç½®</span></span><br><span class="line">    auto ptr = (uint8_t *) m_ptr + Fixed32Size + m_actualSize - size;</span><br><span class="line">    <span class="keyword">if</span> (m_crypter) &#123;</span><br><span class="line">        <span class="comment">// åŠ å¯†è¿™å—åŒºåŸŸ</span></span><br><span class="line">        m_crypter-&gt;encrypt(ptr, ptr, size);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 6. æ›´æ–° CRC</span></span><br><span class="line">    updateCRCDigest(ptr, size, KeepSequence);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½çš„, å¯ä»¥çœ‹åˆ°æ›´æ–°é”®å€¼å¯¹çš„æ“ä½œè¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„, é¦–å…ˆå°†é”®å€¼å¯¹æ•°æ®å†™å…¥åˆ°æ–‡ä»¶æ˜ å°„çš„å†…å­˜ä¸­, å†™å…¥æˆåŠŸä¹‹åæ›´æ–°æ•£åˆ—æ•°æ®</p><p>å…³äºå†™å…¥åˆ°æ–‡ä»¶æ˜ å°„çš„è¿‡ç¨‹, ä¸Šé¢ä»£ç ä¸­çš„æ³¨é‡Šä¹Ÿéå¸¸çš„æ¸…æ™°, æ¥ä¸‹æ¥æˆ‘ä»¬ ensureMemorySize æ˜¯å¦‚ä½•è¿›è¡Œæ•°æ®çš„é‡æ•´ä¸æ‰©å®¹çš„</p><h5 id="5-2-1-æ•°æ®çš„é‡æ•´ä¸æ‰©å®¹"><a href="#5-2-1-æ•°æ®çš„é‡æ•´ä¸æ‰©å®¹" class="headerlink" title="5.2.1 æ•°æ®çš„é‡æ•´ä¸æ‰©å®¹"></a>5.2.1 æ•°æ®çš„é‡æ•´ä¸æ‰©å®¹</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MMKV.cpp</span></span><br><span class="line">bool MMKV::ensureMemorySize(size_t newSize) &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// è®¡ç®—æ–°é”®å€¼å¯¹çš„å¤§å°</span></span><br><span class="line">    constexpr size_t ItemSizeHolderSize = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">if</span> (m_dic.empty()) &#123;</span><br><span class="line">        newSize += ItemSizeHolderSize;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ•°æ®é‡å†™: </span></span><br><span class="line">    <span class="comment">// 1. æ–‡ä»¶å‰©ä½™ç©ºé—²ç©ºé—´å°‘äºæ–°çš„é”®å€¼å¯¹</span></span><br><span class="line">    <span class="comment">// 2. æ•£åˆ—ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> (newSize &gt;= m_output-&gt;spaceLeft() || m_dic.empty()) &#123;</span><br><span class="line">        <span class="comment">// è®¡ç®—æ‰€éœ€çš„æ•°æ®ç©ºé—´</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> offset = pbFixed32Size(<span class="number">0</span>);</span><br><span class="line">        MMBuffer data = MiniPBCoder::encodeDataWithObject(m_dic);</span><br><span class="line">        size_t lenNeeded = data.length() + offset + newSize;</span><br><span class="line">        <span class="keyword">if</span> (m_isAshmem) &#123;</span><br><span class="line">            ......</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// </span></span><br><span class="line">            <span class="comment">// è®¡ç®—æ¯ä¸ªé”®å€¼å¯¹çš„å¹³å‡å¤§å°</span></span><br><span class="line">            size_t avgItemSize = lenNeeded / std::max&lt;size_t&gt;(<span class="number">1</span>, m_dic.size());</span><br><span class="line">            <span class="comment">// è®¡ç®—æœªæ¥å¯èƒ½ä¼šä½¿ç”¨çš„å¤§å°(ç±»ä¼¼äº 1.5 å€)</span></span><br><span class="line">            size_t futureUsage = avgItemSize * std::max&lt;size_t&gt;(<span class="number">8</span>, (m_dic.size() + <span class="number">1</span>) / <span class="number">2</span>);</span><br><span class="line">            <span class="comment">// 1. æ‰€éœ€ç©ºé—´ &gt;= å½“å‰æ–‡ä»¶æ€»å¤§å°</span></span><br><span class="line">            <span class="comment">// 2. æ‰€éœ€ç©ºé—´çš„ 1.5 å€ &gt;= å½“å‰æ–‡ä»¶æ€»å¤§å°</span></span><br><span class="line">            <span class="keyword">if</span> (lenNeeded &gt;= m_size || (lenNeeded + futureUsage) &gt;= m_size) &#123;</span><br><span class="line">                <span class="comment">// æ‰©å®¹ä¸º 2 å€</span></span><br><span class="line">                size_t oldSize = m_size;</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    m_size *= <span class="number">2</span>;</span><br><span class="line">                &#125; <span class="keyword">while</span> (lenNeeded + futureUsage &gt;= m_size);</span><br><span class="line">                .......</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ......</span><br><span class="line">        <span class="comment">// è¿›è¡Œæ•°æ®çš„é‡å†™</span></span><br><span class="line">        writeAcutalSize(data.length());</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°</p><ul><li>æ•°æ®çš„é‡å†™æ—¶æœº<ul><li>æ–‡ä»¶å‰©ä½™ç©ºé—´å°‘äºæ–°çš„é”®å€¼å¯¹å¤§å°</li><li>æ•£åˆ—ä¸ºç©º</li></ul></li><li>æ–‡ä»¶æ‰©å®¹æ—¶æœº<ul><li>æ‰€éœ€ç©ºé—´çš„ 1.5 å€è¶…è¿‡äº†å½“å‰æ–‡ä»¶çš„æ€»å¤§å°æ—¶, æ‰©å®¹ä¸ºä¹‹å‰çš„ä¸¤å€</li></ul></li></ul><h3 id="5-3å›é¡¾"><a href="#5-3å›é¡¾" class="headerlink" title="5.3å›é¡¾"></a>5.3å›é¡¾</h3><p>è‡³æ­¤ encode çš„æµç¨‹æˆ‘ä»¬å°±èµ°å®Œäº†, å›é¡¾ä¸€ä¸‹æ•´ä¸ª encode çš„æµç¨‹</p><ul><li><p>ä½¿ç”¨ ProtocolBuffer ç¼–ç  value</p></li><li><p>å°† </p><p>key</p><p> å’Œ </p><p>ç¼–ç åçš„ value</p><p> ä½¿ç”¨ ProtocolBuffer çš„æ ¼å¼ append åˆ°æ–‡ä»¶æ˜ å°„åŒºå†…å­˜çš„å°¾éƒ¨ </p><ul><li>æ–‡ä»¶ç©ºé—´ä¸è¶³ <ul><li>åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</li><li>è¿›è¡Œæ•°æ®çš„å›å†™</li></ul></li><li>å³åœ¨æ–‡ä»¶åè¿›è¡Œè¿½åŠ </li></ul></li><li><p>å¯¹è¿™ä¸ªé”®å€¼å¯¹åŒºåŸŸè¿›è¡Œç»Ÿä¸€çš„åŠ å¯†</p></li><li><p>æ›´æ–° CRC çš„å€¼</p></li><li><p>å°† key å’Œ value å¯¹åº”çš„ ProtocolBuffer ç¼–ç å†…å­˜åŒºåŸŸ, æ›´æ–°åˆ°æ•£åˆ—è¡¨ m_dic ä¸­</p></li></ul><p>é€šè¿‡ encode çš„åˆ†æ, æˆ‘ä»¬å¾—çŸ¥ MMKV æ–‡ä»¶çš„å­˜å‚¨æ–¹å¼å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190817212352.png" alt></p><p>æ¥ä¸‹æ¥çœ‹çœ‹ decode çš„æµç¨‹</p><h2 id="å…­ã€decode"><a href="#å…­ã€decode" class="headerlink" title="å…­ã€decode"></a>å…­ã€decode</h2><p>decode çš„è¿‡ç¨‹åŒæ ·ä»¥ decodeString ä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// native-bridge.cpp</span></span><br><span class="line">MMKV_JNI jstring</span><br><span class="line">decodeString(JNIEnv *env, jobject obj, jlong handle, jstring oKey, jstring oDefaultValue) &#123;</span><br><span class="line">    MMKV *kv = reinterpret_cast&lt;MMKV *&gt;(handle);</span><br><span class="line">    <span class="keyword">if</span> (kv &amp;&amp; oKey) &#123;</span><br><span class="line">        string key = jstring2string(env, oKey);</span><br><span class="line">        <span class="comment">// é€šè¿‡ getStringForKey, å°†æ•°æ®è¾“å‡ºåˆ°ä¼ å‡ºå‚æ•°ä¸­ value ä¸­</span></span><br><span class="line">        string value;</span><br><span class="line">        bool hasValue = kv-&gt;getStringForKey(key, value);</span><br><span class="line">        <span class="keyword">if</span> (hasValue) &#123;</span><br><span class="line">            <span class="keyword">return</span> string2jstring(env, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> oDefaultValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MMKV.cpp</span></span><br><span class="line">bool MMKV::getStringForKey(<span class="keyword">const</span> std::string &amp;key, std::string &amp;result) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key.empty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    SCOPEDLOCK(m_lock);</span><br><span class="line">    <span class="comment">// 1. ä»å†…å­˜ç¼“å­˜ä¸­è·å–æ•°æ®</span></span><br><span class="line">    auto &amp;data = getDataForKey(key);</span><br><span class="line">    <span class="keyword">if</span> (data.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 2. è§£æ data å¯¹åº”çš„ ProtocolBuffer æ•°æ®</span></span><br><span class="line">        result = MiniPBCoder::decodeString(data);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MMBuffer &amp;MMKV::getDataForKey(<span class="keyword">const</span> std::string &amp;key) &#123;</span><br><span class="line">    <span class="comment">// ä»æ•£åˆ—è¡¨ä¸­è·å– key å¯¹åº”çš„ value</span></span><br><span class="line">    auto itr = m_dic.find(key);</span><br><span class="line">    <span class="keyword">if</span> (itr != m_dic.end()) &#123;</span><br><span class="line">        <span class="keyword">return</span> itr-&gt;second;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> MMBuffer <span class="title">nan</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> nan;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½çš„å¯ä»¥çœ‹åˆ° decode çš„æµç¨‹æ¯”è¾ƒç®€å•, å…ˆä»å†…å­˜ç¼“å­˜ä¸­è·å– key å¯¹åº”çš„ value çš„ ProtocolBuffer å†…å­˜åŒºåŸŸ, å†è§£æè¿™å—å†…å­˜åŒºåŸŸ, ä»ä¸­è·å–çœŸæ­£çš„ value å€¼</p><h3 id="6-1-æ€è€ƒ"><a href="#6-1-æ€è€ƒ" class="headerlink" title="6.1 æ€è€ƒ"></a>6.1 æ€è€ƒ</h3><p>çœ‹åˆ°è¿™é‡Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªç–‘é—®, <strong>ä¸ºä»€ä¹ˆ m_dic ä¸ç›´æ¥å­˜å‚¨ key å’Œ value åŸå§‹æ•°æ®å‘¢, è¿™æ ·æŸ¥è¯¢æ•ˆç‡ä¸æ˜¯æ›´å¿«å—?</strong></p><ul><li>å¦‚æ­¤ä¸€æ¥æŸ¥è¯¢æ•ˆç‡çš„ç¡®ä¼šæ›´å¿«, å› ä¸ºå°‘äº† ProtocolBuffer è§£ç çš„è¿‡ç¨‹</li></ul><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190817212418.png" alt></p><p>ä»å›¾ä¸Šçš„ç»“æœå¯ä»¥çœ‹å‡º, MMKV çš„è¯»å–æ€§èƒ½æ—¶ç•¥ä½äº SharedPreferences çš„, è¿™é‡Œç¬”è€…ç»™å‡ºè‡ªå·±çš„æ€è€ƒ</p><ul><li><strong>m_dic åœ¨æ•°æ®é‡æ•´ä¸­ä¹Ÿèµ·åˆ°äº†éå¸¸é‡è¦çš„ä½œç”¨, éœ€è¦ä¾é  m_dic å°†æ•°æ®å†™å…¥åˆ° mmap çš„æ–‡ä»¶æ˜ å°„åŒº</strong>, è¿™ä¸ªè¿‡ç¨‹æ˜¯éå¸¸è€—æ—¶çš„, è‹¥æ˜¯åŸå§‹çš„ value, åˆ™éœ€è¦å¯¹æ‰€æœ‰çš„ value å†è¿›è¡Œä¸€æ¬¡ ProtocolBuffer ç¼–ç æ“ä½œ, å°¤å…¶æ˜¯å½“æ•°æ®é‡æ¯”è¾ƒåºå¤§æ—¶, å…¶å¸¦æ¥çš„æ€§èƒ½æŸè€—æ›´æ˜¯æ— æ³•å¿½ç•¥çš„</li></ul><p>æ—¢ç„¶ m_dic è¿˜æ‰¿æ‹…ç€æ–¹ä¾¿æ•°æ®å¤å†™çš„åŠŸèƒ½, é‚£<strong>èƒ½å¦å†æ·»åŠ ä¸€ä¸ªå†…å­˜ç¼“å­˜ä¸“é—¨ç”¨äºå­˜å‚¨åŸå§‹çš„ value å‘¢?</strong></p><ul><li>å½“ç„¶å¯ä»¥, è¿™æ · MMKV çš„è¯»å–å®šæ˜¯èƒ½å¤Ÿè¾¾åˆ° SharedPreferences çš„æ°´å¹³, ä¸è¿‡ value çš„å†…å­˜æ¶ˆè€—åˆ™ä¼šåŠ å€, <strong>MMKV ä½œä¸ºä¸€ä¸ªè½»é‡çº§ç¼“å­˜çš„æ¡†æ¶, æŸ¥è¯¢æ—¶æ—¶é—´çš„æå‡å¹…åº¦è¿˜ä¸è¶³ä»¥ç”¨å†…å­˜åŠ å€çš„ä»£ä»·å»æ¢å–</strong>, æˆ‘æƒ³è¿™æ˜¯ Tencent åœ¨è¿›è¡Œå¤šæ–¹é¢æƒè¡¡ä¹‹å, å¾—åˆ°çš„ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„è§£å†³æ–¹æ¡ˆ</li></ul><h2 id="ä¸ƒã€è¿›ç¨‹è¯»å†™çš„åŒæ­¥"><a href="#ä¸ƒã€è¿›ç¨‹è¯»å†™çš„åŒæ­¥" class="headerlink" title="ä¸ƒã€è¿›ç¨‹è¯»å†™çš„åŒæ­¥"></a>ä¸ƒã€è¿›ç¨‹è¯»å†™çš„åŒæ­¥</h2><p>è¯´èµ·è¿›ç¨‹é—´è¯»å†™åŒæ­¥, æˆ‘ä»¬å¾ˆè‡ªç„¶çš„æƒ³åˆ° Linux çš„å…±äº«å†…å­˜é…åˆä¿¡å·é‡ä½¿ç”¨çš„æ¡ˆä¾‹, ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªå¼Šç«¯, é‚£å°±æ˜¯<strong>å½“æŒæœ‰é”çš„è¿›ç¨‹æ„å¤–æ­»äº¡çš„æ—¶å€™, å¹¶ä¸ä¼šé‡Šæ”¾å…¶æ‹¥æœ‰çš„ä¿¡å·é‡, è‹¥å¤šè¿›ç¨‹ä¹‹é—´å­˜åœ¨ç«äº‰, é‚£ä¹ˆé˜»å¡çš„è¿›ç¨‹å°†ä¸ä¼šè¢«å”¤é†’</strong>, è¿™æ˜¯éå¸¸å±é™©çš„</p><p>MMKV æ˜¯é‡‡ç”¨ <strong>æ–‡ä»¶é”</strong> çš„æ–¹å¼æ¥è¿›è¡Œè¿›ç¨‹é—´çš„åŒæ­¥æ“ä½œ</p><ul><li><strong>LOCK_SH(å…±äº«é”)</strong>: å¤šä¸ªè¿›ç¨‹å¯ä»¥ä½¿ç”¨åŒä¸€æŠŠé”, å¸¸è¢«ç”¨ä½œè¯»å…±äº«é”</li><li><strong>LOCK_EX(æ’ä»–é”)</strong>: åŒæ—¶åªå…è®¸ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨, å¸¸è¢«ç”¨ä½œå†™é”</li><li><strong>LOCK_UN</strong>: é‡Šæ”¾é”</li></ul><p>æ¥ä¸‹æ¥æˆ‘çœ‹çœ‹ MMKV åŠ è§£é”çš„æ“ä½œ</p><h3 id="7-1-æ–‡ä»¶å…±äº«é”"><a href="#7-1-æ–‡ä»¶å…±äº«é”" class="headerlink" title="7.1 æ–‡ä»¶å…±äº«é”"></a>7.1 æ–‡ä»¶å…±äº«é”</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">MMKV::MMKV(</span><br><span class="line">    <span class="keyword">const</span> std::string &amp;mmapID, <span class="keyword">int</span> size, MMKVMode mode, string *cryptKey, string *relativePath)</span><br><span class="line">    : m_mmapID(mmapedKVKey(mmapID, relativePath))</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–‡ä»¶é”çš„æè¿°</span></span><br><span class="line">    , m_fileLock(m_metaFile.getFd())</span><br><span class="line">    <span class="comment">// æè¿°å…±äº«é”</span></span><br><span class="line">    , m_sharedProcessLock(&amp;m_fileLock, SharedLockType)</span><br><span class="line">    <span class="comment">// æè¿°æ’å®ƒé”</span></span><br><span class="line">    , m_exclusiveProcessLock(&amp;m_fileLock, ExclusiveLockType)</span><br><span class="line">    <span class="comment">// åˆ¤è¯»æ˜¯å¦ä¸ºè¿›ç¨‹é—´é€šä¿¡</span></span><br><span class="line">    , m_isInterProcess((mode &amp; MMKV_MULTI_PROCESS) != <span class="number">0</span> || (mode &amp; CONTEXT_MODE_MULTI_PROCESS) != <span class="number">0</span>)</span><br><span class="line">    , m_isAshmem((mode &amp; MMKV_ASHMEM) != <span class="number">0</span>) &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// æ ¹æ®æ˜¯å¦è·¨è¿›ç¨‹æ“ä½œåˆ¤æ–­å…±äº«é”å’Œæ’å®ƒé”çš„å¼€å…³</span></span><br><span class="line">    m_sharedProcessLock.m_enable = m_isInterProcess;</span><br><span class="line">    m_exclusiveProcessLock.m_enable = m_isInterProcess;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sensitive zone</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ–‡ä»¶è¯»æ“ä½œ, å¯ç”¨äº†æ–‡ä»¶å…±äº«é”</span></span><br><span class="line">        SCOPEDLOCK(m_sharedProcessLock);</span><br><span class="line">        loadFromFile();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨æˆ‘ä»¬å‰é¢åˆ†æè¿‡çš„æ„é€ å‡½æ•°ä¸­, MMKV å¯¹æ–‡ä»¶é”è¿›è¡Œäº†åˆå§‹åŒ–, å¹¶ä¸”åˆ›å»ºäº†å…±äº«é”å’Œæ’å®ƒé”, å¹¶åœ¨è·¨è¿›ç¨‹æ“ä½œæ—¶å¼€å¯, å½“è¿›è¡Œè¯»æ“ä½œæ—¶, å¯åŠ¨äº†å…±äº«é”</p><h3 id="7-2-æ–‡ä»¶æ’å®ƒé”"><a href="#7-2-æ–‡ä»¶æ’å®ƒé”" class="headerlink" title="7.2 æ–‡ä»¶æ’å®ƒé”"></a>7.2 æ–‡ä»¶æ’å®ƒé”</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">bool MMKV::fullWriteback() &#123;</span><br><span class="line">    ......</span><br><span class="line">    auto allData = MiniPBCoder::encodeDataWithObject(m_dic);</span><br><span class="line">    <span class="comment">// å¯åŠ¨äº†æ’å®ƒé”</span></span><br><span class="line">    SCOPEDLOCK(m_exclusiveProcessLock);</span><br><span class="line">    <span class="keyword">if</span> (allData.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (allData.length() + Fixed32Size &lt;= m_size) &#123;</span><br><span class="line">            <span class="keyword">if</span> (m_crypter) &#123;</span><br><span class="line">                m_crypter-&gt;reset();</span><br><span class="line">                auto ptr = (unsigned <span class="keyword">char</span> *) allData.getPtr();</span><br><span class="line">                m_crypter-&gt;encrypt(ptr, ptr, allData.length());</span><br><span class="line">            &#125;</span><br><span class="line">            writeAcutalSize(allData.length());</span><br><span class="line">            delete m_output;</span><br><span class="line">            m_output = <span class="keyword">new</span> CodedOutputData(m_ptr + Fixed32Size, m_size - Fixed32Size);</span><br><span class="line">            m_output-&gt;writeRawData(allData); <span class="comment">// note: don't write size of data</span></span><br><span class="line">            recaculateCRCDigest();</span><br><span class="line">            m_hasFullWriteback = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ensureMemorySize will extend file &amp; full rewrite, no need to write back again</span></span><br><span class="line">            <span class="keyword">return</span> ensureMemorySize(allData.length() + Fixed32Size - m_size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿›è¡Œæ•°æ®å›å†™çš„å‡½æ•°ä¸­, å¯åŠ¨äº†æ’å®ƒé”</p><h3 id="7-3-è¯»å†™æ•ˆç‡è¡¨ç°"><a href="#7-3-è¯»å†™æ•ˆç‡è¡¨ç°" class="headerlink" title="7.3 è¯»å†™æ•ˆç‡è¡¨ç°"></a>7.3 è¯»å†™æ•ˆç‡è¡¨ç°</h3><p>å…¶è¿›ç¨‹åŒæ­¥è¯»å†™çš„æ€§èƒ½è¡¨ç°å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190817212512.png" alt></p><p>å¯ä»¥çœ‹åˆ°è¿›ç¨‹åŒæ­¥è¯»å†™çš„æ•ˆç‡ä¹Ÿæ˜¯éå¸¸ nice çš„</p><p>å…³äºè·¨è¿›ç¨‹åŒæ­¥å°±ä»‹ç»åˆ°è¿™é‡Œ, å½“ç„¶ MMKV çš„æ–‡ä»¶é”å¹¶æ²¡æœ‰è¡¨é¢ä¸Šé‚£ä¹ˆç®€å•, å› ä¸ºæ–‡ä»¶é”ä¸ºçŠ¶æ€é”, æ— è®ºåŠ äº†å¤šå°‘æ¬¡é”, ä¸€ä¸ªè§£é”æ“ä½œå°±å…¨è§£é™¤, æ˜¾ç„¶æ— æ³•åº”å¯¹å­å‡½æ•°åµŒå¥—è°ƒç”¨çš„é—®é¢˜, <strong>MMKV å†…éƒ¨é€šè¿‡äº†è‡ªè¡Œå®ç°è®¡æ•°å™¨æ¥å®ç°é”çš„å¯é‡å…¥æ€§</strong>, æ›´å¤šçš„ç»†èŠ‚å¯ä»¥æŸ¥çœ‹ <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FTencent%2FMMKV%2Fwiki%2Fandroid_ipc" target="_blank" rel="noopener">wiki</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä¸Šé¢çš„åˆ†æ, æˆ‘ä»¬å¯¹ MMKV æœ‰äº†ä¸€ä¸ªæ•´ä½“ä¸Šçš„æŠŠæ§, å…¶å…·ä½“çš„è¡¨ç°å¦‚ä¸‹æ‰€ç¤º</p><table><thead><tr><th>é¡¹ç›®</th><th>è¯„ä»·</th><th>æè¿°</th></tr></thead><tbody><tr><td>æ­£ç¡®æ€§</td><td>ä¼˜</td><td>æ”¯æŒå¤šè¿›ç¨‹å®‰å…¨, ä½¿ç”¨ mmap, ç”±æ“ä½œç³»ç»Ÿä¿è¯æ•°æ®å›å†™çš„æ­£ç¡®æ€§</td></tr><tr><td>æ—¶é—´å¼€é”€</td><td>ä¼˜</td><td>ä½¿ç”¨ mmap å®ç°, å‡å°‘äº†ç”¨æˆ·ç©ºé—´æ•°æ®åˆ°å†…æ ¸ç©ºé—´çš„æ‹·è´</td></tr><tr><td>ç©ºé—´å¼€é”€</td><td>ä¸­</td><td>ä½¿ç”¨ protocl buffer å­˜å‚¨æ•°æ®, åŒæ ·çš„æ•°æ®ä¼šæ¯” xml å’Œ json æ¶ˆè€—ç©ºé—´å°   ä½¿ç”¨çš„æ˜¯æ•°æ®è¿½åŠ åˆ°æœ«å°¾çš„æ–¹å¼, åªæœ‰åˆ°è¾¾ä¸€å®šé˜ˆå€¼ä¹‹åæ‰ä¼šè§¦å‘é”®å€¼åˆå¹¶, ä¸åˆå¹¶ä¹‹å‰ä¼šå¯¼è‡´åŒä¸€ä¸ª key å­˜åœ¨å¤šä»½</td></tr><tr><td>å®‰å…¨</td><td>ä¸­</td><td>ä½¿ç”¨ crc æ ¡éªŒ, ç”„åˆ«æ–‡ä»¶ç³»ç»Ÿå’Œæ“ä½œç³»ç»Ÿä¸ç¨³å®šå¯¼è‡´çš„å¼‚å¸¸æ•°æ®</td></tr><tr><td>å¼€å‘æˆæœ¬</td><td>ä¼˜</td><td>ä½¿ç”¨æ–¹å¼è¾ƒä¸ºç®€å•</td></tr><tr><td>å…¼å®¹æ€§</td><td>ä¼˜</td><td>å„ä¸ªå®‰å“ç‰ˆæœ¬éƒ½å‰åå…¼å®¹</td></tr></tbody></table><p>è™½ç„¶ MMKV ä¸€äº›åœºæ™¯ä¸‹æ¯” SP ç¨æ…¢(å¦‚: é¦–æ¬¡å®ä¾‹åŒ–ä¼šè¿›è¡Œæ•°æ®çš„å¤å†™å‰”é™¤é‡å¤æ•°æ®, æ¯” SP ç¨æ…¢, æŸ¥è¯¢æ•°æ®æ—¶å­˜åœ¨ ProtocolBuffer è§£ç , æ¯” SP ç¨æ…¢), ä½†å…¶<strong>é€†å¤©çš„æ•°æ®å†™å…¥é€Ÿåº¦ã€mmap Linux å†…æ ¸ä¿è¯æ•°æ®çš„åŒæ­¥, ä»¥åŠ ProtocolBuffer ç¼–ç å¸¦æ¥çš„æ›´å°çš„æœ¬åœ°å­˜å‚¨ç©ºé—´å ç”¨ç­‰éƒ½æ˜¯éå¸¸æ£’çš„é—ªå…‰ç‚¹</strong></p><p>åœ¨åˆ†æ MMKV çš„ä»£ç çš„è¿‡ç¨‹ä¸­, ä»ä¸­å­¦ä¹ åˆ°äº†å¾ˆå¤šçŸ¥è¯†, éå¸¸æ„Ÿè°¢ Tencent ä¸ºå¼€æºç¤¾åŒºåšå‡ºçš„è´¡çŒ®</p><h2 id="å…«ã€å‚è€ƒæ–‡çŒ®"><a href="#å…«ã€å‚è€ƒæ–‡çŒ®" class="headerlink" title="å…«ã€å‚è€ƒæ–‡çŒ®"></a>å…«ã€å‚è€ƒæ–‡çŒ®</h2><ul><li><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FTencent%2FMMKV%2Fwiki%2Fandroid_setup_cn" target="_blank" rel="noopener">github.com/Tencent/MMKâ€¦</a></li><li><a href="https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fencoding" target="_blank" rel="noopener">developers.google.com/protocol-buâ€¦</a></li><li><a href="https://link.juejin.im?target=https%3A%2F%2Ftime.geekbang.org%2Fcolumn%2Farticle%2F76677" target="_blank" rel="noopener">time.geekbang.org/column/artiâ€¦</a></li><li><a href="https://link.juejin.im?target=https%3A%2F%2Fwww.cnblogs.com%2Fkex1n%2Fp%2F7100107.html" target="_blank" rel="noopener">www.cnblogs.com/kex1n/p/710â€¦</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ä¸€ã€å‰è¨€&quot;&gt;&lt;a href=&quot;#ä¸€ã€å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€å‰è¨€&quot;&gt;&lt;/a&gt;ä¸€ã€å‰è¨€&lt;/h2&gt;&lt;p&gt;APP çš„æ€§èƒ½ä¼˜åŒ–ä¹‹è·¯æ˜¯æ°¸æ— æ­¢å¢ƒçš„, è¿™é‡Œå­¦ä¹ ä¸€ä¸ª&lt;strong&gt;è…¾è®¯å¼€æºç”¨äºæå‡æœ¬åœ°å­˜å‚¨æ•ˆç‡çš„è½»é‡çº§å­˜å‚¨æ¡†æ¶&lt;/strong&gt; &lt;a href=&quot;https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FTencent%2FMMKV&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;MMKV&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç›®å‰é¡¹ç›®ä¸­åœ¨è½»é‡çº§å­˜å‚¨ä¸Šä½¿ç”¨çš„æ˜¯ SharedPreferences, è™½ç„¶ SP å…¼å®¹æ€§æå¥½, ä½† SP çš„ä½æ€§èƒ½ä¸€ç›´è¢«è¯Ÿç—…, çº¿ä¸Šä¹Ÿå‡ºç°äº†ä¸€äº›å› ä¸º SP å¯¼è‡´çš„ ANR&lt;/p&gt;
&lt;p&gt;ç½‘ä¸Šæœ‰å¾ˆå¤šé’ˆå¯¹ SP çš„ä¼˜åŒ–æ–¹æ¡ˆ, è¿™é‡Œç¬”è€…ä½¿ç”¨çš„æ˜¯é€šè¿‡ Hook SP åœ¨ Application ä¸­çš„åˆ›å»º, å°†å…¶æ›¿æ¢æˆè‡ªå®šä¹‰çš„ SP çš„æ–¹å¼æ¥å¢å¼ºæ€§èƒ½, ä½† SDK 28 ä»¥åç¦æ­¢åå°„ QueuedWork.getHandler æ¥å£, è¿™ä¸ªæ–¹å¼å°±å¤±æ•ˆäº†&lt;/p&gt;
&lt;p&gt;å› æ­¤éœ€è¦ä¸€ç§æ›¿ä»£çš„è½»é‡çº§å­˜å‚¨æ–¹æ¡ˆ, MMKV ä¾¿æ˜¯è¿™æ ·çš„ä¸€ä¸ªæ¡†æ¶&lt;/p&gt;
&lt;h2 id=&quot;äºŒã€é›†æˆä¸æµ‹è¯•&quot;&gt;&lt;a href=&quot;#äºŒã€é›†æˆä¸æµ‹è¯•&quot; class=&quot;headerlink&quot; title=&quot;äºŒã€é›†æˆä¸æµ‹è¯•&quot;&gt;&lt;/a&gt;äºŒã€é›†æˆä¸æµ‹è¯•&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹ä»‹ç»ç®€å•çš„ä½¿ç”¨æ–¹å¼, æ›´å¤šè¯¦æƒ…è¯·æŸ¥çœ‹ &lt;a href=&quot;https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FTencent%2FMMKV%2Fwiki%2Fandroid_setup_cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Wiki&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-1-ä¾èµ–æ³¨å…¥&quot;&gt;&lt;a href=&quot;#2-1-ä¾èµ–æ³¨å…¥&quot; class=&quot;headerlink&quot; title=&quot;2.1 ä¾èµ–æ³¨å…¥&quot;&gt;&lt;/a&gt;2.1 ä¾èµ–æ³¨å…¥&lt;/h3&gt;&lt;p&gt;åœ¨ App æ¨¡å—çš„ build.gradle æ–‡ä»¶é‡Œæ·»åŠ :&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dependencies &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    implementation &amp;apos;com.tencent:mmkv:1.0.22&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // replace &amp;quot;1.0.22&amp;quot; with any available version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="æ¡†æ¶" scheme="https://zhangmiao.cc/categories/Android/%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="æ¡†æ¶" scheme="https://zhangmiao.cc/tags/%E6%A1%86%E6%9E%B6/"/>
    
  </entry>
  
  <entry>
    <title>BannerViewPage</title>
    <link href="https://zhangmiao.cc/posts/6831bdd1.html"/>
    <id>https://zhangmiao.cc/posts/6831bdd1.html</id>
    <published>2019-08-13T10:13:23.000Z</published>
    <updated>2019-08-13T10:17:35.408Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BannerViewPage"><a href="#BannerViewPage" class="headerlink" title="BannerViewPage"></a><a href="https://github.com/zhangmiaocc/BannerViewPage" target="_blank" rel="noopener">BannerViewPage</a></h1><p>Bannerå½“å‰å±å¹•æ˜¾ç¤ºä¸‹ä¸€é¡µå†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œç”¨ViewPageråç§»æ¥å®ç°ã€‚</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/aaa.gif" alt></p><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;BannerViewPage&quot;&gt;&lt;a href=&quot;#BannerViewPage&quot; class=&quot;headerlink&quot; title=&quot;BannerViewPage&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://github.com/zhangmiaocc/BannerViewPage&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;BannerViewPage&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Bannerå½“å‰å±å¹•æ˜¾ç¤ºä¸‹ä¸€é¡µå†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œç”¨ViewPageråç§»æ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/aaa.gif&quot; alt&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="View" scheme="https://zhangmiao.cc/categories/Android/View/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="View" scheme="https://zhangmiao.cc/tags/View/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºOKRçš„è§£è¯»</title>
    <link href="https://zhangmiao.cc/posts/5b77eb6.html"/>
    <id>https://zhangmiao.cc/posts/5b77eb6.html</id>
    <published>2019-07-31T06:56:33.000Z</published>
    <updated>2019-07-31T07:00:21.114Z</updated>
    
    <content type="html"><![CDATA[<p>OKRæ˜¯ä¸€å¥—ä¸¥å¯†çš„æ€è€ƒæ¡†æ¶å’ŒæŒç»­çš„çºªå¾‹è¦æ±‚ï¼Œæ—¨åœ¨ç¡®ä¿å‘˜å·¥ç´§å¯†åä½œï¼ŒæŠŠç²¾åŠ›èšç„¦åœ¨ä¿ƒè¿›ç»„ç»‡æˆé•¿çš„ã€å¯è¡¡é‡çš„è´¡çŒ®ä¸Šã€‚</p><p>å…·ä½“æ‹†è§£å¦‚ä¸‹ï¼š</p><p>1ã€ä¸¥å¯†çš„æ€è€ƒæ¡†æ¶ï¼šOKRæ„åœ¨æå‡ç»©æ•ˆï¼Œä½†å¦‚æœåªæ˜¯ç®€å•çš„æ¯ä¸ªå­£åº¦è·Ÿè¸ªä¸€ä¸‹çš„ä½ çš„ç»“æœï¼Œä½ ä¸ä¼šå¦‚å¿æ‰€æ„¿ã€‚</p><p>2ã€æŒç»­çš„çºªå¾‹è¦æ±‚ï¼šOKRä»£è¡¨äº†ä¸€ç§æ—¶é—´å’Œç²¾åŠ›ä¸Šçš„æ‰¿è¯ºã€‚</p><ul><li>ä»¥å­£åº¦ï¼ˆæˆ–è€…å…¶ä»–é¢„å…ˆè§„å®šçš„å‘¨æœŸï¼‰ä¸ºå•ä½åˆ·æ–°OKRï¼›</li><li>ä»”ç»†ç¡®è®¤ç»“æœè¾¾æˆæƒ…å†µï¼›</li><li>å¦‚æœ‰å¿…è¦ï¼ŒæŒç»­ä¿®æ­£ç°è¡Œæˆ˜ç•¥å’Œå•†ä¸šæ¨¡å¼ï¼›</li><li>ç»“æœå¯¼å‘ã€‚</li></ul><p>3ã€ç¡®ä¿å‘˜å·¥ç´§å¯†åä½œï¼šç”±äºOKRå¯¹æ¯ä¸ªäººéƒ½å……åˆ†å…±äº«ï¼Œç»„ç»‡å†…ä»ä¸Šè‡³ä¸‹éƒ½å¯ä»¥çœ‹åˆ°OKRåŠå…¶è¾¾æˆæƒ…å†µã€‚</p><p>4ã€ç²¾åŠ›èšç„¦ï¼šOKRä¸æ˜¯ï¼Œä¹Ÿä¸åº”è¢«å½“æˆä¸€å¼ å¾…å®Œæˆçš„ä»»åŠ¡æ¸…å•ã€‚OKRçš„ä¸»è¦ç›®çš„æ˜¯ç”¨æ¥è¯†åˆ«æœ€å…³é”®çš„ä¸šåŠ¡ç›®æ ‡ï¼Œå¹¶é€šè¿‡é‡åŒ–çš„å…³é”®ç»“æœå»è¡¡é‡ç›®æ ‡è¾¾æˆæƒ…å†µã€‚æˆ˜ç•¥å°±æ˜¯ä¸åšä»€ä¹ˆå’Œåšä»€ä¹ˆï¼Œä¸¤è€…éƒ½åŒç­‰é‡è¦ï¼Œä¸å¯ååºŸï¼OKRä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä½ å¿…é¡»åšå‡ºæœ€ç»ˆå–èˆï¼Œå†³å®šå“ªäº›å†…å®¹æ‰æ˜¯ä½ æœ€ç»ˆçš„å…³æ³¨ç‚¹ã€‚</p><p>5ã€åšå‡ºå¯è¡¡é‡çš„è´¡çŒ®ï¼šä»»ä½•æ—¶å€™ï¼Œå¦‚æœ‰å¯èƒ½ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥å°½é‡é¿å…ä¸»è§‚æè¿°KRï¼ŒKRè¦èƒ½ç²¾ç¡®åœ°æŒ‡å‡ºå®ƒçš„è¾¾æˆå¯¹ä¸šåŠ¡ç©¶ç«Ÿæœ‰å¤šå¤§çš„ä¿ƒè¿›ä½œç”¨ã€‚</p><p>6ã€ä¿ƒè¿›ç»„ç»‡æˆé•¿ï¼šåˆ¤æ–­OKRæˆåŠŸä¸å¦çš„æœ€ç»ˆæ ‡å‡†ï¼Œè¿˜æ˜¯è¦ç”¨ç»“æœè¯´è¯ï¼Œçœ‹ä½ çš„ç›®æ ‡æ‰€å–å¾—çš„å®é™…æˆæœå¦‚ä½•ã€‚</p><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;OKRæ˜¯ä¸€å¥—ä¸¥å¯†çš„æ€è€ƒæ¡†æ¶å’ŒæŒç»­çš„çºªå¾‹è¦æ±‚ï¼Œæ—¨åœ¨ç¡®ä¿å‘˜å·¥ç´§å¯†åä½œï¼ŒæŠŠç²¾åŠ›èšç„¦åœ¨ä¿ƒè¿›ç»„ç»‡æˆé•¿çš„ã€å¯è¡¡é‡çš„è´¡çŒ®ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“æ‹†è§£å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;1ã€ä¸¥å¯†çš„æ€è€ƒæ¡†æ¶ï¼šOKRæ„åœ¨æå‡ç»©æ•ˆï¼Œä½†å¦‚æœåªæ˜¯ç®€å•çš„æ¯ä¸ªå­£åº¦è·Ÿè¸ªä¸€ä¸‹çš„ä½ çš„ç»“æœï¼Œä½ ä¸ä¼šå¦‚å¿æ‰€æ„¿ã€‚&lt;/p&gt;
&lt;p&gt;2ã€æŒç»­çš„çºªå¾‹è¦æ±‚ï¼šOKRä»£è¡¨äº†ä¸€ç§æ—¶é—´å’Œç²¾åŠ›ä¸Šçš„æ‰¿è¯ºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»¥å­£åº¦ï¼ˆæˆ–è€…å…¶ä»–é¢„å…ˆè§„å®šçš„å‘¨æœŸï¼‰ä¸ºå•ä½åˆ·æ–°OKRï¼›&lt;/li&gt;
&lt;li&gt;ä»”ç»†ç¡®è®¤ç»“æœè¾¾æˆæƒ…å†µï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœ‰å¿…è¦ï¼ŒæŒç»­ä¿®æ­£ç°è¡Œæˆ˜ç•¥å’Œå•†ä¸šæ¨¡å¼ï¼›&lt;/li&gt;
&lt;li&gt;ç»“æœå¯¼å‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;3ã€ç¡®ä¿å‘˜å·¥ç´§å¯†åä½œï¼šç”±äºOKRå¯¹æ¯ä¸ªäººéƒ½å……åˆ†å…±äº«ï¼Œç»„ç»‡å†…ä»ä¸Šè‡³ä¸‹éƒ½å¯ä»¥çœ‹åˆ°OKRåŠå…¶è¾¾æˆæƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;4ã€ç²¾åŠ›èšç„¦ï¼šOKRä¸æ˜¯ï¼Œä¹Ÿä¸åº”è¢«å½“æˆä¸€å¼ å¾…å®Œæˆçš„ä»»åŠ¡æ¸…å•ã€‚OKRçš„ä¸»è¦ç›®çš„æ˜¯ç”¨æ¥è¯†åˆ«æœ€å…³é”®çš„ä¸šåŠ¡ç›®æ ‡ï¼Œå¹¶é€šè¿‡é‡åŒ–çš„å…³é”®ç»“æœå»è¡¡é‡ç›®æ ‡è¾¾æˆæƒ…å†µã€‚æˆ˜ç•¥å°±æ˜¯ä¸åšä»€ä¹ˆå’Œåšä»€ä¹ˆï¼Œä¸¤è€…éƒ½åŒç­‰é‡è¦ï¼Œä¸å¯ååºŸï¼OKRä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä½ å¿…é¡»åšå‡ºæœ€ç»ˆå–èˆï¼Œå†³å®šå“ªäº›å†…å®¹æ‰æ˜¯ä½ æœ€ç»ˆçš„å…³æ³¨ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;5ã€åšå‡ºå¯è¡¡é‡çš„è´¡çŒ®ï¼šä»»ä½•æ—¶å€™ï¼Œå¦‚æœ‰å¯èƒ½ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥å°½é‡é¿å…ä¸»è§‚æè¿°KRï¼ŒKRè¦èƒ½ç²¾ç¡®åœ°æŒ‡å‡ºå®ƒçš„è¾¾æˆå¯¹ä¸šåŠ¡ç©¶ç«Ÿæœ‰å¤šå¤§çš„ä¿ƒè¿›ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;6ã€ä¿ƒè¿›ç»„ç»‡æˆé•¿ï¼šåˆ¤æ–­OKRæˆåŠŸä¸å¦çš„æœ€ç»ˆæ ‡å‡†ï¼Œè¿˜æ˜¯è¦ç”¨ç»“æœè¯´è¯ï¼Œçœ‹ä½ çš„ç›®æ ‡æ‰€å–å¾—çš„å®é™…æˆæœå¦‚ä½•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="awsome" scheme="https://zhangmiao.cc/categories/awsome/"/>
    
    
      <category term="awsome" scheme="https://zhangmiao.cc/tags/awsome/"/>
    
  </entry>
  
  <entry>
    <title>ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒï¼Œç°åº¦æµ‹è¯•</title>
    <link href="https://zhangmiao.cc/posts/5b196854.html"/>
    <id>https://zhangmiao.cc/posts/5b196854.html</id>
    <published>2019-07-30T07:36:54.000Z</published>
    <updated>2019-07-30T07:40:29.370Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒï¼Ÿ</h4><p>ç°åº¦å‘å¸ƒï¼Œåˆåé‡‘ä¸é›€å‘å¸ƒï¼Œæˆ–è€…ç°åº¦æµ‹è¯•ï¼Œæ˜¯æŒ‡åœ¨é»‘ä¸ç™½ä¹‹é—´èƒ½å¤Ÿå¹³æ»‘è¿‡æ¸¡çš„ä¸€ç§å‘å¸ƒæ–¹å¼ã€‚åœ¨å…¶ä¸Šå¯ä»¥è¿›è¡ŒA/B testingï¼Œå³è®©ä¸€éƒ¨åˆ†ç”¨æˆ·ç»§ç»­ç”¨äº§å“ç‰¹æ€§Aï¼Œä¸€éƒ¨åˆ†ç”¨æˆ·å¼€å§‹ç”¨äº§å“ç‰¹æ€§Bï¼Œå¦‚æœç”¨æˆ·å¯¹Bæ²¡æœ‰ä»€ä¹ˆåå¯¹æ„è§ï¼Œé‚£ä¹ˆé€æ­¥æ‰©å¤§èŒƒå›´ï¼ŒæŠŠæ‰€æœ‰ç”¨æˆ·éƒ½è¿ç§»åˆ°Bä¸Šé¢æ¥ã€‚</p><p>ç°åº¦å‘å¸ƒæ˜¯å¯¹æŸä¸€äº§å“çš„å‘å¸ƒé€æ­¥æ‰©å¤§ä½¿ç”¨ç¾¤ä½“èŒƒå›´ï¼Œä¹Ÿå«ç°åº¦æ”¾é‡ã€‚ç°åº¦å‘å¸ƒå¯ä»¥ä¿è¯æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šï¼Œåœ¨åˆå§‹ç°åº¦çš„æ—¶å€™å°±å¯ä»¥å‘ç°ã€è°ƒæ•´é—®é¢˜ï¼Œä»¥ä¿è¯å…¶å½±å“åº¦ã€‚</p><p>ç°åº¦æœŸï¼šç°åº¦å‘å¸ƒå¼€å§‹åˆ°ç»“æŸæœŸé—´çš„è¿™ä¸€æ®µæ—¶é—´ï¼Œç§°ä¸ºç°åº¦æœŸã€‚</p><h4 id="ç°åº¦å‘å¸ƒçš„æ„ä¹‰"><a href="#ç°åº¦å‘å¸ƒçš„æ„ä¹‰" class="headerlink" title="ç°åº¦å‘å¸ƒçš„æ„ä¹‰"></a>ç°åº¦å‘å¸ƒçš„æ„ä¹‰</h4><p>ç°åº¦å‘å¸ƒèƒ½åŠæ—©è·å¾—ç”¨æˆ·çš„æ„è§åé¦ˆï¼Œå®Œå–„äº§å“åŠŸèƒ½ï¼Œæå‡äº§å“è´¨é‡ï¼Œè®©ç”¨æˆ·å‚ä¸äº§å“æµ‹è¯•ï¼ŒåŠ å¼ºä¸ç”¨æˆ·äº’åŠ¨ï¼Œé™ä½äº§å“å‡çº§æ‰€å½±å“çš„ç”¨æˆ·èŒƒå›´ã€‚</p><h4 id="ç°åº¦å‘å¸ƒæ­¥éª¤"><a href="#ç°åº¦å‘å¸ƒæ­¥éª¤" class="headerlink" title="ç°åº¦å‘å¸ƒæ­¥éª¤"></a>ç°åº¦å‘å¸ƒæ­¥éª¤</h4><ol><li>å®šä¹‰ç›®æ ‡</li><li>é€‰å®šç­–ç•¥ï¼šåŒ…æ‹¬ç”¨æˆ·è§„æ¨¡ã€å‘å¸ƒé¢‘ç‡ã€åŠŸèƒ½è¦†ç›–åº¦ã€å›æ»šç­–ç•¥ã€è¿è¥ç­–ç•¥ã€æ–°æ—§ç³»ç»Ÿéƒ¨ç½²ç­–ç•¥ç­‰</li><li>ç­›é€‰ç”¨æˆ·ï¼šåŒ…æ‹¬ç”¨æˆ·ç‰¹å¾ã€ç”¨æˆ·æ•°é‡ã€ç”¨æˆ·å¸¸ç”¨åŠŸèƒ½ã€ç”¨æˆ·èŒƒå›´ç­‰</li><li>éƒ¨ç½²ç³»ç»Ÿï¼šéƒ¨ç½²æ–°ç³»ç»Ÿã€éƒ¨ç½²ç”¨æˆ·è¡Œä¸ºåˆ†æç³»ç»Ÿï¼ˆweb analyticsï¼‰ã€è®¾å®šåˆ†æµè§„åˆ™ã€è¿è¥æ•°æ®åˆ†æã€åˆ†æµè§„åˆ™å¾®è°ƒ</li><li>å‘å¸ƒæ€»ç»“ï¼šç”¨æˆ·è¡Œä¸ºåˆ†ææŠ¥å‘Šã€ç”¨æˆ·é—®å·è°ƒæŸ¥ã€ç¤¾ä¼šåŒ–åª’ä½“æ„è§æ”¶é›†ã€å½¢æˆäº§å“åŠŸèƒ½æ”¹è¿›åˆ—è¡¨</li><li>äº§å“å®Œå–„</li><li>æ–°ä¸€è½®ç°åº¦å‘å¸ƒæˆ–å®Œæ•´å‘å¸ƒ</li></ol><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒï¼Ÿ&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒï¼Ÿ&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒï¼Ÿ&lt;/h4&gt;&lt;p&gt;ç°åº¦å‘å¸ƒï¼Œåˆåé‡‘ä¸é›€å‘å¸ƒï¼Œæˆ–è€…ç°åº¦æµ‹è¯•ï¼Œæ˜¯æŒ‡åœ¨é»‘ä¸ç™½ä¹‹é—´èƒ½å¤Ÿå¹³æ»‘è¿‡æ¸¡çš„ä¸€ç§å‘å¸ƒæ–¹å¼ã€‚åœ¨å…¶ä¸Šå¯ä»¥è¿›è¡ŒA/B testingï¼Œå³è®©ä¸€éƒ¨åˆ†ç”¨æˆ·ç»§ç»­ç”¨äº§å“ç‰¹æ€§Aï¼Œä¸€éƒ¨åˆ†ç”¨æˆ·å¼€å§‹ç”¨äº§å“ç‰¹æ€§Bï¼Œå¦‚æœç”¨æˆ·å¯¹Bæ²¡æœ‰ä»€ä¹ˆåå¯¹æ„è§ï¼Œé‚£ä¹ˆé€æ­¥æ‰©å¤§èŒƒå›´ï¼ŒæŠŠæ‰€æœ‰ç”¨æˆ·éƒ½è¿ç§»åˆ°Bä¸Šé¢æ¥ã€‚&lt;/p&gt;
&lt;p&gt;ç°åº¦å‘å¸ƒæ˜¯å¯¹æŸä¸€äº§å“çš„å‘å¸ƒé€æ­¥æ‰©å¤§ä½¿ç”¨ç¾¤ä½“èŒƒå›´ï¼Œä¹Ÿå«ç°åº¦æ”¾é‡ã€‚ç°åº¦å‘å¸ƒå¯ä»¥ä¿è¯æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šï¼Œåœ¨åˆå§‹ç°åº¦çš„æ—¶å€™å°±å¯ä»¥å‘ç°ã€è°ƒæ•´é—®é¢˜ï¼Œä»¥ä¿è¯å…¶å½±å“åº¦ã€‚&lt;/p&gt;
&lt;p&gt;ç°åº¦æœŸï¼šç°åº¦å‘å¸ƒå¼€å§‹åˆ°ç»“æŸæœŸé—´çš„è¿™ä¸€æ®µæ—¶é—´ï¼Œç§°ä¸ºç°åº¦æœŸã€‚&lt;/p&gt;
&lt;h4 id=&quot;ç°åº¦å‘å¸ƒçš„æ„ä¹‰&quot;&gt;&lt;a href=&quot;#ç°åº¦å‘å¸ƒçš„æ„ä¹‰&quot; class=&quot;headerlink&quot; title=&quot;ç°åº¦å‘å¸ƒçš„æ„ä¹‰&quot;&gt;&lt;/a&gt;ç°åº¦å‘å¸ƒçš„æ„ä¹‰&lt;/h4&gt;&lt;p&gt;ç°åº¦å‘å¸ƒèƒ½åŠæ—©è·å¾—ç”¨æˆ·çš„æ„è§åé¦ˆï¼Œå®Œå–„äº§å“åŠŸèƒ½ï¼Œæå‡äº§å“è´¨é‡ï¼Œè®©ç”¨æˆ·å‚ä¸äº§å“æµ‹è¯•ï¼ŒåŠ å¼ºä¸ç”¨æˆ·äº’åŠ¨ï¼Œé™ä½äº§å“å‡çº§æ‰€å½±å“çš„ç”¨æˆ·èŒƒå›´ã€‚&lt;/p&gt;
&lt;h4 id=&quot;ç°åº¦å‘å¸ƒæ­¥éª¤&quot;&gt;&lt;a href=&quot;#ç°åº¦å‘å¸ƒæ­¥éª¤&quot; class=&quot;headerlink&quot; title=&quot;ç°åº¦å‘å¸ƒæ­¥éª¤&quot;&gt;&lt;/a&gt;ç°åº¦å‘å¸ƒæ­¥éª¤&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;å®šä¹‰ç›®æ ‡&lt;/li&gt;
&lt;li&gt;é€‰å®šç­–ç•¥ï¼šåŒ…æ‹¬ç”¨æˆ·è§„æ¨¡ã€å‘å¸ƒé¢‘ç‡ã€åŠŸèƒ½è¦†ç›–åº¦ã€å›æ»šç­–ç•¥ã€è¿è¥ç­–ç•¥ã€æ–°æ—§ç³»ç»Ÿéƒ¨ç½²ç­–ç•¥ç­‰&lt;/li&gt;
&lt;li&gt;ç­›é€‰ç”¨æˆ·ï¼šåŒ…æ‹¬ç”¨æˆ·ç‰¹å¾ã€ç”¨æˆ·æ•°é‡ã€ç”¨æˆ·å¸¸ç”¨åŠŸèƒ½ã€ç”¨æˆ·èŒƒå›´ç­‰&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²ç³»ç»Ÿï¼šéƒ¨ç½²æ–°ç³»ç»Ÿã€éƒ¨ç½²ç”¨æˆ·è¡Œä¸ºåˆ†æç³»ç»Ÿï¼ˆweb analyticsï¼‰ã€è®¾å®šåˆ†æµè§„åˆ™ã€è¿è¥æ•°æ®åˆ†æã€åˆ†æµè§„åˆ™å¾®è°ƒ&lt;/li&gt;
&lt;li&gt;å‘å¸ƒæ€»ç»“ï¼šç”¨æˆ·è¡Œä¸ºåˆ†ææŠ¥å‘Šã€ç”¨æˆ·é—®å·è°ƒæŸ¥ã€ç¤¾ä¼šåŒ–åª’ä½“æ„è§æ”¶é›†ã€å½¢æˆäº§å“åŠŸèƒ½æ”¹è¿›åˆ—è¡¨&lt;/li&gt;
&lt;li&gt;äº§å“å®Œå–„&lt;/li&gt;
&lt;li&gt;æ–°ä¸€è½®ç°åº¦å‘å¸ƒæˆ–å®Œæ•´å‘å¸ƒ&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="awsome" scheme="https://zhangmiao.cc/categories/awsome/"/>
    
    
      <category term="awsome" scheme="https://zhangmiao.cc/tags/awsome/"/>
    
  </entry>
  
  <entry>
    <title>java.lang.ClassNotFoundException:&quot;org.apache.http.ProtocolVersion&quot;</title>
    <link href="https://zhangmiao.cc/posts/c7a54c5f.html"/>
    <id>https://zhangmiao.cc/posts/c7a54c5f.html</id>
    <published>2019-07-26T03:38:39.000Z</published>
    <updated>2019-07-26T03:46:34.082Z</updated>
    
    <content type="html"><![CDATA[<h3 id="è¿è¡Œé¡¹ç›®é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š"><a href="#è¿è¡Œé¡¹ç›®é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š" class="headerlink" title="è¿è¡Œé¡¹ç›®é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š"></a>è¿è¡Œé¡¹ç›®é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š</h3><blockquote><p>Caused by: java.lang.ClassNotFoundException: Didnâ€™t find class â€œorg.apache.http.ProtocolVersionâ€ on path: DexPathList[[zip file â€œ/data/user_de/0/com.google.android.gms/app_chimera/m/00000043/MapsDynamite.apkâ€],nativeLibraryDirectories=[/data/user_de/0/com.google.android.gms/app_chimera/m/00000043/MapsDynamite.apk!/lib/arm64-v8a, /system/lib64, /product/lib64]]</p></blockquote><h3 id="è§£å†³æ–¹æ¡ˆï¼š"><a href="#è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼š"></a>è§£å†³æ–¹æ¡ˆï¼š</h3><p><strong>1.åœ¨æ¸…å•æ–‡ä»¶å¢åŠ ä»£ç :</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:usesCleartextTraffic</span>=<span class="string">"true"</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2.åœ¨æ¸…å•æ–‡ä»¶æ¸…å•å†åŠ ä¸€å¥ä»£ç ï¼š</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:usesCleartextTraffic</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">uses-library</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:name</span>=<span class="string">"org.apache.http.legacy"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:required</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œé‡æ–°è¿è¡Œè§£å†³äº†.<br>æœ€æ ¹æœ¬çš„åšæ³•æ˜¯ä½¿ç”¨httpsè¿›è¡Œæ¥å£è®¿é—®ï¼Œæ¯•ç«Ÿæ¶‰åŠæ•°æ®çš„å®‰å…¨æ€§ã€‚å½“ç„¶äº†ï¼Œè¿™éœ€è¦æœåŠ¡å™¨çš„æ”¯æŒã€‚è¿˜æœ‰ç¬¬ä¸‰æ–¹sdkï¼Œä¹Ÿéœ€è¦ä½¿ç”¨httpsã€‚</p><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;è¿è¡Œé¡¹ç›®é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š&quot;&gt;&lt;a href=&quot;#è¿è¡Œé¡¹ç›®é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š&quot; class=&quot;headerlink&quot; title=&quot;è¿è¡Œé¡¹ç›®é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š&quot;&gt;&lt;/a&gt;è¿è¡Œé¡¹ç›®é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;Caused by: java.lang.ClassNotFoundException: Didnâ€™t find class â€œorg.apache.http.ProtocolVersionâ€ on path: DexPathList[[zip file â€œ/data/user_de/0/com.google.android.gms/app_chimera/m/00000043/MapsDynamite.apkâ€],nativeLibraryDirectories=[/data/user_de/0/com.google.android.gms/app_chimera/m/00000043/MapsDynamite.apk!/lib/arm64-v8a, /system/lib64, /product/lib64]]&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;è§£å†³æ–¹æ¡ˆï¼š&quot;&gt;&lt;a href=&quot;#è§£å†³æ–¹æ¡ˆï¼š&quot; class=&quot;headerlink&quot; title=&quot;è§£å†³æ–¹æ¡ˆï¼š&quot;&gt;&lt;/a&gt;è§£å†³æ–¹æ¡ˆï¼š&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;1.åœ¨æ¸…å•æ–‡ä»¶å¢åŠ ä»£ç :&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;application&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;     &lt;span class=&quot;attr&quot;&gt;android:usesCleartextTraffic&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;2.åœ¨æ¸…å•æ–‡ä»¶æ¸…å•å†åŠ ä¸€å¥ä»£ç ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;application&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;android:usesCleartextTraffic&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;uses-library&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;org.apache.http.legacy&quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;android:required&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;false&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;application&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;å¥½äº†ï¼Œé‡æ–°è¿è¡Œè§£å†³äº†.&lt;br&gt;æœ€æ ¹æœ¬çš„åšæ³•æ˜¯ä½¿ç”¨httpsè¿›è¡Œæ¥å£è®¿é—®ï¼Œæ¯•ç«Ÿæ¶‰åŠæ•°æ®çš„å®‰å…¨æ€§ã€‚å½“ç„¶äº†ï¼Œè¿™éœ€è¦æœåŠ¡å™¨çš„æ”¯æŒã€‚è¿˜æœ‰ç¬¬ä¸‰æ–¹sdkï¼Œä¹Ÿéœ€è¦ä½¿ç”¨httpsã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="Exception" scheme="https://zhangmiao.cc/categories/Android/Exception/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="Exception" scheme="https://zhangmiao.cc/tags/Exception/"/>
    
  </entry>
  
  <entry>
    <title>GoogleMapä½¿ç”¨ä»‹ç»</title>
    <link href="https://zhangmiao.cc/posts/50fe3b5b.html"/>
    <id>https://zhangmiao.cc/posts/50fe3b5b.html</id>
    <published>2019-07-25T08:17:10.000Z</published>
    <updated>2019-07-25T08:48:12.764Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>é€šè¿‡æœ¬æ–‡ï¼Œä½ å¯ä»¥çŸ¥é“å¦‚ä½•ä½¿ç”¨ GoogleMap ç›¸å…³ APIã€å®šä½å½“å‰ä½ç½®ã€è·å–å½“å‰æ‰€åœ¨åŸå¸‚ã€è·å–å½“å‰ä½ç½®é™„è¿‘çš„åœ°ç‚¹ã€å¯¼èˆªã€åœ°ç‚¹æœç´¢ç­‰å†…å®¹ã€‚å¤§è‡´å†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹å¦‚ä¸‹æ€ç»´å¯¼å›¾ã€‚</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/GoogleMapXmind.png" alt></p><a id="more"></a><h3 id="ç‰¹åˆ«æ³¨æ„ï¼š"><a href="#ç‰¹åˆ«æ³¨æ„ï¼š" class="headerlink" title="ç‰¹åˆ«æ³¨æ„ï¼š"></a><strong>ç‰¹åˆ«æ³¨æ„</strong>ï¼š</h3><p>demo ä½¿ç”¨çš„ GoogleMap key å¯¹åº”æˆ‘è‡ªå·±ç”µè„‘çš„ keystoreï¼Œå¦‚æœé‡æ–°ç¼–è¯‘é¡¹ç›®ï¼Œç”Ÿæˆçš„apkä½¿ç”¨çš„æ˜¯ä½ çš„ç”µè„‘çš„ keystoreï¼Œå’Œæˆ‘çš„ keystore æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥è¦æ­£å¸¸è¿è¡Œï¼Œ</p><ol><li>ç›´æ¥ä¸‹è½½æˆ‘ç¼–è¯‘å¥½çš„ apkï¼›</li><li>ç”¨æˆ‘çš„é¡¹ç›®åŒ…åï¼Œå’Œä½ è‡ªå·±çš„ keystore çš„ SHA-1 å»ç”³è¯·æ–°çš„ GoogleMap keyã€‚ï¼ˆæ–¹æ³•åœ¨ä¸‹é¢ï¼Œå¾€ä¸‹çœ‹å“ˆï¼‰</li></ol><h2 id="å‰æœŸå‡†å¤‡"><a href="#å‰æœŸå‡†å¤‡" class="headerlink" title="å‰æœŸå‡†å¤‡"></a>å‰æœŸå‡†å¤‡</h2><h3 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h3><p>å› ä¸ºå›½å†…ä¼—æ‰€å‘¨çŸ¥çš„ç½‘ç»œé—®é¢˜ï¼Œè°·æ­Œåœ°å›¾çš„é¡µé¢åŠ è½½å’Œ API çš„ä½¿ç”¨ä¼šå‡ºç°æ— æ•ˆçš„æƒ…å†µï¼Œå¦‚æœä½ è¦ä½¿ç”¨æˆ–è°ƒè¯•ï¼Œé¦–å…ˆè¦ç¡®ä¿æ˜¯å¯ä»¥ç§‘å­¦ä¸Šç½‘çš„ã€‚</p><h3 id="è®¾å¤‡"><a href="#è®¾å¤‡" class="headerlink" title="è®¾å¤‡"></a>è®¾å¤‡</h3><p>Android è®¾å¤‡ï¼Œå¿…é¡»<strong>å®‰è£…äº† Google æœåŠ¡</strong>ã€‚</p><h3 id="è°·æ­Œè´¦å·"><a href="#è°·æ­Œè´¦å·" class="headerlink" title="è°·æ­Œè´¦å·"></a>è°·æ­Œè´¦å·</h3><p>ä½œä¸ºç”¨æˆ·ï¼Œä¸éœ€è¦æ‹¥æœ‰æˆ–è€…ç™»å½•ä½ çš„ Google è´¦å·ã€‚ç½‘ç»œå’Œ Google æœåŠ¡æ­£å¸¸å³å¯ã€‚</p><p>ä½œä¸ºå¼€å‘è€…ï¼Œå¿…é¡»æ‹¥æœ‰ä¸€ä¸ª Google è´¦å·ã€‚è¦çŸ¥é“ï¼Œè°·æ­Œåœ°å›¾æ˜¯ä¸å¼€æºçš„ï¼Œè¦ä½¿ç”¨ä»–çš„ API ï¼Œå¿…é¡»ç”¨ä½ çš„åŒ…åï¼Œå’Œç¼–è¯‘ Android app çš„ keystore çš„ SHA-1ï¼Œå»ç”³è¯·App å¯¹åº”çš„ Google Map Keyã€‚è·å– Key çš„æ•™ç¨‹å®˜ç½‘è®²å¾—å¾ˆè¯¦ç»†ï¼Œ<a href="https://developers.google.com/maps/documentation/android-api/signup" target="_blank" rel="noopener">è¯·çœ‹è¿™é‡Œ</a></p><p><a href="https://console.developers.google.com/project/_/apiui/credential" target="_blank" rel="noopener">Google API Console</a> è®¾ç½®å®Œæˆåï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190725162411.png" alt></p><p>è®¾ç½®å¥½åï¼Œè¿˜è¦ç¡®ä¿å·²ç» <strong>Enable</strong>äº†å¯¹åº”çš„APIï¼Œ<strong>ä¸ç„¶ä¼šå‡ºç°æ•°æ®è®¿é—®ä¸åˆ°çš„æƒ…å†µ</strong>ã€‚<br><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190725162433.png" alt></p><p>æŠŠè¿™ä¸ª API key å¡«å…¥ <em>AndroidManifest.xml</em> ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">"com.google.android.geo.API_KEY"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:value</span>=<span class="string">"your key"</span> /&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Map-ç›¸å…³"><a href="#Map-ç›¸å…³" class="headerlink" title="Map ç›¸å…³"></a>Map ç›¸å…³</h3><h4 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h4><h5 id="åˆå§‹åŒ–-Google-Map"><a href="#åˆå§‹åŒ–-Google-Map" class="headerlink" title="åˆå§‹åŒ– Google Map"></a>åˆå§‹åŒ– Google Map</h5><h6 id="å¸ƒå±€"><a href="#å¸ƒå±€" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h6><p>åœ¨ä½ çš„å¸ƒå±€æ–‡ä»¶é‡Œé¢ï¼Œåªéœ€è¦å¦‚ä¸‹æ–¹å¼å£°æ˜ä¸€ä¸ª Fragmentï¼Œè¿™ä¸ª Fragment æ˜¯å¯ä»¥æ”¾åœ¨ LinearLayout æˆ– RelativeLayout ä¸‹é¢çš„ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/map"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">map:uiZoomControls</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">map:uiCompass</span> = <span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"com.google.android.gms.maps.SupportMapFragment"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_below</span>=<span class="string">"@id/layout_btn"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h6 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h6><p>åœ¨ <em>onCreate</em> çš„æ—¶å€™ï¼Œè¿›è¡Œåˆå§‹åŒ–æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> GoogleMap mMap;</span><br><span class="line">SupportMapFragment mapFragment = (SupportMapFragment) getSupportFragmentManager()</span><br><span class="line">        .findFragmentById(map);</span><br><span class="line">mapFragment.getMapAsync(<span class="keyword">new</span> OnMapReadyCallback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMapReady</span><span class="params">(GoogleMap googleMap)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–å®Œ GoogleMap</span></span><br><span class="line">        mMap = googleMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="ç¡®ä¿-GoogleMap-å®ä¾‹åŒ–"><a href="#ç¡®ä¿-GoogleMap-å®ä¾‹åŒ–" class="headerlink" title="ç¡®ä¿ GoogleMap å®ä¾‹åŒ–"></a>ç¡®ä¿ GoogleMap å®ä¾‹åŒ–</h5><p>åœ¨ä½¿ç”¨ GoogleMap ç›¸å…³æ¥å£å‰ï¼Œå¿…é¡»ç¡®ä¿ GoogleMap å·²ç»å®ä¾‹åŒ–ï¼Œå³å·²ç»åœ¨ <em>onMapReady</em>å›è°ƒä¸­è·å–äº† GoogleMapå®ä¾‹ã€‚</p><h4 id="å¼€å…³ç±»"><a href="#å¼€å…³ç±»" class="headerlink" title="å¼€å…³ç±»"></a>å¼€å…³ç±»</h4><h5 id="å®šä½æŒ‰é’®"><a href="#å®šä½æŒ‰é’®" class="headerlink" title="å®šä½æŒ‰é’®"></a>å®šä½æŒ‰é’®</h5><p>å®šä½åŠŸèƒ½å¿…é¡»è·å–ç”¨æˆ·çš„ä½ç½®æƒé™ï¼Œåˆ¤æ–­æ˜¯éè·å–äº†ç”¨æˆ·æƒé™ï¼Œæ²¡æœ‰è·å–åˆ™æ‰‹åŠ¨è¯·æ±‚æƒé™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æ£€æŸ¥å®šä½æƒé™ï¼Œå¦‚æœæœªæˆæƒåˆ™è¯·æ±‚è¯¥æƒé™</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  trueï¼šå·²ç»æˆæƒï¼› falseï¼šæœªæˆæƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkLocationPermission</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION)</span><br><span class="line">            != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">        <span class="comment">// Permission to access the location is missing.</span></span><br><span class="line">        PermissionUtils.requestPermission(<span class="keyword">this</span>, LOCATION_PERMISSION_REQUEST_CODE,</span><br><span class="line">                Manifest.permission.ACCESS_FINE_LOCATION, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">requestPermission</span><span class="params">(FragmentActivity activity, <span class="keyword">int</span> requestId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     String permission, <span class="keyword">boolean</span> finishActivity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ActivityCompat.shouldShowRequestPermissionRationale(activity, permission)) &#123;</span><br><span class="line">        <span class="comment">// Display a dialog with rationale.</span></span><br><span class="line">        PermissionUtils.RationaleDialog.newInstance(requestId, finishActivity)</span><br><span class="line">                .show(activity.getSupportFragmentManager(), <span class="string">"dialog"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Location permission has not been granted yet, request it.</span></span><br><span class="line">        ActivityCompat.requestPermissions(activity, <span class="keyword">new</span> String[]&#123;permission&#125;, requestId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦è®©åœ°å›¾ä¸Šæ˜¾ç¤ºå¼€å…³æŒ‰é’®ï¼Œåªéœ€è¦è®¾ç½®<code>mMap.setMyLocationEnabled(true);</code></p><p>ç‚¹å‡»æ­¤æŒ‰é’®ï¼Œåœ°å›¾çš„æ‘„åƒå¤´å°±ä¼šå¼€å§‹ç§»åŠ¨ï¼Œå®šä½åˆ°å½“å‰è®¾å¤‡æ‰€åœ¨ä½ç½®ï¼Œå¦‚æœè¦è·å–ç‚¹å‡»æ­¤æŒ‰é’®çš„å›è°ƒï¼Œå¯ä»¥è®¾ç½®ç›‘å¬å™¨ <code>mMap.setOnMyLocationButtonClickListener</code></p><h5 id="æ”¾å¤§ï¼ç¼©å°æŒ‰é’®"><a href="#æ”¾å¤§ï¼ç¼©å°æŒ‰é’®" class="headerlink" title="æ”¾å¤§ï¼ç¼©å°æŒ‰é’®"></a>æ”¾å¤§ï¼ç¼©å°æŒ‰é’®</h5><p>åœ°å›¾çš„æ”¾å¤§ç¼©å°ï¼Œå°±ä»¥æ‘„åƒå¤´ç„¦ç‚¹ï¼ˆåœ°å›¾ä¸­å¿ƒï¼‰è¿›è¡Œç¼©æ”¾ã€‚è¦å‡ºç°è¿™ä¸ªå¼€å…³ï¼Œåªéœ€è¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UiSettings uiSettings = mMap.getUiSettings();</span><br><span class="line">uiSettings.setZoomControlsEnabled(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure><h5 id="æŒ‡å—é’ˆæŒ‰é’®"><a href="#æŒ‡å—é’ˆæŒ‰é’®" class="headerlink" title="æŒ‡å—é’ˆæŒ‰é’®"></a>æŒ‡å—é’ˆæŒ‰é’®</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UiSettings uiSettings = mMap.getUiSettings();</span><br><span class="line">uiSettings.setCompassEnabled(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure><h5 id="æ‰‹åŠ¿"><a href="#æ‰‹åŠ¿" class="headerlink" title="æ‰‹åŠ¿"></a>æ‰‹åŠ¿</h5><ol><li><p>æ—‹è½¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UiSettings uiSettings = mMap.getUiSettings();</span><br><span class="line">uiSettings.setRotateGesturesEnabled(mRotateGesturesEnabled);</span><br></pre></td></tr></table></figure></li><li><p>å¹³ç§»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UiSettings uiSettings = mMap.getUiSettings();</span><br><span class="line">uiSettings.setScrollGesturesEnabled(mScrollGesturesEnabled);</span><br></pre></td></tr></table></figure></li></ol><h4 id="è‡ªå®šä¹‰æ ‡æ³¨"><a href="#è‡ªå®šä¹‰æ ‡æ³¨" class="headerlink" title="è‡ªå®šä¹‰æ ‡æ³¨"></a>è‡ªå®šä¹‰æ ‡æ³¨</h4><h5 id="æ¸…é™¤æ ‡æ³¨"><a href="#æ¸…é™¤æ ‡æ³¨" class="headerlink" title="æ¸…é™¤æ ‡æ³¨"></a>æ¸…é™¤æ ‡æ³¨</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mMap.clear();</span><br></pre></td></tr></table></figure><h5 id="æ–°å¢æ ‡æ³¨"><a href="#æ–°å¢æ ‡æ³¨" class="headerlink" title="æ–°å¢æ ‡æ³¨"></a>æ–°å¢æ ‡æ³¨</h5><p>å¢åŠ ä¸€ä¸ªæ ‡æ³¨ï¼Œåªéœ€è¦æŠŠå½“å‰çš„ç»çº¬åº¦ï¼Œå›¾æ ‡ï¼Œæ ‡é¢˜ç­‰ä¿¡æ¯ä¼ å…¥ <em>MarkerOptions</em> ï¼Œä¹‹ååœ¨ <em>addMarker</em> åˆ° mapå¯¹è±¡å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LatLng latLng = <span class="keyword">new</span> LatLng(latitude, longitude);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ‡è®°å½“å‰åæ ‡</span></span><br><span class="line">mMap.addMarker(<span class="keyword">new</span> MarkerOptions()</span><br><span class="line">        .position(latLng)</span><br><span class="line">        .icon(BitmapDescriptorFactory.fromResource(R.drawable.icon_position_small))</span><br><span class="line">        .title(getString(R.string.map_camera_center_location)));</span><br></pre></td></tr></table></figure><h4 id="æ‘„åƒå¤´"><a href="#æ‘„åƒå¤´" class="headerlink" title="æ‘„åƒå¤´"></a>æ‘„åƒå¤´</h4><h5 id="å½“å‰ä½ç½®"><a href="#å½“å‰ä½ç½®" class="headerlink" title="å½“å‰ä½ç½®"></a>å½“å‰ä½ç½®</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–å½“å‰æ‘„åƒå¤´ä¸­å¿ƒç‚¹çš„åæ ‡</span></span><br><span class="line"><span class="keyword">double</span> latitude = mMap.getCameraPosition().target.latitude;</span><br><span class="line"><span class="keyword">double</span> longitude = mMap.getCameraPosition().target.longitude;</span><br></pre></td></tr></table></figure><h5 id="ç§»åŠ¨ç›¸å…³ç›‘å¬"><a href="#ç§»åŠ¨ç›¸å…³ç›‘å¬" class="headerlink" title="ç§»åŠ¨ç›¸å…³ç›‘å¬"></a>ç§»åŠ¨ç›¸å…³ç›‘å¬</h5><ol><li><p>å¼€å§‹ç›‘å¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‘„åƒå¤´å¼€å§‹æ»‘åŠ¨ç›‘å¬</span></span><br><span class="line">mMap.setOnCameraMoveStartedListener(<span class="keyword">new</span> GoogleMap.OnCameraMoveStartedListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCameraMoveStarted</span><span class="params">(<span class="keyword">int</span> reason)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (reason == GoogleMap.OnCameraMoveStartedListener.REASON_GESTURE) &#123;</span><br><span class="line">            <span class="comment">//è¡¨ç¤ºæ‘„åƒå¤´ç§»åŠ¨æ˜¯ä¸ºäº†å“åº”ç”¨æˆ·åœ¨åœ°å›¾ä¸Šåšå‡ºçš„æ‰‹åŠ¿ï¼Œå¦‚å¹³ç§»ã€å€¾æ–œã€é€šè¿‡æåˆæ‰‹æŒ‡è¿›è¡Œç¼©æ”¾æˆ–æ—‹è½¬åœ°å›¾</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (reason == GoogleMap.OnCameraMoveStartedListener</span><br><span class="line">                .REASON_API_ANIMATION) &#123;</span><br><span class="line">            <span class="comment">//è¡¨ç¤º API ç§»åŠ¨æ‘„åƒå¤´æ˜¯ä¸ºäº†å“åº”éæ‰‹åŠ¿ç”¨æˆ·æ“ä½œï¼Œå¦‚ç‚¹æŒ‰ zoom æŒ‰é’®ã€ç‚¹æŒ‰ My Location æŒ‰é’®æˆ–ç‚¹å‡»æ ‡è®°</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (reason == GoogleMap.OnCameraMoveStartedListener</span><br><span class="line">                .REASON_DEVELOPER_ANIMATION) &#123;</span><br><span class="line">            <span class="comment">//è¡¨ç¤ºæ‚¨çš„åº”ç”¨å·²å‘èµ·æ‘„åƒå¤´ç§»åŠ¨</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; ;</span><br></pre></td></tr></table></figure></li><li><p>å–æ¶ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‘„åƒå¤´ç§»åŠ¨åœæ­¢çŠ¶æ€çš„ç›‘å¬</span></span><br><span class="line">mMap.setOnCameraIdleListener(<span class="keyword">new</span> GoogleMap.OnCameraIdleListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCameraIdle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>åœæ­¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‘„åƒå¤´ç§»åŠ¨ä¸­è¢«å–æ¶ˆæ—¶çš„ç›‘å¬</span></span><br><span class="line">mMap.setOnCameraMoveCanceledListener(<span class="keyword">new</span> GoogleMap.OnCameraMoveCanceledListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCameraMoveCanceled</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ol><h4 id="ç‚¹å‡»ç›‘å¬"><a href="#ç‚¹å‡»ç›‘å¬" class="headerlink" title="ç‚¹å‡»ç›‘å¬"></a>ç‚¹å‡»ç›‘å¬</h4><h5 id="ç‚¹å‡»"><a href="#ç‚¹å‡»" class="headerlink" title="ç‚¹å‡»"></a>ç‚¹å‡»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç‚¹å‡»åœ°å›¾ä¸ŠæŸä¸ªåæ ‡</span></span><br><span class="line">mMap.setOnMapClickListener(<span class="keyword">new</span> GoogleMap.OnMapClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMapClick</span><span class="params">(LatLng latLng)</span> </span>&#123;</span><br><span class="line">        Toast.makeText(MapActivity.<span class="keyword">this</span>,</span><br><span class="line">                getString(R.string.map_click_tip, latLng.latitude, latLng.longitude),</span><br><span class="line">                Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="é•¿æŒ‰"><a href="#é•¿æŒ‰" class="headerlink" title="é•¿æŒ‰"></a>é•¿æŒ‰</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é•¿æŒ‰åœ°å›¾ä¸ŠæŸä¸ªåæ ‡</span></span><br><span class="line">mMap.setOnMapLongClickListener(<span class="keyword">new</span> GoogleMap.OnMapLongClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMapLongClick</span><span class="params">(LatLng latLng)</span> </span>&#123;</span><br><span class="line">        Toast.makeText(MapActivity.<span class="keyword">this</span>,</span><br><span class="line">                getString(R.string.map_long_click_tip, latLng.latitude, latLng.longitude),</span><br><span class="line">                Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="ç‚¹å‡»æ™¯ç‚¹"><a href="#ç‚¹å‡»æ™¯ç‚¹" class="headerlink" title="ç‚¹å‡»æ™¯ç‚¹"></a>ç‚¹å‡»æ™¯ç‚¹</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç‚¹å‡»åœ°å›¾ä¸ŠæŸä¸ªæ™¯ç‚¹</span></span><br><span class="line">mMap.setOnPoiClickListener(<span class="keyword">new</span> GoogleMap.OnPoiClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPoiClick</span><span class="params">(PointOfInterest pointOfInterest)</span> </span>&#123;</span><br><span class="line">        Toast.makeText(MapActivity.<span class="keyword">this</span>,</span><br><span class="line">                getString(R.string.map_place_click_tip, pointOfInterest.name, pointOfInterest.placeId, pointOfInterest.latLng.latitude, pointOfInterest.latLng.longitude),</span><br><span class="line">                Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="å¿«ç…§"><a href="#å¿«ç…§" class="headerlink" title="å¿«ç…§"></a>å¿«ç…§</h4><p>å¿«ç…§åˆ†ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç›´æ¥ä¸ç®¡åœ°å›¾æœ‰æ²¡æœ‰åŠ è½½å®Œï¼Œå°±æŠŠå½“å‰çš„åœ°å›¾æˆªå±ï¼Œå¦‚æœæ­¤æ—¶åœ°å›¾æœªåŠ è½½å®Œï¼Œæˆªå–çš„å›¾ç‰‡ä¼šå‡ºç°æ¨¡ç³Šçš„æƒ…å†µï¼›å¦å¤–ä¸€ç§æ˜¯åˆ¤æ–­åœ°å›¾æ˜¯å¦åœ¨åŠ è½½ä¸­ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç­‰åŠ è½½å®Œæ¯•å†æˆªå›¾ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ç›´æ¥æˆªå›¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ˜¯å¦ç­‰å¾…åœ°å›¾åŠ è½½å®Œæ¯•</span></span><br><span class="line"><span class="keyword">if</span> (mWaitForMapLoaded) &#123;</span><br><span class="line">    <span class="comment">//è·å–åŠ è½½å®Œçš„é«˜æ¸…å›¾ç‰‡</span></span><br><span class="line">    mMap.setOnMapLoadedCallback(<span class="keyword">new</span> GoogleMap.OnMapLoadedCallback() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMapLoaded</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != mMap) &#123;</span><br><span class="line">                mMap.snapshot(<span class="keyword">new</span> GoogleMap.SnapshotReadyCallback() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSnapshotReady</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</span><br><span class="line">                    <span class="comment">//è·å–bitmap</span></span><br><span class="line">                    </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//æœªåŠ è½½å®Œï¼Œå°±æ‰§è¡Œå¿«ç…§åŠŸèƒ½ï¼Œä¼šå¯¼è‡´æˆªå–æ¨¡ç³Šå›¾ç‰‡</span></span><br><span class="line">    mMap.snapshot(<span class="keyword">new</span> GoogleMap.SnapshotReadyCallback() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSnapshotReady</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è·å–bitmap</span></span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="GoogleApiClient"><a href="#GoogleApiClient" class="headerlink" title="GoogleApiClient"></a>GoogleApiClient</h3><h4 id="å‰æ-1"><a href="#å‰æ-1" class="headerlink" title="å‰æ"></a>å‰æ</h4><ol><li><p>åˆå§‹åŒ– GoogleApiClient</p><p>åœ¨ onCreate çš„æ—¶å€™è¿›è¡Œåˆå§‹åŒ–æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ– google client ç”¨äºè·å–åœ°ç‚¹ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createGoogleApiClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mGoogleApiClient == <span class="keyword">null</span>) &#123;</span><br><span class="line">        mGoogleApiClient = <span class="keyword">new</span> GoogleApiClient</span><br><span class="line">                .Builder(<span class="keyword">this</span>)</span><br><span class="line">                .addApi(Places.GEO_DATA_API)</span><br><span class="line">                .addApi(Places.PLACE_DETECTION_API)</span><br><span class="line">                .addApi(LocationServices.API)</span><br><span class="line">                .addConnectionCallbacks(<span class="keyword">new</span> GoogleApiClient.ConnectionCallbacks() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onConnected</span><span class="params">(@Nullable Bundle bundle)</span> </span>&#123;</span><br><span class="line">                        <span class="comment">//è¿æ¥æˆåŠŸ</span></span><br><span class="line">                        mConnected = <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onConnectionSuspended</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">                        <span class="comment">//è¿æ¥æš‚åœ</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .addOnConnectionFailedListener(<span class="keyword">new</span> GoogleApiClient.OnConnectionFailedListener() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onConnectionFailed</span><span class="params">(@NonNull ConnectionResult connectionResult)</span> </span>&#123;</span><br><span class="line">                        <span class="comment">//è¿æ¥å¤±è´¥</span></span><br><span class="line">                        mConnected = <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .enableAutoManage(<span class="keyword">this</span>, <span class="keyword">new</span> GoogleApiClient.OnConnectionFailedListener() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onConnectionFailed</span><span class="params">(@NonNull ConnectionResult connectionResult)</span> </span>&#123;</span><br><span class="line">                        <span class="comment">//è¿æ¥å¤±è´¥</span></span><br><span class="line">                        mConnected = <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨ onStart() çš„æ—¶å€™è¿æ¥ï¼Œåœ¨ onStop() çš„æ—¶å€™ï¼Œæ–­å¼€è¿æ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onStart();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != mGoogleApiClient) &#123;</span><br><span class="line">        mGoogleApiClient.connect();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onStop();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != mGoogleApiClient) &#123;</span><br><span class="line">        mGoogleApiClient.disconnect();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ä½ç½®ç›¸å…³ API çš„å‰æï¼Œå¿…é¡»ç¡®ä¿ç”¨æˆ·æˆäºˆä½ç½®æƒé™ã€‚æ–¹æ³•åŒä¸Šçš„ <em>checkLocationPermission()</em></p></li></ol><h4 id="è·å–å½“å‰å®šä½çš„ç»çº¬åº¦åæ ‡"><a href="#è·å–å½“å‰å®šä½çš„ç»çº¬åº¦åæ ‡" class="headerlink" title="è·å–å½“å‰å®šä½çš„ç»çº¬åº¦åæ ‡"></a>è·å–å½“å‰å®šä½çš„ç»çº¬åº¦åæ ‡</h4><h5 id="ç§‘æ™®"><a href="#ç§‘æ™®" class="headerlink" title="ç§‘æ™®"></a>ç§‘æ™®</h5><ul><li><p>WGS-84</p><p>å›½é™…æ ‡å‡†çš„åæ ‡ç³»ï¼Œå›½é™…æ ‡å‡†çš„ GPS è®¾å¤‡å®šä½è·å–çš„å°±æ˜¯è¿™ç§åæ ‡ã€‚ç®€ç§° <strong>åœ°çƒåæ ‡ç³»</strong>ã€‚</p></li><li><p>GCJ-02</p><p>åœ¨æˆ‘ä»¬å›½å®¶ï¼Œæ®è¯´æ˜¯ä¸ºäº†ä¿å¯†ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨ WGS-84 åæ ‡ï¼Œè€Œæ˜¯ä½¿ç”¨ç»è¿‡åŠ å¯†çš„ GCJ-02ï¼Œé«˜å¾·åœ°å›¾ï¼Œè°·æ­Œåœ°å›¾ï¼ˆå›½å†…æ¿å—ï¼‰éƒ½æ˜¯ä½¿ç”¨è¿™ä¸ªåæ ‡ç³»ã€‚è¿™ä¸ªå°±æ˜¯ä¿—ç§°çš„ <strong>ç«æ˜Ÿåæ ‡ç³»</strong>ã€‚</p></li><li><p>å…¶ä»–åæ ‡ç³»</p><p>æ¯”å¦‚ç™¾åº¦åœ°å›¾ï¼Œä»–ç”¨çš„æ˜¯ä»–ä»¬å®¶çš„ BD-09 åæ ‡ï¼Œè¿™ä¸ªåªé€‚ç”¨äºç™¾åº¦ç›¸å…³äº§å“ã€‚æœç‹—åœ°å›¾ä¹Ÿæœ‰è‡ªå·±çš„åæ ‡ã€‚</p></li><li><p>æ ¼å¼<br>æ³¨æ„åˆ°è°·æ­Œåœ°å›¾çš„åæ ‡æ˜¯ latitude, longitude æ ¼å¼ï¼Œå³ çº¬åº¦ï¼Œç»åº¦ æ ¼å¼ã€‚å’Œå›½å†…çš„ç™¾åº¦ï¼Œé«˜å¾·åæ ‡å†™æ³•æ˜¯åè¿‡æ¥çš„ã€‚å›½å†…çš„ä¸€èˆ¬æ˜¯ ç»åº¦ï¼Œçº¬åº¦ çš„æ–¹å¼ã€‚</p></li></ul><h5 id="API"><a href="#API" class="headerlink" title="API"></a>API</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Location lastLocation = LocationServices.FusedLocationApi.getLastLocation(mGoogleApiClient);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != lastLocation) &#123;</span><br><span class="line">    <span class="keyword">double</span> latitude = lastLocation.getLatitude();</span><br><span class="line">    <span class="keyword">double</span> longitude = lastLocation.getLongitude();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆšå¼€å§‹æˆ‘ä¹Ÿä»¥ä¸ºè¿™ä¹ˆç®€å•å°±å¯ä»¥äº†ï¼Œåœ¨æµ‹è¯•è®¾å¤‡ä¸Šç¡®å®å¯ä»¥è·å–åˆ°åæ ‡ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œå¤§å¤šæ•°æƒ…å†µï¼Œåœ¨ç¬¬ä¸€æ¬¡è¿è¡Œå®šä½çš„æ—¶å€™ï¼Œè·å–çš„ Location å¯¹è±¡æ˜¯ä¸ºnullã€‚æ‰€ä»¥è¿˜éœ€è¦æ³¨å†Œä½ç½®å˜åŒ–çš„ç›‘å¬ã€‚ç­‰ç›‘å¬åˆ°ä½ç½®ä¿¡æ¯åï¼Œç§»é™¤æ­¤ç›‘å¬ï¼Œé˜²æ­¢ä¸æ–­ç›‘å¬å¼•èµ·é«˜è€—ç”µç°è±¡ã€‚è¿™éƒ¨åˆ†ç™¾åº¦åœ°å›¾ç”¨å¾—å¾ˆæ–¹ä¾¿ï¼Œä»–å°è£…å¥½äº†ï¼Œä½†æ˜¯è°·æ­Œåœ°å›¾å°±è¦è‡ªå·±å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">long</span> UPDATE_INTERVAL = <span class="number">10</span> * <span class="number">1000</span>;  <span class="comment">/* 10 secs */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">long</span> FASTEST_INTERVAL = <span class="number">1500</span>; <span class="comment">/* 1.5 sec */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_TIME = <span class="number">2</span>; <span class="comment">//æœ€å¤šå®šä½æ¬¡æ•°</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> time;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != lastLocation) &#123;</span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//å¦‚æœè·å–ä¸åˆ°ä½ç½®ä¿¡æ¯ï¼Œæ³¨å†Œä½ç½®å˜åŒ–ç›‘å¬</span></span><br><span class="line">regLocationUpdates();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">regLocationUpdates</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!checkLocationPermission()) &#123;</span><br><span class="line">        showContentText(getString(R.string.cilent_permission_failed));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LocationRequest locationRequest = LocationRequest.create()</span><br><span class="line">            .setPriority(LocationRequest.PRIORITY_HIGH_ACCURACY)</span><br><span class="line">            .setInterval(UPDATE_INTERVAL)</span><br><span class="line">            .setFastestInterval(FASTEST_INTERVAL);</span><br><span class="line"></span><br><span class="line">    LocationServices.FusedLocationApi.requestLocationUpdates(mGoogleApiClient,</span><br><span class="line">            locationRequest, <span class="keyword">new</span> LocationListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLocationChanged</span><span class="params">(Location location)</span> </span>&#123;</span><br><span class="line">                    time++;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//å¦‚æœè·å–åˆ°ä½ç½®ä¿¡æ¯ï¼Œåˆ™ç§»é™¤ä½ç½®å˜åŒ–ç›‘å¬</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">null</span> != location) &#123;</span><br><span class="line">                        LocationServices.FusedLocationApi.removeLocationUpdates(mGoogleApiClient, <span class="keyword">this</span>);</span><br><span class="line">                        <span class="comment">//è·å–å®šä½çš„ç»çº¬åº¦</span></span><br><span class="line">                        <span class="keyword">double</span> latitude = location.getLatitude();</span><br><span class="line">                        <span class="keyword">double</span> longitude = location.getLongitude();</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//å¦‚æœè¶…è¿‡æœ€å¤§çš„å®šä½æ¬¡æ•°åˆ™åœæ­¢ä½ç½®å˜åŒ–ç›‘å¬</span></span><br><span class="line">                    <span class="keyword">if</span> (time == MAX_TIME) &#123;</span><br><span class="line">                        <span class="comment">//ç§»é™¤ä½ç½®å˜åŒ–ç›‘å¬</span></span><br><span class="line">                        LocationServices.FusedLocationApi.removeLocationUpdates(mGoogleApiClient, <span class="keyword">this</span>);</span><br><span class="line"><span class="comment">//è·å–å½“å‰ä½ç½®å¤±è´¥</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ç»ˆäºè·å–åˆ°å®šä½åæ ‡äº†ï¼Œç­‰ç­‰ï¼Œå¥½åƒä¸å¤ªå¯¹ï¼Œè¿™ä¸ªåæ ‡å’Œæˆ‘å®é™…ä½ç½®å¥½åƒæœ‰ä¸å°‘çš„åå·®â€¦..æˆ‘æ‰“å¼€äº† GoogleMap è¿™ä¸ªå®˜æ–¹çš„ APPï¼Œç‚¹å‡»äº†ä»–çš„å®šä½ã€‚è¿™ä¸‹å°±æ‡µé€¼äº†ï¼Œæ€ä¹ˆå®˜æ–¹çš„è¿™ä¸ªæ˜¯æ²¡é—®é¢˜äº†ï¼Œè¯¯å·®å¾ˆå°â€¦.</p><p>æˆ‘æ˜æ˜ç”¨çš„æ˜¯ GoogleMap çš„ APIï¼Œä¸ºä»€ä¹ˆå®šä½ä¼šä¸ä¸€æ ·ï¼Ÿ</p><p>åŸå› åœ¨åˆšæ‰çš„åæ ‡ç³»é‡Œé¢ï¼Œè°·æ­Œåœ°å›¾çš„å›½å†…æ¿å—æ˜¯ç”¨ GCJ-02ï¼Œä½†æ˜¯å®šä½ API è·å–çš„åæ ‡æ˜¯å›½é™…æ ‡å‡†åæ ‡ WGS-84ï¼Œæ‰€ä»¥éœ€è¦æŠŠ WGS-84 è½¬åŒ– GCJ-02ã€‚</p><p>é‚£è°·æ­Œåœ°å›¾ APP ä¸Šä¸ºä»€ä¹ˆå¯ä»¥å‘¢ï¼Ÿ</p><p>æˆ‘çŒœæµ‹ï¼Œè°·æ­Œåœ°å›¾åœ¨è®¿é—®ç½‘ç»œçš„æ—¶å€™ï¼Œä¼šè¿›è¡Œä½ç½®åˆ¤æ–­ï¼Œå¦‚æœæ˜¯å›½å†…åæ ‡ï¼Œå°±è¿›è¡Œè½¬æ¢ï¼Œå›½å¤–åæ ‡å°±ä¸è½¬æ¢ã€‚</p><p><strong>WGS-84 è½¬åŒ– GCJ-02 æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">double</span> a = <span class="number">6378245.0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">double</span> ee = <span class="number">0.00669342162296594323</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠŠ WGS-84 è½¬æ¢æˆ GCJ-02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> wgLoc</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LatLng <span class="title">transformFromWGSToGCJ</span><span class="params">(LatLng wgLoc)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœåœ¨å›½å¤–ï¼Œåˆ™é»˜è®¤ä¸è¿›è¡Œè½¬æ¢</span></span><br><span class="line">    <span class="keyword">if</span> (outOfChina(wgLoc.latitude, wgLoc.longitude)) &#123;</span><br><span class="line">        <span class="comment">//return new LatLng(wgLoc.latitude, wgLoc.longitude);</span></span><br><span class="line">        <span class="keyword">return</span> wgLoc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> dLat = transformLat(wgLoc.longitude - <span class="number">105.0</span>,</span><br><span class="line">            wgLoc.latitude - <span class="number">35.0</span>);</span><br><span class="line">    <span class="keyword">double</span> dLon = transformLon(wgLoc.longitude - <span class="number">105.0</span>,</span><br><span class="line">            wgLoc.latitude - <span class="number">35.0</span>);</span><br><span class="line">    <span class="keyword">double</span> radLat = wgLoc.latitude / <span class="number">180.0</span> * Math.PI;</span><br><span class="line">    <span class="keyword">double</span> magic = Math.sin(radLat);</span><br><span class="line">    magic = <span class="number">1</span> - ee * magic * magic;</span><br><span class="line">    <span class="keyword">double</span> sqrtMagic = Math.sqrt(magic);</span><br><span class="line">    dLat = (dLat * <span class="number">180.0</span>)/ ((a * (<span class="number">1</span> - ee)) / (magic * sqrtMagic) * Math.PI);</span><br><span class="line">    dLon = (dLon * <span class="number">180.0</span>) / (a / sqrtMagic * Math.cos(radLat) * Math.PI);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LatLng(wgLoc.latitude + dLat, wgLoc.longitude + dLon);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">transformLat</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> ret = -<span class="number">100.0</span> + <span class="number">2.0</span> * x + <span class="number">3.0</span> * y + <span class="number">0.2</span> * y * y + <span class="number">0.1</span> * x * y</span><br><span class="line">            + <span class="number">0.2</span> * Math.sqrt(x &gt; <span class="number">0</span> ? x : -x);</span><br><span class="line">    ret += (<span class="number">20.0</span> * Math.sin(<span class="number">6.0</span> * x * Math.PI) + <span class="number">20.0</span> * Math.sin(<span class="number">2.0</span> * x</span><br><span class="line">            * Math.PI)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">    ret += (<span class="number">20.0</span> * Math.sin(y * Math.PI) + <span class="number">40.0</span> * Math.sin(y / <span class="number">3.0</span></span><br><span class="line">            * Math.PI)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">    ret += (<span class="number">160.0</span> * Math.sin(y / <span class="number">12.0</span> * Math.PI) + <span class="number">320</span> * Math.sin(y</span><br><span class="line">            * Math.PI / <span class="number">30.0</span>)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">transformLon</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> ret = <span class="number">300.0</span> + x + <span class="number">2.0</span> * y + <span class="number">0.1</span> * x * x + <span class="number">0.1</span> * x * y + <span class="number">0.1</span></span><br><span class="line">            * Math.sqrt(x &gt; <span class="number">0</span> ? x : -x);</span><br><span class="line">    ret += (<span class="number">20.0</span> * Math.sin(<span class="number">6.0</span> * x * Math.PI) + <span class="number">20.0</span> * Math.sin(<span class="number">2.0</span> * x</span><br><span class="line">            * Math.PI)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">    ret += (<span class="number">20.0</span> * Math.sin(x * Math.PI) + <span class="number">40.0</span> * Math.sin(x / <span class="number">3.0</span></span><br><span class="line">            * Math.PI)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">    ret += (<span class="number">150.0</span> * Math.sin(x / <span class="number">12.0</span> * Math.PI) + <span class="number">300.0</span> * Math.sin(x</span><br><span class="line">            / <span class="number">30.0</span> * Math.PI)) * <span class="number">2.0</span> / <span class="number">3.0</span>;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­æ˜¯å¦åœ¨ä¸­å›½ä»¥å¤–</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> lat</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> lon</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">outOfChina</span><span class="params">(<span class="keyword">double</span> lat, <span class="keyword">double</span> lon)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lon &lt; <span class="number">72.004</span> || lon &gt; <span class="number">137.8347</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (lat &lt; <span class="number">0.8293</span> || lat &gt; <span class="number">55.8271</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ ¹æ®ç»çº¬åº¦è·å–é™„è¿‘åœ°ç‚¹"><a href="#æ ¹æ®ç»çº¬åº¦è·å–é™„è¿‘åœ°ç‚¹" class="headerlink" title="æ ¹æ®ç»çº¬åº¦è·å–é™„è¿‘åœ°ç‚¹"></a>æ ¹æ®ç»çº¬åº¦è·å–é™„è¿‘åœ°ç‚¹</h4><p>é€šè¿‡ç»çº¬åº¦è·å–å¯¹åº”çš„åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œè¿™ä¸ªå«åš<strong>ååœ°ç†ç¼–ç è¯·æ±‚</strong>ï¼Œä»¥å‰ç™¾åº¦åœ°å›¾æœ‰ä¸ª API <code>mGeoCoder.reverseGeoCode(mReverseGeoCodeOption);</code>å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼ŒGoogleåœ°å›¾ä¹Ÿæœ‰ç±»ä¼¼çš„ï¼Œåªä¸è¿‡åœ¨æˆ‘ä½¿ç”¨è¿‡ç¨‹ä¸­å­˜åœ¨ bugã€‚</p><p>å¿ƒæ€¥æƒ³é©¬ä¸Šèƒ½ç”¨çš„ï¼Œå¯ä»¥è‡ªå·±è°ƒåˆ° <strong>Web API</strong> ä¸­çš„ ã€æ ¹æ®ç»çº¬åº¦è·å–é™„è¿‘åœ°ç‚¹ã€‘ç« èŠ‚ã€‚</p><p>æ­¤å¤„å­˜åœ¨çš„é—®é¢˜ï¼šå¦‚æœåæ ‡åˆ‡æ¢ä¸ºå›½å¤–ï¼Œå°±ä¼šé€ æˆè·å–æ•°æ®ä¸ºnullã€‚å³ä½¿ä¿®æ”¹åœ°åŒº mGeocoder = new Geocoder(this, Locale.JAPAN) ä¹Ÿæ— æ•ˆã€‚</p><ol><li><p>åˆå§‹åŒ– <strong>Geocoder</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mGeocoder = <span class="keyword">new</span> Geocoder(<span class="keyword">this</span>, Locale.getDefault());</span><br><span class="line"><span class="comment">//è®¾ç½®åŒºåŸŸ</span></span><br><span class="line"><span class="comment">//mGeocoder = new Geocoder(this, Locale.JAPAN);</span></span><br></pre></td></tr></table></figure></li><li><p>åœ¨å­çº¿ç¨‹è·å–æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Address&gt; addressList =  mGeocoder.getFromLocation(latitude, longitude, maxResult);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != addressList &amp;&amp; addressList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">//éå†è·å–é™„è¿‘åœ°ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">for</span> (Address address : addressList) &#123;</span><br><span class="line">    <span class="comment">//çœ</span></span><br><span class="line">    String adminArea = address.getAdminArea();</span><br><span class="line">    <span class="comment">//å¸‚</span></span><br><span class="line">    String city = address.getLocality();</span><br><span class="line">    <span class="comment">//åœ°å€</span></span><br><span class="line">    String feature = address.getFeatureName();</span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//è·å–é™„è¿‘åœ°ç‚¹å¤±è´¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="startActivityæ–¹å¼"><a href="#startActivityæ–¹å¼" class="headerlink" title="startActivityæ–¹å¼"></a>startActivityæ–¹å¼</h3><h4 id="åœ°ç‚¹æœç´¢"><a href="#åœ°ç‚¹æœç´¢" class="headerlink" title="åœ°ç‚¹æœç´¢"></a>åœ°ç‚¹æœç´¢</h4><ol><li><p>æ‰“å¼€ Activity</p><p><code>private static final int REQUEST_CODE_AUTOCOMPLETE = 2;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰“å¼€æœç´¢çš„ Activity</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">openAutocompleteActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// MODE_FULLSCREEN å…¨å±æ–¹å¼å¯åŠ¨ä¸€ä¸ª Activity</span></span><br><span class="line">        <span class="comment">// MODE_OVERLAY å¯åŠ¨æµ®åœ¨ç•Œé¢ä¸Šçš„æ§ä»¶</span></span><br><span class="line">        Intent intent = <span class="keyword">new</span> PlaceAutocomplete.IntentBuilder(PlaceAutocomplete.MODE_OVERLAY)</span><br><span class="line">                .build(<span class="keyword">this</span>);</span><br><span class="line">        startActivityForResult(intent, REQUEST_CODE_AUTOCOMPLETE);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (GooglePlayServicesRepairableException e) &#123;</span><br><span class="line">        GoogleApiAvailability.getInstance().getErrorDialog(<span class="keyword">this</span>, e.getConnectionStatusCode(), <span class="number">0</span>).show();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (GooglePlayServicesNotAvailableException e) &#123;</span><br><span class="line">        String message = <span class="string">"Google Play Services is not available: "</span> +</span><br><span class="line">                GoogleApiAvailability.getInstance().getErrorString(e.errorCode);</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, message, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨ <em>onActivityResult</em> å›è°ƒä¸­è·å–æœç´¢çš„åœ°ç‚¹ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</span><br><span class="line"> <span class="keyword">if</span> (requestCode == REQUEST_CODE_AUTOCOMPLETE) &#123;</span><br><span class="line">            <span class="keyword">if</span> (resultCode == RESULT_OK) &#123;</span><br><span class="line">                Place place = PlaceAutocomplete.getPlace(<span class="keyword">this</span>, data);</span><br><span class="line">                String placeText = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> != place) &#123;</span><br><span class="line">                    placeText = <span class="string">"place.getId() = "</span> + place.getId()</span><br><span class="line">                              + <span class="string">"\nplace.getName() = "</span> + place.getName()</span><br><span class="line">                              + <span class="string">"\nplace.getLatLng().latitude = "</span> + place.getLatLng().latitude</span><br><span class="line">                              + <span class="string">"\nplace.getLatLng().longitude = "</span> + place.getLatLng().longitude</span><br><span class="line">                              + <span class="string">"\nplace.getAddress() = "</span> +place.getAddress()</span><br><span class="line">                              + <span class="string">"\nplace.getPhoneNumber() = "</span> + place.getPhoneNumber()</span><br><span class="line">                              + <span class="string">"\nplace.getLocale() = "</span> + place.getLocale()</span><br><span class="line">                              + <span class="string">"\n......."</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        </span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, getString(R.string.start_by_activity_btn_search_place_result, placeText), Toast.LENGTH_LONG).show();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resultCode == PlaceAutocomplete.RESULT_ERROR) &#123;</span><br><span class="line">            <span class="comment">//é”™è¯¯ç </span></span><br><span class="line">                Status status = PlaceAutocomplete.getStatus(<span class="keyword">this</span>, data);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resultCode == RESULT_CANCELED) &#123;</span><br><span class="line">            <span class="comment">//å–æ¶ˆ</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="å¯¼èˆª"><a href="#å¯¼èˆª" class="headerlink" title="å¯¼èˆª"></a>å¯¼èˆª</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¼€å¯å¯¼èˆª</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> latitude</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> longitude</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startNavigation</span><span class="params">(<span class="keyword">double</span> latitude, <span class="keyword">double</span> longitude)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Uri gmmIntentUri = Uri.parse(<span class="string">"google.navigation:q="</span>+latitude+<span class="string">","</span>+longitude+<span class="string">"&amp;mode=d"</span>);</span><br><span class="line">        Intent mapIntent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW, gmmIntentUri);</span><br><span class="line">        mapIntent.setPackage(<span class="string">"com.google.android.apps.maps"</span>);</span><br><span class="line">        startActivity(mapIntent);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">//æç¤ºæœªå®‰è£…google map</span></span><br><span class="line">       </span><br><span class="line">        <span class="comment">//å¼€å¯google mapä¸‹è½½ç•Œé¢</span></span><br><span class="line">        showGoogleMapDownloadView();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¼€å¯google mapä¸‹è½½ç•Œé¢</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showGoogleMapDownloadView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Uri uri = Uri.parse(<span class="string">"market://details?id=com.google.android.apps.maps"</span>);</span><br><span class="line">    Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW, uri);</span><br><span class="line">    <span class="keyword">this</span>.startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é™„è¿‘åœ°ç‚¹"><a href="#é™„è¿‘åœ°ç‚¹" class="headerlink" title="é™„è¿‘åœ°ç‚¹"></a>é™„è¿‘åœ°ç‚¹</h4><ol><li><p>è·å–å®šä½æƒé™</p><p>è·å–æ–¹æ³•å’Œå‰é¢ä¸€æ ·ï¼Œä½¿ç”¨ <em>checkLocationPermission()</em></p></li><li><p>æ‰“å¼€ Activityï¼Œå¼€å¯é™„è¿‘åœ°ç‚¹é€‰æ‹©</p><p><code>private static final int PLACE_PICKER_REQUEST = 3;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PlacePicker.IntentBuilder builder = <span class="keyword">new</span> PlacePicker.IntentBuilder();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    startActivityForResult(builder.build(<span class="keyword">this</span>), PLACE_PICKER_REQUEST);</span><br><span class="line">&#125; <span class="keyword">catch</span> (GooglePlayServicesRepairableException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (GooglePlayServicesNotAvailableException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨ onActivityResult è·å–é€‰æ‹©çš„åœ°ç‚¹ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (requestCode == PLACE_PICKER_REQUEST) &#123;</span><br><span class="line">      <span class="keyword">if</span> (resultCode == RESULT_OK) &#123;</span><br><span class="line">          Place place = PlacePicker.getPlace(<span class="keyword">this</span>, data);</span><br><span class="line">          <span class="comment">//place.getName() .... </span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="Places"><a href="#Places" class="headerlink" title="Places"></a>Places</h2><h3 id="å½“å‰ä½ç½®åŠé™„è¿‘åœ°ç‚¹"><a href="#å½“å‰ä½ç½®åŠé™„è¿‘åœ°ç‚¹" class="headerlink" title="å½“å‰ä½ç½®åŠé™„è¿‘åœ°ç‚¹"></a>å½“å‰ä½ç½®åŠé™„è¿‘åœ°ç‚¹</h3><h4 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mMaxEntries = <span class="number">5</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å½“å‰ä½ç½®åŠé™„è¿‘åœ°ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getCurrentPlaces</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!mConnected) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!checkLocationPermission()) &#123;</span><br><span class="line">    <span class="comment">//æœªæˆæƒå®šä½</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PendingResult&lt;PlaceLikelihoodBuffer&gt; result = Places.PlaceDetectionApi</span><br><span class="line">            .getCurrentPlace(mGoogleApiClient, <span class="keyword">null</span>);</span><br><span class="line">    result.setResultCallback(<span class="keyword">new</span> ResultCallback&lt;PlaceLikelihoodBuffer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResult</span><span class="params">(@NonNull PlaceLikelihoodBuffer likelyPlaces)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">            String[] likelyPlaceNames = <span class="keyword">new</span> String[mMaxEntries];</span><br><span class="line">            String[] likelyPlaceAddresses = <span class="keyword">new</span> String[mMaxEntries];</span><br><span class="line">            String[] likelyPlaceAttributions = <span class="keyword">new</span> String[mMaxEntries];</span><br><span class="line">            LatLng[] likelyPlaceLatLngs = <span class="keyword">new</span> LatLng[mMaxEntries];</span><br><span class="line">            <span class="keyword">for</span> (PlaceLikelihood placeLikelihood : likelyPlaces) &#123;</span><br><span class="line">                <span class="comment">// Build a list of likely places to show the user. Max 5.</span></span><br><span class="line">                likelyPlaceNames[i] = (String) placeLikelihood.getPlace().getName();</span><br><span class="line">                likelyPlaceAddresses[i] = (String) placeLikelihood.getPlace().getAddress();</span><br><span class="line">                likelyPlaceAttributions[i] = (String) placeLikelihood.getPlace()</span><br><span class="line">                        .getAttributions();</span><br><span class="line">                likelyPlaceLatLngs[i] = placeLikelihood.getPlace().getLatLng();</span><br><span class="line"></span><br><span class="line">                i++;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//String placeId = (String) placeLikelihood.getPlace().getId();</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (i &gt; (mMaxEntries - <span class="number">1</span>)) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            likelyPlaces.release();</span><br><span class="line"></span><br><span class="line">            StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span> (String placeName : likelyPlaceNames) &#123;</span><br><span class="line">                builder.append(placeName + <span class="string">"\n"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ˜¾ç¤ºåœ°ç‚¹åˆ—è¡¨</span></span><br><span class="line">            <span class="comment">//builder.toString()</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ ¹æ®-PlaceID-è·å–å¯¹åº”åœ°ç‚¹"><a href="#æ ¹æ®-PlaceID-è·å–å¯¹åº”åœ°ç‚¹" class="headerlink" title="æ ¹æ® PlaceID è·å–å¯¹åº”åœ°ç‚¹"></a>æ ¹æ® PlaceID è·å–å¯¹åº”åœ°ç‚¹</h3><p>åœ¨ <em>onResult</em> è¿”å›çš„ places ä¸€èˆ¬åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå°±æ˜¯ id å¯¹åº”çš„åœ°ç‚¹ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡placeIdè·å–å¯¹åº”çš„ä½ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> placeId</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span>  <span class="keyword">void</span> <span class="title">getPlaceById</span><span class="params">(String placeId)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (TextUtils.isEmpty(placeId)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Places.GeoDataApi.getPlaceById(mGoogleApiClient, placeId)</span><br><span class="line">            .setResultCallback(<span class="keyword">new</span> ResultCallback&lt;PlaceBuffer&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResult</span><span class="params">(PlaceBuffer places)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (places.getStatus().isSuccess() &amp;&amp; places.getCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        Place myPlace = places.get(<span class="number">0</span>);</span><br><span class="line">                        <span class="comment">//è·å–idå¯¹åº”çš„Place</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">//æ²¡æœ‰è·å–åˆ°æ•°æ®</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    places.release();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Web-API"><a href="#Web-API" class="headerlink" title="Web API"></a>Web API</h2><p>è¿™é‡Œè¯´çš„ Web API æ˜¯æŒ‡ï¼šé€šè¿‡æ‹¼æ¥ url çš„æ–¹å¼ï¼Œå‘ Google æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€æ®µ JSONï¼Œæˆ‘ä»¬æœ¬åœ°å†ç”¨ fastjson è§£æï¼Œè·å–å¯¹åº”çš„æ•°æ®ã€‚</p><h3 id="æ ¹æ®åæ ‡è·å–æ‰€åœ¨åŸå¸‚"><a href="#æ ¹æ®åæ ‡è·å–æ‰€åœ¨åŸå¸‚" class="headerlink" title="æ ¹æ®åæ ‡è·å–æ‰€åœ¨åŸå¸‚"></a>æ ¹æ®åæ ‡è·å–æ‰€åœ¨åŸå¸‚</h3><p>è¿™é‡Œçš„ URL å¯ä»¥è¿™æ ·æ‹¼æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String GOOGLE_MAP_URL = <span class="string">"https://maps.google.com/maps/api/geocode/json?language=%1$s&amp;sensor=true&amp;latlng=%2$s,%3$s"</span>;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <em>%1$s</em> å¯¹åº”çš„æ˜¯è¯­è¨€ï¼Œæ¯”å¦‚æˆ‘è¦è¿”å›çš„æ˜¯ä¸­æ–‡ï¼Œé‚£ä¹ˆå¯¹äºçš„å°±æ˜¯ <em>zh-CN*ï¼Œ</em>%2$s %3$s* å¯¹åº”çš„å°±æ˜¯çº¬åº¦å’Œç»åº¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_LANGUAGE = <span class="string">"zh-CN"</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‹¼æ¥url(é»˜è®¤è®¾ç½®è¯­è¨€ä¸ºä¸­æ–‡)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> latitude</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> longitude</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getGoogleMapUrl</span><span class="params">(<span class="keyword">double</span> latitude, <span class="keyword">double</span> longitude)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> String.format(GOOGLE_MAP_URL, DEFAULT_LANGUAGE, Double.valueOf(latitude), Double.valueOf(longitude));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå¤–é¢åªéœ€è¦ç›´æ¥è°ƒè¿™ä¸ªæ–¹æ³•ï¼Œå‚æ•°ä¼ å…¥çº¬åº¦ã€ç»åº¦ï¼Œå°±ä¼šè¿”å›æ‹¼æ¥å¥½çš„ URLã€‚</p><p>è·å–äº† URLï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼‚æ­¥è®¿é—®ç½‘ç»œï¼Œå»è·å–æ•°æ®äº†ã€‚è¿™é‡Œä¸»è¦è®²ä¸‹æ€è·¯ï¼Œè¯¦ç»†ä»£ç ï¼Œå¯ä»¥è‡ªå·±æŸ¥çœ‹ <a href="https://github.com/ansuote/GoogleMapDemo" target="_blank" rel="noopener">Demo</a>ã€‚</p><p>ä»¥Demoä¸ºä¾‹ï¼Œæ‹¼æ¥çš„URLä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//maps.google.com/maps/api/geocode/json?language=zh-CN&amp;sensor=true&amp;latlng=22.536817569098282,113.97451490163802</span></span><br></pre></td></tr></table></figure><p>è·å–çš„ JSON å¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"results"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"address_components"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"long_name"</span>: <span class="string">"9028"</span>,</span><br><span class="line">                    <span class="attr">"short_name"</span>: <span class="string">"9028"</span>,</span><br><span class="line">                    <span class="attr">"types"</span>: [</span><br><span class="line">                        <span class="string">"street_number"</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"long_name"</span>: <span class="string">"æ·±å—å¤§é“"</span>,</span><br><span class="line">                    <span class="attr">"short_name"</span>: <span class="string">"æ·±å—å¤§é“"</span>,</span><br><span class="line">                    <span class="attr">"types"</span>: [</span><br><span class="line">                        <span class="string">"route"</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"long_name"</span>: <span class="string">"åä¾¨åŸ"</span>,</span><br><span class="line">                    <span class="attr">"short_name"</span>: <span class="string">"åä¾¨åŸ"</span>,</span><br><span class="line">                    <span class="attr">"types"</span>: [</span><br><span class="line">                        <span class="string">"neighborhood"</span>,</span><br><span class="line">                        <span class="string">"political"</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"long_name"</span>: <span class="string">"å—å±±åŒº"</span>,</span><br><span class="line">                    <span class="attr">"short_name"</span>: <span class="string">"å—å±±åŒº"</span>,</span><br><span class="line">                    <span class="attr">"types"</span>: [</span><br><span class="line">                        <span class="string">"political"</span>,</span><br><span class="line">                        <span class="string">"sublocality"</span>,</span><br><span class="line">                        <span class="string">"sublocality_level_1"</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"long_name"</span>: <span class="string">"æ·±åœ³å¸‚"</span>,</span><br><span class="line">                    <span class="attr">"short_name"</span>: <span class="string">"æ·±åœ³å¸‚"</span>,</span><br><span class="line">                    <span class="attr">"types"</span>: [</span><br><span class="line">                        <span class="string">"locality"</span>,</span><br><span class="line">                        <span class="string">"political"</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"long_name"</span>: <span class="string">"å¹¿ä¸œçœ"</span>,</span><br><span class="line">                    <span class="attr">"short_name"</span>: <span class="string">"å¹¿ä¸œçœ"</span>,</span><br><span class="line">                    <span class="attr">"types"</span>: [</span><br><span class="line">                        <span class="string">"administrative_area_level_1"</span>,</span><br><span class="line">                        <span class="string">"political"</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;,</span><br><span class="line">                /**</span><br><span class="line">                 * ç¯‡å¹…åŸå› ï¼Œçœç•¥å…¶ä½™æ•°æ®</span><br><span class="line">                 */</span><br><span class="line">    <span class="string">"status"</span>: <span class="string">"OK"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ type å¯¹åº”çš„å€¼æ˜¯ <strong>locality</strong> çš„å°±æ˜¯<strong>åŸå¸‚åå­—</strong>ï¼Œ<strong>political</strong> ä»£è¡¨<strong>æ”¿æ²»å®ä½“</strong>ã€‚</p><p>å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®ç»çº¬åº¦è·å–å¯¹åº”çš„åŸå¸‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> latitude</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> longitude</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getCityByLatlngWeb</span><span class="params">(<span class="keyword">double</span> latitude, <span class="keyword">double</span> longitude)</span> </span>&#123;</span><br><span class="line">    String urlString = GoogleMapUrlUtil.getGoogleMapUrl(latitude, longitude);</span><br><span class="line">    <span class="keyword">if</span> (URLUtil.isNetworkUrl(urlString)) &#123;</span><br><span class="line">        <span class="keyword">new</span> GeocodeTask().execute(urlString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GeocodeTask</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">String</span>, <span class="title">Void</span>, <span class="title">JSONObject</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPreExecute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> com.alibaba.fastjson.<span class="function">JSONObject <span class="title">doInBackground</span><span class="params">(String... params)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è¯·æ±‚ç½‘ç»œï¼Œå¹¶ä¸”è½¬åŒ–ä¸º JSONObject å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> GoogleMapUrlUtil.returnResult(HttpUtils.doGet(params[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(com.alibaba.fastjson.JSONObject result)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != result) &#123;</span><br><span class="line">            JSONArray jsonArray = result.getJSONArray(<span class="string">"results"</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != jsonArray) &#123;</span><br><span class="line">                Object firstObj = jsonArray.get(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> != firstObj) &#123;</span><br><span class="line">                    GeocodeBean bean = JSON.parseObject(firstObj.toString(), GeocodeBean.class);</span><br><span class="line">                    <span class="comment">//è·å–æ‰€åœ¨åŸå¸‚</span></span><br><span class="line">                    String city = getLocality(bean);</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeocodeBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;AddressComponent&gt; address_components;</span><br><span class="line">    <span class="keyword">private</span> String formatted_address;</span><br><span class="line">    <span class="comment">//geometry</span></span><br><span class="line">    <span class="keyword">private</span> String place_id;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; types;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//set, get æ–¹æ³•è‡ªå·±è¡¥å……å“ˆ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»æ•°æ®é›†é‡Œé¢è·å–æ‰€åœ¨åŸå¸‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getLocality</span><span class="params">(GeocodeBean bean)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> isFound = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> != bean) &#123;</span><br><span class="line">        List&lt;AddressComponent&gt; list = bean.getAddress_components();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != list) &#123;</span><br><span class="line">            <span class="keyword">for</span> (AddressComponent address : list) &#123;</span><br><span class="line">                List&lt;String&gt; types = address.getTypes();</span><br><span class="line">                <span class="keyword">for</span> (String type : types) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">"locality"</span>.equals(type)) &#123;</span><br><span class="line">                        isFound = <span class="keyword">true</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (isFound) &#123;</span><br><span class="line">                    <span class="keyword">return</span> address.getShort_name();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ ¹æ®ç»çº¬åº¦è·å–é™„è¿‘åœ°ç‚¹-1"><a href="#æ ¹æ®ç»çº¬åº¦è·å–é™„è¿‘åœ°ç‚¹-1" class="headerlink" title="æ ¹æ®ç»çº¬åº¦è·å–é™„è¿‘åœ°ç‚¹"></a>æ ¹æ®ç»çº¬åº¦è·å–é™„è¿‘åœ°ç‚¹</h3><p>å‰é¢è·å–å¯¹åº”åŸå¸‚ä¸­ç”¨çš„ URL å¾ˆæ–¹ä¾¿ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰é™åˆ¶ã€‚ä½†æ˜¯è·å–é™„è¿‘åœ°ç‚¹çš„å°±æ²¡è¿™ä¹ˆå¥½äº†ï¼Œåœ¨æ‹¼æ¥ URL çš„æ—¶å€™ï¼Œéœ€è¦åŠ ä¸Šè°·æ­Œæˆæƒç»™ä½ çš„ <em>Web API key</em>ã€‚è¿™ä¸ªæ˜¯å®˜æ–¹æ¨èçš„åšæ³•ï¼Œè¯¦æƒ…å¯ä»¥æŸ¥çœ‹<a href="https://developers.google.com/maps/documentation/geocoding/intro" target="_blank" rel="noopener">å®˜ç½‘çš„ä»‹ç»</a></p><h4 id="ç‰¹åˆ«æ³¨æ„"><a href="#ç‰¹åˆ«æ³¨æ„" class="headerlink" title="ç‰¹åˆ«æ³¨æ„"></a>ç‰¹åˆ«æ³¨æ„</h4><p>è¿™é‡Œæœ‰ä¸€ç‚¹è¦ç‰¹åˆ«æ³¨æ„çš„ï¼Œè¿™é‡Œè¯´çš„ <em>Web API key</em> å¿…é¡»è¦é‡æ–°ç”³è¯·çš„ã€‚ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨ GoogleMap çš„æ—¶å€™å·²ç»ç”³è¯·äº† KEYï¼Œä½†æ˜¯é€‰é¡¹é€‰æ‹©çš„æ˜¯<strong>ã€Android appsã€‘</strong>ï¼Œåªæ˜¯ä½œç”¨äº Android Map ç›¸å…³ APIï¼Œè¿™ä¸ªæ—¶å€™è®¿é—® Web API å¿…é¡»é‡æ–°ç”³è¯·å¤šä¸€ä¸ª KEYã€‚ç”³è¯·æ–¹æ³•å’Œå‰é¢ä¸€æ ·ï¼Œåªæ˜¯é€‰é¡¹ä¸º<strong>ã€Noneã€‘</strong>å³å¯ã€‚</p><p>è®¾ç½®å®Œä¹‹åå¦‚æœä¸€èˆ¬é—´éš”å‡ åˆ†é’Ÿå°±å¯ä»¥è°ƒç”¨ï¼Œå¦‚æœä¸è¡Œï¼Œå°±è¦æ‰‹åŠ¨å¼€å¯æœåŠ¡ã€‚<a href="https://console.developers.google.com/apis/api/places_backend?project=_" target="_blank" rel="noopener">ç‚¹å‡»æ­¤å¤„å¼€å¯</a>,é€‰æ‹©å¯¹åº”çš„é¡¹ç›®ï¼Œ<strong>ã€å¯ç”¨ã€‘</strong> <em>Google Places API Web Service</em> æœåŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String GOOGLE_MAP_PLACES_URL = <span class="string">"https://maps.googleapis.com/maps/api/place/nearbysearch/json?language=%1$s&amp;location=%2$s,%3$s&amp;radius=%4$s&amp;type=%5$s&amp;key=%6$s"</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸‹å‚æ•°æœ‰ç‚¹å¤šäº†å“ˆï¼Œå‰é¢3ä¸ªå’Œä¹‹å‰ä¸€æ ·ï¼Œåˆ†åˆ«å¯¹åº”è¯­è¨€ã€çº¬åº¦ã€ç»åº¦ã€‚ç¬¬å››ä¸ªå‚æ•°æ˜¯æŸ¥è¯¢åœ°ç‚¹çš„åŠå¾„å¤šå¤§ï¼Œç¬¬äº”ä¸ªæ˜¯ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ <strong>point_of_interest</strong> æ„æ€æ˜¯<strong>å·²ç»å‘½åçš„æ™¯ç‚¹</strong>ï¼Œ<a href="https://developers.google.com/maps/documentation/geocoding/intro#Types" target="_blank" rel="noopener">å…¶ä»–ç±»å‹å¯ä»¥æŸ¥çœ‹å®˜ç½‘</a>ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯ä½ çš„ APP ç”³è¯·çš„ Keyå€¼ã€‚</p><p>å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ç»çº¬åº¦å¯¹åº”çš„é™„è¿‘åœ°ç‚¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> latitude</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> longitude</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getPlacesByLatLngWeb</span><span class="params">(<span class="keyword">double</span> latitude, <span class="keyword">double</span> longitude)</span> </span>&#123;</span><br><span class="line">    String url = GoogleMapUrlUtil.getGoogleMapPlacesUrl(latitude, longitude);</span><br><span class="line">    <span class="keyword">if</span> (URLUtil.isNetworkUrl(url)) &#123;</span><br><span class="line">        <span class="keyword">new</span> NearbyPlacesTask().execute(url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NearbyPlacesTask</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">String</span>, <span class="title">Void</span>, <span class="title">JSONObject</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> JSONObject <span class="title">doInBackground</span><span class="params">(String... params)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> GoogleMapUrlUtil.returnResult(HttpUtils.doGet(params[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(JSONObject result)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != result) &#123;</span><br><span class="line">            JSONArray jsonArray = result.getJSONArray(<span class="string">"results"</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != jsonArray) &#123;</span><br><span class="line">                List&lt;NearbyPlaceBean&gt; list = JSON.parseArray(jsonArray.toString(), NearbyPlaceBean.class);</span><br><span class="line">                <span class="comment">//éå† list å¯ä»¥è·å–å¯¹åº”çš„é™„è¿‘åœ°ç‚¹ä¿¡æ¯</span></span><br><span class="line">                <span class="comment">//listçš„sizeèƒ½æ¯”è¾ƒå¤§ï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼ŒæŒ‡æˆªå–å‰é¢10ä¸ªã€‚</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NearbyPlaceBean</span> </span>&#123;</span><br><span class="line">    <span class="comment">//geometry</span></span><br><span class="line">    <span class="comment">//icon</span></span><br><span class="line">    <span class="keyword">private</span> String id;      <span class="comment">//1f7541b5f729cdc8bc8bb546f205848c50315af7</span></span><br><span class="line">    <span class="keyword">private</span> String name;    <span class="comment">//æ¾æŸç™½é‡‘å‡æ—¥å…¬å¯“</span></span><br><span class="line">    <span class="comment">//photos</span></span><br><span class="line">    <span class="keyword">private</span> String place_id;    <span class="comment">//ChIJX9_kRAXsAzQRKmc97njB67c</span></span><br><span class="line">    <span class="comment">//reference</span></span><br><span class="line">    <span class="comment">//scope</span></span><br><span class="line">    <span class="comment">//types</span></span><br><span class="line">    <span class="keyword">private</span> String vicinity;    <span class="comment">//æ·±åœ³å¸‚å®å®‰åŒº</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> GeometryBean geometry;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//setï¼Œget è‡ªå·±è¡¥å……å“ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®æˆ˜ï¼šé™„è¿‘åœ°ç‚¹æ¨è"><a href="#å®æˆ˜ï¼šé™„è¿‘åœ°ç‚¹æ¨è" class="headerlink" title="å®æˆ˜ï¼šé™„è¿‘åœ°ç‚¹æ¨è"></a>å®æˆ˜ï¼šé™„è¿‘åœ°ç‚¹æ¨è</h2><p>å¯ä»¥åƒä¸Šé¢é‚£æ ·ä½¿ç”¨ Activity çš„æ–¹å¼ï¼Œå¼¹å‡º Google è‡ªå¸¦çš„åœ°ç‚¹æ¨èï¼é€‰å–ç•Œé¢ï¼Œä½†æ˜¯è¿™æ ·çš„UIå®šåˆ¶æ€§ä½ï¼Œä¸èƒ½æŒ‰ç…§é¡¹ç›®éœ€æ±‚æ˜¾ç¤ºç•Œé¢ã€‚æ‰€ä»¥æ ¹æ®ä¸Šé¢å­¦ä¹ åˆ°çš„ä¸œè¥¿ï¼Œæˆ‘é‡æ–°å†™äº†ä¸ªç±»ä¼¼çš„ç•Œé¢ï¼Œå®ç°åœ°ç‚¹æ¨èã€æœç´¢ã€é€‰æ‹©å’Œæˆªå›¾åŠŸèƒ½çš„åŠŸèƒ½ã€‚è€ƒè™‘åˆ°é¢‘ç¹è°ƒæ¥å£ä¼šæŸè€—è¯·æ±‚æ¬¡æ•°ï¼Œæ‰€ä»¥æˆ‘è®¾ç½®äº†ä¸ªåŠå¾„ï¼Œè¶…è¿‡åŠå¾„çš„æ‰é‡æ–°è¯·æ±‚æ•°æ®ã€‚</p><h2 id="é™åˆ¶ï¼æ”¶è´¹"><a href="#é™åˆ¶ï¼æ”¶è´¹" class="headerlink" title="é™åˆ¶ï¼æ”¶è´¹"></a>é™åˆ¶ï¼æ”¶è´¹</h2><p>å‰é¢æˆ‘æŠŠç±»å‹åˆ†ä¸º Mapï¼ŒPlacesä¸»è¦åŸå› å°±æ˜¯ï¼Œä»–ä»¬çš„æ”¶è´¹æ ‡å‡†æ˜¯ä¸åŒçš„ã€‚<a href="https://developers.google.com/maps/pricing-and-plans/#details" target="_blank" rel="noopener">è¯¦æƒ…å¯è§</a></p><table><thead><tr><th align="left">Android</th><th align="left">æ ‡å‡†æ–¹æ¡ˆ</th><th align="left">é«˜çº§</th></tr></thead><tbody><tr><td align="left">Google Maps Android API</td><td align="left">ä¸å—é™åˆ¶åœ°å…è´¹ä½¿ç”¨ã€‚<a href="https://developers.google.com/maps/pricing-and-plans/#sup_1" target="_blank" rel="noopener">1</a></td><td align="left">å®šä»·åŸºäºæ‰€éœ€æ•°é‡ã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://developers.google.com/maps/premium/usage-limits" target="_blank" rel="noopener">Premium Planä½¿ç”¨ç‡å’Œé™åˆ¶</a>ã€‚</td></tr><tr><td align="left">Google Places API for Android</td><td align="left">é»˜è®¤æ¯å¤© 1,000 æ¬¡å…è´¹è¯·æ±‚ï¼Œ<a href="https://developers.google.com/places/android-api/usage#query-limits" target="_blank" rel="noopener">ä¿¡ç”¨å¡éªŒè¯</a>åå¯å¢è‡³æ¯å¤© 150,000 æ¬¡å…è´¹è¯·æ±‚ã€‚ç¬¦åˆè¦æ±‚çš„åº”ç”¨å¯å…è´¹æå‡ã€‚<a href="https://developers.google.com/places/android-api/usage" target="_blank" rel="noopener">è¯¦æƒ…</a></td><td align="left">â€”-</td></tr></tbody></table><table><thead><tr><th align="left">Web æœåŠ¡</th><th align="left">æ ‡å‡†</th><th align="left">é«˜çº§</th></tr></thead><tbody><tr><td align="left">Google Places API Web Service</td><td align="left">æ¯å¤© 150,000 æ¬¡å…è´¹è¯·æ±‚ï¼ˆ<a href="https://developers.google.com/places/web-service/usage" target="_blank" rel="noopener">ä¿¡ç”¨å¡éªŒè¯</a>åï¼‰ã€‚</td><td align="left">å®šä»·åŸºäºæ‰€éœ€æ•°é‡ã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://developers.google.com/maps/premium/usage-limits" target="_blank" rel="noopener">Premium Planä½¿ç”¨ç‡å’Œé™åˆ¶</a>ã€‚</td></tr></tbody></table><h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><h3 id="å®˜æ–¹-Demo"><a href="#å®˜æ–¹-Demo" class="headerlink" title="å®˜æ–¹ Demo"></a>å®˜æ–¹ Demo</h3><p>å®˜æ–¹ Demo è¦è·‘èµ·æ¥ï¼Œå¿…é¡»åƒå‰é¢çš„æ–¹å¼ä¸€æ ·ï¼Œå»ç”³è¯·å¯¹åº”çš„ Keyã€‚</p><h4 id="android-samples-apiDemos"><a href="#android-samples-apiDemos" class="headerlink" title="android-samples-apiDemos"></a><a href="https://github.com/googlemaps/android-samples/tree/master/ApiDemos" target="_blank" rel="noopener">android-samples-apiDemos</a></h4><p>ä»‹ç» Map ç›¸å…³ APIã€‚</p><h4 id="android-play-places"><a href="#android-play-places" class="headerlink" title="android-play-places"></a><a href="https://github.com/googlesamples/android-play-places/" target="_blank" rel="noopener">android-play-places</a></h4><p>ä»‹ç» Places ç›¸å…³ API ã€‚åŒ…æ‹¬åœ°ç‚¹æœç´¢ï¼Œé™„è¿‘åœ°ç‚¹é€‰æ‹©ï¼Œåœ°ç‚¹è¡¥å…¨ç­‰ã€‚</p><h4 id="android-maps-utils"><a href="#android-maps-utils" class="headerlink" title="android-maps-utils"></a><a href="https://github.com/googlemaps/android-maps-utils" target="_blank" rel="noopener">android-maps-utils</a></h4><p><strong>ç‚¹èšåˆ Clustering</strong> å¯ä»¥é€šè¿‡è¿™ä¸ª demo å­¦ä¹ ï¼ŒGoogleMapçš„ç‚¹èšåˆå’Œç™¾åº¦æ˜¯ä¸€æ ·çš„ç”¨æ³•ï¼Œå¤–å±‚ä»£ç åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ã€‚</p><h3 id="å·¥å…·ç±»ç½‘é¡µ"><a href="#å·¥å…·ç±»ç½‘é¡µ" class="headerlink" title="å·¥å…·ç±»ç½‘é¡µ"></a>å·¥å…·ç±»ç½‘é¡µ</h3><ol><li><a href="https://console.developers.google.com/apis/credentials?project=savvy-generator-167702" target="_blank" rel="noopener">API Console</a> ï¼ˆKey ç®¡ç†æ§åˆ¶å°ï¼‰</li><li><a href="https://developers.google.com/android/reference/com/google/android/gms/maps/package-summary" target="_blank" rel="noopener">Google Map API æŸ¥è¯¢</a></li><li>åæ ‡åæŸ¥ (é€šè¿‡ç»çº¬åº¦æŸ¥å¯¹åº”åœ°ç‚¹)<br><a href="https://www.google.com/maps" target="_blank" rel="noopener">GoogleMap</a><br>(è°·æ­Œåœ°å›¾ç›´æ¥æŠŠç»çº¬åº¦è¾“å…¥è¾“å…¥æ¡†å³å¯æŸ¥è¯¢ï¼Œä¾‹å¦‚è¾“å…¥ï¼š22.536817569098282,113.97451490163802 )<br><a href="http://lbs.amap.com/console/show/picker" target="_blank" rel="noopener">é«˜å¾·åœ°å›¾</a><br><a href="http://api.map.baidu.com/lbsapi/getpoint/" target="_blank" rel="noopener">ç™¾åº¦åœ°å›¾</a></li></ol><h3 id="ç›¸å…³å‚è€ƒ"><a href="#ç›¸å…³å‚è€ƒ" class="headerlink" title="ç›¸å…³å‚è€ƒ"></a>ç›¸å…³å‚è€ƒ</h3><p>[1]å®˜æ–¹ Map æ•™ç¨‹ <a href="https://developers.google.com/maps/documentation/android-api/" target="_blank" rel="noopener">https://developers.google.com/maps/documentation/android-api/</a><br>[2]å®˜æ–¹ Places æ•™ç¨‹ <a href="https://developers.google.com/places/android-api/" target="_blank" rel="noopener">https://developers.google.com/places/android-api/</a><br>[3]å¯åŠ¨ GoogleMap <a href="https://developers.google.com/maps/documentation/android-api/intents" target="_blank" rel="noopener">https://developers.google.com/maps/documentation/android-api/intents</a><br>[4]Androidä½¿ç”¨intentè°ƒå–å¯¼èˆªæˆ–è€…åœ°å›¾ <a href="https://blog.csdn.net/qwer4755552/article/details/51659833" target="_blank" rel="noopener">https://blog.csdn.net/qwer4755552/article/details/51659833</a><br>[5]å…³äºåœ°å›¾å’Œåç§»çš„é‚£äº›äº‹ <a href="https://blog.csdn.net/sanjay_f/article/details/48493699" target="_blank" rel="noopener">https://blog.csdn.net/sanjay_f/article/details/48493699</a><br>[6]åœ°å›¾åæ ‡è½¬æ¢å¤§å…¨ <a href="http://www.eoeandroid.com/forum.php?mod=viewthread&tid=332419" target="_blank" rel="noopener">http://www.eoeandroid.com/forum.php?mod=viewthread&amp;tid=332419</a><br>[7]Show Popup when Location access is disable by user (Andorid Google Maps) <a href="https://stackoverflow.com/questions/24160472/show-popup-when-location-access-is-disable-by-user-andorid-google-maps" target="_blank" rel="noopener">https://stackoverflow.com/questions/24160472/show-popup-when-location-access-is-disable-by-user-andorid-google-maps</a><br>[8]How to show enable location dialog like Google maps? <a href="https://stackoverflow.com/questions/29801368/how-to-show-enable-location-dialog-like-google-maps" target="_blank" rel="noopener">https://stackoverflow.com/questions/29801368/how-to-show-enable-location-dialog-like-google-maps</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h2&gt;&lt;p&gt;é€šè¿‡æœ¬æ–‡ï¼Œä½ å¯ä»¥çŸ¥é“å¦‚ä½•ä½¿ç”¨ GoogleMap ç›¸å…³ APIã€å®šä½å½“å‰ä½ç½®ã€è·å–å½“å‰æ‰€åœ¨åŸå¸‚ã€è·å–å½“å‰ä½ç½®é™„è¿‘çš„åœ°ç‚¹ã€å¯¼èˆªã€åœ°ç‚¹æœç´¢ç­‰å†…å®¹ã€‚å¤§è‡´å†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹å¦‚ä¸‹æ€ç»´å¯¼å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/GoogleMapXmind.png&quot; alt&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="Map" scheme="https://zhangmiao.cc/categories/Android/Map/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="Map" scheme="https://zhangmiao.cc/tags/Map/"/>
    
  </entry>
  
  <entry>
    <title>æœ€æ–°Androidæ¡†æ¶æ’è¡Œæ¦œï¼Œä¸Šç™¾é¡¹èµ„æºæ±‡æ€»ä¸å®¹é”™è¿‡</title>
    <link href="https://zhangmiao.cc/posts/b0de6447.html"/>
    <id>https://zhangmiao.cc/posts/b0de6447.html</id>
    <published>2019-07-22T03:30:00.000Z</published>
    <updated>2019-07-22T03:36:29.957Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Androidæ¡†æ¶æ’è¡Œæ¦œ"><a href="#Androidæ¡†æ¶æ’è¡Œæ¦œ" class="headerlink" title="Androidæ¡†æ¶æ’è¡Œæ¦œ"></a>Androidæ¡†æ¶æ’è¡Œæ¦œ</h4><h5 id="1-Retrofit"><a href="#1-Retrofit" class="headerlink" title="1.Retrofitã€€ã€€"></a>1.Retrofitã€€ã€€</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šRetrofitæ˜¯ä¸€æ¬¾ç±»å‹å®‰å…¨çš„ç½‘ç»œæ¡†æ¶ï¼ŒåŸºäºHTTPåè®®ï¼ŒæœåŠ¡äºAndroidå’Œjavaè¯­è¨€</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šRetrofitä»¥21.8kçš„starsé‡é›„è¸githubä¸­androidå­æ ‡é¢˜æ¦œé¦–ï¼Œç¬¬ä¸€å½“ä¹‹æ— æ„§ã€‚</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://square.github.io/retrofit/" target="_blank" rel="noopener">http://square.github.io/retrofit/</a></li><li>githubï¼š<a href="https://github.com/square/retrofit" target="_blank" rel="noopener">https://github.com/square/retrofit</a></li><li>ä½œè€…ï¼šsquareå›¢é˜Ÿ</li></ul><h5 id="ä½¿ç”¨ï¼š"><a href="#ä½¿ç”¨ï¼š" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.squareup.retrofit2:retrofit:2.3.0&apos;</span><br></pre></td></tr></table></figure><h5 id="2-okhttp"><a href="#2-okhttp" class="headerlink" title="2.okhttp"></a>2.okhttp</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šokhttpæ˜¯ä¸€æ¬¾åŸºäºHTTPå’ŒHTTP2.0åè®®çš„ç½‘ç»œæ¡†æ¶ï¼ŒæœåŠ¡äºjavaå’Œandroidå®¢æˆ·ç«¯</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼Œokhttpä»¥20.4kçš„starsé‡é›„è¸githubä¸­androidå­æ ‡é¢˜ç¬¬äºŒåã€‚å¤§å‹å…¬å¸æ¯”å¦‚æ·˜å®ä¹Ÿå°è£…çš„æ˜¯okhttpã€‚Retrofit2.0å¼€å§‹å†…ç½®okhttpæ¡†æ¶ï¼ŒRetrofitä¸“æ³¨å°è£…æ¥å£å®Œæˆä¸šåŠ¡éœ€æ±‚ï¼Œokhttpä¸“æ³¨ç½‘ç»œè¯·æ±‚çš„å®‰å…¨é«˜æ•ˆï¼Œç¬”è€…å°†ä¸¤è€…åŒºåˆ†å¼€ï¼Œæ˜¯æƒ³è®©åæ¥å­¦ä¹ è€…çŸ¥é“ï¼Œè¿™æ˜¯ä¸¤å¥—æ¡†æ¶ï¼Œå­¦ä¹ æ¡†æ¶åŸç†æ—¶å¯ä»¥åˆ†å¼€å­¦ä¹ ï¼Œä»¥å…ç†è§£æ··ä¹±ã€‚</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://square.github.io/okhttp/" target="_blank" rel="noopener">http://square.github.io/okhttp/</a></li><li>githubï¼š<a href="https://github.com/square/okhttp" target="_blank" rel="noopener">https://github.com/square/okhttp</a></li><li>ä½œè€…ï¼šsquareå›¢é˜Ÿ</li></ul><h5 id="ä½¿ç”¨ï¼š-1"><a href="#ä½¿ç”¨ï¼š-1" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.squareup.okhttp3:okhttp:3.9.1&apos;</span><br></pre></td></tr></table></figure><a id="more"></a><h5 id="3-Butter-Knife"><a href="#3-Butter-Knife" class="headerlink" title="3.Butter Knife"></a>3.Butter Knife</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šButter Knifeæ‰€æä¾›äº†ä¸€ç§èƒ½åŠ›â€”â€”ä½¿ç”¨æ³¨è§£ç”Ÿæˆæ¨¡æ¿ä»£ç ï¼Œå°†viewä¸æ–¹æ³•å’Œå‚æ•°ç»‘å®šã€‚</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šgithubä¸Š16.5Kä¸ªstarï¼Œé…åˆAndroidstudioæä¾›çš„Butter Knifeæ’ä»¶ï¼Œå¸®åŠ©å¼€å‘è€…çœå´äº†é¢‘ç¹findviewbyidçš„çƒ¦æ¼ï¼Œæœ€æ–°çš„Butter Knifeè¿˜æä¾›äº†onclickç»‘å®šä»¥åŠå­—ç¬¦ä¸²çš„åˆå§‹åŒ–ï¼Œåˆå­¦è€…å¯ä»¥æŸ¥é˜…Butter Knifeä»¥åŠButter Knifeæ’ä»¶è¿›ä¸€æ­¥å­¦ä¹ ï¼</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://jakewharton.github.io/butterknife/" target="_blank" rel="noopener">http://jakewharton.github.io/butterknife/</a></li><li>githubï¼š<a href="https://github.com/JakeWharton/butterknife" target="_blank" rel="noopener">https://github.com/JakeWharton/butterknife</a></li><li>ä½œè€…ï¼šJakeWharton ï¼Œä¹Ÿæ˜¯squareå›¢é˜Ÿæˆå‘˜ä¹‹ä¸€</li></ul><h5 id="ä½¿ç”¨ï¼š-2"><a href="#ä½¿ç”¨ï¼š-2" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  compile &apos;com.jakewharton:butterknife:8.8.1&apos;  </span><br><span class="line">  annotationProcessor &apos;com.jakewharton:butterknife-compiler:8.8.1&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4-MPAndroidChart"><a href="#4-MPAndroidChart" class="headerlink" title="4.MPAndroidChart"></a>4.MPAndroidChart</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šMPAndroidChartæ˜¯ä¸€æ¬¾å›¾è¡¨æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šgithubä¸Š16.1Kä¸ªstarï¼Œä»¥å¿«é€Ÿã€ç®€æ´ã€‚å¼ºå¤§è‘—ç§°çš„å›¾è¡¨æ¡†æ¶</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="https://github.com/PhilJay/MPAndroidChart" target="_blank" rel="noopener">https://github.com/PhilJay/MPAndroidChart</a></li><li>githubï¼š<a href="https://github.com/PhilJay/MPAndroidChart" target="_blank" rel="noopener">https://github.com/PhilJay/MPAndroidChart</a></li><li>ä½œè€…ï¼šPhilJay</li></ul><h5 id="ä½¿ç”¨ï¼š-3"><a href="#ä½¿ç”¨ï¼š-3" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>åœ¨ASä¸­åŠ å…¥Gradleä¾èµ–</p><p>åœ¨æ ¹ç›®å½•çš„ build.gradleä¸ŠåŠ å…¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">            maven &#123; url &quot;https://jitpack.io&quot; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨appçš„build.gradleä¸ŠåŠ å…¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;com.github.PhilJay:MPAndroidChart:v3.0.3&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="5-glide"><a href="#5-glide" class="headerlink" title="5.glide"></a>5.glide</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šglideæ˜¯ä¸€æ¬¾ä¸“æ³¨äºæä¾›æµç•…åˆ’åŠ¨èƒ½åŠ›çš„â€œå›¾ç‰‡åŠ è½½å’Œç¼“å­˜æ¡†æ¶â€</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š15.9kä¸ªstarï¼Œå›¾ç‰‡åŠ è½½ç±»æ¡†æ¶æ’åç¬¬ä¸€çš„æ¡†æ¶ï¼Œgoogle åœ¨2014å¼€å‘è€…å¤§ä¼šä¸Šæ¼”ç¤ºçš„camera appå°±æ˜¯åŸºäºgildeæ¡†æ¶å¼€å‘çš„</p><ul><li>githubï¼š<a href="https://github.com/bumptech/glide" target="_blank" rel="noopener">https://github.com/bumptech/glide</a></li><li>ä½œè€…ï¼šBump Technologieså›¢é˜Ÿ</li></ul><h5 id="ä½¿ç”¨ï¼š-4"><a href="#ä½¿ç”¨ï¼š-4" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">  mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation &apos;com.github.bumptech.glide:glide:4.5.0&apos;   </span><br><span class="line">    annotationProcessor &apos;com.github.bumptech.glide:compiler:4.5.0&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="6-leakcanary"><a href="#6-leakcanary" class="headerlink" title="6.leakcanary"></a>6.leakcanary</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾å†…å­˜æ£€æµ‹æ¡†æ¶ï¼ŒæœåŠ¡äºjavaå’Œandroidå®¢æˆ·ç«¯</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ–¹ä¾¿ï¼Œç®€æ´æ˜¯leakcanaryæœ€å¤§çš„ç‰¹ç‚¹ï¼Œåªéœ€åœ¨åº”ç”¨çš„apllicationä¸­é›†æˆï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒï¼›15.5kä¸ªstarè¯´æ˜äº†å®ƒæœ‰å¤šä¹ˆå—æ¬¢è¿</p><ul><li>githubï¼š<a href="https://github.com/square/leakcanary" target="_blank" rel="noopener">https://github.com/square/leakcanary</a></li><li>ä½œè€…ï¼šsquareå›¢é˜Ÿ</li></ul><h5 id="ä½¿ç”¨ï¼š-5"><a href="#ä½¿ç”¨ï¼š-5" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">   debugCompile &apos;com.squareup.leakcanary:leakcanary-android:1.5.4&apos;   </span><br><span class="line">   releaseCompile &apos;com.squareup.leakcanary:leakcanary-android-no-op:1.5.4&apos;   </span><br><span class="line">   testCompile &apos;com.squareup.leakcanary:leakcanary-android-no-op:1.5.4&apos; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ Application ä¸­å†™å…¥:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class ExampleApplication extends Application &#123;</span><br><span class="line"></span><br><span class="line">  @Override public void onCreate() &#123; </span><br><span class="line">    super.onCreate();    </span><br><span class="line">    if (LeakCanary.isInAnalyzerProcess(this)) &#123;      </span><br><span class="line">      // This process is dedicated to LeakCanary for heap analysis.      </span><br><span class="line">      // You should not init your app in this process.      </span><br><span class="line">      return;    </span><br><span class="line">    &#125;    </span><br><span class="line">    LeakCanary.install(this);    </span><br><span class="line">    // Normal app init code...  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="7-Android-Universal-Image-Loader"><a href="#7-Android-Universal-Image-Loader" class="headerlink" title="7.Android-Universal-Image-Loader"></a>7.Android-Universal-Image-Loader</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šæ›¾ç»çš„å›¾ç‰‡åŠ è½½æ¡†æ¶ç‹è€…ï¼Œandroidå¼€å‘è€æ‰‹éƒ½ç”¨è¿‡å®ƒ</p></blockquote><p>ä¸Šæ¦œç†ç”±:androidç«¯å›¾ç‰‡åŠ è½½æ¡†æ¶çš„è€å¤§å“¥äº†ï¼Œ15.3kä¸ªstarè¶³ä»¥è¯æ˜å®ƒçš„çƒ­é—¨ï¼ŒUILä¸gildeæœ€å¤§åŒºåˆ«æ˜¯å¯å®šåˆ¶ï¼ŒUILæä¾›äº†å¤§é‡é…ç½®æ–¹å¼ï¼Œå›¾ç‰‡åŠ è½½çŠ¶æ€çš„å›è°ƒï¼ˆæˆåŠŸï¼Œå¤±è´¥ï¼Œè¿›è¡Œä¸­ï¼‰ï¼ŒåŠ è½½åŠ¨ç”»ç­‰ï¼›ä»¥åŠæä¾›äº†ç§»åŠ¨ç«¯å›¾ç‰‡åŠ è½½æ¡†æ¶çš„ç¼“å­˜æ€è·¯ï¼šä¸‰çº§ç¼“å­˜ç­–ç•¥ sdå¡-å†…å­˜-ç½‘ç»œï¼›å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒUILä»¥åŠä¸¤å¹´æœªæ›´æ–°äº†ï¼Œä½†ç¬”è€…ä»æ¨èå„ä½ä½¿ç”¨ï¼</p><ul><li>githubï¼š<a href="https://github.com/nostra13/Android-Universal-Image-Loader" target="_blank" rel="noopener">https://github.com/nostra13/Android-Universal-Image-Loader</a></li><li>ä½œè€…ï¼šnostra13</li></ul><h6 id="ä½¿ç”¨ï¼š-6"><a href="#ä½¿ç”¨ï¼š-6" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h6><ul><li>ä¸‹è½½åœ°å€  universal-image-loader-1.9.5.jar</li></ul><h5 id="8-EventBus"><a href="#8-EventBus" class="headerlink" title="8.EventBus"></a>8.EventBus</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šEventBusæ˜¯ä¸€æ¬¾æœ¬åœ°ç»„ä»¶é—´é€šä¿¡æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šç»„ä»¶é—´é€šä¿¡æ¡†æ¶staré‡ç¬¬ä¸€ï¼š14.8kï¼Œåœ¨å¤§å‹é¡¹ç›®çš„Activitiesï¼Œfragmentsï¼ŒThreadsï¼ŒServiceséƒ½å¯ä»¥çœ‹åˆ°å®ƒçš„ä½¿ç”¨åœºæ™¯ï¼Œå°½ç®¡EventBusåœ¨å‘æœªåˆ›å»ºçš„ç»„ä»¶ä¼ é€’äº‹ä»¶æ—¶æœ‰äº›å±€é™ï¼Œä»…é€‚åˆåœ¨â€œæ´»ç€çš„â€ç»„ä»¶é—´ä¼ é€’æ¶ˆæ¯ï¼Œä½†ä»ä¸å¦¨ç¢å®ƒæ´»è·ƒåœ¨å„ä¸ªå¤§å‹é¡¹ç›®å„ä¸ªåœºæ™¯é‡Œã€‚</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://greenrobot.org/eventbus/documentation/how-to-get-started/" target="_blank" rel="noopener">http://greenrobot.org/eventbus/documentation/how-to-get-started/</a></li><li>githubï¼š<a href="https://github.com/greenrobot/EventBus" target="_blank" rel="noopener">https://github.com/greenrobot/EventBus</a></li><li>ä½œè€…ï¼šgreenrobot</li></ul><h5 id="ä½¿ç”¨ï¼š-7"><a href="#ä½¿ç”¨ï¼š-7" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;org.greenrobot:eventbus:3.1.1&apos;</span><br></pre></td></tr></table></figure><h5 id="9-zxing"><a href="#9-zxing" class="headerlink" title="9.zxing"></a>9.zxing</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šæ¡ç å›¾åƒå¤„ç†åº“</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå¦‚æœä½ ç”¨è¿‡äºŒç»´ç ï¼Œä½ è‚¯å®šå·²ç»é—´æ¥ä½¿ç”¨è¿‡å¤§åé¼é¼çš„zxingäº†ã€‚13.9Kçš„staré‡ï¼Œè®©å®ƒæ’åœ¨æœ¬æ¦œå•ç¬¬ä¹ï¼Œå®è‡³åå½’ï¼Œå¦‚æœä½ æœ‰äº†è§£äºŒç»´ç çš„éœ€æ±‚ï¼Œä¸å¦¨ä»äº†è§£ã€ä¿®æ”¹å®ƒæºç å…¥æ‰‹ã€‚</p><ul><li>githubï¼š<a href="https://github.com/zxing/zxing" target="_blank" rel="noopener">https://github.com/zxing/zxing</a></li><li>ä½œè€…ï¼šSean Owen</li></ul><h5 id="10-picasso"><a href="#10-picasso" class="headerlink" title="10.picasso"></a>10.picasso</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šå¼ºåŠ›çš„å›¾ç‰‡ä¸‹è½½ã€ç¼“å­˜æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæœ¬æ¦œå•å‡ºç°çš„ç¬¬ä¸‰æ¬¾å›¾ç‰‡ç±»æ¡†æ¶ï¼Œä¸åŒçš„æ˜¯picassoæ›´å¼ºè°ƒå›¾ç‰‡ä¸‹è½½ï¼Œä½ å¯ä»¥å°†picassoé›†æˆè¿›ä½ çš„é¡¹ç›®ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥ç»“åˆgildeå’ŒUILä¸picassoï¼Œä¸‰è€…ä¸€é½å°è£…è‡³ä½ çš„é¡¹ç›®ä¸­ï¼ŒæŒ‰éœ€æ‰€ç”¨ã€‚</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://square.github.io/picasso/" target="_blank" rel="noopener">http://square.github.io/picasso/</a></li><li>githubï¼š<a href="https://github.com/square/picasso" target="_blank" rel="noopener">https://github.com/square/picasso</a></li><li>ä½œè€…ï¼šsquareå›¢é˜Ÿ</li></ul><h5 id="ä½¿ç”¨ï¼š-8"><a href="#ä½¿ç”¨ï¼š-8" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.squareup.picasso:picasso:2.5.2&apos;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä¸‹è½½jaråŒ…</p><h5 id="11-lottie-android"><a href="#11-lottie-android" class="headerlink" title="11.lottie-android"></a>11.lottie-android</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾å¯ä»¥åœ¨Androidç«¯å¿«é€Ÿå±•ç¤ºAdobe Afeter Effectï¼ˆAEï¼‰å·¥å…·æ‰€ä½œåŠ¨ç”»çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šåŠ¨ç”»ç±»æ¡†æ¶ç¬¬ä¸€åï¼Œgithubä¸Š13.3kä¸ªstarè¯æ˜äº†ä»–çš„ä¼˜è¶Šæ€§ï¼Œåˆ©ç”¨jsonæ–‡ä»¶å¿«é€Ÿå®ç°åŠ¨ç”»æ•ˆæœæ˜¯å®ƒæœ€å¤§çš„ä¾¿åˆ©ï¼Œè€Œè¿™ä¸ªjsonæ–‡ä»¶ä¹Ÿæ˜¯ç”±Adobeæä¾›çš„After Effectsï¼ˆAEï¼‰å·¥å…·åˆ¶ä½œçš„ï¼Œåœ¨AEä¸­è£…ä¸€ä¸ªBodymovinçš„æ’ä»¶ï¼Œä½¿ç”¨è¿™ä¸ªæ’ä»¶æœ€ç»ˆå°†åŠ¨ç”»æ•ˆæœç”Ÿæˆjsonæ–‡ä»¶ï¼Œè¿™ä¸ªjsonæ–‡ä»¶å³å¯ç”±LottieAnimationViewè§£æå¹¶ç”Ÿæˆç»šä¸½çš„åŠ¨ç”»æ•ˆæœã€‚è€Œä¸”å®ƒè¿˜æ”¯æŒè·¨å¹³å°å“Ÿã€‚</p><ul><li>githubï¼š<a href="https://github.com/airbnb/lottie-android" target="_blank" rel="noopener">https://github.com/airbnb/lottie-android</a></li><li>ä½œè€…ï¼šAirbnb å›¢é˜Ÿ</li></ul><h5 id="12-fresco"><a href="#12-fresco" class="headerlink" title="12.fresco"></a>12.fresco</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾å¯ä»¥ç®¡ç†å›¾ç‰‡å†…å­˜çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±:githubä¸Š12.8kä¸ªstarï¼Œå›¾ç‰‡ç±»æ’è¡Œæ¦œç¬¬å››åï¼Œfacebookçš„å‡ºèº«è¯æ˜äº†å®ƒå¹¶éæ˜¯é‡å¤é€ çš„è½®å­ï¼Œåœ¨ç®¡ç†å›¾ç‰‡å†…å­˜é¢†åŸŸä¸Šæœ‰ç€å®ƒçš„ä¸€ç‰‡å¤©åœ°ï¼Œæ¸è¿›å¼åŠ è½½ã€åŠ è½½giféƒ½æ˜¯å®ƒä¸å‰ä¸‰ä½ç›¸æ¯”ç‹¬æœ‰çš„ç‰¹æ€§</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="https://www.fresco-cn.org/" target="_blank" rel="noopener">https://www.fresco-cn.org/</a></li><li>githubï¼š<a href="https://github.com/facebook/fresco" target="_blank" rel="noopener">https://github.com/facebook/fresco</a></li><li>ä½œè€…ï¼šfacebook</li></ul><h5 id="ä½¿ç”¨ï¼š-9"><a href="#ä½¿ç”¨ï¼š-9" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  // å…¶ä»–ä¾èµ–  </span><br><span class="line">  compile &apos;com.facebook.fresco:fresco:0.12.0&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„ä¾èµ–éœ€è¦æ ¹æ®éœ€æ±‚æ·»åŠ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  // åœ¨ API &lt; 14 ä¸Šçš„æœºå™¨æ”¯æŒ WebP æ—¶ï¼Œéœ€è¦æ·»åŠ   </span><br><span class="line">  compile &apos;com.facebook.fresco:animated-base-support:0.12.0&apos;  </span><br><span class="line"></span><br><span class="line">  // æ”¯æŒ GIF åŠ¨å›¾ï¼Œéœ€è¦æ·»åŠ   </span><br><span class="line">  compile &apos;com.facebook.fresco:animated-gif:0.12.0&apos;  </span><br><span class="line"></span><br><span class="line">  // æ”¯æŒ WebP ï¼ˆé™æ€å›¾+åŠ¨å›¾ï¼‰ï¼Œéœ€è¦æ·»åŠ   </span><br><span class="line">  compile &apos;com.facebook.fresco:animated-webp:0.12.0&apos;  </span><br><span class="line">  compile &apos;com.facebook.fresco:webpsupport:0.12.0&apos;  </span><br><span class="line"></span><br><span class="line">  // ä»…æ”¯æŒ WebP é™æ€å›¾ï¼Œéœ€è¦æ·»åŠ   </span><br><span class="line">  compile &apos;com.facebook.fresco:webpsupport:0.12.0&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="13-RxAndroid"><a href="#13-RxAndroid" class="headerlink" title="13.RxAndroid"></a>13.RxAndroid</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾Androidå®¢æˆ·ç«¯ç»„ä»¶é—´å¼‚æ­¥é€šä¿¡çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šgithubä¸Š12.7kä¸ªstarï¼Œä½å±…ç»„ä»¶é€šä¿¡æ¡†æ¶çš„ç¬¬äºŒåï¼Œä»…åœ¨EventBusä¹‹åï¼Œå¦‚æœè¦é—®ä¸¤è€…çš„åŒºåˆ«ï¼ŒEventbusæ˜¯ç”¨æ¥å–ä»£ç»„ä»¶é—´ç¹ççš„interfaceï¼ŒRxAndroidæ˜¯ç”¨æ¥å–ä»£AnsyTaskçš„ï¼Œå¹¶ä¸å†²çªï¼›å½“ç„¶RxAndroidçš„ä¼˜ç‚¹å¹¶ä¸ä»…é™äºæ­¤ï¼Œæ›´å¤šä¼˜é›…çš„å®ç°ï¼Œå¯ä»¥å»å®˜ç½‘æŸ¥é˜…ï¼</p><ul><li>githubï¼š<a href="https://github.com/ReactiveX/RxAndroid" target="_blank" rel="noopener">https://github.com/ReactiveX/RxAndroid</a></li><li>ä½œè€…ï¼šJakeWharton</li></ul><h5 id="ä½¿ç”¨ï¼š-10"><a href="#ä½¿ç”¨ï¼š-10" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;io.reactivex.rxjava2:rxandroid:2.0.1&apos;</span><br><span class="line">compile &apos;io.reactivex.rxjava2:rxjava:2.1.0&apos;</span><br></pre></td></tr></table></figure><h5 id="14-SlidingMenu"><a href="#14-SlidingMenu" class="headerlink" title="14.SlidingMenu"></a>14.SlidingMenu</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¾§æ»‘èœå•æ æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šä¸Userval-Image-loader é½åçš„ä¸Šå¤ç¥å™¨æ¡†æ¶â€”â€”ä¸ºä½ çš„appæä¾›ä¾§æ»‘èœå•æ çš„åŠŸèƒ½ï¼›githubé—ªæ›´æœ‰10.5kä¸ªstarï¼Œè¯æ˜äº†å®ƒçš„ç»ä¹…ä¸è¡°ï¼Œå³ä½¿åœ¨Googleæ¨å‡ºäº†NavigationDrawerï¼Œä»ç„¶æ²¡æœ‰å‡å°‘å¼€å‘è€…å¯¹SildingMenuçš„æ‹¥ç°‡ï¼Œç»å…¸æ€»æ˜¯ç»å¾—èµ·è€ƒéªŒçš„ï¼Œè¿™ä¸ªä¸Šå¤ç¥å…½å·²ç»å››å¹´æ²¡æœ‰æ›´æ–°äº†ï¼›æœ‰å¤ªå¤šå¤ªå¤šçš„appä½¿ç”¨è¿‡å®ƒï¼Œè¿™äº›éƒ½å¯ä»¥åœ¨è½¯ä»¶çš„å¼€æºè®¸å¯ä¸Šçœ‹åˆ°ï¼</p><ul><li>githubï¼š<a href="https://github.com/jfeinstein10/SlidingMenu" target="_blank" rel="noopener">https://github.com/jfeinstein10/SlidingMenu</a></li><li>ä½œè€…ï¼šJeremy Feinstein</li></ul><h5 id="ä½¿ç”¨ï¼š-11"><a href="#ä½¿ç”¨ï¼š-11" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>åœ¨gihubä¸Šforkæºç ï¼Œé›†æˆè¿›é¡¹ç›®ä¸­</p><h5 id="15-PhotoView"><a href="#15-PhotoView" class="headerlink" title="15.PhotoView"></a>15.PhotoView</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾ImageViewå±•ç¤ºæ¡†æ¶ï¼Œæ”¯æŒç¼©æ”¾ï¼Œå“åº”æ‰‹åŠ¿</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š10.3kçš„staræ•°é‡ï¼Œä½äºå›¾ç‰‡ç±»æ¡†æ¶æ’è¡Œæ¦œç¬¬äº”ä½ï¼ŒPhotoViewä¸å‰å››ä½ä¸åŒçš„æ˜¯è¿™æ¬¡å¸¦æ¥çš„æ˜¯å›¾ç‰‡çš„å±•ç¤ºèƒ½åŠ›ï¼Œä½ ä¸€å®šå¥½å¥‡å¾®ä¿¡çš„å¤´åƒç‚¹å‡»æ”¾å¤§æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå¾ˆå¤šAppçš„å›¾ç‰‡æ˜¾ç¤ºå“åº”æ‰‹åŠ¿æŒ‰å‹æ˜¯å¦‚ä½•å®ç°çš„ï¼Œäº†è§£PhotoViewï¼Œä½ ä¸€å®šä¼šå¼€å¿ƒçš„ï¼ï¼ˆç¬”è€…ä¹Ÿä¸ä¼šå‘Šè¯‰ä½ ImageViewçš„ç‚¹å‡»æ”¾å¤§æ•ˆæœåœ¨Androidçš„sampleä¹Ÿæœ‰ï¼‰</p><ul><li>githubï¼š<a href="https://github.com/chrisbanes/PhotoView" target="_blank" rel="noopener">https://github.com/chrisbanes/PhotoView</a></li><li>ä½œè€…ï¼šchrisbanes</li></ul><h5 id="ä½¿ç”¨ï¼š-12"><a href="#ä½¿ç”¨ï¼š-12" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>åœ¨appæ ¹ç›®å½•çš„build.gradleä¸­åŠ å…¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url &quot;https://jitpack.io&quot; &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨appçš„moduleç›®å½•çš„build.graldeä¸­åŠ å…¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;com.github.chrisbanes:PhotoView:latest.release.here&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.github.chrisbanes.photoview.PhotoView</span><br><span class="line">    android:id=&quot;@+id/photo_view&quot;    </span><br><span class="line">    android:layout_width=&quot;match_parent&quot;    </span><br><span class="line">    android:layout_height=&quot;match_parent&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PhotoView photoView = (PhotoView) findViewById(R.id.photo_view);</span><br><span class="line">photoView.setImageResource(R.drawable.image);</span><br></pre></td></tr></table></figure><h5 id="16-material-dialogs"><a href="#16-material-dialogs" class="headerlink" title="16.material-dialogs"></a>16.material-dialogs</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾è‡ªå®šä¹‰dialogæ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š9.9kä¸ªstarï¼Œä¹Ÿæ˜¯ç»§PhotoViewï¼ŒSlidingMenuä¹‹åç¬¬ä¸‰æ¬¾è‡ªå®šä¹‰Viewæ¡†æ¶ï¼Œä¹Ÿè®¸ä½ è¿˜æ˜¯è‡ªå®šä¹‰Viewçš„æ–°äººï¼Œå¯¹Dialogä½¿ç”¨çš„è¿˜æœ‰ç‚¹ç”Ÿç–ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒæå‡ä½ çš„Dilaogä½¿ç”¨èƒ½åŠ›</p><ul><li>githubï¼š<a href="https://github.com/afollestad/material-dialogs" target="_blank" rel="noopener">https://github.com/afollestad/material-dialogs</a></li><li>ä½œè€…ï¼šAidan Follestad</li></ul><h5 id="ä½¿ç”¨ï¼š-13"><a href="#ä½¿ç”¨ï¼š-13" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    // ... other dependencies here    </span><br><span class="line">    compile &apos;com.afollestad.material-dialogs:core:0.9.4.5&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="17-droid-async-http"><a href="#17-droid-async-http" class="headerlink" title="17.droid-async-http"></a>17.droid-async-http</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾åŸºäºHttpåè®®çš„å¼‚æ­¥è¯·æ±‚çš„ç½‘ç»œæ¡†æ¶ï¼Œ</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šè™½ç„¶ä½ æœ‰æ— æ•°ä¸ªä½¿ç”¨retrofit+okhttpçš„ç†ç”±ï¼Œä½†9.8kä¸ªstarï¼Œè¯æ˜å®ƒä»ç„¶å€¼å¾—ä½ æ·±å…¥å­¦ä¹ ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå®ƒä¹Ÿå·²ç»æœ‰ä¸¤å¹´æ²¡æ›´æ–°äº†ï¼Œä½ å°½ç®¡æ‹¿å»å½“ä½ æ‡’æƒ°çš„ç†ç”±ï¼</p><ul><li>githubï¼š<a href="https://github.com/loopj/android-async-http" target="_blank" rel="noopener">https://github.com/loopj/android-async-http</a></li><li>ä½œè€…ï¼šJames Smith</li></ul><h5 id="ä½¿ç”¨ï¼š-14"><a href="#ä½¿ç”¨ï¼š-14" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">  maven &#123; </span><br><span class="line">    url &apos;https://oss.sonatype.org/content/repositories/snapshots/&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">  compile &apos;com.loopj.android:android-async-http:1.5.0-SNAPSHOT&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="18-androidannotations"><a href="#18-androidannotations" class="headerlink" title="18.androidannotations"></a>18.androidannotations</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾åŸºäºæ³¨è§£çš„å¿«é€Ÿå¼€å‘æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šä¸Butterknifeä¸€æ ·åŸºäºæ³¨è§£ï¼Œåˆ©ç”¨æ³¨è§£å¿«é€Ÿå®Œæˆviewçš„åˆå§‹åŒ–ï¼Œä¸åŒçš„æ˜¯androidannotationsæä¾›äº†æ›´å¤šçš„èƒ½åŠ›ï¼šç®€å•çš„çº¿ç¨‹æ¨¡å‹ç­‰ï¼›ç¬”è€…åªæ¥è§¦è¿‡Butterknifeï¼Œæ— æ³•æ›´è¿›ä¸€æ­¥å™è¿°androidannotationsçš„ä¼˜åŠ¿ï¼Œå¦‚æœä½ å¿—åœ¨æ·±å…¥äº†è§£æ³¨è§£çš„å¦™ç”¨ï¼Œå¯ä»¥å°è¯•æ¢ç´¢ä¸€ä¸‹ï¼</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://androidannotations.org/" target="_blank" rel="noopener">http://androidannotations.org/</a></li><li>githubï¼š<a href="https://github.com/androidannotations/androidannotations" target="_blank" rel="noopener">https://github.com/androidannotations/androidannotations</a></li><li>ä½œè€…ï¼šWonderCsabo</li></ul><h5 id="19-fastjson"><a href="#19-fastjson" class="headerlink" title="19.fastjson"></a>19.fastjson</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»:ä¸€æ¬¾åŸºäºjsonè§£æã€ç”Ÿæˆçš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šä»å®ƒçš„åå­—ä¸éš¾çœ‹å‡ºï¼Œå¿«é€Ÿæ˜¯å®ƒæœ€å¤§çš„ç‰¹æ€§ï¼Œé˜¿é‡Œå·´å·´çš„å‡ºèº«ä¿è¯äº†ä»£ç çš„è´¨é‡å’Œä¼˜è¶Šï¼Œ9.4kçš„staræ•°é‡ï¼Œä¹Ÿæ˜¯æ¦œå•é‡Œç¬¬ä¸€ä¸ªå‡ºç°çš„ä¸­å›½å¼€æºæ¡†æ¶ï¼Œæ¶‰åŠç½‘ç»œçš„appéƒ½ä¼šç”¨åˆ°jsonï¼Œfastjsonå€¼å¾—ä½œä¸ºä½ çš„é¦–é€‰ï¼</p><ul><li>githubï¼š<a href="https://github.com/alibaba/fastjson" target="_blank" rel="noopener">https://github.com/alibaba/fastjson</a></li><li>ä½œè€…ï¼šalibaba</li></ul><h5 id="ä½¿ç”¨ï¼š-15"><a href="#ä½¿ç”¨ï¼š-15" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.alibaba:fastjson:1.1.58.android&apos;</span><br></pre></td></tr></table></figure><h5 id="20-Material-Animations"><a href="#20-Material-Animations" class="headerlink" title="20.Material-Animations"></a>20.Material-Animations</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›åœºæ™¯è½¬æ¢è¿‡æ¸¡èƒ½åŠ›çš„åŠ¨ç”»æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šAndroidåŠ¨ç”»æ¡†æ¶æ’è¡Œæ¦œç¬¬äºŒåï¼Œ9.3kä¸ªstaræ•°é‡ï¼Œä¸åŠ¨ç”»æ¡†æ¶æ¦œå•ç¬¬ä¸€ålottie-androidä¸åŒçš„æ˜¯ï¼ŒMaterial-Animationsæä¾›çš„æ˜¯åœºæ™¯åˆ‡æ¢çš„åŠ¨ç”»æ•ˆæœã€‚Android å®˜ç½‘sampleä¸­å·²ç»æä¾›äº†éƒ¨åˆ†Transition ï¼ˆè½¬åœºåŠ¨ç”»ï¼‰çš„å±•ç¤ºï¼Œä½œä¸ºåˆå­¦è€…å¾ˆéš¾å¿«é€Ÿæ‹“å±•åˆ°è‡ªå·±é¡¹ç›®ä¸­ï¼ŒMaterial-Animationsçš„ç¤ºä¾‹å‡ºç°ä¸ºå¼€å‘è€…çœå»äº†æ­¤ç±»éº»çƒ¦ï¼Œç›´æ¥ç…§æ¬åº”ç”¨åˆ°è‡ªå·±çš„Appä¸­å§ã€‚</p><ul><li>githubï¼š<a href="https://github.com/lgvalle/Material-Animations" target="_blank" rel="noopener">https://github.com/lgvalle/Material-Animations</a></li><li>ä½œè€…ï¼šLuis G. Valle</li></ul><h5 id="ä½¿ç”¨ï¼š-16"><a href="#ä½¿ç”¨ï¼š-16" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>downæºç ï¼Œä¿®æ”¹å­¦ä¹ </p><h5 id="21-tinker"><a href="#21-tinker" class="headerlink" title="21.tinker"></a>21.tinker</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šå®ƒæ˜¯å¾®ä¿¡å®˜ç½‘çš„Androidçƒ­è¡¥ä¸è§£å†³æ–¹æ¡ˆ</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š9.1kä¸ªstarï¼Œå¾®ä¿¡åœ¨ç”¨çš„çƒ­è¡¥ä¸æ–¹æ¡ˆï¼Œå¿ƒåŠ¨ä¸å¦‚è¡ŒåŠ¨</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://www.tinkerpatch.com/Docs/intro" target="_blank" rel="noopener">http://www.tinkerpatch.com/Docs/intro</a></li><li>githubï¼š<a href="https://github.com/Tencent/tinker" target="_blank" rel="noopener">https://github.com/Tencent/tinker</a></li><li>ä½œè€…ï¼šTencent</li></ul><h5 id="22-ViewPagerIndicator"><a href="#22-ViewPagerIndicator" class="headerlink" title="22.ViewPagerIndicator"></a>22.ViewPagerIndicator</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾åŸºäºViewPagerçš„é¡µé¢æŒ‡ç¤ºå™¨å¼€æºæ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šä¸Šå¤ç¥å™¨ï¼Œå°½ç®¡å·²ç»äº”å¹´æœªæ›´æ–°äº†ï¼Œä½†ä½ ä»ç„¶å¯ä»¥åœ¨æ·˜å®ç­‰appä¸­çœ‹åˆ°å®ƒçš„ä½¿ç”¨åœºæ™¯ï¼Œ8.9Kçš„staré‡è®©å®ƒä¸æ„ ä¸ç«çš„åœ¨çŸ—ç«‹åœ¨æ¦œå•é‡Œ</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://viewpagerindicator.com/" target="_blank" rel="noopener">http://viewpagerindicator.com/</a></li><li>githubï¼š<a href="https://github.com/JakeWharton/ViewPagerIndicator" target="_blank" rel="noopener">https://github.com/JakeWharton/ViewPagerIndicator</a></li><li>ä½œè€…ï¼šJakeWharton</li></ul><h5 id="ä½¿ç”¨ï¼š-17"><a href="#ä½¿ç”¨ï¼š-17" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/JakeWharton/Android-ViewPagerIndicator/zipball/master" target="_blank" rel="noopener">https://github.com/JakeWharton/Android-ViewPagerIndicator/zipball/master</a></p><h5 id="23-Android-CleanArchitecture"><a href="#23-Android-CleanArchitecture" class="headerlink" title="23.Android-CleanArchitecture"></a>23.Android-CleanArchitecture</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€ä¸ªè®²è§£è®¾è®¡æ¡†æ¶çš„demo</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå®ƒä¸æ˜¯æ¡†æ¶ï¼Œä½ å¯ä»¥æŠŠå®ƒå½“ä½œä¸€æœ¬ä¹¦ï¼Œå®ƒå°†æ•™ä¼šä½ å¦‚ä½•è®¾è®¡ç®€æ´çš„æ¶æ„ï¼Œå·¥ç¨‹é‡Œæœ‰ä¸€ä¸ªsample appï¼Œé…åˆå›¾æ–‡è®²è§£ï¼Œä½ å°†å¯¹Androidå®¢æˆ·ç«¯çš„æ¶æ„æœ‰æ›´æ·±ä¸€å±‚çš„è®¤è¯†ã€‚8.8kçš„staræ•°é‡ï¼Œè¯æ˜äº†å®ƒæ˜¯ä¸€æœ¬â€œå¥½ä¹¦â€å“Ÿã€‚</p><ul><li>githubï¼š<a href="https://github.com/android10/Android-CleanArchitecture" target="_blank" rel="noopener">https://github.com/android10/Android-CleanArchitecture</a></li><li>ä½œè€…ï¼šFernando Cejas</li></ul><h5 id="24-Android-PullToRefresh"><a href="#24-Android-PullToRefresh" class="headerlink" title="24.Android-PullToRefresh"></a>24.Android-PullToRefresh</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾ä¸ºæ™®é€šè§†å›¾æä¾›åˆ·æ–°UIçš„è§†å›¾æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š8.2Kçš„staræ•°é‡ä½¿å®ƒä½å±…åˆ·æ–°ç±»UIæ¡†æ¶æ¦œé¦–ï¼Œå¼ºå¤§çš„å…¼å®¹èƒ½åŠ›ï¼Œè¯¥æ¡†æ¶æ”¯æŒListViewï¼ŒGrdiViewï¼ŒWebViewScrollViewï¼ŒViewPagerç­‰ä¼—å¤šViewå¢åŠ åˆ·æ–°çš„èƒ½åŠ›ï¼Œå¦‚æœä½ æœ‰å¢åŠ ä¸Šæ‹‰åŠ è½½ï¼Œä¸‹æ‹‰åŠ è½½çš„éœ€æ±‚ï¼Œä½ åº”è¯¥è€ƒè™‘å®ƒäº†ï¼</p><ul><li>githubï¼š<a href="https://github.com/chrisbanes/Android-PullToRefresh" target="_blank" rel="noopener">https://github.com/chrisbanes/Android-PullToRefresh</a></li><li>ä½œè€…ï¼šChris Banes</li></ul><h5 id="ä½¿ç”¨ï¼š-18"><a href="#ä½¿ç”¨ï¼š-18" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>github forkæºç ï¼Œé›†æˆåˆ°é¡¹ç›®ä¸­</p><h5 id="25-flexbox-layout"><a href="#25-flexbox-layout" class="headerlink" title="25.flexbox-layout"></a>25.flexbox-layout</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾å¼¹æ€§ä¼¸ç¼©å¸ƒå±€</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š8.1kä¸ªstarï¼Œå‰ç«¯H5å¼€å‘è€…è½¬Androidå¼€å‘çš„ç¦éŸ³ï¼ŒFlexboxLayoutä½œä¸ºLinearLayoutå’ŒRelativeLayoutçš„æ›¿ä»£è€…ï¼Œå€¼å¾—å„ä½ä¸€è¯•ï¼Œä¸å…¶ä¸€åŒæ¨å‡ºçš„è¿˜æœ‰ConstraintLayoutã€‚</p><ul><li>githubï¼š<a href="https://github.com/google/flexbox-layout" target="_blank" rel="noopener">https://github.com/google/flexbox-layout</a></li><li>ä½œè€…ï¼šGoogle</li></ul><h5 id="ä½¿ç”¨ï¼š-19"><a href="#ä½¿ç”¨ï¼š-19" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;com.google.android:flexbox:0.3.0-alpha3&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="26-AndroidSwipeLayout"><a href="#26-AndroidSwipeLayout" class="headerlink" title="26.AndroidSwipeLayout"></a>26.AndroidSwipeLayout</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šéå¸¸å¼ºå¤§æ»‘åŠ¨å¼å¸ƒå±€</p></blockquote><p>ä¸Šæ¦œç†ç”±:æ»‘åŠ¨åˆ é™¤æ˜¯å›½äº§appå¸¸è§éœ€æ±‚ï¼Œå•†å“è¯¦æƒ…çš„ä¸Šä¸‹æ»‘åŠ¨éœ€æ±‚ä½œä¸ºå¼€å‘è€…çš„æˆ‘ä»¬ä¹Ÿç»å¸¸é‡åˆ°ï¼ŒAndroidSwipeLayoutåœ¨githubä¸Šæ‹¥æœ‰8Kä¸ªstarï¼Œè¯æ˜å®ƒç»å—ä½äº†æ£€éªŒï¼Œå„ä½å€¼å¾—ä¸€è¯•</p><ul><li>githubï¼š<a href="https://github.com/daimajia/AndroidSwipeLayout" target="_blank" rel="noopener">https://github.com/daimajia/AndroidSwipeLayout</a></li><li>ä½œè€…ï¼šdaimajia</li></ul><h5 id="ä½¿ç”¨ï¼š-20"><a href="#ä½¿ç”¨ï¼š-20" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;com.android.support:recyclerview-v7:21.0.0&apos;    </span><br><span class="line">    compile &apos;com.android.support:support-v4:20.+&apos;    </span><br><span class="line">    compile &quot;com.daimajia.swipelayout:library:1.2.0@aar&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æˆ–ä¸‹è½½"><a href="#æˆ–ä¸‹è½½" class="headerlink" title="æˆ–ä¸‹è½½"></a>æˆ–ä¸‹è½½</h5><p>AndroidSwipeLayout-v1.1.8.jar</p><h5 id="27-realm-java"><a href="#27-realm-java" class="headerlink" title="27.realm-java"></a>27.realm-java</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šRealmæ˜¯ä¸€æ¬¾ç§»åŠ¨ç«¯æ•°æ®åº“æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ ¸å¿ƒæ•°æ®å¼•æ“C++æ‰“é€ ï¼Œæ¯”æ™®é€šçš„Sqliteå‹æ•°æ®åº“å¿«çš„å¤šã€‚ç¬”è€…çŒœæµ‹æ­£æ˜¯å¦‚æ­¤ï¼Œrealmä»¥7892ä¸ªstaræ•°è®©å®ƒä½äºå¤§åé¼é¼çš„æ•°æ®åº“æ¡†æ¶GreenDaoï¼ˆ7877ï¼‰ä¹‹å‰</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="https://realm.io/cn/" target="_blank" rel="noopener">https://realm.io/cn/</a></li><li>githubï¼š<a href="https://github.com/realm/realm-java" target="_blank" rel="noopener">https://github.com/realm/realm-java</a></li><li>ä½œè€…ï¼šRealmå›¢é˜Ÿ</li></ul><h5 id="ä½¿ç”¨ï¼š-21"><a href="#ä½¿ç”¨ï¼š-21" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p><a href="https://realm.io/docs/java/latest/" target="_blank" rel="noopener">https://realm.io/docs/java/latest/</a></p><h5 id="28-greenDAO"><a href="#28-greenDAO" class="headerlink" title="28.greenDAO"></a>28.greenDAO</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šgreenDAOæ˜¯ä¸€æ¬¾é«˜æ•ˆã€å¿«é€Ÿçš„SQLiteå‹æ•°æ®åº“</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šgreenDAOçš„staræ•°é‡ä¸Realmä¸ç›¸ä¸Šä¸‹ï¼Œä¸”ä¸EventBuså¸ˆå‡ºåŒé—¨ï¼Œä¹Ÿæ˜¯ç”±greenrobotå›¢é˜Ÿå¼€å‘ç»´æŠ¤çš„ï¼Œè´¨é‡æœ‰æ‰€ä¿è¯ï¼Œä½†è‹¥æ‹·é—®ç¬”è€…Realmä¸greenDaoä¸¤è€…çš„ä¼˜åŠ£æ€§ï¼Œåªèƒ½å…·ä½“åˆ°å®é™…ä½¿ç”¨å½“ä¸­ï¼Œæ¨¡æ‹Ÿçº¿ä¸Šçš„ä½¿ç”¨æƒ…å½¢ï¼Œè¿›è¡Œé«˜å¼ºåº¦æµ‹è¯•åæ‰èƒ½ä¸‹åˆ¤æ–­ï¼Œæ•…åœ¨æ­¤ä¸èƒ½ä¸€è¨€ä¸¤è¯­è¯´å®Œï¼Œæ·±è¡¨é—æ†¾</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://greenrobot.org/greendao/" target="_blank" rel="noopener">http://greenrobot.org/greendao/</a></li><li>githubï¼š<a href="https://github.com/greenrobot/greenDAO" target="_blank" rel="noopener">https://github.com/greenrobot/greenDAO</a></li></ul><h5 id="ä½¿ç”¨ï¼š-22"><a href="#ä½¿ç”¨ï¼š-22" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()        </span><br><span class="line">        mavenCentral() // add repository    </span><br><span class="line">    &#125;    </span><br><span class="line">    dependencies &#123; </span><br><span class="line">        classpath &apos;com.android.tools.build:gradle:2.3.1&apos;        </span><br><span class="line">        classpath &apos;org.greenrobot:greendao-gradle-plugin:3.2.2&apos; // add plugin</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">-----</span><br><span class="line"></span><br><span class="line">apply plugin: &apos;com.android.application&apos;</span><br><span class="line">apply plugin: &apos;org.greenrobot.greendao&apos; // apply plugin </span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;org.greenrobot:greendao:3.2.2&apos; // add library</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="29-stetho"><a href="#29-stetho" class="headerlink" title="29.stetho"></a>29.stetho</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›åœ¨Chromeå¼€å‘è€…å·¥å…·ä¸Šè°ƒè¯•Android appèƒ½åŠ›çš„å¼€æºæ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šä¸Šå¤æ—¶æœŸAndroidç¨‹åºå‘˜è¦è°ƒè¯•æœ¬åœ°æ•°æ®åº“ï¼Œéœ€è¦è¿›å…¥Android Device Monitoræ‰¾åˆ°/data/data/com.xxx.xxx/databasesé‡Œé¢çš„dbæ–‡ä»¶ï¼Œå¯¼å‡ºåˆ°PCç«¯ï¼Œç”¨PCçš„æ•°æ®å·¥å…·æŸ¥çœ‹ï¼Œç°åœ¨ä½¿ç”¨stethoçœå´äº†å¦‚æ­¤çš„éº»çƒ¦ï¼›å¦‚ä»Šçš„Androidç¨‹åºå‘˜å¦‚æœæƒ³è°ƒè¯•ç½‘ç»œè¯·æ±‚å“åº”è¿‡ç¨‹ä¸­çš„æŠ¥æ–‡æ®µï¼Œéœ€è¦åœ¨è¯·æ±‚ä¸­åŠ å…¥Logè¯­å¥ï¼Œä¸€ä¸ªä¿¡æ¯ä¸€ä¸ªä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œç›¸å½“ç¹çï¼Œç°åœ¨è¯·ä½¿ç”¨stethoï¼Œçœå´è¯¸å¦‚æ­¤ç±»çš„éº»çƒ¦æŠŠï¼7.8Kä¸ªstaræ•°ï¼Œå¹¿å¤§Androidå¼€å‘è€…è°ƒè¯•çš„ç¦éŸ³ï¼Œä½ å€¼å¾—æ‹¥æœ‰ï¼</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://facebook.github.io/stetho/" target="_blank" rel="noopener">http://facebook.github.io/stetho/</a></li><li>githubï¼š<a href="https://github.com/facebook/stetho" target="_blank" rel="noopener">https://github.com/facebook/stetho</a></li><li>ä½œè€…ï¼šFaceBook</li></ul><h5 id="ä½¿ç”¨ï¼š-23"><a href="#ä½¿ç”¨ï¼š-23" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile â€˜com.facebook.stetho:stetho:1.5.0â€™</span><br></pre></td></tr></table></figure><h5 id="30-BaseRecyclerViewAdapterHelper"><a href="#30-BaseRecyclerViewAdapterHelper" class="headerlink" title="30.BaseRecyclerViewAdapterHelper"></a>30.BaseRecyclerViewAdapterHelper</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šå¼ºå¤§ã€æµç•…çš„Recyvlerviewé€šç”¨é€‚é…å™¨</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå¦‚æœä½ æ˜¯RecyclerViewçš„æ‹¥ç°‡è€…ï¼Œä½ ä¸€å®šè¦ä½“éªŒè¿™æ¬¾ä¸“é—¨æœåŠ¡è¯¥viewçš„é€‚é…å™¨ï¼Œ7.7Kä¸ªstarï¼Œè®©è¿™ä¸ªå®¶ä¼™ä½äºgithubä¸ŠAndroid é€‚é…å™¨æ’è¡Œæ¦œç¬¬ä¸€ï¼Œè¿˜æœ‰å¾ˆå¤šæƒŠå–œç­‰ä½ å»æ¢å¯»ï¼</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://www.recyclerview.org/" target="_blank" rel="noopener">http://www.recyclerview.org/</a></li></ul><p>ä½¿ç”¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123; </span><br><span class="line">        ...       </span><br><span class="line">        maven &#123; url &quot;https://jitpack.io&quot;&#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">        compile &apos;com.github.CymChad:BaseRecyclerViewAdapterHelper:VERSION_CODE&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="31-AndroidViewAnimations"><a href="#31-AndroidViewAnimations" class="headerlink" title="31.AndroidViewAnimations"></a>31.AndroidViewAnimations</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›å¯çˆ±åŠ¨ç”»é›†åˆçš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ­£å¦‚ä½œè€…æ‰€è¯´ï¼Œå®ƒå›Šæ‹¬äº†å¼€å‘éœ€æ±‚è¿‡ç¨‹ä¸­æ‰€æœ‰çš„åŠ¨ç”»æ•ˆæœï¼Œé›†æˆè¿›äº†è¿™ä¸ªç®€æ´å¯çˆ±çš„åŠ¨ç”»æ¡†æ¶ã€‚7.6Kçš„staræ•°ï¼Œè¯æ˜äº†å®ƒåœ¨åŠ¨ç”»æ¡†æ¶é¢†åŸŸçš„æˆ˜æ–—åŠ›ï¼Œè®©å®ƒä»…ä»…ä½åˆ—lottie-androidå’ŒMaterial-Animationsä¸¤ä¸ªåŠ¨ç”»æ¡†æ¶éœ¸ä¸»ä¹‹åï¼Œå±ˆå±…ç¬¬ä¸‰å</p><ul><li>githubï¼š<a href="https://github.com/daimajia/AndroidViewAnimations" target="_blank" rel="noopener">https://github.com/daimajia/AndroidViewAnimations</a></li><li>ä½œè€…ï¼šdaimajia</li></ul><h5 id="ä½¿ç”¨ï¼š-24"><a href="#ä½¿ç”¨ï¼š-24" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">        compile &apos;com.android.support:support-compat:25.1.1&apos;        </span><br><span class="line">        compile &apos;com.daimajia.easing:library:2.0@aar&apos;        </span><br><span class="line">        compile &apos;com.daimajia.androidanimations:library:2.2@aar&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sampleï¼š</span><br><span class="line">YoYo.with(Techniques.Tada)</span><br><span class="line">    .duration(700)    </span><br><span class="line">    .repeat(5)    </span><br><span class="line">    .playOn(findViewById(R.id.edit_area));</span><br></pre></td></tr></table></figure><h5 id="32-MaterialDrawer"><a href="#32-MaterialDrawer" class="headerlink" title="32.MaterialDrawer"></a>32.MaterialDrawer</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šå¼ºå¤§çš„å¡‘æ–™é£æ ¼çš„æŠ½å±‰æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š7.6Kçš„staræ•°é‡ï¼Œä½œè€…çš„æŒç»­æ›´æ–°çŠ¶æ€ï¼Œå¦‚æœä½ è¿˜åœ¨çŠ¹è±«ä¸Šæ‰‹SlidingMenué‡åˆ°bugæ²¡äººç®¡çš„å›°å¢ƒï¼Œé‚£ä¹ˆä½ å¯ä»¥å…¥æ‰‹å®ƒä½œä¸ºä½ çš„æŠ½å±‰å¸ƒå±€</p><ul><li>githubï¼š<a href="https://github.com/mikepenz/MaterialDrawer" target="_blank" rel="noopener">https://github.com/mikepenz/MaterialDrawer</a></li><li>ä½œè€…ï¼šMike Penz</li></ul><h5 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨:"></a>ä½¿ç”¨:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">compile(&apos;com.mikepenz:materialdrawer:5.9.2@aar&apos;) &#123;</span><br><span class="line">    transitive = true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">new DrawerBuilder().withActivity(this).build();</span><br></pre></td></tr></table></figure><h5 id="33-Android-ObservableScrollView"><a href="#33-Android-ObservableScrollView" class="headerlink" title="33.Android-ObservableScrollView"></a>33.Android-ObservableScrollView</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾è®©è§†å›¾æ»‘åŠ¨æ›´å…·æœ‰è§†è§‰æ•ˆæœçš„æ»‘åŠ¨å¼æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š7.5Kçš„staræ•°é‡ï¼Œè¯æ˜äº†å®ƒæ›¾ç»çš„ä»·å€¼ï¼Œgithubä¸Šæä¾›äº†12ç§æ»‘åŠ¨æ•ˆæœï¼Œä½ å¯ä»¥ç”¨å®ƒå¼¥è¡¥å…¶ä»–æ¡†æ¶çš„ä¸è¶³ï¼Œæå‡ä½ çš„Appä½“éªŒï¼</p><ul><li>githubï¼š<a href="https://github.com/ksoichiro/Android-ObservableScrollView" target="_blank" rel="noopener">https://github.com/ksoichiro/Android-ObservableScrollView</a></li><li>ä½œè€…ï¼šSoichiro Kashima</li></ul><h5 id="ä½¿ç”¨ï¼š-25"><a href="#ä½¿ç”¨ï¼š-25" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile com.github.ksoichiro:android-observablescrollview</span><br></pre></td></tr></table></figure><h5 id="34-CircleImageView"><a href="#34-CircleImageView" class="headerlink" title="34.CircleImageView"></a>34.CircleImageView</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šåœ†è§’ImageView</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šä¹Ÿè®¸ä½ å·²ç»å¬è¯´è¿‡æ— æ•°ç§å±•ç¤ºåœ†è§’å›¾ç‰‡çš„æ–¹æ³•ï¼Œä½†å¦‚æœä½ ä¸å°è¯•å°è¯•CircleImageViewï¼Œé‚£ä¹ˆä½ çš„çŸ¥è¯†åº“ä¼šå› ä¸ºå°‘äº†å®ƒé»¯ç„¶å¤±è‰²ï¼Œæœ‰çš„æ—¶å€™å®Œæˆéœ€æ±‚æ˜¯å¼€å‘è€…ä¼˜å…ˆè€ƒè™‘çš„ï¼Œä¸åŒå®ç°æ–¹æ³•ç‰µæ‰¯åˆ°çš„æ€§èƒ½å·®å¼‚æ›´å€¼å¾—è®©äººæ·±æ€ï¼Œå¦‚æœä½ æœ‰å¿ƒåœ¨å›¾ç‰‡æ€§èƒ½ä¸Šæœ‰æ‰€æ¶‰çŒï¼Œé‚£ä¹ˆCircleImageViewç»å¯¹ä¸ä¼šè®©ä½ è´¥å…´è€Œå½’ã€‚æœ€ååˆ«å¿˜äº†è®°å¾—å»çœ‹Romain Guyçš„å»ºè®®å“Ÿã€‚</p><ul><li>githubï¼š<a href="https://github.com/hdodenhof/CircleImageView" target="_blank" rel="noopener">https://github.com/hdodenhof/CircleImageView</a></li><li>ä½œè€…ï¼šHenning Dodenhof</li></ul><h5 id="ä½¿ç”¨ï¼š-26"><a href="#ä½¿ç”¨ï¼š-26" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    ...    </span><br><span class="line">    compile &apos;de.hdodenhof:circleimageview:2.1.0&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;de.hdodenhof.circleimageview.CircleImageView</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    android:id=&quot;@+id/profile_image&quot;</span><br><span class="line">    android:layout_width=&quot;96dp&quot;</span><br><span class="line">    android:layout_height=&quot;96dp&quot;</span><br><span class="line">    android:src=&quot;@drawable/profile&quot;</span><br><span class="line">    app:civ_border_width=&quot;2dp&quot;    </span><br><span class="line">    app:civ_border_color=&quot;#FF000000&quot;/&gt;</span><br></pre></td></tr></table></figure><h5 id="35-logger"><a href="#35-logger" class="headerlink" title="35.logger"></a>35.logger</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾è®©logæ—¥å¿—ä¼˜é›…æ˜¾ç¤ºçš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šloggerä½œä¸ºè°ƒè¯•æ¡†æ¶ï¼Œå¹¶æœªç»™å‡ºå¾ˆå¼ºå¤§çš„èƒ½åŠ›ï¼Œå®ƒæœ€å¤§çš„äº®ç‚¹æ˜¯ä¼˜é›…çš„è¾“å‡ºlogä¿¡æ¯ï¼Œå¹¶ä¸”æ”¯æŒå¤šç§æ ¼å¼ï¼šçº¿ç¨‹ã€Jsonã€Xmlã€Listã€Mapç­‰ï¼Œå¦‚æœä½ æ•´æ—¥æ²‰è¿·äºæ±ªæ´‹å¤§æµ·èˆ¬çš„logä¿¡æ¯ä¸èƒ½è‡ªæ‹”ï¼Œloggerå°±æ˜¯ä½ çš„æŒ‡è·¯æ˜ç¯ï¼6.6kä¸ªstarè®©ä»–ä½åˆ—è°ƒè¯•æ¡†æ¶ç¬¬äºŒåï¼Œå±ˆå±…facebookçš„stethoä¹‹å</p><ul><li>githubï¼š<a href="https://github.com/orhanobut/logger" target="_blank" rel="noopener">https://github.com/orhanobut/logger</a></li><li>ä½œè€…ï¼šOrhan Obut</li></ul><p>ä½¿ç”¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.orhanobut:logger:2.1.1&apos;</span><br><span class="line"></span><br><span class="line">Logger.d(MAP);</span><br><span class="line">Logger.d(SET);</span><br><span class="line">Logger.d(LIST);</span><br><span class="line">Logger.d(ARRAY);</span><br><span class="line">Logger.json(JSON_CONTENT);</span><br><span class="line">Logger.xml(XML_CONTENT);</span><br></pre></td></tr></table></figure><h5 id="36-agera"><a href="#36-agera" class="headerlink" title="36.agera"></a>36.agera</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»:ä¸€æ¬¾æœåŠ¡äºAndroidå¹³å°çš„å“åº”å¼ç¼–ç¨‹æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šgoogleä¸“é—¨æ¨å‡ºä¸€å¥—å“åº”å¼ç¼–ç¨‹æ¡†æ¶æœåŠ¡äºAndroidå¼€å‘è€…ï¼Œç›¸æ¯”äºä¹‹å“åº”å¼ç¼–ç¨‹æ¡†æ¶æ¦œé¦–çš„ RxJava RxAndroidï¼Œå®ƒæ›´è½»é‡ï¼Œä¸¤è€…æœ€å¤§çš„ä¸åŒç‚¹åœ¨äºageraåŸºäºpush eventã€pull data ï¼ˆVS Rxç³»åˆ— push dataï¼‰ã€‚</p><ul><li>githubï¼š<a href="https://github.com/google/agera" target="_blank" rel="noopener">https://github.com/google/agera</a></li><li>ä½œè€…ï¼šGoogle</li></ul><h5 id="ä½¿ç”¨ï¼š-27"><a href="#ä½¿ç”¨ï¼š-27" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.google.android.agera:agera:1.3.0&apos;</span><br></pre></td></tr></table></figure><h5 id="æ‰©å±•èƒ½åŠ›"><a href="#æ‰©å±•èƒ½åŠ›" class="headerlink" title="æ‰©å±•èƒ½åŠ›"></a>æ‰©å±•èƒ½åŠ›</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.google.android.agera:content:1.3.0&apos;  </span><br><span class="line">compile &apos;com.google.android.agera:database:1.3.0&apos;  </span><br><span class="line">compile &apos;com.google.android.agera:net:1.3.0&apos;  </span><br><span class="line">compile &apos;com.google.android.agera:rvadapter:1.3.0&apos;  </span><br><span class="line">compile &apos;com.google.android.agera:rvdatabinding:1.3.0&apos;</span><br></pre></td></tr></table></figure><h5 id="37-BottmBar"><a href="#37-BottmBar" class="headerlink" title="37.BottmBar"></a>37.BottmBar</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾åº•éƒ¨å¯¼èˆªæ è§†å›¾æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šåº•éƒ¨æ é‡Œçš„ç‹è€…æ¡†æ¶ï¼Œ6.3Kçš„staræ•°é‡ï¼Œè¯æ˜äº†å®ƒçš„ä¼˜ç§€ï¼Œå®Œå…¨éµå¾ªææ–™è®¾è®¡è§„èŒƒï¼Œä¸Šæ‰‹éå¸¸æ–¹ä¾¿ã€‚å¦‚æœè¯´ç¼ºç‚¹ï¼Œæ— æ³•è®¾ç½®iconä¸titileçš„é—´è·ï¼Œæ— æ³•è‡ªå®šä¹‰è§†å›¾çš„å¤§å°ç­‰ï¼Œä½†è¿™äº›éƒ½å¯ä»¥é€šè¿‡ä¿®æ”¹æºä»£ç è§£å†³ï¼Œç¬”è€…çŒ®ä¸‘ä¹Ÿä¿®æ”¹äº†ä¸€å¥—ç¬¦åˆå›½å†…å¼€å‘è€…çš„åº•éƒ¨å¯¼èˆªæ¡†æ¶ï¼Œå³å°†å¼€æºã€‚</p><ul><li>githubï¼š<a href="https://github.com/roughike/BottomBar" target="_blank" rel="noopener">https://github.com/roughike/BottomBar</a></li><li>ä½œè€…ï¼šIiro Krankka</li></ul><h5 id="ä½¿ç”¨ï¼š-28"><a href="#ä½¿ç”¨ï¼š-28" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.roughike:bottom-bar:2.3.1&apos;</span><br></pre></td></tr></table></figure><h5 id="38-Calligraphy"><a href="#38-Calligraphy" class="headerlink" title="38.Calligraphy"></a>38.Calligraphy</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾è‡ªå®šä¹‰å­—ä½“æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå¦‚æœä½ è¿˜åœ¨ä¸ºä¸€é”®ä¿®æ”¹Appå†…æ‰€æœ‰å­—ä½“æ ·å¼è€Œçƒ¦æ¼ï¼Œ6.3Kä¸ªstarçš„Calligraphyå°±å€¼å¾—ä½ æ‹¥æœ‰ï¼Œå®ƒå¯ä»¥åŒæ—¶ä¿®æ”¹æ•´ä¸ªæ•´ä¸ªé¡¹ç›®çš„Textviewå­—ä½“ï¼Œä¹Ÿå¯ä»¥å•ç‹¬ è®¾ç½®æŸä¸ªTextviewçš„å­—ä½“ï¼Œè¿˜åœ¨ç­‰ä»€ä¹ˆï¼Œå¿«æ¥è¯•è¯•å§ï¼</p><ul><li>githubï¼š<a href="https://github.com/chrisjenx/Calligraphy" target="_blank" rel="noopener">https://github.com/chrisjenx/Calligraphy</a></li><li>ä½œè€…ï¼šChristopher Jenkins</li></ul><h5 id="ä½¿ç”¨ï¼š-29"><a href="#ä½¿ç”¨ï¼š-29" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;uk.co.chrisjenx:calligraphy:2.3.0&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="39-AndroidSlidingUpPanel"><a href="#39-AndroidSlidingUpPanel" class="headerlink" title="39.AndroidSlidingUpPanel"></a>39.AndroidSlidingUpPanel</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šå¯æ‹–åŠ¨çš„æ»‘åŠ¨é¢æ¿è§†å›¾æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå¦‚æœä½ çš„é¡¹ç›®éœ€è¦ä¸€ä¸ªå¯æ‹–æ‹½çš„æ»‘åŠ¨å¼é¢æ¿ï¼ˆå±•ç¤ºæŸäº›è¯¦æƒ…ä¿¡æ¯ï¼Œæ’­æ”¾éŸ³ä¹ï¼Œåœ°å›¾ä¿¡æ¯ç­‰ï¼‰ï¼Œé‚£ä¹ˆæ¨èä½ ä½¿ç”¨å®ƒï¼Œ6.3kä¸ªstarï¼Œæ¥è‡ªåˆ›ä¸šå…¬å¸umanoçš„ä½œå“ï¼Œè¯æ˜å®ƒæ˜¯ç”¨å¿ƒæ¨å‡ºçš„æ°ä½œ</p><ul><li>githubï¼š<a href="https://github.com/umano/AndroidSlidingUpPanel" target="_blank" rel="noopener">https://github.com/umano/AndroidSlidingUpPanel</a></li><li>ä½œè€…ï¼šumano</li></ul><h5 id="ä½¿ç”¨ï¼š-30"><a href="#ä½¿ç”¨ï¼š-30" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    repositories &#123;    </span><br><span class="line">       mavenCentral()    </span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    compile &apos;com.sothree.slidinguppanel:library:3.3.1&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="40-AppIntro"><a href="#40-AppIntro" class="headerlink" title="40.AppIntro"></a>40.AppIntro</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›å¿«é€Ÿåˆ¶ä½œæ¬¢è¿é¡µçš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šç¬”è€…ä»æœªæŠŠæ‰“ç®—æŠŠæ¬¢è¿é¡µæ¡†æ¶çº³å…¥æ’è¡Œæ¦œå½“ä¸­ï¼Œä½œä¸ºå›½å†…å¼€å‘è€…ï¼ŒViewPagerå¼€å‘Appçš„æ¬¢è¿é¡µå·²ç»æ˜¯æ‰‹åˆ°æ“’æ¥çš„éœ€æ±‚ï¼Œä¸ºä½•ä¸€ä¸ªå¼€æºçš„æ¬¢è¿é¡µæ¡†æ¶ä¼šåœ¨githubä¸Šæ‹¥æœ‰6.3kä¸ªstarï¼Ÿä¹Ÿè®¸ä½ ä¼šä¸å±‘ä¸€é¡¾ï¼Œæ˜¯çš„ï¼Œå¾€å¾€å°±åœ¨ä¸å±‘ä¸€é¡¾çš„ç¬é—´ï¼Œæœºé‡å°±æ‚„æ‚„æºœèµ°äº†ã€‚</p><ul><li>githubï¼š<a href="https://github.com/apl-devs/AppIntro" target="_blank" rel="noopener">https://github.com/apl-devs/AppIntro</a></li><li>ä½œè€…ï¼šPaolo Rotolo</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;  </span><br><span class="line">   repositories &#123;      </span><br><span class="line">       ...            </span><br><span class="line">       maven &#123; url &apos;https://jitpack.io&apos;&#125; </span><br><span class="line">   &#125;      </span><br><span class="line">&#125;        </span><br><span class="line"></span><br><span class="line">dependencies &#123;     </span><br><span class="line">        compile &apos;com.github.apl-devs:appintro:v4.2.0&apos;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="41-recyclerview-animators"><a href="#41-recyclerview-animators" class="headerlink" title="41.recyclerview-animators"></a>41.recyclerview-animators</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾ä¸ºRecyclerviewæä¾›æ‰©å±•åŠ¨ç”»èƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæœ‰ä¸€å¥è€è¯ï¼šå¦‚æœæœ‰å¤©ä½ å¤±å»å¯¹æ–°äº‹ç‰©çš„å…´è¶£ï¼Œé‚£å°±è¯´æ˜ä½ è€äº†ã€‚recyclerviewå·²ç»æ¨å‡ºå¿«ä¸‰å¹´äº†ï¼Œè¿˜åœ¨ç”¨listviewçš„äººä»¬ï¼Œæ˜¯å¦å·²ç»å‘æ˜è‡ªå·±æ¸æ¸å˜è€ï¼›ä¸è¦ç°å¿ƒï¼Œå¿«ä¸ºä½ çš„é¡¹ç›®åŠ å…¥recyclerview-animatorsæ¡†æ¶å§ï¼Œä¸ºâ€œè‡ªå·±â€åŠ å…¥æ–°é²œçš„è¡€æ¶²å’Œèƒ½é‡ï¼ï¼ˆç¬”è€…å¤‡æ³¨ï¼š6.2Kä¸ªstarï¼‰</p><ul><li>githubï¼š<a href="https://github.com/wasabeef/recyclerview-animators" target="_blank" rel="noopener">https://github.com/wasabeef/recyclerview-animators</a></li><li>ä½œè€…ï¼š<a href="https://github.com/wasabeef" target="_blank" rel="noopener">https://github.com/wasabeef</a></li></ul><h5 id="ä½¿ç”¨ï¼š-31"><a href="#ä½¿ç”¨ï¼š-31" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  // jCenter  </span><br><span class="line">  compile &apos;jp.wasabeef:recyclerview-animators:2.2.6&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="42-dagger"><a href="#42-dagger" class="headerlink" title="42.dagger"></a>42.dagger</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾é€šè¿‡ä¾èµ–æ³¨å…¥é™ä½ç¨‹åºé—´è€¦åˆçš„å¼€å‘æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šgithub ä¸Šdagger1ç‰ˆæœ¬ æœ‰6.2kä¸ªstar ï¼Œ dagger2ç‰ˆæœ¬æœ‰7.3kä¸ªï¼›ç”±squareå®Œæˆçš„dagger1ç‰ˆæœ¬ï¼Œåˆ°å¦‚ä»Šgoogleå›¢é˜Ÿæ¥æ‰‹çš„dagger2ç‰ˆæœ¬ï¼Œå¼ºåŠ›å¼€å‘å›¢é˜Ÿä¿è¯äº†ä»£ç åœ¨è®¾è®¡ä¸Šçš„ä¼˜è¶Šæ€§ï¼›å¦‚æœä½ æƒ³æ¢ç©¶Android é¢†åŸŸçš„è®¾è®¡æ¨¡å¼ï¼Œè¿™ä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="https://google.github.io/dagger/" target="_blank" rel="noopener">https://google.github.io/dagger/</a></li><li>githubï¼š<a href="https://github.com/google/dagger" target="_blank" rel="noopener">https://github.com/google/dagger</a></li><li>ä½œè€…ï¼šgoogle</li></ul><h5 id="ä½¿ç”¨ï¼š-32"><a href="#ä½¿ç”¨ï¼š-32" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  compile &apos;com.google.dagger:dagger:2.x&apos;  </span><br><span class="line">  annotationProcessor &apos;com.google.dagger:dagger-compiler:2.x&apos;</span><br><span class="line">&#125;</span><br><span class="line">If you&apos;re using classes in dagger.android you&apos;ll also want to include:</span><br><span class="line"></span><br><span class="line">compile &apos;com.google.dagger:dagger-android:2.x&apos;</span><br><span class="line">compile &apos;com.google.dagger:dagger-android-support:2.x&apos; </span><br><span class="line">annotationProcessor &apos;com.google.dagger:dagger-android-processor:2.x&apos;</span><br></pre></td></tr></table></figure><h5 id="43-Android-Bootstarp"><a href="#43-Android-Bootstarp" class="headerlink" title="43.Android-Bootstarp"></a>43.Android-Bootstarp</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›åœ¨Androidåº”ç”¨ä¸Šå®ç°Bootstrapï¼ˆwebæ¡†æ¶ï¼‰æ‰€ä½œå‡ºæ•ˆæœçš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ¦œå•ä¸Šç¬¬äºŒæ¬¾å“åº”webæŠ€æœ¯çš„Android ç«¯æ¡†æ¶ï¼Œè¿˜è®°å¾—ç¬¬ä¸€åæ˜¯è°å—â€”â€”flexbox-layoutï¼Œä½œä¸ºAndroidå¼€å‘è€…ï¼Œä½ æœ‰å¿…è¦å»äº†è§£WebæŠ€æœ¯äº†ã€‚5.9kä¸ªstarï¼Œè¯æ˜å®ƒä¸å®¹å°è§‘</p><ul><li>githubï¼š<a href="https://github.com/Bearded-Hen/Android-Bootstrap" target="_blank" rel="noopener">https://github.com/Bearded-Hen/Android-Bootstrap</a></li><li>ä½œè€…ï¼šBearded-Henå›¢é˜Ÿ</li></ul><h5 id="ä½¿ç”¨ï¼š-33"><a href="#ä½¿ç”¨ï¼š-33" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">   compile &apos;com.beardedhen:androidbootstrap:&#123;X.X.X&#125;&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="44-RxBinding"><a href="#44-RxBinding" class="headerlink" title="44.RxBinding"></a>44.RxBinding</h5><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›UIç»„ä»¶äº‹ä»¶å“åº”èƒ½åŠ›çš„æ¡†æ¶</p><p>ä¸Šæ¦œç†ç”±ï¼šå¦‚æœä½ è¿˜æœªå¼€å§‹RxAndroid ä¹‹æ—…ï¼ŒRxBindingå¯ä»¥ä½œä¸ºä½ çš„ç¬¬ä¸€ç«™ï¼Œé€šè¿‡RXBindingï¼Œä½ å°†ç†è§£å“åº”å¼ç¼–ç¨‹çš„å¿«ä¹ï¼Œè®©é¡¹ç›®é‡Œçš„äº‹ä»¶æµç¨‹æ›´æ¸…æ™°ã€‚5.6Kä¸ªstarï¼ŒRxAndroidä½œè€…äº²è‡ªæ“åˆ€ï¼Œå¿«æ¥è¯•ç”¨å§ï¼</p><ul><li>githubï¼š<a href="https://github.com/JakeWharton/RxBinding" target="_blank" rel="noopener">https://github.com/JakeWharton/RxBinding</a></li><li>ä½œè€…ï¼šJakeWharton</li></ul><h5 id="Platform-bindings"><a href="#Platform-bindings" class="headerlink" title="Platform bindings:"></a>Platform bindings:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.jakewharton.rxbinding2:rxbinding:2.0.0&apos;</span><br><span class="line">&apos;support-v4&apos; library bindings:</span><br><span class="line"></span><br><span class="line">compile &apos;com.jakewharton.rxbinding2:rxbinding-support-v4:2.0.0&apos;</span><br><span class="line">&apos;appcompat-v7&apos; library bindings:</span><br><span class="line"></span><br><span class="line">compile &apos;com.jakewharton.rxbinding2:rxbinding-appcompat-v7:2.0.0&apos;</span><br><span class="line">&apos;design&apos; library bindings:</span><br><span class="line"></span><br><span class="line">compile &apos;com.jakewharton.rxbinding2:rxbinding-design:2.0.0&apos;</span><br><span class="line">&apos;recyclerview-v7&apos; library bindings:</span><br><span class="line"></span><br><span class="line">compile &apos;com.jakewharton.rxbinding2:rxbinding-recyclerview-v7:2.0.0&apos;</span><br><span class="line">&apos;leanback-v17&apos; library bindings:</span><br><span class="line"></span><br><span class="line">compile &apos;com.jakewharton.rxbinding2:rxbinding-leanback-v17:2.0.0&apos;</span><br></pre></td></tr></table></figure><h5 id="45-ListViewAnimations"><a href="#45-ListViewAnimations" class="headerlink" title="45.ListViewAnimations"></a>45.ListViewAnimations</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾ä¸ºListViewæä¾›åŠ¨å±•ç¤ºç”»æ•ˆæœèƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå¦‚æœæœ‰ä¸€å¤©æˆ‘æ‰¿è®¤è‡ªå·±è€äº†ï¼Œæˆ‘è¿˜ä¼šæ’æ’æˆ‘çš„å…„å¼Ÿâ€”â€”ListViewï¼Œè¯æ˜æˆ‘å’Œå®ƒä¸€èµ·æˆ˜æ–—è¿‡ã€‚ListViewAnimationsçš„å­˜åœ¨å°±æ˜¯è¯æ˜æˆ‘ä»¬è¿™äº›â€œè€å¹´äººâ€ä»æœ‰ç”¨æ­¦ä¹‹åœ°ï¼Œä¹Ÿè®¸ä½ æœ‰è¯´ä¸å‡ºå£çš„éš¾å¤„ï¼Œæ— æ³•ä½“ä¼šåˆ°RecyclerViewé‡ŒåŠ¨ç”»çš„å¿«ä¹ï¼Œæ‹¥æœ‰ListViewAnimationsï¼Œä½ ä¸€æ ·å¯ä»¥éª„å‚²çš„è¯´ï¼Œæˆ‘çš„å­©å­ï¼ˆæ¯ä¸ªitemï¼‰ä¹Ÿæœ‰è‡ªå·±çš„åŠ¨æ•ˆå•¦ã€‚ï¼ˆç¬”è€…å¤‡æ³¨ 5.6Kä¸ªstarï¼‰</p><ul><li>githubï¼š<a href="https://github.com/nhaarman/ListViewAnimations" target="_blank" rel="noopener">https://github.com/nhaarman/ListViewAnimations</a></li><li>ä½œè€…ï¼šnhaarman</li></ul><h5 id="ä½¿ç”¨ï¼š-34"><a href="#ä½¿ç”¨ï¼š-34" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;com.nhaarman.listviewanimations:lib-core:3.1.0@aar&apos;    </span><br><span class="line">    compile &apos;com.nhaarman.listviewanimations:lib-manipulation:3.1.0@aar&apos;    </span><br><span class="line">    compile &apos;com.nhaarman.listviewanimations:lib-core-slh:3.1.0@aar&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="46-UItimateRecyclerView"><a href="#46-UItimateRecyclerView" class="headerlink" title="46.UItimateRecyclerView"></a>46.UItimateRecyclerView</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›åˆ·æ–°ã€åŠ è½½æ›´å¤šã€åŠ¨ç”»ç‰¹æ•ˆç­‰é¢å¤–èƒ½åŠ›çš„RecyclerViewæ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ¦œå•ä¸Šç¬¬ä¸‰æ¬¡å‡ºç°RecyclerViewçš„èº«å½±ï¼Œè¶³ä»¥è¯æ˜RecyclerViewçš„ä¼˜å¼‚æ€§ï¼Œ5.5Kä¸ªstarï¼Œæ¡†æ¶é‡Œæ‰€æä¾›ä¼—å¤šçš„èƒ½åŠ›ï¼Œå¦‚æœä½ æ˜¯ä¸ªåŠŸåˆ©å¼€å‘è€…ï¼Œé‚£ä¹ˆæ­¤æ¡†æ¶ä¼šä¸ºä½ èŠ‚çœå¾ˆå¤šå­¦ä¹ æ—¶é—´ï¼Œå®ƒå¯ä»¥å®Œæˆå¤šitemå¼å¸ƒå±€çš„å¤§å¤šæ•°éœ€æ±‚ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªé¡¹ç›®ä¹Ÿæ˜¯åœ¨å…¶ä»–é¡¹ç›®çš„æ€è·¯ä¸ŠäºŒæ¬¡å¼€å‘çš„ã€‚</p><ul><li>githubï¼š<a href="https://github.com/cymcsg/UltimateRecyclerView" target="_blank" rel="noopener">https://github.com/cymcsg/UltimateRecyclerView</a></li><li>ä½œè€…ï¼šMarshalChen</li></ul><h5 id="ä½¿ç”¨ï¼š-35"><a href="#ä½¿ç”¨ï¼š-35" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    jcenter()    </span><br><span class="line">    &#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    ...    </span><br><span class="line">    compile &apos;com.marshalchen.ultimaterecyclerview:library:0.7.2&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="47-uCrop"><a href="#47-uCrop" class="headerlink" title="47.uCrop"></a>47.uCrop</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾ä¼˜é›…çš„å›¾ç‰‡è£å‰ªæ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š5.3Kä¸ªstarï¼Œå›¾ç‰‡ç¼–è¾‘æ¨¡å—å•ç‹¬æ‹å‡ºæ¥ä¹Ÿæ˜¯ä¸€æ¬¾ä¼˜é›…çš„Appã€‚</p><ul><li>githubï¼š<a href="https://github.com/Yalantis/uCrop" target="_blank" rel="noopener">https://github.com/Yalantis/uCrop</a></li><li>ä½œè€…ï¼šYalantis</li></ul><h5 id="ä½¿ç”¨ï¼š-36"><a href="#ä½¿ç”¨ï¼š-36" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">   repositories &#123;  </span><br><span class="line">      jcenter()      </span><br><span class="line">      maven &#123; url &quot;https://jitpack.io&quot; &#125;   </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">compile &apos;com.github.yalantis:ucrop:2.2.1&apos;</span><br></pre></td></tr></table></figure><h5 id="48-RxJava-Android-Samples"><a href="#48-RxJava-Android-Samples" class="headerlink" title="48.RxJava-Android-Samples"></a>48.RxJava-Android-Samples</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾ä»‹ç»RxJavaä½¿ç”¨åœºæ™¯çš„app</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ¦œå•å‡ºç°çš„ç¬¬ä¸€ä¸ªâ€œä»…ä»…ä¸ºå‘Šè¯‰ä½ å¦‚ä½•ä½¿ç”¨å¦ä¸€ä¸ªé¡¹ç›®â€çš„å¼€æºé¡¹ç›®ï¼Œå®ƒå¯ä»¥è¯´æ˜¯RxJavaçš„ç”¨ä¾‹ï¼Œä½ æƒ³å¾—åˆ°çš„æƒ³ä¸åˆ°çš„RxJavaç”¨æ³•è¿™é‡Œéƒ½æœ‰ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä»¥5.2kä¸ªstarçŸ—ç«‹åœ¨è¿™ä»½æ¦œå•é‡Œçš„åŸå› ã€‚é—æ†¾è‡ªå·±æ²¡æœ‰åˆ›ä½œè¿™ä¹ˆä¸€ä¸ªå—äººè¿½æ§çš„demoï¼Ÿèµ¶å¿«åŠ¨æ‰‹å†™ä¸ªå…¶ä»–çš„â€œXXé¡¹ç›®ç”¨ä¾‹å§â€</p><ul><li>githubï¼š<a href="https://github.com/kaushikgopal/RxJava-Android-Samples" target="_blank" rel="noopener">https://github.com/kaushikgopal/RxJava-Android-Samples</a></li><li>ä½œè€…ï¼škaushikgopal</li></ul><h5 id="ä½¿ç”¨ï¼š-37"><a href="#ä½¿ç”¨ï¼š-37" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>cloneåˆ°æœ¬åœ°æ…¢æ…¢æ¢ç´¢å§</p><h5 id="49-AndroidAutoLayout"><a href="#49-AndroidAutoLayout" class="headerlink" title="49.AndroidAutoLayout"></a>49.AndroidAutoLayout</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€ä¸ªæä¾›é€‚é…èƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š5.2Kä¸ªstarï¼Œé¸¿æ´‹è€å¼Ÿçš„ä½œå“ï¼Œé€‚åˆå°é¡¹ç›®çš„å¼€å‘å›¢é˜Ÿï¼Œæ‹¿åˆ°è®¾è®¡MMçš„pxåƒç´ è®¾è®¡ç¨¿æ˜¯ä¸æ˜¯å¾ˆå¤´ç–¼æï¼Ÿè¿™ä¸ªæ¡†æ¶ä¸€é”®å¼æå®šä½ çš„é—®é¢˜ï¼Œå®ƒæœ‰å¾ˆå¤šçš„ä¸è¶³ï¼Œä½†åœ¨è¿½æ±‚å®Œç¾é€‚é…çš„è·¯ä¸Šï¼Œä½ å€¼å¾—æ¢ç´¢å’Œäº†è§£å®ƒï¼ç¬”è€…å¹¶ä¸æ¨èæŠŠå®ƒåº”ç”¨åˆ°å·²ç»æˆç†Ÿè¿è¡Œçš„é¡¹ç›®ä¸­ï¼Œæ¯•ç«Ÿå¸‚é¢ä¸Šå·²ç»æœ‰å¤ªå¤šçš„é€‚é…è§£å†³æ–¹æ¡ˆäº†ï¼Œé€‚é…é—®é¢˜å°±åƒæ˜¯ä¸ªå¤§æ‚çƒ©ï¼Œæƒ³ç‚’ä¸€ç›˜å¥½èœï¼Œå°±å¾—å¤‡å¥½å„ç§ä½æ–™ï¼ˆé€‚é…å°æ–¹æ¡ˆï¼‰ï¼Œå½“ä½ æŠŠå„ç§å°ä½æ–™ç”¨çš„ç‚‰ç«çº¯é’çš„æ—¶å€™ï¼Œä½ ç¦»ç¾é£Ÿå¤§å¨å°±ä¸è¿œäº†ã€‚</p><ul><li>githubï¼š<a href="https://github.com/hongyangAndroid/AndroidAutoLayout" target="_blank" rel="noopener">https://github.com/hongyangAndroid/AndroidAutoLayout</a></li><li>ä½œè€…ï¼šå¼ é¸¿æ´‹</li></ul><h5 id="ä½¿ç”¨ï¼š-38"><a href="#ä½¿ç”¨ï¼š-38" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;com.zhy:autolayout:1.4.5&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="50-EffectiveAndroidUI"><a href="#50-EffectiveAndroidUI" class="headerlink" title="50.EffectiveAndroidUI"></a>50.EffectiveAndroidUI</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾è®²è§£é«˜æ•ˆå±•ç¤ºUIçš„æ•™å­¦å‹App</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šç¼–ç¨‹æ–°æ‰‹å¾ˆéš¾å¯¹MVC MVP,MVVMç­‰æ¨¡å¼æœ‰æ·±åˆ»çš„ç†è§£ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç¤ºä¾‹å‹appï¼Œé‚£å¯¹åˆå­¦è€…ä¼šæœ‰å¾ˆå¤§è£¨ç›Šï¼Œç¬”è€…åœ¨é‡åˆ°å®ƒæ—¶ä¹Ÿæ˜¯ç›¸è§æ¨æ™šã€‚4.8Kä¸ªstarï¼Œè¯æ˜äº†å®ƒç»å—äº†å¹¿å¤§å¼€å‘è€…çš„è€ƒéªŒä¸å®¡è§†ï¼Œå…¶ä¸­Effective UIçš„ç¼–ç¨‹æ€æƒ³æ›´æ˜¯ä¸Androidå®˜æ–¹è¯¾ç¨‹é‡Œçš„Effective UIè¯¾ç¨‹ä¸è°‹è€Œåˆï¼Œå¹¶ä¸”ï¼Œæ­¤é¡¹ç›®è¿˜åŒ…å«äº†fragmentã€daggerã€ä¸»é¢˜æ ·å¼ã€Butterknifeç­‰ä¼—å¤šå°çŸ¥è¯†ç‚¹ï¼Œä½œä¸ºç¼–ç¨‹åˆå­¦è€…çš„å­¦ä¹ ç”¨ä¾‹å†é€‚åˆä¸è¿‡äº†</p><ul><li>githubï¼š<a href="https://github.com/pedrovgs/EffectiveAndroidUI" target="_blank" rel="noopener">https://github.com/pedrovgs/EffectiveAndroidUI</a></li><li>ä½œè€…ï¼šPedro Vicente</li></ul><h5 id="ä½¿ç”¨ï¼š-39"><a href="#ä½¿ç”¨ï¼š-39" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>cloneé¡¹ç›®åˆ°æœ¬åœ°</p><h5 id="51-Luban"><a href="#51-Luban" class="headerlink" title="51.Luban"></a>51.Luban</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šæœ€æ¥è¿‘å¾®ä¿¡çš„å›¾ç‰‡å‹ç¼©æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå¥½çš„æ€è·¯æ€»æ˜¯å¯ä»¥è®©ä½ å¤§æ”¾å¼‚å½©ï¼ŒLubanä»…ä»¥å›¾ç‰‡å‹ç¼©å•ä¸€åŠŸèƒ½ï¼Œä¿˜è·äº†4.8Kä¸ªstarï¼Œè¯æ˜äº†å®ƒåœ¨å›¾ç‰‡å‹ç¼©ä¸Šçš„é€ è¯£ï¼Œå®ƒå¯èƒ½ä¸æ˜¯æœ€ä¼˜ç§€çš„ï¼Œä½†å®ƒæ˜¯è®©ä½ æˆ‘æœ€æ¥è¿‘ä¼Ÿå¤§çš„é¡¹ç›®</p><ul><li>githubï¼š<a href="https://github.com/Curzibn/Luban" target="_blank" rel="noopener">https://github.com/Curzibn/Luban</a></li><li>ä½œè€…ï¼šCurzibn</li></ul><h5 id="ä½¿ç”¨ï¼š-40"><a href="#ä½¿ç”¨ï¼š-40" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;top.zibin:Luban:1.1.1&apos;</span><br></pre></td></tr></table></figure><h5 id="52-DroidPlugin"><a href="#52-DroidPlugin" class="headerlink" title="52.DroidPlugin"></a>52.DroidPlugin</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾çƒ­é—¨çš„æ’ä»¶åŒ–å¼€å‘æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š4.8Kä¸ªstarï¼Œæ’ä»¶åŒ–æ¡†æ¶æ¦œå•ç¬¬ä¸€åï¼Œï¼Œ360å›¢é˜Ÿå‡ºå“ï¼Œæ¡†æ¶è´¨é‡æœ‰ä¿è¯ï¼Œæœ‰æˆåŠŸæ¡ˆä¾‹â€”â€”360æ‰‹æœºåŠ©æ‰‹ï¼Œå¹¶ä¸”æŒç»­ç»´æŠ¤ç€</p><ul><li>githubï¼š<a href="https://github.com/DroidPluginTeam/DroidPlugin/blob/master/readme_cn.md" target="_blank" rel="noopener">https://github.com/DroidPluginTeam/DroidPlugin/blob/master/readme_cn.md</a></li><li>ä½œè€…ï¼šAndy Zhang</li></ul><h5 id="ä½¿ç”¨-2"><a href="#ä½¿ç”¨-2" class="headerlink" title="ä½¿ç”¨:"></a>ä½¿ç”¨:</h5><p>cloneé¡¹ç›®åˆ°æœ¬åœ°</p><h5 id="53-otto"><a href="#53-otto" class="headerlink" title="53.otto"></a>53.otto</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»:ä¸€æ¬¾è€æ—§ä¸”å¼ºå¤§çš„äº‹ä»¶æ€»çº¿æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š4.8Kä¸ªstarï¼Œæ˜¯squareå›¢é˜Ÿæ—©å…ˆæ¨å‡ºçš„äº‹ä»¶å“åº”å‹æ¡†æ¶ï¼Œæ·˜å®appçš„äº‹ä»¶é©±åŠ¨ä¹Ÿæ˜¯åŸºäºæ­¤æ¡†æ¶å°è£…çš„ï¼Œå¦‚ä»Šsquareå·²ç»å»ºè®®å¼€å‘è€…é‡‡ç”¨RxJava RxAndroidæ¥ä»£æ›¿ottoäº†ã€‚ä½†ottoä»æœ‰ä¸EventBusæ¨ªå‘å¯¹æ¯”çš„ä»·å€¼ï¼Œçºµå‘æ¥è¯´ï¼Œottoä¸squareè‡ªå®¶å¼€å‘çš„Rxç³»åˆ—æ¡†æ¶çš„å·®å¼‚åŒæ ·å€¼å¾—å¼€å‘è€…ä»¬å»æ¢ç©¶ã€‚</p><ul><li>github <a href="https://github.com/square/otto" target="_blank" rel="noopener">https://github.com/square/otto</a></li><li>ä½œè€…ï¼šsquare</li></ul><h5 id="ä½¿ç”¨ï¼š-41"><a href="#ä½¿ç”¨ï¼š-41" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    mavenCentral()    </span><br><span class="line">    maven &#123; url &quot;https://oss.sonatype.org/content/repositories/snapshots/&quot; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">compile &apos;com.michaelpardo:activeandroid:3.1.0-SNAPSHOT&apos;</span><br></pre></td></tr></table></figure><h5 id="54-u2020"><a href="#54-u2020" class="headerlink" title="54.u2020"></a>54.u2020</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›Daggerçš„é«˜çº§æ•™å­¦ç¤ºä¾‹çš„appï¼ˆé¢ï¼Œåå­—æ˜¯æœ‰ç‚¹ç»•ï¼‰</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š4.7Kä¸ªstarï¼ŒJakeWhartonç‰µå¤´å¼€å‘çš„æ•™å­¦ç±»appï¼Œæ•™ä½ ä½¿ç”¨Daggeråœ¨å…¶ä»–é«˜çº§æ¡†æ¶çš„ç”¨æ³•ï¼Œå®ƒå±•ç¤ºäº†Daggerä¸ButterKnifeã€Retrofitã€Moshiã€Picassoã€Okhttpã€RxJavaã€Timberã€Madgeã€LeakCanarç­‰ä¼—å¤šä¼˜ç§€æ¡†æ¶ç»“åˆèµ·æ¥çš„é«˜çº§ç”¨æ³•ï¼Œä½ ä¹Ÿå¯ä»¥å€Ÿé‰´åˆ°è‡ªå·±çš„é¡¹ç›®å½“ä¸­</p><ul><li>githubï¼š<a href="https://github.com/JakeWharton/u2020" target="_blank" rel="noopener">https://github.com/JakeWharton/u2020</a></li><li>ä½œè€…ï¼šJakeWharton</li></ul><h5 id="55-buck"><a href="#55-buck" class="headerlink" title="55.buck"></a>55.buck</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šbuckæ˜¯ä¸€ä¸ªå¿«é€Ÿæ„å»ºç³»ç»Ÿ</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šfacebook+googleå‡ºèº«çš„ä½œè€…ï¼Œå¯¹æ„å»ºä»£ç çš„å‡ºè‰²ç†è§£ï¼ŒåŠ ä¸Šå¤§å‹å›¢é˜Ÿçš„ç»´æŠ¤ï¼Œä»¥åŠå¢é‡æ›´æ–°æ—¶çš„å¿«é€Ÿé«˜æ•ˆï¼Œè®©buckæˆä¸ºäº†å¾®ä¿¡Androidå›¢é˜Ÿæ„å»ºé¡¹ç›®çš„é¦–é€‰ï¼Œæ„å»ºå¤§å‹é¡¹ç›®æ—¶ï¼Œå®ƒæ¯”gradleæ›´å¿«ï¼Œç„¶è€Œä¸­å°å…¬å¸å¹¶ä¸é€‚åˆæ­¤æ¡†æ¶ï¼Œä½†ä½œä¸ºç«‹å¿—åœ¨æ¡†æ¶è®¾è®¡é¢†åŸŸæœ‰ä¸€ç•ªä½œä¸ºçš„äººä»¬ï¼Œæ¬¢è¿æ¥ä¸€æ¢ç©¶ç«Ÿ</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="https://buckbuild.com/" target="_blank" rel="noopener">https://buckbuild.com/</a></li><li>githubï¼š<a href="https://github.com/facebook/buck" target="_blank" rel="noopener">https://github.com/facebook/buck</a></li><li>ä½œè€…ï¼šfacebook</li></ul><h5 id="ä½¿ç”¨ï¼š-42"><a href="#ä½¿ç”¨ï¼š-42" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>linux or mac system  +docs</p><h5 id="56-PermissionsDispatcher"><a href="#56-PermissionsDispatcher" class="headerlink" title="56.PermissionsDispatcher"></a>56.PermissionsDispatcher</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾åŸºäºæ³¨è§£çš„æä¾›è§£å†³è¿è¡Œæ—¶å±é™©æƒé™æ–¹æ¡ˆçš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šè‡ªAndroid6.0 Googleæå‡ºå±é™©æƒé™ä¸€è¯èµ·ï¼Œç”¨æˆ·å®‰å…¨æ€§è¢«æåˆ°ä¸€å®šçš„é«˜åº¦ï¼Œä¸€äº›è¿è¡Œæ—¶å¯¹ç”¨æˆ·è¾ƒä¸ºå±é™©çš„æƒé™å°†ä¸å†è‡ªåŠ¨è¢«å¼€å‘è€…è·å–ï¼Œéœ€è¦ç»è¿‡ç”¨æˆ·æ‰¹å‡†ï¼Œå¼€å‘è€…æ‰å¯ä»¥ç»§ç»­ä½¿ç”¨è¯¥æƒé™ï¼Œå¦‚æœä½ æ›¾ç»è¢«æƒé™é—®é¢˜æçš„æŠ“è€³æŒ è…®ï¼Œå»ºè®®ä½ è¯•è¯•è¿™ä¸ªæ¡†æ¶ï¼Œå®ƒè¶³å¤Ÿè§£å†³ä½ çš„é—®é¢˜</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="https://hotchemi.github.io/PermissionsDispatcher/" target="_blank" rel="noopener">https://hotchemi.github.io/PermissionsDispatcher/</a></li><li>githubï¼š<a href="https://github.com/hotchemi/PermissionsDispatcher" target="_blank" rel="noopener">https://github.com/hotchemi/PermissionsDispatcher</a></li><li>ä½œè€…ï¼šShintaro Katafuchi</li></ul><h5 id="ä½¿ç”¨ï¼š-43"><a href="#ä½¿ç”¨ï¼š-43" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  compile(&apos;com.github.hotchemi:permissionsdispatcher:$&#123;latest.version&#125;&apos;) &#123;</span><br><span class="line">        exclude module: &quot;support-v13&quot;  </span><br><span class="line">  &#125;  </span><br><span class="line">  annotationProcessor &apos;com.github.hotchemi:permissionsdispatcher-processor:$&#123;latest.version&#125;&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">  jcenter()  </span><br><span class="line">  maven &#123; url &apos;http://oss.jfrog.org/artifactory/oss-snapshot-local/&apos; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="57-android-gif-drawable"><a href="#57-android-gif-drawable" class="headerlink" title="57.android-gif-drawable"></a>57.android-gif-drawable</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»:ä¸€æ¬¾æä¾›å±•ç¤ºGIFåŠ¨ç”»èƒ½åŠ›çš„è§†å›¾æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ®æˆ‘æ‰€æŸ¥å›½å†…è‘—åAppâ€”â€”çŸ¥ä¹ä½¿ç”¨äº†android-gif-drawableï¼Œå› æ­¤è¯æ˜äº†å®ƒçš„å­˜åœ¨ä»·å€¼ï¼Œå°½ç®¡åœ¨æ¦œå•ç¬¬åä¸€ä½ä»‹ç»äº†lottie-androidç›´æ¥åº”ç”¨AEåŠ¨ç”»çš„ç¤ºä¾‹ï¼Œä½†AEè®¾è®¡å¸ˆä¸æ˜¯æ¯ä¸ªå…¬å¸éƒ½é…å¤‡çš„ï¼ŒGIFçš„å­˜åœ¨ï¼Œå°±å¿…ç„¶å­˜åœ¨äº†å±•ç¤ºGIFçš„éœ€è¦ï¼Œå®ƒå€¼å¾—ä½ æ‹¥æœ‰ï¼</p><ul><li>githubï¼š<a href="https://github.com/koral--/android-gif-drawable" target="_blank" rel="noopener">https://github.com/koral--/android-gif-drawable</a></li><li>ä½œè€…ï¼šKarol WrÃ³tniak</li></ul><h5 id="ä½¿ç”¨ï¼š-44"><a href="#ä½¿ç”¨ï¼š-44" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    mavenCentral()    </span><br><span class="line">    maven &#123; url &quot;https://oss.sonatype.org/content/repositories/snapshots&quot; &#125;</span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;pl.droidsonroids.gif:android-gif-drawable:1.2.+&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="58-Apktool"><a href="#58-Apktool" class="headerlink" title="58.Apktool"></a>58.Apktool</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾åç¼–è¯‘apkçš„å·¥å…·</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå¼€æºçš„åç¼–è¯‘å·¥å…·ï¼Œå¯¹äºå¿—åœ¨äº†è§£apké€†å‘ç ´è§£çš„è¯¸ä½ï¼Œå€¼å¾—æ‹¥æœ‰ï¼Œ4.5kä¸ªstarï¼Œé€†å‘ç ´è§£apkç¥å™¨ï¼</p><ul><li>githubï¼š<a href="https://github.com/iBotPeaches/Apktool" target="_blank" rel="noopener">https://github.com/iBotPeaches/Apktool</a></li><li>å®˜ç½‘åœ°å€ï¼š<a href="https://ibotpeaches.github.io/Apktool/" target="_blank" rel="noopener">https://ibotpeaches.github.io/Apktool/</a></li><li>ä½œè€…ï¼šConnor Tumbleson</li></ul><h5 id="59-dynamic-load-apk"><a href="#59-dynamic-load-apk" class="headerlink" title="59.dynamic-load-apk"></a>59.dynamic-load-apk</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šæ’ä»¶åŒ–å¼€å‘æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š4.5kä¸ªstarï¼Œä½äºæ’ä»¶åŒ–å¼€å‘æ¡†æ¶ç¬¬äºŒåï¼ˆç¬¬ä¸€åæ¥è‡ª360å›¢é˜Ÿï¼‰ï¼Œå…¨é¢çš„æ–‡æ¡£ä»‹ç»è®©ä½ å¾ˆå¿«å°±èƒ½ä¸Šæ‰‹æ’ä»¶åŒ–å¼€å‘ï¼Œå¦‚æœä½ å–œæ¬¢å¤§æ®µæ–‡å­—è®²è§£ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡¹ç›®ä¸€å®šé€‚åˆä½ </p><ul><li>githubï¼š<a href="https://github.com/singwhatiwanna/dynamic-load-apk" target="_blank" rel="noopener">https://github.com/singwhatiwanna/dynamic-load-apk</a></li><li>ä½œè€…ï¼šsingwhatiwanna</li></ul><h5 id="ä½¿ç”¨ï¼š-45"><a href="#ä½¿ç”¨ï¼š-45" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>githubä¸Šçš„æ–‡æ¡£é…åˆä½œè€…åšå®¢æ›´é…å“Ÿ</p><h5 id="60-atlas"><a href="#60-atlas" class="headerlink" title="60.atlas"></a>60.atlas</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šæ·˜å®æ¨å‡ºçš„ç»„ä»¶åŒ–å¼€å‘æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ·˜å®å›¢é˜Ÿæ‰€å‡ºçš„ç²¾å“ï¼Œatlasæ¡†æ¶æä¾›äº†è§£è€¦ã€ç»„ä»¶ã€åŠ¨æ€çš„å¼€å‘èƒ½åŠ›ï¼Œ4.5kä¸ªstarè®©ä»–ä½åˆ—ç»„ä»¶åŒ–å¼€å‘æ¡†æ¶ç¬¬ä¸€å</p><ul><li>githubï¼š<a href="https://github.com/alibaba/atlas" target="_blank" rel="noopener">https://github.com/alibaba/atlas</a></li><li>ä½œè€…ï¼šalibaba</li></ul><h5 id="61-volley"><a href="#61-volley" class="headerlink" title="61.volley"></a>61.volley</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šgoogleæ¨èä½¿ç”¨çš„Androidç«¯ç½‘ç»œè¯·æ±‚æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š4.4kä¸ªstarï¼Œå¹¶ä¸æ˜¯ä»–ä¸å¤Ÿä¼˜ç§€ï¼Œè€Œæ˜¯ä½¿ç”¨volleyå·²ç»æ¸æ¸æˆä¸ºå¹¿å¤§å¼€å‘è€…çš„ä¹ æƒ¯</p><ul><li>githubï¼š<a href="https://github.com/google/volleyï¼ˆæ–°ç‰ˆvolleyåœ°å€ï¼‰" target="_blank" rel="noopener">https://github.com/google/volleyï¼ˆæ–°ç‰ˆvolleyåœ°å€ï¼‰</a></li><li>ä½œè€…ï¼šgoogle</li></ul><h5 id="ä½¿ç”¨ï¼š-46"><a href="#ä½¿ç”¨ï¼š-46" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>cloneæºç åˆ°æœ¬åœ°</p><h5 id="62-androidmvp"><a href="#62-androidmvp" class="headerlink" title="62.androidmvp"></a>62.androidmvp</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾å±•ç¤ºAndroidç«¯Mvpè®¾è®¡çš„demo</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ¦œå•é‡Œä¸ºæ•°ä¸å¤šã€ä»…å‡­å±•ç¤ºæŸç§è®¾è®¡æ¨¡å¼å°±è·å¾—4.2Kä¸ªstarçš„é¡¹ç›®ï¼Œå¦‚æœä½ æœ‰å°è¯•mvpçš„æ‰“ç®—ï¼Œandroidmvpå¯ä»¥ä½œä¸ºä½ çš„å‰å“¨ç«™</p><ul><li>githubï¼š<a href="https://github.com/antoniolg/androidmvp" target="_blank" rel="noopener">https://github.com/antoniolg/androidmvp</a></li><li>ä½œè€…ï¼šAntonio Leiva</li></ul><h5 id="ä½¿ç”¨ï¼š-47"><a href="#ä½¿ç”¨ï¼š-47" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>cloneåˆ°æœ¬åœ°</p><h5 id="63-SwipeBackLayout"><a href="#63-SwipeBackLayout" class="headerlink" title="63.SwipeBackLayout"></a>63.SwipeBackLayout</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»:ä¸€æ¬¾å¯ä»¥è®©ä½ é€šè¿‡æ»‘åŠ¨æ‰‹åŠ¿å…³é—­é¡µé¢çš„çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šä»¿å¾®ä¿¡æ»‘åŠ¨é€€å‡ºå½“å‰èŠå¤©ç•Œé¢çš„æ•ˆæœï¼Œæä¾›äº†activityçš„æ»‘åŠ¨å…³é—­èƒ½åŠ›ï¼Œé€šè¿‡è¿™ç§æ€è·¯ï¼Œå®ç°fragmentçš„æ»‘åŠ¨å…³é—­è½»è€Œæ˜“ä¸¾;ç¬”è€…åšæŒå»ºè®®è¯¸ä½cloneæºç åˆ°æœ¬åœ°æ¢ç´¢ä¸€ç•ªï¼›4.2kä¸ªstarè¯æ˜å¾ˆå¤šäººéƒ½å–œçˆ±å®ƒ</p><ul><li>githubï¼š<a href="https://github.com/ikew0ng/SwipeBackLayout" target="_blank" rel="noopener">https://github.com/ikew0ng/SwipeBackLayout</a></li><li>ä½œè€…ï¼šike_w0ng</li></ul><h5 id="ä½¿ç”¨-3"><a href="#ä½¿ç”¨-3" class="headerlink" title="ä½¿ç”¨:"></a>ä½¿ç”¨:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;me.imid.swipebacklayout.lib:library:1.0.0&apos;</span><br></pre></td></tr></table></figure><h5 id="64-FlycoTabLayout"><a href="#64-FlycoTabLayout" class="headerlink" title="64.FlycoTabLayout"></a>64.FlycoTabLayout</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾å¯ä»¥è®©ä½œå‡ºå¤šç§å¤šæ ·æŒ‡ç¤ºå™¨æ•ˆæœçš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå°½ç®¡æˆ‘ä»¬æ²¡æœ‰ç†ç”±ä¸ºäº†ç»™appåŠ å…¥é¡µé¢æŒ‡ç¤ºå™¨åŠŸèƒ½å°±é›†æˆ2.5Mçš„ä¾èµ–åº“ï¼Œä½†æ˜¯ä½œä¸ºäº†è§£viewpageræˆ–swip viewsçš„æŒ‡ç¤ºå™¨è®¾è®¡åŸç†çš„ä¼˜ç§€æ¡†æ¶ï¼Œä½ å€¼å¾—æ‰“å¼€å®ƒè¯•è¯•ï¼Œç¬”è€…å»ºè®®å•ç‹¬æ‹†åˆ†æ‰€éœ€æºç ï¼ŒåŠ å…¥åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­å»ã€‚4.1Kä¸ªstarï¼ŒäºŒæ¬¡å¼€å‘çš„ä½œå“ï¼Œä»ç„¶æ¨èï¼</p><ul><li>githubï¼š<a href="https://github.com/H07000223/FlycoTabLayout" target="_blank" rel="noopener">https://github.com/H07000223/FlycoTabLayout</a></li><li>ä½œè€…ï¼šFlyco</li></ul><h5 id="65-android-testing"><a href="#65-android-testing" class="headerlink" title="65.android-testing"></a>65.android-testing</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾å±•ç¤ºå››å¤§è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ç”¨ä¾‹çš„demoï¼ˆEspressoï¼ŒUiAutomatorï¼ŒAndroidJunitRunnerï¼ŒJUnit4ï¼‰</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå­¦ä¹ è€…ç»å¸¸ä¼šé™·å…¥ä¼¼æ‡‚éæ‡‚çš„å¢ƒåœ°ï¼Œå¦‚æœä½ æœ‰å¹¸å­¦ä¹ è¿‡Android Testing Support Library siteçš„è¯¾ç¨‹ï¼Œé‚£ä¹ˆä½ ä¸€å®šå¯¹androidçš„å››å¤§æµ‹è¯•æ¡†æ¶è¿«ä¸åŠå¾…ï¼Œè¿™æ¬¾demoéå¸¸é€‚åˆä½ ï¼Œå¿«æ¥å­¦ä¹ è¿™ä¸ª4.1kä¸ªstarçš„æ˜æ˜Ÿé¡¹ç›®å§</p><ul><li>githubï¼š<a href="https://github.com/googlesamples/android-testing" target="_blank" rel="noopener">https://github.com/googlesamples/android-testing</a></li><li>ä½œè€…ï¼šgooglesampeså›¢é˜Ÿ</li></ul><h5 id="66-FileDownloader"><a href="#66-FileDownloader" class="headerlink" title="66.FileDownloader"></a>66.FileDownloader</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾é«˜æ•ˆã€ç¨³å®šã€çµæ´»ã€æ˜“ç”¨çš„æ–‡ä»¶ä¸‹è½½å¼•æ“</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š4.1kè¯æ˜äº†å®ƒæœ‰å¤šå—äººå–œçˆ±ï¼Œæ–‡ä»¶ä¸‹è½½çœ‹ä¼¼ç®€å•çš„èƒŒåæš—è—äº†å¤šå°‘çš„å‘å‘ç‚¹ç‚¹ï¼Œæˆ‘çŸ¥é“ä½ æœ‰èƒ½åŠ›è‡ªå·±å®ç°æ–‡ä»¶ä¸‹è½½åŠŸèƒ½ï¼Œä½†ä¼˜ç§€çš„æ¡†æ¶å¯ä»¥æå‡ä½ çš„è®¾è®¡ç¼–ç èƒ½åŠ›ï¼Œè¿™æ¬¾æ¡†æ¶å¯ä»¥æå‡ä½ çš„å®åŠ›ï¼</p><ul><li>githubï¼š<a href="https://github.com/lingochamp/FileDownloader" target="_blank" rel="noopener">https://github.com/lingochamp/FileDownloader</a></li><li>ä½œè€…ï¼šLingoChampå›¢é˜Ÿ</li></ul><h5 id="ä½¿ç”¨ï¼š-48"><a href="#ä½¿ç”¨ï¼š-48" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;com.liulishuo.filedownloader:library:1.5.5&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="67-JieCaoVideoPlayer"><a href="#67-JieCaoVideoPlayer" class="headerlink" title="67.JieCaoVideoPlayer"></a>67.JieCaoVideoPlayer</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šåŸºäºMediaPlayer apiâ€”â€”VideoView çš„å¤šåª’ä½“æ’­æ”¾æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ¦œå•é‡Œç¬¬ä¸‰æ¬¾å¤šåª’ä½“æ’­æ”¾æ¡†æ¶ï¼Œå®ƒä»¥çµå·§çš„èº«å§¿æŒ¤å…¥æœ¬æ¦œå•ï¼Œç²¾å·§æ˜¯å®ƒæœ€å¤§çš„ä¼˜ç‚¹ï¼Œä¸åˆ°100kï¼Œæ‹¥æœ‰å®ƒï¼Œä½ å°±å¯ä»¥å¿«é€Ÿå¼€å‘ç±»ä¼¼ä»Šæ—¥å¤´æ¡é‚£æ ·çš„è§†é¢‘æ’­æ”¾æ•ˆæœï¼Œ4kä¸ªstarï¼Œè¯æ˜å®ƒå€¼å¾—ä¸€è¯•</p><ul><li>githubï¼š<a href="https://github.com/lipangit/JieCaoVideoPlayer" target="_blank" rel="noopener">https://github.com/lipangit/JieCaoVideoPlayer</a></li><li>ä½œè€…ï¼šNathen</li></ul><h5 id="ä½¿ç”¨ï¼š-49"><a href="#ä½¿ç”¨ï¼š-49" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;fm.jiecao:jiecaovideoplayer:5.5.4&apos;</span><br></pre></td></tr></table></figure><h5 id="68-glide-transformations"><a href="#68-glide-transformations" class="headerlink" title="68.glide-transformations"></a>68.glide-transformations</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸ºä¼—å¤šè‘—åå›¾ç‰‡åŠ è½½æ¡†æ¶æä¾›å›¾ç‰‡å½¢çŠ¶å˜å¹»èƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šåœ¨æ¦œå•é å‰çš„éƒ¨åˆ†å·²ç»ä»‹ç»è¿‡glideï¼ŒPicassoï¼ŒFrescoç­‰å›¾ç‰‡åŠ è½½æ¡†æ¶ï¼Œglide-transformationså°±æ˜¯ä¸€æ¬¾ä¸ºä»–ä»¬æä¾›å›¾ç‰‡å˜å½¢èƒ½åŠ›çš„æ¡†æ¶ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼Œå› æ­¤å—åˆ°äº†å¤§å®¶çš„å–œçˆ±ï¼Œgithubä¸Šæœ‰3.8Kä¸ªstar</p><ul><li>githubï¼š<a href="https://github.com/wasabeef/glide-transformations" target="_blank" rel="noopener">https://github.com/wasabeef/glide-transformations</a></li><li>ä½œè€…ï¼šDaichi Furiya</li></ul><h5 id="ä½¿ç”¨ï¼š-50"><a href="#ä½¿ç”¨ï¼š-50" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;jp.wasabeef:glide-transformations:2.0.2&apos;    </span><br><span class="line">    // If you want to use the GPU Filters    </span><br><span class="line">    compile &apos;jp.co.cyberagent.android.gpuimage:gpuimage-library:1.4.1&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨Glideé‡Œè®¾ç½®å˜å¹»æ•ˆæœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Set Glide Transform.</span><br><span class="line"></span><br><span class="line">Glide.with(this).load(R.drawable.demo) </span><br><span class="line">       .bitmapTransform(new BlurTransformation(context))        </span><br><span class="line">       .into((ImageView) findViewById(R.id.image));</span><br></pre></td></tr></table></figure><h5 id="69-android-gpuimage"><a href="#69-android-gpuimage" class="headerlink" title="69.android-gpuimage"></a>69.android-gpuimage</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾åŸºäºOpenGLçš„å›¾ç‰‡æ¸²æŸ“å¼•æ“</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ”¾ä¸‹GpuImageåœ¨IOSå¹³å°çš„è£èª‰ä¸è°ˆï¼ŒAndroidç‰ˆçš„android-gpuimageå°±æä¾›å¤šè¾¾70å¤šç§å›¾ç‰‡æ¸²æŸ“æ•ˆæœï¼Œä½ è¿˜åœ¨å¥½å¥‡ç¾å›¾ç§€ç§€æ˜¯å¦‚ä½•å®ç°å›¾ç‰‡å˜å¹»çš„ï¼Ÿæœ‰äº†å®ƒï¼Œä¸€åˆ‡éƒ½ä¸æ˜¯é—®é¢˜ã€‚å¦‚æœä½ æ˜¯ç¾å›¾å·¥å…·ç±»çš„å·¥ç¨‹å¸ˆï¼Œæ­¤æ¡†æ¶çš„å»ºè®¾æ€è·¯ä¹Ÿä¼šå¯¹ä½ å¤§æœ‰è£¨ç›Šã€‚ç¬”è€…ä¹Ÿæ˜¯é€šè¿‡android-gpuimageä»¿é€ äº†ç¾å›¾Appå¹¶ä¿˜è·å¥³å‹èŠ³å¿ƒçš„ï¼Œå†æ¬¡ä¸ºå®ƒçš„å®åŠ›ç‚¹èµã€‚iosç‰ˆ+androidç‰ˆä¸€å…±19kä¸ªstarï¼Œå·²ç»è¯æ˜äº†å®ƒçš„å®åŠ›ï¼Œè¿˜åœ¨ç­‰ä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>githubï¼š<a href="https://github.com/CyberAgent/android-gpuimage" target="_blank" rel="noopener">https://github.com/CyberAgent/android-gpuimage</a></li><li>ä½œè€…ï¼šCyberAgent å›¢é˜Ÿ</li></ul><h5 id="ä½¿ç”¨ï¼š-51"><a href="#ä½¿ç”¨ï¼š-51" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;jp.co.cyberagent.android.gpuimage:gpuimage-library:1.4.1&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´å¤šçš„æ”¹é€ æ–¹æ³•ï¼Œè¿˜éœ€è¦é˜…è¯»Iosçš„ç¼–ç¨‹æ–‡æ¡£ï¼Œå¯¹äºæœ‰æ¯…åŠ›çš„å°ä¼™ä¼´å¼ºåŠ›æ¨èï¼</p><h5 id="70-RxPermissions"><a href="#70-RxPermissions" class="headerlink" title="70.RxPermissions"></a>70.RxPermissions</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾åŸºäºRxJavaå®Œæˆæƒé™ç”³è¯·çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ¦œå•é‡Œç¬¬äºŒæ¬¾æä¾›æƒæœåŠ¡çš„æ¡†æ¶ï¼ŒåŸºäºRxJavaçš„è®¾è®¡ï¼Œè®©ä½ å¯ä»¥ä¸“å¿ƒå†™ä¸šåŠ¡ï¼Œ3.7Kä¸ªstarå·²ç»è¯æ˜äº†å®ƒçš„å®ç”¨ä»·å€¼</p><ul><li>githubï¼š<a href="https://github.com/tbruyelle/RxPermissions" target="_blank" rel="noopener">https://github.com/tbruyelle/RxPermissions</a></li><li>ä½œè€…ï¼šThomas Bruyelle</li></ul><h5 id="ä½¿ç”¨ï¼š-52"><a href="#ä½¿ç”¨ï¼š-52" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    jcenter() // If not already there</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;com.tbruyelle.rxpermissions:rxpermissions:0.9.4@aar&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼˜é›…çš„ä½¿ç”¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RxPermissions rxPermissions = new RxPermissions(this); </span><br><span class="line"></span><br><span class="line">rxPermissions</span><br><span class="line">    .request(Manifest.permission.CAMERA)    </span><br><span class="line">    .subscribe(granted -&gt; &#123;   </span><br><span class="line">        if (granted) &#123; // I can control the camera now        </span><br><span class="line">        &#125; else &#123;       </span><br><span class="line">           // Oups permission denied       </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h5 id="71-freeline"><a href="#71-freeline" class="headerlink" title="71.freeline"></a>71.freeline</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾åŠ¨æ€æ›¿æ¢çš„ç¼–è¯‘æ„å»ºæ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šç»§Facebookçš„Buckï¼ŒAndrodiå®˜æ–¹çš„InstRunä¹‹åï¼Œèš‚èšé‡‘æœæ¨å‡ºäº†Freelineç¼–è¯‘æ¡†æ¶ï¼Œå®˜ç½‘å®£ç§°Freelineä¸ä¸šå†…ä¸»æµæ„å»ºæ–¹å¼ç›¸æ¯”ä»ç„¶æœ‰æ•°å€çš„é€Ÿåº¦é¢†å…ˆ;æ’è¡Œæœ‰å…ˆåï¼Œç¼–è¯‘é€Ÿåº¦å¹¶ä¸åœ¨æœ¬æ¦œå•æ’åºçš„è€ƒæ®å› ç´ ä¸­ï¼Œå› æ­¤freelineä»¥3.7ä¸ªstarï¼Œæš‚åˆ—ç¼–è¯‘æ¡†æ¶ç¬¬äºŒå</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="https://www.freelinebuild.com/" target="_blank" rel="noopener">https://www.freelinebuild.com/</a></li><li>githubï¼š<a href="https://github.com/alibaba/freeline" target="_blank" rel="noopener">https://github.com/alibaba/freeline</a></li><li>ä½œè€…ï¼šalibaba</li></ul><h5 id="ä½¿ç”¨ï¼š-53"><a href="#ä½¿ç”¨ï¼š-53" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;   </span><br><span class="line">        jcenter()   </span><br><span class="line">    &#125;    </span><br><span class="line">    dependencies &#123; </span><br><span class="line">       classpath &apos;com.antfortune.freeline:gradle:0.8.7&apos;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply plugin: &apos;com.antfortune.freeline&apos;</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>File â†’ Settingsâ€¦ â†’ Plugins â†’ Browse repositories â†’freeline.</p></blockquote><h5 id="72-RxLifecycle"><a href="#72-RxLifecycle" class="headerlink" title="72.RxLifecycle"></a>72.RxLifecycle</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›åœ¨ä½¿ç”¨RxJavaè¿‡ç¨‹ä¸­ç®¡ç†Activityå’ŒFragmentç”Ÿå‘½å‘¨æœŸèƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šåœ¨æ¦œå•é å‰çš„éƒ¨åˆ†ï¼Œä½ å·²ç»äº†è§£RxJavaå’ŒRxAndroidçš„å¼ºå¤§ä¹‹å¤„ï¼Œä½†éƒ¨åˆ†ç²—å¿ƒçš„å¼€å‘è€…å› ä¸ºæ²¡æœ‰åŠæ—¶å–æ¶ˆè®¢é˜…è€Œäº§ç”Ÿä¸¥é‡çš„å†…å­˜æ³„æ¼ï¼Œä¸è¦æ‹…å¿ƒï¼ŒRxLifecycleå¯ä»¥ä¸ºä½ è§£å†³éš¾é¢˜ï¼Œåœ¨gtihubä¸Šæ‹¥æœ‰3.7Kä¸ªstarï¼Œå›½å†…çŸ¥åè½¯ä»¶â€”â€”çŸ¥ä¹å’Œæ·˜å®ä¹Ÿéƒ½åœ¨ä½¿ç”¨å®ƒ</p><ul><li>githubï¼š<a href="https://github.com/trello/RxLifecycle" target="_blank" rel="noopener">https://github.com/trello/RxLifecycle</a></li><li>ä½œè€…ï¼štrelloå›¢é˜Ÿ</li></ul><h5 id="ä½¿ç”¨ï¼š-54"><a href="#ä½¿ç”¨ï¼š-54" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>cloneæºç åˆ°æœ¬åœ°</p><h5 id="73-classyshark"><a href="#73-classyshark" class="headerlink" title="73.classyshark"></a>73.classyshark</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾å¯æ‰§è¡Œæ–‡ä»¶æµè§ˆå™¨</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ¦œå•é‡Œç»§Apktoolä¹‹åç¬¬äºŒæ¬¾apké€†å‘å·¥å…·ï¼Œå¦‚æœä½ å–œæ¬¢ä¼˜é›…çš„å›¾å½¢æ•°æ®å±•ç¤ºï¼Œé‚£ä¹ˆä½ ä¸€å®šä¸èƒ½é”™è¿‡ä»–ï¼Œclassysharkå¯ä»¥å°†ç ´è§£çš„ç»“æœä»¥å›¾å½¢åŒ–å±•ç¤ºç”¨æˆ·ï¼Œæ–¹ä¾¿åˆ†æï¼Œ3.7Kä¸ªstarï¼Œè®©å®ƒæš‚åˆ—apké€†å‘å·¥å…·ç¬¬äºŒä½ï¼</p><ul><li>githubï¼š<a href="https://github.com/google/android-classyshark" target="_blank" rel="noopener">https://github.com/google/android-classyshark</a></li><li>ä½œè€…ï¼šgoogle</li></ul><h5 id="ä½¿ç”¨ï¼š-55"><a href="#ä½¿ç”¨ï¼š-55" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>ä¸‹è½½ JAR</p><h5 id="74-acra"><a href="#74-acra" class="headerlink" title="74.acra"></a>74.acra</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›è®°å½•APPå´©æºƒæ—¥å¿—èƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå¦‚æœä½ é¢ä¸´ç€æ”¶é›†APPå´©æºƒæ—¥å¿—çš„éœ€æ±‚ï¼Œé‚£ä¹ˆacraæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚3.7Kä¸ªstarï¼Œè®©acraä½åˆ—å´©æºƒæ—¥å¿—æ¡†æ¶æ’è¡Œæ¦œç¬¬ä¸€åï¼Œacraæœ‰è¶³å¤Ÿçš„èƒ½åŠ›è®°å½•çº¿ä¸ŠAPPï¼Œå¹¶ä¸”å‘å›æœåŠ¡ç«¯ï¼Œacraä¹Ÿæä¾›äº†ç›¸å½“æ£’çš„å´©æºƒæ—¥å¿—ç»Ÿè®¡æœåŠ¡ç«¯æ¡†æ¶Acralyzerï¼Œcralyzerå·¥ä½œåœ¨Apache CouchDBä¹‹ä¸Šï¼Œæ‰€ä»¥é™¤äº†CouchDBä¹‹å¤–ï¼Œæ²¡æœ‰å¿…è¦å®‰è£…ä»»ä½•é¢å¤–çš„è½¯ä»¶ï¼Œç§»åŠ¨ç«¯å¼€å‘è€…ä¹Ÿå¯ä»¥å€Ÿæ­¤å­¦ä¹ æœåŠ¡ç«¯çš„å»ºè®¾ï¼Œä¸€ä¸¾ä¸¤å¾—ï¼</p><ul><li>githubï¼š<a href="https://github.com/ACRA/acra" target="_blank" rel="noopener">https://github.com/ACRA/acra</a></li><li>æœåŠ¡ç«¯githubï¼š<a href="https://github.com/ACRA/acralyzer" target="_blank" rel="noopener">https://github.com/ACRA/acralyzer</a></li><li>ä½œè€…ï¼šacraå›¢é˜Ÿ</li></ul><h5 id="ä½¿ç”¨ï¼š-56"><a href="#ä½¿ç”¨ï¼š-56" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•æ¯”cloneæºç åˆ°æœ¬åœ°æ›´æ–¹ä¾¿äº†</p><h5 id="75-DiskLruCache"><a href="#75-DiskLruCache" class="headerlink" title="75.DiskLruCache"></a>75.DiskLruCache</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›ç£ç›˜æ–‡ä»¶ç¼“å­˜ç®¡ç†èƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š3.7kä¸ªstarå¹¶ä¸è¶³ä»¥è¯´æ˜DiskLruCacheçš„ä¼˜ç§€ï¼Œä»…ä»…ä»¥ç®¡ç†ç£ç›˜æ–‡ä»¶èƒ½åŠ›å•ç‹¬æ‹å‡ºæ¥æˆä¸ºä¸€ä¸ªæ¡†æ¶ï¼Œä½œè€…éœ€è¦å¾ˆå¤§çš„å‹‡æ°”ï¼Œå¾ˆå¹¸è¿ï¼Œä½œè€…åšåˆ°äº†ï¼Œå¹¶ä¸”ä¹Ÿæˆä¸ºGoogleå®˜ç½‘æå€¡çš„ç¼“å­˜  ï¼›å¦‚è¿˜è®°å¾—ä¸Šæ¬¡åšâ€œä¸€é”®æ¸…é™¤ç¼“å­˜â€ã€â€œæŸ¥çœ‹ç¼“å­˜æ–‡ä»¶å¤§å°â€åŠŸèƒ½æ˜¯ä»€ä¹ˆæ—¶å€™å—ï¼ŸDiskLruCacheä¸€å¥è¯å°±å¯ä»¥æå®šï¼</p><ul><li>githubï¼š<a href="https://github.com/JakeWharton/DiskLruCache" target="_blank" rel="noopener">https://github.com/JakeWharton/DiskLruCache</a></li><li>ä½œè€…ï¼šJakeWharton</li></ul><h5 id="ä½¿ç”¨ï¼š-57"><a href="#ä½¿ç”¨ï¼š-57" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.jakewharton:disklrucache:2.0.2&apos;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä¸‹è½½ latest .jar</p><h5 id="76-dexposed"><a href="#76-dexposed" class="headerlink" title="76.dexposed"></a>76.dexposed</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æ”¯æ’‘é˜¿é‡Œå¤§éƒ¨åˆ†Appå®¢æˆ·ç«¯çƒ­ä¿®å¤ã€çº¿ä¸Šè°ƒè¯•èƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ¦œå•ä¸Šå†æ¬¡å‡ºç°çƒ­ä¿®å¤æ¡†æ¶çš„èº«å½±ï¼Œè¯æ˜Appçƒ­ä¿®å¤æŠ€æœ¯çš„ç«çƒ­ï¼Œdexposedæä¾›å›¾å½¢åŒ–çš„æ€§èƒ½ç›‘æ§ã€åœ¨çº¿çƒ­ä¿®å¤bugæ¼æ´ã€æ”¯æŒAOPç¼–ç¨‹æ€æƒ³ç­‰ï¼Œä¸è®ºä½ æ˜¯ä¼ä¸šçƒ­ä¿®å¤æŠ€æœ¯çš„è®¾è®¡è€…è¿˜æ˜¯æ‰“ç®—åœ¨çƒ­ä¿®å¤é¢†åŸŸä¸€æ¢ç©¶ç«Ÿçš„æ–°äººï¼Œè¿™æ¬¾æ¡†æ¶å¾ˆé€‚åˆä½ ã€‚3.5kä¸ªstarï¼Œè¯æ˜å®ƒä½œä¸ºä¸€é—¨æŠ€æœ¯æ¡†æ¶çš„å­˜åœ¨ï¼Œæ˜¯å¤šä¹ˆä»¤äººå–œçˆ±ï¼</p><ul><li>githubï¼š<a href="https://github.com/alibaba/dexposed" target="_blank" rel="noopener">https://github.com/alibaba/dexposed</a></li><li>ä½œè€…ï¼šalibaba</li></ul><h5 id="ä½¿ç”¨ï¼š-58"><a href="#ä½¿ç”¨ï¼š-58" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">        compile &apos;com.taobao.android:dexposed:0.1.1@aar&apos;  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h5 id="77-Litho"><a href="#77-Litho" class="headerlink" title="77.Litho"></a>77.Litho</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›é«˜æ•ˆæ„å»ºUIèƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šä½œä¸ºä¸€æ¬¾ä¸“é—¨æ„å»ºUIçš„æ¡†æ¶ï¼ŒLithoé«˜æ•ˆçš„åœ°æ–¹åœ¨äºï¼šå•ç‹¬å¼€è¾Ÿäº†ç”¨äºæ¸²æŸ“å’Œå¸ƒå±€çš„çº¿ç¨‹ï¼Œç„¶åå°†åˆ›å»ºå¥½çš„ç»„ä»¶ä¼ é€’ç»™UIçº¿ç¨‹å»å®Œæˆæœ€ç»ˆçš„æ¸²æŸ“ï¼Œä½¿ç”¨æ›´å°‘çš„è§†å›¾å±‚çº§ï¼Œæ¥æå‡ç•Œé¢çš„æ»šåŠ¨é€Ÿåº¦ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå®ƒä»…æ”¯æŒå¼€å‘è€…ä½œå‡ºä¸å¯æ”¹å˜çš„UIç»„ä»¶ ,3.5Kä¸ªstarï¼Œè¯æ˜äº†å®ƒåœ¨æ„å»ºUIé¢†åŸŸçš„ä»·å€¼ï¼Œæ›´å¤šçš„å¦™å¤„ï¼ŒæœŸå¾…ä½ äº²è‡ªå»å‘æ˜ï¼</p><ul><li>githubï¼š<a href="https://github.com/facebook/litho" target="_blank" rel="noopener">https://github.com/facebook/litho</a></li><li>ä½œè€…ï¼šfacebook</li></ul><h5 id="ä½¿ç”¨ï¼š-59"><a href="#ä½¿ç”¨ï¼š-59" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  // ...  </span><br><span class="line">  // Litho  </span><br><span class="line">  compile &apos;com.facebook.litho:litho-core:0.3.1&apos;  </span><br><span class="line">  compile &apos;com.facebook.litho:litho-widget:0.3.1&apos;  </span><br><span class="line">  provided &apos;com.facebook.litho:litho-annotations:0.3.1&apos;  </span><br><span class="line"></span><br><span class="line">  annotationProcessor &apos;com.facebook.litho:litho-processor:0.3.1&apos;  </span><br><span class="line"></span><br><span class="line">  // SoLoader  </span><br><span class="line">  compile &apos;com.facebook.soloader:soloader:0.2.0&apos;  </span><br><span class="line"></span><br><span class="line">  // Optional  </span><br><span class="line">  // For debugging  </span><br><span class="line">  debugCompile &apos;com.facebook.litho:litho-stetho:0.3.1&apos;  </span><br><span class="line"></span><br><span class="line">  // For integration with Fresco  </span><br><span class="line">  compile &apos;com.facebook.litho:litho-fresco:0.3.1&apos;  </span><br><span class="line"></span><br><span class="line">  // For testing  </span><br><span class="line">  testCompile &apos;com.facebook.litho:litho-testing:0.3.1&apos;&#125;</span><br></pre></td></tr></table></figure><h5 id="78-mosby"><a href="#78-mosby" class="headerlink" title="78.mosby"></a>78.mosby</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›æ„å»ºMVPé¡¹ç›®èƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šæ¦œå•é å‰çš„éƒ¨åˆ†å·²ç»ä»‹ç»äº†MVC,MVVM,MVPçš„æ¡†æ¶é¡¹ç›®ï¼Œæƒ³å¿…æ­¤æ—¶ä½ åœ¨æ„å»ºä¼ä¸šé¡¹ç›®æ¶æ„ä¸Šï¼Œé€‰æ‹©æˆ–è€…å¼€å‘ä¸€æ¬¾åˆé€‚çš„MVPæ¡†æ¶è¿«åœ¨çœ‰ç«ï¼Œmosbyå¯ä»¥ä½œä¸ºä½ çš„ç¬¬ä¸€æ­¥å‚è€ƒï¼Œä½ å¯ä»¥å°è£…å®ƒï¼Œä¹Ÿå¯ä»¥ç…§æŠ„å®ƒï¼Œæ— è®ºå¦‚ä½•ï¼Œ3.4Kä¸ªstarï¼Œè¯æ˜äº†å®ƒåœ¨æ¡†æ¶è®¾è®¡ä¸Šæœ‰å¤šå—å¼€å‘è€…çš„å–œçˆ±</p><ul><li>githubï¼š<a href="https://github.com/sockeqwe/mosby" target="_blank" rel="noopener">https://github.com/sockeqwe/mosby</a></li><li>ä½œè€…ï¼šHannes Dorfmann</li></ul><h5 id="ä½¿ç”¨ï¼š-60"><a href="#ä½¿ç”¨ï¼š-60" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line"></span><br><span class="line">  compile &apos;com.hannesdorfmann.mosby3:mvi:3.0.4&apos; // Model-View-Intent  </span><br><span class="line">  // or  </span><br><span class="line">  compile &apos;com.hannesdorfmann.mosby3:mvp:3.0.4&apos; // Plain MVP  </span><br><span class="line">  // or  </span><br><span class="line">  compile &apos;com.hannesdorfmann.mosby3:viewstate:3.0.4&apos; // MVP + ViewState support</span><br><span class="line">&#125;</span><br><span class="line">allprojects &#123;</span><br><span class="line">  repositories &#123;</span><br><span class="line">      ...    </span><br><span class="line"></span><br><span class="line">      maven &#123; url &quot;https://oss.sonatype.org/content/repositories/snapshots/&quot; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="79-AndResGuard"><a href="#79-AndResGuard" class="headerlink" title="79.AndResGuard"></a>79.AndResGuard</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›èµ„æºæ–‡ä»¶è·¯å¾„æ··æ·† çš„å·¥å…·</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå¦‚æœä½ æ˜¯ä¸ªå¯¹APKå¤§å°å¾ˆæ•æ„Ÿçš„äººï¼Œé‚£ä¹ˆAndResGuardä¸€å®šé€‚åˆä½ ï¼Œå®ƒçš„åŸç†ç±»ä¼¼Java Proguardï¼Œä½†æ˜¯åªé’ˆå¯¹èµ„æºã€‚ä»–ä¼šå°†åŸæœ¬å†—é•¿çš„èµ„æºè·¯å¾„å˜çŸ­ï¼Œä¾‹å¦‚å°†res/drawable/wechatå˜ä¸ºr/d/aï¼Œ3.4Kä¸ªstarï¼Œè¯æ˜äº†åœ¨ä¼˜åŒ–APKé“è·¯ä¸Šï¼Œä½ ä¸æ˜¯ä¸€ä¸ªäººåœ¨æˆ˜æ–—ï¼</p><ul><li>githubï¼š<a href="https://github.com/shwenzhang/AndResGuard" target="_blank" rel="noopener">https://github.com/shwenzhang/AndResGuard</a></li><li>ä½œè€…ï¼šwechat team</li></ul><h5 id="ä½¿ç”¨ï¼š-61"><a href="#ä½¿ç”¨ï¼š-61" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>cloneé¡¹ç›®åˆ°æœ¬åœ°ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ä¸ªä¸‰ä¸¤å¥è¯çš„æ–‡æ¡£</p><h5 id="80-StatusBarUtil"><a href="#80-StatusBarUtil" class="headerlink" title="80.StatusBarUtil"></a>80.StatusBarUtil</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›è®¾ç½®æ²‰æµ¸å¼çŠ¶æ€æ æ ·å¼èƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šè®¾è®¡å¸ˆMMæ€»æ˜¯æŠ±æ€¨ç³»ç»ŸçŠ¶æ€æ ä¸ä¼˜é›…ï¼Ÿé‚£å°±ç»™å¥¹ä¸€ä¸ªå®Œç¾çš„æ²‰æµ¸å¼çŠ¶æ€æ ã€‚StatusBarUtilå¯ä»¥éšå¿ƒæ‰€æ¬²çš„è®¾ç½®çŠ¶æ€æ æ ·å¼ï¼Œ3.3Kä¸ªstarï¼Œè¶³ä»¥è¯´æ˜å®ƒæœ‰å¤šå—è®¾è®¡MMçš„å–œçˆ±</p><ul><li>githubï¼š<a href="https://github.com/laobie/StatusBarUtil" target="_blank" rel="noopener">https://github.com/laobie/StatusBarUtil</a></li><li>ä½œè€…ï¼šJaeger</li></ul><h5 id="ä½¿ç”¨ï¼š-62"><a href="#ä½¿ç”¨ï¼š-62" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.jaeger.statusbarutil:library:1.4.0&apos;</span><br></pre></td></tr></table></figure><h5 id="81-robolectric"><a href="#81-robolectric" class="headerlink" title="81.robolectric"></a>81.robolectric</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾ä¸ä¾èµ–äºAndroidè®¾å¤‡çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œ</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šsampleä¸­åˆ—ä¸¾äº†å¦‚ä½•å¯¹Androidå››å¤§ç»„ä»¶å’Œå¸¸è§åŠŸèƒ½æµ‹è¯•çš„ç”¨ä¾‹ï¼Œ3.2Kä¸ªstarï¼Œå€¼å¾—å……æ»¡å¥½å¥‡å¿ƒçš„äººå°è¯•</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://robolectric.org/" target="_blank" rel="noopener">http://robolectric.org/</a></li><li>githubï¼š<a href="https://github.com/robolectric/robolectric" target="_blank" rel="noopener">https://github.com/robolectric/robolectric</a></li><li>ä½œè€…ï¼šrobolectric</li></ul><h5 id="ä½¿ç”¨ï¼š-63"><a href="#ä½¿ç”¨ï¼š-63" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testCompile &quot;org.robolectric:robolectric:3.3.2&quot;</span><br></pre></td></tr></table></figure><h5 id="82-Fragmentation"><a href="#82-Fragmentation" class="headerlink" title="82.Fragmentation"></a>82.Fragmentation</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»:ä¸€æ¬¾æä¾›ç®¡ç†FragmenåµŒå¥—tèƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå¯¹äºActivityå’ŒFragmentä½¿ç”¨ï¼Œä½ ä¸€å®šå¾—å¿ƒåº”æ‰‹ï¼Œä½†å¦‚æœè¦åšä¸€å¥—é€šç”¨çš„Activity&amp;FragmentåµŒå¥—è®¾è®¡ï¼Œæƒ³å¿…ä½ æœ‰ç‚¹æ‰‹è¶³æ— æªäº†ï¼ŒFragmentationå¯ä»¥ä½œä¸ºä½ è®¾è®¡Fragmentç®¡ç†ä¸Šçš„ç¬¬ä¸€æ­¥ï¼Œ3.2Kä¸ªstarï¼Œç¬”è€…è®¤ä¸ºæœ‰ç‚¹åå‰¯å…¶å®äº†ï¼Œé¡¹ç›®ä»‹ç»é‡Œè¯´çš„æ˜¯Fragmentçš„ç®¡ç†èƒ½åŠ›ï¼Œä½†å¹¶æœªæä¾›Fragment&amp;Activityç”Ÿå‘½å‘¨æœŸã€ä»»åŠ¡æ ˆçš„ç®¡ç†èƒ½åŠ›ï¼Œå› æ­¤å¾ˆéš¾ç›´æ¥åº”ç”¨åˆ°ä¼ä¸šé¡¹ç›®å½“ä¸­ï¼Œä½†æºç å½“ä¸­çš„è®¾è®¡æ€è·¯ï¼Œå€¼å¾—ç¬”è€…ä¸è¯¸ä½å€Ÿé‰´ï¼Œæ‹¾äººç‰™æ…§ç•™æœ‰ä½™é¦™ï¼</p><ul><li>githubï¼š<a href="https://github.com/YoKeyword/Fragmentation" target="_blank" rel="noopener">https://github.com/YoKeyword/Fragmentation</a></li><li>ä½œè€…ï¼šYoKey</li></ul><h5 id="ä½¿ç”¨ï¼š-64"><a href="#ä½¿ç”¨ï¼š-64" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// appcompat v7åŒ…æ˜¯å¿…é¡»çš„compile â€˜me.yokeyword:fragmentation:0.10.7â€™// å¦‚æœæƒ³ä½¿ç”¨SwipeBack æ»‘åŠ¨è¾¹ç¼˜é€€å‡ºFragment/ActivityåŠŸèƒ½ï¼Œè¯·å†æ·»åŠ ä¸‹é¢çš„åº“// compile â€˜me.yokeyword:fragmentation-swipeback:0.10.4â€™</span><br></pre></td></tr></table></figure><h5 id="83-Small"><a href="#83-Small" class="headerlink" title="83.Small"></a>83.Small</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šè½»å·§çš„æ’ä»¶åŒ–æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šä½œä¸ºæ’ä»¶æ¡†æ¶æ¦œå•çš„æ–°æˆå‘˜ï¼ŒSmallçš„ä¼˜ç‚¹æ˜¯è½»å·§ï¼Œé€‚åˆä½œä¸ºå°å›¢é˜Ÿçš„æ’ä»¶å¼€å‘æ–¹æ¡ˆï¼Œ3.1Kä¸ªstarï¼Œè®©å®ƒè·å¾—äº†é…·ç‹—éŸ³ä¹ç­‰è‘—åå¼€å‘å›¢é˜Ÿçš„é’çï¼Œå¦‚æœä½ ä»¬çš„å›¢é˜Ÿæƒ³é€æ­¥å®æ–½æ’ä»¶åŒ–å¼€å‘ï¼ŒSmallæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="http://code.wequick.net/Small/cn/cases" target="_blank" rel="noopener">http://code.wequick.net/Small/cn/cases</a></li><li>githubï¼š<a href="https://github.com/wequick/Small" target="_blank" rel="noopener">https://github.com/wequick/Small</a></li><li>ä½œè€…ï¼šwequick å›¢é˜Ÿ</li></ul><h5 id="ä½¿ç”¨ï¼š-65"><a href="#ä½¿ç”¨ï¼š-65" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">buildscript  &#123;</span><br><span class="line">    dependencies &#123;  </span><br><span class="line">          classpath &apos;net.wequick.tools.build:gradle-small:1.2.0-alpha6&apos;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply plugin: &apos;net.wequick.small&apos;small &#123; </span><br><span class="line">   aarVersion = &apos;1.2.0-alpha6&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="84-JsBridge"><a href="#84-JsBridge" class="headerlink" title="84.JsBridge"></a>84.JsBridge</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›WebViewå’ŒJavascripté€šä¿¡èƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šè¯¥æ¡†æ¶æä¾›ç»™äº†å…è®¸H5é¡µé¢è°ƒç”¨é€šè¿‡JSè°ƒç”¨Appæ–¹æ³•çš„èƒ½åŠ›ï¼›3.1Kä¸ªstarï¼Œç®€æ´çš„é€šè®¯æ–¹å¼ï¼Œå€¼å¾—æ¯ä¸€ä¸ªWebHybrid Appå¼€å‘è€…å°è¯•</p><ul><li>gtihubï¼š<a href="https://github.com/lzyzsd/JsBridge" target="_blank" rel="noopener">https://github.com/lzyzsd/JsBridge</a></li><li>ä½œè€…ï¼šhiå¤§å¤´é¬¼hi</li></ul><h5 id="ä½¿ç”¨ï¼š-66"><a href="#ä½¿ç”¨ï¼š-66" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    // ...    </span><br><span class="line">    maven &#123; url &quot;https://jitpack.io&quot; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123; </span><br><span class="line">   compile &apos;com.github.lzyzsd:jsbridge:1.0.4&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="85-richeditor-android"><a href="#85-richeditor-android" class="headerlink" title="85.richeditor-android"></a>85.richeditor-android</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾å¼ºå¤§çš„å¯Œæ–‡æœ¬ç¼–è¾‘æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š2.8kä¸ªstarï¼Œæ¦œå•é‡Œç¬¬ä¸€ä¸ªä¸ºTextViewæä¾›æ‰©å±•èƒ½åŠ›çš„æ¡†æ¶ï¼Œä½ æš‚æ—¶ä¸éœ€è¦å®ƒï¼Œä½†ä¸èƒ½ä¸çŸ¥é“å®ƒ</p><ul><li>githubï¼š<a href="https://github.com/wasabeef/richeditor-android" target="_blank" rel="noopener">https://github.com/wasabeef/richeditor-android</a></li><li>ä½œè€…ï¼šDaichi Furiya</li></ul><h5 id="ä½¿ç”¨ï¼š-67"><a href="#ä½¿ç”¨ï¼š-67" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;jp.wasabeef:richeditor-android:1.2.2&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="86-Transitions-Everywhere"><a href="#86-Transitions-Everywhere" class="headerlink" title="86.Transitions-Everywhere"></a>86.Transitions-Everywhere</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æ•™ä½ æ­£ç¡®ä½¿ç”¨Transitions APIï¼ˆAndroid è½¬åœºåŠ¨ç”»APIï¼‰çš„æ•™å­¦å‹é¡¹ç›®</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šä½ å¯èƒ½è¿˜æœªå°è¯•è¿‡Android APIçš„Transitions æ¡†æ¶ï¼Œå¯èƒ½å¬è¿‡ï¼Œä½†å´æ— æ³•åšå‡ºä¼˜é›…å¥‡å¦™çš„åŠ¨æ•ˆâ€”â€”åˆ«æ‹…å¿ƒï¼ŒTransitions-Everywhereæ­£å¦‚å®ƒçš„åå­—ä¸€æ ·ï¼Œå®ƒå°†å¸¦ä½ å…¨é¢ä½“éªŒTransitions çš„å¼ºå¤§ä¹‹å¤„</p><ul><li>githubï¼š<a href="https://github.com/andkulikov/Transitions-Everywhere" target="_blank" rel="noopener">https://github.com/andkulikov/Transitions-Everywhere</a></li><li>ä½œè€…ï¼šAndrey Kulikov</li></ul><h5 id="ä½¿ç”¨ï¼š-68"><a href="#ä½¿ç”¨ï¼š-68" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile &quot;com.andkulikov:transitionseverywhere:1.7.4&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="87-android-viewbadger"><a href="#87-android-viewbadger" class="headerlink" title="87.android-viewbadger"></a>87.android-viewbadger</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šèƒ½å¤Ÿå¿«é€Ÿçš„ä¸ºAndroid è§†å›¾åŠ å…¥â€œå‹‹ç« â€èƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå¦‚æœè¯´å‹‹ç« ä¸€è¯å¬èµ·æ¥é™Œç”Ÿï¼Œé‚£ä¹ˆæ˜¾ç¤ºå·²è¯»æœªè¯»ä¸ªæ•°ã€å°çº¢ç‚¹æ ‡è®°ä¿¡æ¯è¿™ä¸€ç±»è¯è¯­ä½ ä¸€å®šä¸å¤ªé™Œç”Ÿï¼Œç¬”è€…ç›¸ä¿¡åœ¨è¯¸ä½å®é™…å¼€å‘ä¸­ç»å¸¸é‡åˆ°ä¸ºæŸäº›itemåŠ å…¥å°çº¢ç‚¹æ ‡è®°çš„éœ€æ±‚ï¼Œèªæ˜çš„å„ä½ä¸€å®šæœ‰ç€å„ç§å®ç°æ–¹æ¡ˆï¼Œä¸ºä»€ä¹ˆä¸èƒ½å¿«é€Ÿä¼˜é›…çš„å®Œæˆå‘¢ï¼Ÿandroid-viewbadgerå¯ä»¥å¸®ä½ å®ç°ï¼Œå½“ç„¶ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦å…·å¤‡ä¿®æ”¹æºç çš„èƒ½åŠ›ï¼Œä»¥ç¬¦åˆè®¾è®¡MMçš„éœ€æ±‚ï¼å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™å®½é¡¹ç›®å·²ç»äº”å¹´æ²¡æœ‰æ›´æ–°äº†ï¼</p><ul><li>githubï¼š<a href="https://github.com/jgilfelt/android-viewbadger" target="_blank" rel="noopener">https://github.com/jgilfelt/android-viewbadger</a></li><li>ä½œè€…ï¼šJeff Gilfelt</li></ul><h5 id="ä½¿ç”¨ï¼š-69"><a href="#ä½¿ç”¨ï¼š-69" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><p>cloneæºç åˆ°æœ¬åœ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">View target = findViewById(R.id.target_view);</span><br><span class="line">BadgeView badge = new BadgeView(this, target);</span><br><span class="line">badge.setText(&quot;1&quot;);</span><br><span class="line">badge.show();</span><br></pre></td></tr></table></figure><h5 id="88-AndroidWiFiADB"><a href="#88-AndroidWiFiADB" class="headerlink" title="88.AndroidWiFiADB"></a>88.AndroidWiFiADB</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾ä¸ç”¨æ•°æ®çº¿ä¹Ÿå¯ä»¥è®©ä½ è°ƒè¯•æ‰‹æœºè®¾å¤‡APPçš„æ’ä»¶é¡¹ç›®</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šä½ æ˜¯å¦è¿˜åœ¨æ‹…å¿ƒæµ‹è¯•è¿‡ç¨‹ä¸­é«˜å¼ºåº¦çš„æ‹”æ’æ•°æ®çº¿å¯¹æ‰‹æœºç”µæ± å’ŒUSBç«¯å£é€ æˆç»ˆç”Ÿéš¾ä»¥å¼¥è¡¥çš„æŸå®³ï¼Ÿåˆ«æ‹…å¿ƒï¼Œæœ‰wifiæœ‰AndroidWiFiADBï¼Œæ— é¡»æ•°æ®çº¿ä¹Ÿå¯ä»¥è°ƒè¯•åº”ç”¨äº†ï¼Œæ›´æœ‰è¶£çš„æ˜¯ï¼Œåœ¨æµ‹è¯•å·¥ç¨‹å¸ˆä¸€è¾¹æ‹¿ç€æ‰‹æœºä¸€è¾¹æ‰¾ä½ èŠbugçš„æ—¶å€™ï¼Œä½ å·²ç»å·å·åœ¨å®ƒçš„æ‰‹æœºä¸Šä¿®å¤äº†bugï¼Œæ·±è—åŠŸä¸åï¼</p><ul><li>githubï¼š<a href="https://github.com/pedrovgs/AndroidWiFiADB" target="_blank" rel="noopener">https://github.com/pedrovgs/AndroidWiFiADB</a></li><li>ä½œè€…ï¼šPedro Vicente GÃ³mez SÃ¡nchez</li></ul><h5 id="ä½¿ç”¨ï¼š-70"><a href="#ä½¿ç”¨ï¼š-70" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><blockquote><p>Preferences/Settings-&gt;Plugins-&gt;Browse Repositories-&gt;serch AndroidWiFiADB</p></blockquote><h5 id="89-emojicon"><a href="#89-emojicon" class="headerlink" title="89.emojicon"></a>89.emojicon</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›åœ¨TextViewã€EdiTextå±•ç¤ºè¡¨æƒ…åŒ…èƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼š2.7kä¸ªstarï¼Œ,æ¦œå•ç¬¬äºŒæ¬¾å¢å¼ºTextViewæ˜¾ç¤ºèƒ½åŠ›çš„æ¡†æ¶ï¼Œè¿™æ¬¾ä¸“ä¸ºè¡¨æƒ…åŒ…è®¾è®¡ï¼Œå¦‚æœä½ æ›¾ç»å¥½å¥‡å¾®ä¿¡ã€QQçš„è¡¨æƒ…æ˜¾ç¤ºæ˜¯å¦‚ä½•åšåˆ°çš„ï¼Ÿè¿™æ¬¾æ¡†æ¶ä¸€å®šèƒ½æ»¡è¶³ä½ çš„æ±‚çŸ¥æ¬²ã€‚</p><h5 id="90-packer-ng-plugin"><a href="#90-packer-ng-plugin" class="headerlink" title="90.packer-ng-plugin"></a>90.packer-ng-plugin</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æ‰“çˆ†å·¥å…·æ’ä»¶</p></blockquote><p>ä¸Šæ¦œåˆ©ç”¨ï¼šç¬”è€…å°½åŠ›ç»´æŠ¤æ¦œå•æ¶‰åŠèŒƒå›´çš„å…¨é¢æ€§ï¼Œå› æ­¤å¼•å…¥æ­¤æ’ä»¶é¡¹ç›®â€”â€”é¡¹ç›®å·ç§°å®Œæˆ100ä¸ªæ¸ é“åŒ…åªéœ€è¦10ç§’é’Ÿï¼Œåœ¨å¸‚é¢ä¸Šå„ç§å„æ ·å¤šæ¸ é“æ‰“åŒ…æ–¹æ¡ˆçš„ä»Šå¤©ï¼Œé€‰æ‹©ä¸€æ¬¾é€‚åˆè‡ªå·±å›¢é˜Ÿçš„ï¼Œæ‰æ˜¯ä¸Šä¸Šé€‰æ‹©</p><ul><li>githubï¼š<a href="https://github.com/mcxiaoke/packer-ng-plugin" target="_blank" rel="noopener">https://github.com/mcxiaoke/packer-ng-plugin</a></li><li>ä½œè€…ï¼šXiaoke Zhang</li></ul><h5 id="ä½¿ç”¨ï¼š-71"><a href="#ä½¿ç”¨ï¼š-71" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    ......    </span><br><span class="line">    dependencies&#123;    </span><br><span class="line">    // add packer-ng </span><br><span class="line">       classpath &apos;com.mcxiaoke.gradle:packer-ng:1.0.9&apos;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line">apply plugin: &apos;packer&apos; </span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile &apos;com.mcxiaoke.gradle:packer-helper:1.0.9&apos;</span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">android &#123;    //...    signingConfigs &#123;</span><br><span class="line">      release &#123;          </span><br><span class="line">      // æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶æ—¶éœ€è¦æ­¤é…ç½®          </span><br><span class="line">      // 1. Gradleç‰ˆæœ¬ &gt;= 2.14.1          </span><br><span class="line">      // 2. Android Gradle Plugin ç‰ˆæœ¬ &gt;= 2.2.0          </span><br><span class="line">      // ä½œç”¨æ˜¯åªä½¿ç”¨æ—§ç‰ˆç­¾åï¼Œç¦ç”¨V2ç‰ˆç­¾åæ¨¡å¼        </span><br><span class="line">      v2SigningEnabled false       &#125;    &#125;  &#125;</span><br></pre></td></tr></table></figure><h5 id="91-android-priority-jobqueue"><a href="#91-android-priority-jobqueue" class="headerlink" title="91.android-priority-jobqueue"></a>91.android-priority-jobqueue</h5><blockquote><p>ä¸€å¥è¯ä»‹ç»ï¼šä¸€æ¬¾æä¾›åå°ä»»åŠ¡ç®¡ç†èƒ½åŠ›çš„æ¡†æ¶</p></blockquote><p>ä¸Šæ¦œç†ç”±ï¼šå¦‚æœä½ æ˜¯ä¸ªå¿—åœ¨æ·±å…¥ç ”ç©¶å¤šçº¿ç¨‹æ“ä½œçš„å¼€å‘è€…ï¼Œè¿™ä¸ªé¡¹ç›®ä¸€å®šä¸è¦é”™è¿‡ï¼Œä¸è®ºæ˜¯Activityé‡æ–°åŠ è½½ã€Serviceä½¿ç”¨çº¿ç¨‹æ± æ—¶çš„ä»»åŠ¡ä¼˜å…ˆçº§å’Œå¹¶å‘é—®é¢˜ï¼Œéƒ½ä¸è¦æ‹…å¿ƒï¼ŒJob Manageä¼šç…§é¡¾ä¼˜å…ˆçº§ï¼ŒæŒä¹…æ€§ï¼Œè´Ÿè½½å¹³è¡¡ï¼Œå»¶è¿Ÿï¼Œç½‘ç»œæ§åˆ¶ï¼Œåˆ†ç»„ï¼Œ2.4Kä¸ªstarï¼Œä¼˜ç§€çš„å¤šçº¿ç¨‹ç®¡ç†èƒ½åŠ›ï¼Œå†µä¸”å®ƒä¾èµ–çš„ç¬¬ä¸‰æ–¹æ¡†æ¶å¾ˆå°‘ï¼Œå€¼å¾—ä½ ä¸€è¯•</p><ul><li>githubï¼š<a href="https://github.com/yigit/android-priority-jobqueue" target="_blank" rel="noopener">https://github.com/yigit/android-priority-jobqueue</a></li><li>ä½œè€…ï¼šYigit Boyar</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;Androidæ¡†æ¶æ’è¡Œæ¦œ&quot;&gt;&lt;a href=&quot;#Androidæ¡†æ¶æ’è¡Œæ¦œ&quot; class=&quot;headerlink&quot; title=&quot;Androidæ¡†æ¶æ’è¡Œæ¦œ&quot;&gt;&lt;/a&gt;Androidæ¡†æ¶æ’è¡Œæ¦œ&lt;/h4&gt;&lt;h5 id=&quot;1-Retrofit&quot;&gt;&lt;a href=&quot;#1-Retrofit&quot; class=&quot;headerlink&quot; title=&quot;1.Retrofitã€€ã€€&quot;&gt;&lt;/a&gt;1.Retrofitã€€ã€€&lt;/h5&gt;&lt;blockquote&gt;
&lt;p&gt;ä¸€å¥è¯ä»‹ç»ï¼šRetrofitæ˜¯ä¸€æ¬¾ç±»å‹å®‰å…¨çš„ç½‘ç»œæ¡†æ¶ï¼ŒåŸºäºHTTPåè®®ï¼ŒæœåŠ¡äºAndroidå’Œjavaè¯­è¨€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸Šæ¦œç†ç”±ï¼šRetrofitä»¥21.8kçš„starsé‡é›„è¸githubä¸­androidå­æ ‡é¢˜æ¦œé¦–ï¼Œç¬¬ä¸€å½“ä¹‹æ— æ„§ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®˜ç½‘åœ°å€ï¼š&lt;a href=&quot;http://square.github.io/retrofit/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://square.github.io/retrofit/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;githubï¼š&lt;a href=&quot;https://github.com/square/retrofit&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/square/retrofit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½œè€…ï¼šsquareå›¢é˜Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&quot;ä½¿ç”¨ï¼š&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨ï¼š&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨ï¼š&quot;&gt;&lt;/a&gt;ä½¿ç”¨ï¼š&lt;/h5&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;compile &amp;apos;com.squareup.retrofit2:retrofit:2.3.0&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h5 id=&quot;2-okhttp&quot;&gt;&lt;a href=&quot;#2-okhttp&quot; class=&quot;headerlink&quot; title=&quot;2.okhttp&quot;&gt;&lt;/a&gt;2.okhttp&lt;/h5&gt;&lt;blockquote&gt;
&lt;p&gt;ä¸€å¥è¯ä»‹ç»ï¼šokhttpæ˜¯ä¸€æ¬¾åŸºäºHTTPå’ŒHTTP2.0åè®®çš„ç½‘ç»œæ¡†æ¶ï¼ŒæœåŠ¡äºjavaå’Œandroidå®¢æˆ·ç«¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸Šæ¦œç†ç”±ï¼Œokhttpä»¥20.4kçš„starsé‡é›„è¸githubä¸­androidå­æ ‡é¢˜ç¬¬äºŒåã€‚å¤§å‹å…¬å¸æ¯”å¦‚æ·˜å®ä¹Ÿå°è£…çš„æ˜¯okhttpã€‚Retrofit2.0å¼€å§‹å†…ç½®okhttpæ¡†æ¶ï¼ŒRetrofitä¸“æ³¨å°è£…æ¥å£å®Œæˆä¸šåŠ¡éœ€æ±‚ï¼Œokhttpä¸“æ³¨ç½‘ç»œè¯·æ±‚çš„å®‰å…¨é«˜æ•ˆï¼Œç¬”è€…å°†ä¸¤è€…åŒºåˆ†å¼€ï¼Œæ˜¯æƒ³è®©åæ¥å­¦ä¹ è€…çŸ¥é“ï¼Œè¿™æ˜¯ä¸¤å¥—æ¡†æ¶ï¼Œå­¦ä¹ æ¡†æ¶åŸç†æ—¶å¯ä»¥åˆ†å¼€å­¦ä¹ ï¼Œä»¥å…ç†è§£æ··ä¹±ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®˜ç½‘åœ°å€ï¼š&lt;a href=&quot;http://square.github.io/okhttp/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://square.github.io/okhttp/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;githubï¼š&lt;a href=&quot;https://github.com/square/okhttp&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/square/okhttp&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½œè€…ï¼šsquareå›¢é˜Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&quot;ä½¿ç”¨ï¼š-1&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨ï¼š-1&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨ï¼š&quot;&gt;&lt;/a&gt;ä½¿ç”¨ï¼š&lt;/h5&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;compile &amp;apos;com.squareup.okhttp3:okhttp:3.9.1&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="æ¡†æ¶" scheme="https://zhangmiao.cc/categories/Android/%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="æ¡†æ¶" scheme="https://zhangmiao.cc/tags/%E6%A1%86%E6%9E%B6/"/>
    
  </entry>
  
  <entry>
    <title>Androidé¢è¯•æ€»ç»“</title>
    <link href="https://zhangmiao.cc/posts/27a6e4df.html"/>
    <id>https://zhangmiao.cc/posts/27a6e4df.html</id>
    <published>2019-07-10T06:29:31.000Z</published>
    <updated>2019-07-22T09:19:05.257Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é¢è¯•å¤§çº²"><a href="#é¢è¯•å¤§çº²" class="headerlink" title="é¢è¯•å¤§çº²"></a>é¢è¯•å¤§çº²</h3><ul><li>javaåŸºç¡€ã€é¢å‘å¯¹è±¡ã€é›†åˆã€çº¿ç¨‹ä½¿ç”¨ï¼›</li><li>Android æœºå‹é€‚é…ã€SDKé€‚é…ã€å†…å­˜ä¼˜åŒ–ã€å†…å­˜æº¢å‡ºã€å†…å­˜æ³„æ¼ï¼›</li><li>MVC/MVP/MVVMçš„ä½¿ç”¨åœºæ™¯ï¼›</li><li>äº†è§£å¹¶èƒ½ä½¿ç”¨æœ€æ–°æµè¡Œå¼€æºåº“RXjava+Retrofit+OKHttpã€Glideã€EventBusç­‰ï¼›</li><li>JNIåŠNDKçš„ä½¿ç”¨ã€ç†Ÿæ‚‰Frameworkã€‚</li></ul><a id="more"></a><h3 id="é¢‘ç¹é¢è¯•é¢˜"><a href="#é¢‘ç¹é¢è¯•é¢˜" class="headerlink" title="é¢‘ç¹é¢è¯•é¢˜"></a>é¢‘ç¹é¢è¯•é¢˜</h3><ul><li>1.é¢å‘å¯¹è±¡ï¼ˆOOPï¼‰ </li><li>2.æ•°æ®ç±»å‹ </li><li>3.equalå’Œ==çš„åŒºåˆ« </li><li>4.å­—ç¬¦ä¸²è¿è¡Œé€Ÿåº¦ï¼šStringBuilderã€StringBufferã€ String </li><li>5.Queue é˜Ÿåˆ—ã€Stack æ ˆ </li><li>6.ListViewæœºåˆ¶ </li><li>7.Fragmentç”Ÿå‘½å‘¨æœŸ</li><li>8.å››å¤§å¼•ç”¨ç±»å‹ </li><li>9.çº¿ç¨‹ã€è¿›ç¨‹åŠå…¶é€šä¿¡æ–¹å¼ </li><li>10.PackageManagerService </li><li>11.binderæœºåˆ¶ </li><li>12.launcherçš„å®ç° </li><li>13.Android ç‰ˆæœ¬ç‰¹æ€§ </li><li>14.BroadcastReceiverå¹¿æ’­ </li><li>15.RecycleView </li><li>16.å„ç§é›†åˆæ¯”è¾ƒSparseArrayã€HashMapã€ArrayMapã€LinkedListã€ArrayList </li><li>17.SQLiteå‡çº§ </li><li>18.Bitmap </li><li>19.Handleræœºåˆ¶ </li><li>20.æ€§èƒ½ä¼˜åŒ–æŠ€å·§ </li><li>21.ANR </li><li>22.è‡ªå®šä¹‰View </li><li>23.MVCã€MVPã€MVVMä¸‰ç§æ¶æ„è®¾è®¡ </li><li>24.APP å¯åŠ¨æµç¨‹ </li><li>25.æ’ä»¶åŒ– </li><li>26.Kotlin å¤šå¹³å°åº”ç”¨çš„é™æ€ç¼–ç¨‹è¯­è¨€ </li><li>27.Framework å·¥ä½œåŸç† </li><li>28.Android å±å¹•é€‚é… </li><li>29.äº‹ä»¶åˆ†å‘æœºåˆ¶ </li><li>30.Android åŠ¨ç”»åˆ†ç±»ï¼šè§†å›¾ï¼Œå±æ€§ï¼Œå¸§ï¼Œgif </li><li>31.Android è¿›ç¨‹ </li><li>32.Android äº”å¤§å­˜å‚¨æ–¹å¼ </li><li>33.å±å¹•æ—‹è½¬Activityç”Ÿå‘½å‘¨æœŸ</li><li>34.Activity å››å¤§å¯åŠ¨æ¨¡å¼ </li><li>35.CPUã€GPUå·¥ä½œåŸç† </li><li>36.UIå¡é¡¿åŸå›  </li><li>37.Applicationçš„ç”Ÿå‘½å‘¨æœŸ </li><li>38.å¦‚ä½•é¿å…å› å¼•å…¥çš„å¼€æºåº“å¯¼è‡´çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ï¼Ÿ </li><li>39.ç®€å•çš„éŸ³é¢‘/è§†é¢‘æ ¼å¼ </li><li>40.çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•</li><li>41.çº¿ç¨‹å®‰å…¨çš„å•ä¾‹ </li><li>42.Serializableã€Parcelelable </li><li>43.Serviceå¯åŠ¨æ–¹å¼å’Œç”Ÿå‘½å‘¨æœŸ </li><li>44.Android å¸¸è§å¸ƒå±€ </li><li>45.Httpã€Httpsã€Volleyã€OkHttpã€RxJava + Retrofit + OkHttpã€TCPã€UDP </li><li>46.å¦‚ä½•èŠ‚çœå†…å­˜ä½¿ç”¨ï¼Œä¸»åŠ¨å›æ”¶å†…å­˜ï¼Ÿ </li><li>47.Activityå¦‚ä½•ç”ŸæˆViewï¼Ÿ </li><li>48.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ </li><li>49.ç°åœºä¿æŠ¤ </li><li>50.å†…å­˜æº¢å‡ºã€å†…å­˜æ³„æ¼</li><li>51.JNIå’ŒNDK</li><li>52.å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼åŠå…¶å®ç°æ€æƒ³å’Œä½œç”¨</li><li>53.HashMapã€ HashTableã€HashSetçš„å¼‚åŒ</li><li>54.Android ä¸­å†…å­˜æ³„æ¼åŸå› åŠä¼˜åŒ–æ–¹æ¡ˆ</li><li>55.LeakCanary å†…å­˜æ³„æ¼æ£€æŸ¥çš„å¼€æºå·¥å…·</li><li>56.å¤šçº¿ç¨‹ã€çº¿ç¨‹æ± </li><li>57.è…¾è®¯ Bugly</li><li>58.Glide</li><li>59.Fresco</li><li>60.React</li></ul><h3 id="é¢è¯•é¢˜è§£æ"><a href="#é¢è¯•é¢˜è§£æ" class="headerlink" title="é¢è¯•é¢˜è§£æ"></a>é¢è¯•é¢˜è§£æ</h3><h4 id="1-é¢å‘å¯¹è±¡ï¼ˆOOPï¼‰"><a href="#1-é¢å‘å¯¹è±¡ï¼ˆOOPï¼‰" class="headerlink" title="1.é¢å‘å¯¹è±¡ï¼ˆOOPï¼‰"></a>1.é¢å‘å¯¹è±¡ï¼ˆOOPï¼‰</h4><p>é’ˆå¯¹ä¸šåŠ¡å¤„ç†è¿‡ç¨‹çš„å®ä½“åŠå…¶å±æ€§å’Œè¡Œä¸ºè¿›è¡ŒæŠ½è±¡å°è£…ä»¥è·å¾—é«˜æ•ˆæ¸…æ™°çš„é€»è¾‘å•å…ƒåˆ’åˆ†ã€‚  </p><p><strong>ä¸‰å¤§ç‰¹æ€§ï¼šâ‘ å°è£…</strong>ï¼ˆéšè—å¯¹è±¡çš„å±æ€§å’Œå®ç°ç»†èŠ‚ï¼Œä»…å¯¹å¤–æä¾›å…¬å…±è®¿é—®æ–¹å¼ï¼Œå°†å˜é‡éš”ç¦»ä¾¿äºä½¿ç”¨ï¼Œæé«˜ä»£ç çš„æœç”¨å°å’Œå®‰å…¨æ€§ï¼‰ï¼›â‘¡<strong>ç»§æ‰¿</strong>ï¼ˆæé«˜ä»£ç çš„å¤ç”¨æ€§ï¼Œç»§æ‰¿æ˜¯å¤šæ€çš„å‰æï¼‰ï¼›â‘¢<strong>å¤šæ€</strong>ï¼ˆçˆ¶ç±»æˆ–æ¥å£å®šä¹‰çš„å¼•ç”¨å˜é‡å¯ä»¥æŒ‡å‘å­ç±»æˆ–å…·ä½“å®ç°ç±»çš„å½¢è±¡ï¼Œæé«˜äº†ç¨‹åºçš„æ‹“å±•æ€§ï¼‰ã€‚</p><p><strong>äº”å¤§åŸåˆ™ï¼š</strong>å•ä¸€èŒè´£ã€å¼€æ”¾å°é—­ã€é‡Œæ°æ›¿æ¢ã€ä¾èµ–å€’ç½®ã€æ¥å£åˆ†ç¦»ã€‚</p><h4 id="2-æ•°æ®ç±»å‹"><a href="#2-æ•°æ®ç±»å‹" class="headerlink" title="2.æ•°æ®ç±»å‹"></a>2.æ•°æ®ç±»å‹</h4><p>byte 1ä¸ªå­—ç¬¦ï¼Œshort ã€char2 ä¸ªå­—ç¬¦ï¼Œint ã€float 4ä¸ªå­—ç¬¦ï¼Œlong ã€double 8ä¸ªå­—ç¬¦ã€‚**</p><p><strong>volatileæ˜¯ä¸€ä¸ªç±»å‹ä¿®é¥°ç¬¦ï¼ˆtype specifierï¼‰volatileçš„ä½œç”¨æ˜¯ä½œä¸ºæŒ‡ä»¤å…³é”®å­—ï¼Œç¡®ä¿æœ¬æ¡æŒ‡ä»¤ä¸ä¼šå› ç¼–è¯‘å™¨çš„ä¼˜åŒ–è€Œçœç•¥ï¼Œä¸”è¦æ±‚æ¯æ¬¡ç›´æ¥è¯»å€¼ã€‚ï¼ˆfromç™¾åº¦ï¼‰</strong></p><p>volatileçš„å˜é‡æ˜¯è¯´è¿™å˜é‡å¯èƒ½ä¼šè¢«æ„æƒ³ä¸åˆ°åœ°æ”¹å˜ï¼Œè¿™æ ·ï¼Œ<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fbaike.baidu.com%2Fitem%2F%E7%BC%96%E8%AF%91%E5%99%A8%2F8853067" target="_blank" rel="noopener">ç¼–è¯‘å™¨</a>å°±ä¸ä¼šå»å‡è®¾è¿™ä¸ªå˜é‡çš„å€¼äº†ã€‚</p><p>åœ¨JDK1.7ä¹‹å‰ï¼Œswitchè¯­å¥ä»…æ”¯æŒbyteã€shortã€charã€intï¼Œ<strong>åœ¨JDK1.7ä¹‹åï¼Œæšä¸¾ã€å­—ç¬¦ä¸²ç±»å‹éƒ½å¯ä»¥ï¼Œé€šè¿‡String.hashcodeè½¬æˆintè¿›è¡Œåˆ¤æ–­ã€‚</strong></p><p><strong>Stringä¸å¯å˜åŸå› ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± çš„éœ€è¦ï¼›è¿è¡ŒStringå¯¹è±¡ç¼“å­˜HashCodeï¼Œæé«˜æ•ˆç‡ï¼›å¤šçº¿ç¨‹å®‰å…¨ã€‚</strong></p><p><strong>String è½¬integerçš„æ–¹æ³•å’ŒåŸç†</strong></p><p> <strong>â‘ </strong>Integer.parseIntï¼ˆString strï¼‰è°ƒç”¨Integerå†…éƒ¨çš„ï¼›</p><p>â‘¡Integer.parseIntï¼ˆString s, int radixï¼‰parseIntå†…éƒ¨é¦–å…ˆåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«ç¬¦å·ï¼ˆ-æˆ–è€…+ï¼‰ï¼Œåˆ™å¯¹ç›¸åº”çš„negativeå’Œlimitè¿›è¡Œèµ‹å€¼ï¼Œç„¶åå†å¾ªç¯å­—ç¬¦ä¸²ï¼Œå¯¹å•ä¸ªcharè¿›è¡Œæ•°å€¼è®¡ç®—</p><p>â‘¢Character.digit(char ch, int radix) è¿”å›æŒ‡å®šåŸºæ•°ä¸­å­—ç¬¦è¡¨ç¤ºçš„æ•°å€¼ã€‚å‡½æ•°è‚¯å®šè¿›å…¥åˆ°0-9å­—ç¬¦çš„åˆ¤æ–­ï¼ˆç›¸å¯¹äºstringè½¬æ¢åˆ°intï¼‰ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ•°å­—å°±æ˜¯å¦‚ä¸Šé¢è¿›è¡Œæ‹¼æ¥ç„¶åç”Ÿæˆçš„intç±»å‹æ•°å€¼ã€‚</p><p><strong>é™å®šå‚æ•°ç±»å‹çš„ä¸Šç•Œï¼šå‚æ•°ç±»å‹å¿…é¡»æ˜¯Tæˆ–Tçš„å­ç±»å‹</strong></p><p><strong>&lt;? super T&gt; é™å®šå‚æ•°ç±»å‹çš„ä¸‹ç•Œï¼šå‚æ•°ç±»å‹å¿…é¡»æ˜¯Tæˆ–Tçš„è¶…ç±»å‹</strong></p><h4 id="3-equalå’Œ-çš„åŒºåˆ«ï¼šequal-æ¯”è¾ƒå¯¹è±¡ï¼Œ-æ¯”è¾ƒåŸç”Ÿç±»å‹"><a href="#3-equalå’Œ-çš„åŒºåˆ«ï¼šequal-æ¯”è¾ƒå¯¹è±¡ï¼Œ-æ¯”è¾ƒåŸç”Ÿç±»å‹" class="headerlink" title="3.equalå’Œ==çš„åŒºåˆ«ï¼šequal æ¯”è¾ƒå¯¹è±¡ï¼Œ==æ¯”è¾ƒåŸç”Ÿç±»å‹"></a>3.equalå’Œ==çš„åŒºåˆ«ï¼šequal æ¯”è¾ƒå¯¹è±¡ï¼Œ==æ¯”è¾ƒåŸç”Ÿç±»å‹</h4><p>equalï¼šå­˜å‚¨ç©ºé—´çš„å€¼æ˜¯å¦ç›¸åŒï¼Œå­—ç¬¦ä¸²å†…å®¹æ¯”è¾ƒï¼Œ<strong>å€¼æ˜¯å¦ç›¸åŒ</strong></p><p>==ï¼šæ˜¯å¦ä¸ºåŒä¸€å†…å­˜ç©ºé—´ï¼Œå†…å­˜ç©ºé—´æ˜¯å¦ç›¸åŒï¼Œå¼•ç”¨æ˜¯å¦ç›¸åŒ</p><p><strong>å¦‚æœä¸€ä¸ªç±»é‡å†™äº†equals()æ–¹æ³•ï¼Œåˆ™ä¸€å®šä¹Ÿè¦é‡å†™hashCode()æ–¹æ³•</strong>ï¼ŒåŸå› æ˜¯ï¼šè™½ç„¶equals()æ–¹æ³•é‡å†™å¯ä»¥ä¿è¯æ­£ç¡®åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡åœ¨é€»è¾‘æ˜¯å¦ç›¸åŒï¼Œä½†æ˜¯hashCode()æ–¹æ³•æ˜ å°„çš„ç‰©ç†åœ°å€æ˜¯ä¸ç›¸åŒçš„ï¼Œä¾ç„¶ä¼šå°†é€»è¾‘ä¸Šç›¸åŒçš„ä¸¤ä¸ªå…ƒç´ å­˜å…¥é›†åˆï¼Œä½†æ˜¯ç¬¬äºŒä¸ªå¯¹è±¡çš„å†…å®¹ä¼šæ˜¯Null.</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.cnblogs.com%2Fnesnes%2Fp%2F9863664.html" target="_blank" rel="noopener">å…³äºjavaä¸­Objectç±»ä¸­çš„equals()å’ŒhashCode()æ–¹æ³•çš„ä½¿ç”¨ä¸ªäººæ€»ç»“ - å¼ æ£®ï¼ˆZhangSenï¼‰ - åšå®¢å›­</a></p><h4 id="4-å­—ç¬¦ä¸²è¿è¡Œé€Ÿåº¦ï¼šStringBuilder-gt-StringBuffer-ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰-gt-String-ï¼ŒStringä¸ºå¸¸é‡ï¼Œå…¶å®ƒä¸ºå˜é‡ï¼Œæ‰€ä»¥è¿è¡Œæ…¢ã€‚"><a href="#4-å­—ç¬¦ä¸²è¿è¡Œé€Ÿåº¦ï¼šStringBuilder-gt-StringBuffer-ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰-gt-String-ï¼ŒStringä¸ºå¸¸é‡ï¼Œå…¶å®ƒä¸ºå˜é‡ï¼Œæ‰€ä»¥è¿è¡Œæ…¢ã€‚" class="headerlink" title="4.å­—ç¬¦ä¸²è¿è¡Œé€Ÿåº¦ï¼šStringBuilder &gt; StringBuffer ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰&gt; String ï¼ŒStringä¸ºå¸¸é‡ï¼Œå…¶å®ƒä¸ºå˜é‡ï¼Œæ‰€ä»¥è¿è¡Œæ…¢ã€‚"></a>4.å­—ç¬¦ä¸²è¿è¡Œé€Ÿåº¦ï¼šStringBuilder &gt; StringBuffer ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰&gt; String ï¼ŒStringä¸ºå¸¸é‡ï¼Œå…¶å®ƒä¸ºå˜é‡ï¼Œæ‰€ä»¥è¿è¡Œæ…¢ã€‚</h4><h4 id="5-Queue-é˜Ÿåˆ—ï¼šå…ˆè¿›å…ˆå‡ºï¼ŒStack-æ ˆï¼šåè¿›å…ˆå‡ºã€‚Collect-â€“-gt-List-Set-Map"><a href="#5-Queue-é˜Ÿåˆ—ï¼šå…ˆè¿›å…ˆå‡ºï¼ŒStack-æ ˆï¼šåè¿›å…ˆå‡ºã€‚Collect-â€“-gt-List-Set-Map" class="headerlink" title="5.Queue é˜Ÿåˆ—ï¼šå…ˆè¿›å…ˆå‡ºï¼ŒStack æ ˆï¼šåè¿›å…ˆå‡ºã€‚Collect â€“&gt;List/Set/Map"></a>5.Queue é˜Ÿåˆ—ï¼šå…ˆè¿›å…ˆå‡ºï¼ŒStack æ ˆï¼šåè¿›å…ˆå‡ºã€‚Collect â€“&gt;List/Set/Map</h4><h4 id="6-ListViewæœºåˆ¶ï¼šç”¨åˆ°çš„é€‚é…å™¨æœ‰ArrayAdapterã€SimpleAdapterã€BaseAdapter"><a href="#6-ListViewæœºåˆ¶ï¼šç”¨åˆ°çš„é€‚é…å™¨æœ‰ArrayAdapterã€SimpleAdapterã€BaseAdapter" class="headerlink" title="6.ListViewæœºåˆ¶ï¼šç”¨åˆ°çš„é€‚é…å™¨æœ‰ArrayAdapterã€SimpleAdapterã€BaseAdapter"></a>6.ListViewæœºåˆ¶ï¼šç”¨åˆ°çš„é€‚é…å™¨æœ‰ArrayAdapterã€SimpleAdapterã€BaseAdapter</h4><p>BaseAdapter é‡å†™çš„æ–¹æ³•getCount()ã€getItem()ã€getItemId()ã€getView()ï¼Œ<strong>æ¯ç»˜åˆ¶ä¸€æ¬¡å°±è°ƒç”¨ä¸€æ¬¡getView()</strong>ï¼Œåœ¨getView()ä¸­å°†äº‹å…ˆå®šå¥½çš„layoutå¸ƒå±€ç¡®å®šæ˜¾ç¤ºçš„æ•ˆæœå¹¶è¿”å›ä¸€ä¸ªviewå¯¹è±¡ä½œä¸ºä¸€ä¸ªitem æ˜¾ç¤ºå‡ºæ¥ï¼ŒgetItem()ã€getItemId()åœ¨è°ƒç”¨LIstViewå“åº”æ–¹æ³•æ—¶è°ƒç”¨ã€‚</p><h4 id="7-Fragmentç”Ÿå‘½å‘¨æœŸ"><a href="#7-Fragmentç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="7.Fragmentç”Ÿå‘½å‘¨æœŸ"></a>7.Fragmentç”Ÿå‘½å‘¨æœŸ</h4><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fqq_36882793%2Farticle%2Fdetails%2F82151686" target="_blank" rel="noopener">Fragmentå„ç§æƒ…å†µçš„ç”Ÿå‘½å‘¨æœŸ - çŒ«å»é±¼çš„åšå®¢ - CSDNåšå®¢</a></p><p>onAttach()ï¼š å®ŒæˆFragmentå’ŒActivityçš„ç»‘å®šï¼Œå‚æ•°ä¸­çš„Activityå³ä¸ºè¦ç»‘å®šçš„Activityï¼Œå¯ä»¥è¿›è¡Œèµ‹å€¼ç­‰æ“ä½œã€‚</p><p>onCreate() : å®ŒæˆFragmentçš„åˆå§‹åŒ–</p><p>onCreateView() : åŠ è½½Fragmentå¸ƒå±€ï¼Œç»‘å®šå¸ƒå±€æ–‡ä»¶</p><p>onActivityCreated() : è¡¨åä¸Fragmentç»‘å®šçš„Activityå·²ç»æ‰§è¡Œå®Œæˆäº†onCreateï¼Œå¯ä»¥ä¸Activityè¿›è¡Œäº¤äº’æ“ä½œã€‚</p><p>onStart() : Fragmentå˜ä¸ºå¯è§çŠ¶æ€</p><p>onResume() : Fragmentå˜ä¸ºå¯äº¤äº’çŠ¶æ€</p><p>onPause()ï¼š Fragmentå˜ä¸ºä¸å¯äº¤äº’çŠ¶æ€(ä¸ä»£è¡¨ä¸å¯è§)</p><p>onSaveInstanceState()ï¼šä¿å­˜å½“å‰Fragmentçš„çŠ¶æ€ã€‚è®°å½•ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚EditTexté”®å…¥çš„æ–‡æœ¬ï¼Œå³ä½¿Fragmentè¢«å›æ”¶åˆé‡æ–°åˆ›å»ºï¼Œä¸€æ ·èƒ½æ¢å¤EditTextä¹‹å‰é”®å…¥çš„æ–‡æœ¬ã€‚</p><p>onStop(): Fragmentå˜ä¸ºä¸å¯è§çŠ¶æ€</p><p>onDestroyView() : é”€æ¯Fragmentçš„æœ‰å…³è§†å›¾ï¼Œä½†å¹¶æœªå’ŒActivityè§£ç»‘ï¼Œå¯ä»¥é€šè¿‡onCreateView()é‡æ–°åˆ›å»ºè§†å›¾ã€‚Fragmenté”€æ¯æ—¶æˆ–è€…ViewPager+Fragmentæƒ…å†µä¸‹ä¼šè°ƒç”¨</p><p>onDestroy() : é”€æ¯Fragmentæ—¶è°ƒç”¨</p><p>onDetach() : è§£é™¤å’ŒActivityçš„ç»‘å®šã€‚Fragmené”€æ¯æœ€åä¸€æ­¥ã€‚</p><h4 id="8-å››å¤§å¼•ç”¨ç±»å‹"><a href="#8-å››å¤§å¼•ç”¨ç±»å‹" class="headerlink" title="8.å››å¤§å¼•ç”¨ç±»å‹"></a>8.å››å¤§å¼•ç”¨ç±»å‹</h4><p><strong>å¼ºå¼•ç”¨</strong>ï¼š æ˜¯æŒ‡åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶æŠŠè¿™ä¸ªå¯¹è±¡èµ‹ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ã€‚ å¼ºå¼•ç”¨æœ‰<strong>å¼•ç”¨å˜é‡æŒ‡å‘æ—¶æ°¸è¿œä¸ä¼šè¢«åƒåœ¾å›æ”¶</strong>ï¼ŒJVMå®æ„¿æŠ›å‡ºOutOfMemoryé”™è¯¯ä¹Ÿä¸ä¼šå›æ”¶è¿™ç§å¯¹è±¡ã€‚</p><p><strong>è½¯å¼•ç”¨</strong>ï¼ˆSoftReferenceï¼‰ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰è½¯å¼•ç”¨ï¼Œå†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶å®ƒï¼›<strong>å¦‚æœå†…å­˜ç©ºé—´ä¸è¶³äº†ï¼Œå°±ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„å†…å­˜</strong>ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜,æ¯”å¦‚ç½‘é¡µç¼“å­˜ã€å›¾ç‰‡ç¼“å­˜ç­‰ã€‚ä½¿ç”¨è½¯å¼•ç”¨èƒ½é˜²æ­¢å†…å­˜æ³„éœ²ï¼Œå¢å¼ºç¨‹åºçš„å¥å£®æ€§ã€‚SoftReferenceçš„ç‰¹ç‚¹æ˜¯å®ƒçš„ä¸€ä¸ªå®ä¾‹ä¿å­˜å¯¹ä¸€ä¸ªJavaå¯¹è±¡çš„è½¯å¼•ç”¨ï¼Œ è¯¥è½¯å¼•ç”¨çš„å­˜åœ¨ä¸å¦¨ç¢åƒåœ¾æ”¶é›†çº¿ç¨‹å¯¹è¯¥Javaå¯¹è±¡çš„å›æ”¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦SoftReferenceä¿å­˜äº†å¯¹ä¸€ä¸ªJavaå¯¹è±¡çš„è½¯å¼•ç”¨åï¼Œåœ¨åƒåœ¾çº¿ç¨‹å¯¹ è¿™ä¸ªJavaå¯¹è±¡å›æ”¶å‰ï¼ŒSoftReferenceç±»æ‰€æä¾›çš„get()æ–¹æ³•è¿”å›Javaå¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚å¦å¤–ï¼Œä¸€æ—¦åƒåœ¾çº¿ç¨‹å›æ”¶è¯¥Javaå¯¹è±¡ä¹‹ åï¼Œget()æ–¹æ³•å°†è¿”å›nullã€‚</p><p><strong>å¼±å¼•ç”¨</strong>ï¼ˆWeakReferenceï¼‰ï¼š<strong>å¼±å¼•ç”¨ä¹Ÿæ˜¯ç”¨æ¥æè¿°éå¿…éœ€å¯¹è±¡çš„ï¼Œå½“JVMè¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡</strong>ã€‚åœ¨javaä¸­ï¼Œç”¨java.lang.ref.WeakReferenceç±»æ¥è¡¨ç¤ºã€‚</p><p><strong>è™šå¼•ç”¨</strong>ï¼ˆPhantomReferenceï¼‰ï¼šè™šå¼•ç”¨å’Œå‰é¢çš„è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ä¸åŒï¼Œå®ƒå¹¶ä¸å½±å“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨javaä¸­ç”¨java.lang.ref.PhantomReferenceç±»è¡¨ç¤ºã€‚<strong>å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸è™šå¼•ç”¨å…³è”ï¼Œåˆ™è·Ÿæ²¡æœ‰å¼•ç”¨ä¸ä¹‹å…³è”ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶</strong>ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—å…³è”ä½¿ç”¨ï¼Œå½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹ å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚å¦‚æœç¨‹åºå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚</p><p>å¯¹äºå¼ºå¼•ç”¨ï¼Œæˆ‘ä»¬å¹³æ—¶åœ¨ç¼–å†™ä»£ç æ—¶ç»å¸¸ä¼šç”¨åˆ°ã€‚è€Œå¯¹äºå…¶ä»–ä¸‰ç§ç±»å‹çš„å¼•ç”¨ï¼Œä½¿ç”¨å¾—æœ€å¤šçš„å°±æ˜¯è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨ï¼Œè¿™2ç§æ—¢æœ‰ç›¸ä¼¼ä¹‹å¤„åˆæœ‰åŒºåˆ«ã€‚å®ƒä»¬éƒ½æ˜¯ç”¨æ¥æè¿°éå¿…éœ€å¯¹è±¡çš„ï¼Œä½†æ˜¯è¢«è½¯å¼•ç”¨å…³è”çš„å¯¹è±¡åªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œè€Œè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åœ¨JVMè¿›è¡Œåƒåœ¾å›æ”¶æ—¶æ€»ä¼šè¢«å›æ”¶ã€‚</p><h4 id="9-çº¿ç¨‹æ˜¯è¿›ç¨‹çš„å­é›†ï¼Œä¸€ä¸ªè¿›ç¨‹å¯æœ‰å¤šä¸ªçº¿ç¨‹ã€‚"><a href="#9-çº¿ç¨‹æ˜¯è¿›ç¨‹çš„å­é›†ï¼Œä¸€ä¸ªè¿›ç¨‹å¯æœ‰å¤šä¸ªçº¿ç¨‹ã€‚" class="headerlink" title="9.çº¿ç¨‹æ˜¯è¿›ç¨‹çš„å­é›†ï¼Œä¸€ä¸ªè¿›ç¨‹å¯æœ‰å¤šä¸ªçº¿ç¨‹ã€‚"></a>9.çº¿ç¨‹æ˜¯è¿›ç¨‹çš„å­é›†ï¼Œä¸€ä¸ªè¿›ç¨‹å¯æœ‰å¤šä¸ªçº¿ç¨‹ã€‚</h4><p><strong>çº¿ç¨‹é—´é€šè®¯æ–¹å¼</strong>ï¼šâ‘ å…±äº«å˜é‡ï¼›â‘¡ç®¡é“ï¼›â‘¢handlerï¼›â‘£runOnUiThread(Runnable)ï¼›â‘¤view.post(Runnable)ã€‚</p><p> <strong>è¿›ç¨‹é—´é€šè®¯æ–¹å¼</strong>ï¼šâ‘ ç®¡é“ï¼›â‘¡FIFOï¼›â‘¢æ¶ˆæ¯é˜Ÿåˆ—ï¼›â‘£ä¿¡å·é‡ï¼›â‘¤å…±äº«å†…å­˜åŒºï¼›â‘¥å¥—æ¥å­—socketä¿¡å·ã€‚</p><p> <strong>Activityé—´çš„é€šä¿¡æ–¹å¼</strong>ï¼šâ‘ Intentï¼›â‘¡å€ŸåŠ©ç±»çš„é™æ€å˜é‡ï¼›â‘¢å€ŸåŠ©å…¨å±€å˜é‡/Applicationï¼›â‘£å€ŸåŠ©å¤–éƒ¨å·¥å…·ï¼ˆSharedPreferenceã€SQLiteã€Fileã€å‰ªè´´æ¿ï¼‰ï¼›â‘¤å€ŸåŠ©Serviceã€‚</p><h4 id="10-PackageManagerService-APPå®‰è£…æœ‰å…³çš„serviceï¼ŒWindowManagerService-APPè°ƒç”¨çª—å£ç›¸å…³çš„serviceï¼ŒActivityManagerService-ç³»ç»Ÿçš„å¼•å¯¼æœåŠ¡ï¼Œæ”¯æŒåº”ç”¨è¿›ç¨‹çš„å¯åŠ¨ã€åˆ‡æ¢ã€è°ƒåº¦ã€å››å¤§ç»„ä»¶çš„å¯åŠ¨å’Œç®¡ç†ã€‚"><a href="#10-PackageManagerService-APPå®‰è£…æœ‰å…³çš„serviceï¼ŒWindowManagerService-APPè°ƒç”¨çª—å£ç›¸å…³çš„serviceï¼ŒActivityManagerService-ç³»ç»Ÿçš„å¼•å¯¼æœåŠ¡ï¼Œæ”¯æŒåº”ç”¨è¿›ç¨‹çš„å¯åŠ¨ã€åˆ‡æ¢ã€è°ƒåº¦ã€å››å¤§ç»„ä»¶çš„å¯åŠ¨å’Œç®¡ç†ã€‚" class="headerlink" title="10.PackageManagerService APPå®‰è£…æœ‰å…³çš„serviceï¼ŒWindowManagerService APPè°ƒç”¨çª—å£ç›¸å…³çš„serviceï¼ŒActivityManagerService ç³»ç»Ÿçš„å¼•å¯¼æœåŠ¡ï¼Œæ”¯æŒåº”ç”¨è¿›ç¨‹çš„å¯åŠ¨ã€åˆ‡æ¢ã€è°ƒåº¦ã€å››å¤§ç»„ä»¶çš„å¯åŠ¨å’Œç®¡ç†ã€‚"></a>10.PackageManagerService APPå®‰è£…æœ‰å…³çš„serviceï¼ŒWindowManagerService APPè°ƒç”¨çª—å£ç›¸å…³çš„serviceï¼ŒActivityManagerService ç³»ç»Ÿçš„å¼•å¯¼æœåŠ¡ï¼Œæ”¯æŒåº”ç”¨è¿›ç¨‹çš„å¯åŠ¨ã€åˆ‡æ¢ã€è°ƒåº¦ã€å››å¤§ç»„ä»¶çš„å¯åŠ¨å’Œç®¡ç†ã€‚</h4><p>è‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡ï¼šåœ¨ServiceManageræ³¨å†Œï¼Œåœ¨Framework/baseå¢åŠ JNIï¼ŒC++ æ–‡ä»¶ï¼Œåœ¨build é…ç½®mkæ–‡ä»¶ï¼Œå…¨éƒ¨ç¼–è¯‘ï¼Œæ‰å¯è°ƒç”¨ã€‚</p><h4 id="11-binderæœºåˆ¶"><a href="#11-binderæœºåˆ¶" class="headerlink" title="11.binderæœºåˆ¶"></a>11.binderæœºåˆ¶</h4><p>Binderæ˜¯Androidç³»ç»Ÿä¸­è¿›ç¨‹é—´é€šè®¯ï¼ˆIPCï¼‰çš„ä¸€ç§æ–¹å¼ï¼Œä¹Ÿæ˜¯Androidç³»ç»Ÿä¸­æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ã€‚Androidä¸­çš„å››å¤§ç»„ä»¶Activityï¼ŒServiceï¼ŒBroadcastï¼ŒContentProviderï¼Œä¸åŒçš„Appç­‰éƒ½è¿è¡Œåœ¨ä¸åŒçš„è¿›ç¨‹ä¸­ï¼Œ<strong>å®ƒæ˜¯è¿™äº›è¿›ç¨‹é—´é€šè®¯çš„æ¡¥æ¢ã€‚æ­£å¦‚å…¶åâ€œç²˜åˆå‰‚â€ä¸€æ ·ï¼Œå®ƒæŠŠç³»ç»Ÿä¸­å„ä¸ªç»„ä»¶ç²˜åˆåˆ°äº†ä¸€èµ·ï¼Œæ˜¯å„ä¸ªç»„ä»¶çš„æ¡¥æ¢</strong>ã€‚</p><h4 id="12-launcherçš„å®ç°"><a href="#12-launcherçš„å®ç°" class="headerlink" title="12.launcherçš„å®ç°"></a>12.launcherçš„å®ç°</h4><p>Manifest é…ç½®launcherï¼ŒPackageManagerã€ActivityManager<strong>å¯¹åº”åŒ…çš„ç®¡ç†å’Œåº”ç”¨è¿›ç¨‹çš„ç®¡ç†</strong>ã€‚</p><h4 id="13-Android-ç‰ˆæœ¬ç‰¹æ€§"><a href="#13-Android-ç‰ˆæœ¬ç‰¹æ€§" class="headerlink" title="13.Android ç‰ˆæœ¬ç‰¹æ€§"></a>13.Android ç‰ˆæœ¬ç‰¹æ€§</h4><p><strong>6.0éœ€è¦ä»£ç è¯·æ±‚æƒé™checkPermissionsï¼Œ7.0åº”ç”¨é—´æ–‡ä»¶å…±äº«é™åˆ¶ï¼Œç³»ç»Ÿå¹¿æ’­åˆ é™¤ï¼Œ8.0é€šçŸ¥æ¸ é“ã€æ‚¬æµ®çª—ã€é€æ˜çª—å£ä¸å…è®¸å±å¹•æ—‹è½¬ï¼Œ9.0æ˜æ–‡æµé‡çš„ç½‘ç»œè¯·æ±‚ï¼ˆHttpsåŠ å¯†ï¼‰</strong></p><p><strong>Android SDKå…¼å®¹</strong>ï¼š<strong>minSdkVersionå¿…é¡»</strong>ï¼ŒtargetSdkVersioné’ˆå¯¹æŸç‰ˆæœ¬ï¼ŒmaxSdkVersionéå¿…éœ€ã€‚</p><p>è¯¦ç»†ç‰¹æ€§å¯è§è½¬è½½æ–‡æ¡£ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fccw0054%2Farticle%2Fdetails%2F83061841" target="_blank" rel="noopener">Android å„ç‰ˆæœ¬æ–°ç‰¹æ€§ä»‹ç» - è½å¶Exçš„åšå®¢ - CSDNåšå®¢</a></p><h4 id="14-BroadcastReceiverå¹¿æ’­"><a href="#14-BroadcastReceiverå¹¿æ’­" class="headerlink" title="14.BroadcastReceiverå¹¿æ’­"></a>14.BroadcastReceiverå¹¿æ’­</h4><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722160840.png" alt></p><p>BroadcastReceiveræ¯”è¾ƒ</p><p>ç‰¹åˆ«æ³¨æ„ï¼š<strong>åŠ¨æ€å¹¿æ’­æœ€å¥½åœ¨Activity çš„ onResume()æ³¨å†Œã€onPause()æ³¨é”€ã€‚</strong></p><p>åŸå› ï¼šå¯¹äºåŠ¨æ€å¹¿æ’­ï¼Œæœ‰æ³¨å†Œå°±å¿…ç„¶å¾—æœ‰æ³¨é”€ï¼Œå¦åˆ™ä¼šå¯¼è‡´<strong>å†…å­˜æ³„éœ²ï¼Œ</strong>é‡å¤æ³¨å†Œã€é‡å¤æ³¨é”€ä¹Ÿä¸å…è®¸</p><p>å¹¿æ’­çš„ç±»å‹ä¸»è¦åˆ†ä¸º5ç±»ï¼š</p><p><strong>æ™®é€šå¹¿æ’­</strong>ï¼ˆNormal Broadcastï¼‰ï¼šå¼€å‘è€…è‡ªèº«å®šä¹‰ intentçš„å¹¿æ’­ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼Œ<strong>sendBroadcast(intent);</strong></p><p><strong>ç³»ç»Ÿå¹¿æ’­</strong>ï¼ˆSystem Broadcastï¼‰ï¼šæ¶‰åŠåˆ°æ‰‹æœºçš„åŸºæœ¬æ“ä½œï¼ˆå¦‚å¼€æœºã€ç½‘ç»œçŠ¶æ€å˜åŒ–ã€æ‹ç…§ç­‰ç­‰ï¼‰ï¼Œéƒ½ä¼šå‘å‡ºç›¸åº”çš„å¹¿æ’­ï¼Œæ¯ä¸ªå¹¿æ’­éƒ½æœ‰ç‰¹å®šçš„Intent - Filterï¼ˆåŒ…æ‹¬å…·ä½“çš„actionï¼‰</p><p><strong>æœ‰åºå¹¿æ’­</strong>ï¼ˆOrdered Broadcastï¼‰ï¼š<strong>å‘é€å‡ºå»çš„å¹¿æ’­è¢«å¹¿æ’­æ¥æ”¶è€…æŒ‰ç…§å…ˆåé¡ºåºæ¥æ”¶ï¼ŒæŒ‰ç…§Priorityå±æ€§å€¼ä»å¤§-å°æ’åºï¼›Priorityå±æ€§ç›¸åŒè€…ï¼ŒåŠ¨æ€æ³¨å†Œçš„å¹¿æ’­ä¼˜å…ˆ</strong>ï¼›</p><p><strong>sendOrderedBroadcast(intent);</strong></p><p>ç‰¹ç‚¹</p><p>æ¥æ”¶å¹¿æ’­æŒ‰é¡ºåºæ¥æ”¶</p><p>å…ˆæ¥æ”¶çš„å¹¿æ’­æ¥æ”¶è€…å¯ä»¥<strong>å¯¹å¹¿æ’­è¿›è¡Œæˆªæ–­</strong>ï¼Œå³åæ¥æ”¶çš„å¹¿æ’­æ¥æ”¶è€…ä¸å†æ¥æ”¶åˆ°æ­¤å¹¿æ’­ï¼›</p><p>å…ˆæ¥æ”¶çš„å¹¿æ’­æ¥æ”¶è€…å¯ä»¥<strong>å¯¹å¹¿æ’­è¿›è¡Œä¿®æ”¹</strong>ï¼Œé‚£ä¹ˆåæ¥æ”¶çš„å¹¿æ’­æ¥æ”¶è€…å°†æ¥æ”¶åˆ°è¢«ä¿®æ”¹åçš„å¹¿æ’­</p><p>Appåº”ç”¨å†…å¹¿æ’­ï¼ˆLocal Broadcastï¼‰ï¼š<a href="https://www.jianshu.com/p/6f1ea19a17ed" target="_blank" rel="noopener">Androidé«˜æ•ˆå®‰å…¨çš„æœ¬åœ°å¹¿æ’­LocalBroadcastå®Œå…¨è§£æ - ç®€ä¹¦</a></p><p>ç²˜æ€§å¹¿æ’­ï¼ˆSticky Broadcastï¼‰ï¼šç”±äºåœ¨Android5.0 &amp; API 21ä¸­å·²ç»å¤±æ•ˆï¼Œæ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨</p><h4 id="15-RecycleView"><a href="#15-RecycleView" class="headerlink" title="15.RecycleView"></a>15.RecycleView</h4><p>æ–¹æ³•ï¼š<strong>onCreateViewHolder() ã€onBinderViewHolder()ã€getItemCount()</strong></p><p>ä¸‰ç§å¸ƒå±€ï¼š<strong>å‚ç›´oræ°´å¹³ã€ç½‘æ ¼ã€ç€‘å¸ƒæµ</strong></p><p>éœ€è¦è‡ªå®šä¹‰åˆ†å‰²çº¿ã€æ˜“äºå›æ”¶ã€Viewå¤ç”¨ã€ä¾¿äºå®ç°æ·»åŠ å’Œåˆ é™¤itemåŠ¨ç”»ã€‚</p><h4 id="16-å„ç§é›†åˆæ¯”è¾ƒ"><a href="#16-å„ç§é›†åˆæ¯”è¾ƒ" class="headerlink" title="16.å„ç§é›†åˆæ¯”è¾ƒ"></a>16.å„ç§é›†åˆæ¯”è¾ƒ</h4><p><strong>SparseArrayç¨€ç–æ•°ç»„ä¸HashMapç›¸æ¯”</strong>ï¼Œæ­£åºæ’å…¥å¿«ï¼Œé€†åºæ’å…¥æ…¢ï¼ŒæŸ¥æ‰¾æ…¢å ç”¨å†…å­˜å°‘äºHashMapï¼›</p><p><strong>HashMapå’ŒArrayMapçš„åŒºåˆ«</strong></p><p>â‘ æŸ¥æ‰¾æ•ˆç‡   HashMapä¾æ®HashCodeæŸ¥æ‰¾ï¼Œæ•ˆç‡å¢åŠ ï¼›ArrayMapä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾ï¼Œæ•ˆç‡ä¸‹é™ã€‚æ•°é‡å¤§æ—¶ç”¨HashMap</p><p>â‘¡æ‰©å±•æ•°é‡   HashMapåˆå§‹å€¼16ä¸ªé•¿åº¦ï¼Œæ¯æ¬¡æ‰©å®¹ç”³è¯·åŒå€çš„æ•°ç»„ç©ºé—´ï¼›Aæ‰©å®¹ç”³è¯·ç©ºé—´æ›´å°‘</p><p>â‘¢æ‰©å®¹æ•ˆç‡  ArrayMapæ›´å¥½</p><p>â‘£å†…å­˜æ¶ˆè€—  æ•°æ®é‡å°æ—¶ï¼ŒArrayMapæ›´èŠ‚çœå†…å­˜</p><p>æ€»ç»“ï¼šæ•°æ®é‡å°æ—¶ï¼Œå¹¶éœ€è¦é¢‘ç¹ä½¿ç”¨mapå­˜å‚¨æ—¶ï¼Œç”¨ArrayMapï¼Œæ•°æ®é‡å¤§æ—¶ï¼Œç”¨HashMapã€‚</p><p><strong>HashMapç”±æ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯HashMapçš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼Œå¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®ä¸å«é“¾è¡¨ï¼ˆå½“å‰entryçš„nextæŒ‡å‘nullï¼‰,é‚£ä¹ˆå¯¹äºæŸ¥æ‰¾ï¼Œæ·»åŠ ç­‰æ“ä½œå¾ˆå¿«ï¼Œä»…éœ€ä¸€æ¬¡å¯»å€å³å¯ï¼›å¦‚æœå®šä½åˆ°çš„æ•°ç»„åŒ…å«é“¾è¡¨ï¼Œå¯¹äºæ·»åŠ æ“ä½œï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œé¦–å…ˆéå†é“¾è¡¨ï¼Œå­˜åœ¨å³è¦†ç›–ï¼Œå¦åˆ™æ–°å¢ï¼›å¯¹äºæŸ¥æ‰¾æ“ä½œæ¥è®²ï¼Œä»éœ€éå†é“¾è¡¨ï¼Œç„¶åé€šè¿‡keyå¯¹è±¡çš„equalsæ–¹æ³•é€ä¸€æ¯”å¯¹æŸ¥æ‰¾ã€‚æ‰€ä»¥ï¼Œæ€§èƒ½è€ƒè™‘ï¼ŒHashMapä¸­çš„é“¾è¡¨å‡ºç°è¶Šå°‘ï¼Œæ€§èƒ½æ‰ä¼šè¶Šå¥½ã€‚</strong></p><p>HashMap çš„å®ä¾‹æœ‰ä¸¤ä¸ªå‚æ•°å½±å“å…¶æ€§èƒ½ï¼šåˆå§‹å®¹é‡å’ŒåŠ è½½å› å­ã€‚å®¹é‡æ˜¯<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fbaike.baidu.com%2Fitem%2F%E5%93%88%E5%B8%8C%E8%A1%A8" target="_blank" rel="noopener">å“ˆå¸Œè¡¨</a>ä¸­æ¡¶çš„æ•°é‡ï¼Œåˆå§‹å®¹é‡åªæ˜¯å“ˆå¸Œè¡¨åœ¨åˆ›å»ºæ—¶çš„å®¹é‡ã€‚åŠ è½½å› å­ æ˜¯å“ˆå¸Œè¡¨åœ¨å…¶å®¹é‡è‡ªåŠ¨å¢åŠ ä¹‹å‰å¯ä»¥è¾¾åˆ°å¤šæ»¡çš„ä¸€ç§å°ºåº¦ã€‚å½“å“ˆå¸Œè¡¨ä¸­çš„æ¡ç›®æ•°è¶…å‡ºäº†åŠ è½½å› å­ä¸å½“å‰å®¹é‡çš„ä¹˜ç§¯æ—¶ï¼Œåˆ™è¦å¯¹è¯¥å“ˆå¸Œè¡¨è¿›è¡Œ rehash æ“ä½œï¼ˆå³é‡å»ºå†…éƒ¨æ•°æ®ç»“æ„ï¼‰ï¼Œä»è€Œå“ˆå¸Œè¡¨å°†å…·æœ‰å¤§çº¦ä¸¤å€çš„æ¡¶æ•°ã€‚åœ¨Javaç¼–ç¨‹è¯­è¨€ä¸­ï¼ŒåŠ è½½å› å­é»˜è®¤å€¼ä¸º0.75ï¼Œé»˜è®¤å“ˆå¸Œè¡¨å…ƒä¸º101</p><p>hashMapçš„é»˜è®¤åŠ è½½å› å­ä¸º0.75ï¼Œ<strong>åŠ è½½å› å­</strong>è¡¨ç¤ºHsahè¡¨ä¸­å…ƒç´ çš„å¡«æ»¡çš„ç¨‹åº¦ã€‚åŠ è½½å› å­è¶Šå¤§,å¡«æ»¡çš„å…ƒç´ è¶Šå¤š,ç©ºé—´åˆ©ç”¨ç‡è¶Šé«˜ï¼Œä½†å†²çªçš„æœºä¼šåŠ å¤§äº†ã€‚åä¹‹,åŠ è½½å› å­è¶Šå°,å¡«æ»¡çš„å…ƒç´ è¶Šå°‘,å†²çªçš„æœºä¼šå‡å°,ä½†ç©ºé—´æµªè´¹å¤šäº†ã€‚å†²çªçš„æœºä¼šè¶Šå¤§,åˆ™æŸ¥æ‰¾çš„æˆæœ¬è¶Šé«˜ã€‚åä¹‹,æŸ¥æ‰¾çš„æˆæœ¬è¶Šå°ã€‚å½“æ¡¶ä¸­å…ƒç´ åˆ°è¾¾8ä¸ªçš„æ—¶å€™ï¼Œæ¦‚ç‡å·²ç»å˜å¾—éå¸¸å°ï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨0.75ä½œä¸ºåŠ è½½å› å­ï¼Œæ¯ä¸ªç¢°æ’ä½ç½®çš„é“¾è¡¨é•¿åº¦è¶…è¿‡ï¼˜ä¸ªæ˜¯å‡ ä¹ä¸å¯èƒ½çš„ã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.jianshu.com/p/dff8f4641814" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆjava Hashmap ä¸­çš„åŠ è½½å› å­æ˜¯é»˜è®¤ä¸º0.75 - ç®€ä¹¦</a></p><p><strong>LinkedList é“¾è¡¨ç»“æ„</strong>ï¼ŒæŸ¥æ‰¾æ…¢ï¼Œæ’å…¥å¿«ï¼›</p><p><strong>ArrayList æ•°ç»„ç»“æ„</strong>ï¼ŒæŸ¥æ‰¾å¿«ï¼Œæ’å…¥æ…¢ã€‚</p><h4 id="17-SQLiteå‡çº§è€Œä¸å½±å“ç°æœ‰æ•°æ®ï¼ŒDBHelperå•ä¾‹ï¼Œåœ¨OnUpgrade-æ–¹æ³•ä¸­åˆ¤æ–­oldVersionå¯¹æ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹æŸ¥ä»¥å®ç°æ•°æ®åº“å‡çº§ã€‚"><a href="#17-SQLiteå‡çº§è€Œä¸å½±å“ç°æœ‰æ•°æ®ï¼ŒDBHelperå•ä¾‹ï¼Œåœ¨OnUpgrade-æ–¹æ³•ä¸­åˆ¤æ–­oldVersionå¯¹æ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹æŸ¥ä»¥å®ç°æ•°æ®åº“å‡çº§ã€‚" class="headerlink" title="17.SQLiteå‡çº§è€Œä¸å½±å“ç°æœ‰æ•°æ®ï¼ŒDBHelperå•ä¾‹ï¼Œåœ¨OnUpgrade()æ–¹æ³•ä¸­åˆ¤æ–­oldVersionå¯¹æ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹æŸ¥ä»¥å®ç°æ•°æ®åº“å‡çº§ã€‚"></a>17.SQLiteå‡çº§è€Œä¸å½±å“ç°æœ‰æ•°æ®ï¼ŒDBHelperå•ä¾‹ï¼Œåœ¨OnUpgrade()æ–¹æ³•ä¸­åˆ¤æ–­oldVersionå¯¹æ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹æŸ¥ä»¥å®ç°æ•°æ®åº“å‡çº§ã€‚</h4><h4 id="18-Bitmap"><a href="#18-Bitmap" class="headerlink" title="18.Bitmap"></a>18.Bitmap</h4><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.cnblogs.com%2Fwinter-is-coming%2Fp%2F9112192.html" target="_blank" rel="noopener">Android Bitmapè¯¦è§£ - å°çˆ·å®‹ - åšå®¢å›­</a></p><p>ä½å›¾åŒ…æ‹¬å›¾ç‰‡çš„åƒç´ ã€é•¿å®½ã€é¢œè‰²ç­‰æè¿°ï¼Œå¯é€šè¿‡è¿™äº›ä¿¡æ¯è®¡ç®—å‡ºå›¾åƒå ç”¨å†…å­˜çš„å¤§å°ã€‚ä½œä¸ºèŠ±æ¶ï¼Œå¯å¯¹å›¾ç‰‡åšä¸€äº›å¤„ç†ï¼Œä½å›¾æ–‡ä»¶æ˜¾ç¤ºæ•ˆæœå¥½ï¼Œä½†æ˜¯éå‹ç¼©æ ¼å¼ï¼Œéœ€è¦å ç”¨è¾ƒå¤§å­˜å‚¨ç©ºé—´ã€‚</p><p>â‘ <strong>Configï¼šè¡¨ç¤ºå›¾ç‰‡åƒç´ ç±»å‹</strong></p><p>â‘¡ä¸‰ç§å‹ç¼©æ ¼å¼ï¼š<strong>Bitmap.CompressFormat.JPEGã€Bitmap.CompressFormat.PNGã€Bitmap.CompressFormat.WEBP</strong></p><p><strong>â‘¢</strong>BitmapFactoryæä¾›äº†å››ç±»åŠ è½½æ–¹æ³•ï¼š<strong>decodeFileã€decodeResourceã€decodeStreamã€decodeByteArrayã€‚å·¨å›¾åŠ è½½ï¼šBitmapRegionDecoderï¼Œå¯ä»¥æŒ‰ç…§åŒºåŸŸè¿›è¡ŒåŠ è½½ã€‚é«˜æ•ˆåŠ è½½ï¼šæ ¸å¿ƒå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œä¸»è¦æ˜¯é‡‡æ ·å‹ç¼©ã€ç¼“å­˜ç­–ç•¥ã€å¼‚æ­¥åŠ è½½ç­‰</strong></p><p>â‘£<strong>å†…å­˜ä¼˜åŒ–</strong>ï¼šç¼“å­˜LRUã€ç¼©æ”¾ã€Configã€Compressé€‰æ‹©ã€å†…å­˜ç®¡ç†ã€ç¼“å­˜æ–¹å¼ç­‰ç­‰æ–¹é¢å…¥æ‰‹ã€‚ã€å†…å­˜ç®¡ç†ã€å†…å­˜ä¼˜åŒ–ã€ç¼©æ”¾ã€configã€compress</p><p>å¼€æºæ¡†æ¶ï¼šImageLoaderã€Glideï¼ˆgoogleï¼‰ã€Frescoï¼ˆFaceBookï¼‰ã€Picassoï¼ˆSquareï¼‰</p><p><strong>å›¾ç‰‡ä¼˜åŒ–ï¼šå¼‚æ­¥åŠ è½½ï¼Œå‹ç¼©å¤„ç†bitmapFactory.optionsï¼Œè®¾ç½®å†…å­˜å¤§å°ï¼Œç¼“å­˜äºå†…å­˜ã€SDå¡ï¼Œæ²¡æœ‰å†…å­˜å†ä»ç½‘ç»œå–</strong>ã€‚</p><p><strong>PicassoåŒ…ä½“ç§¯å°ã€æ¸…æ™°ï¼Œä½†åŠŸèƒ½æœ‰å±€é™ä¸èƒ½åŠ è½½gifã€åªèƒ½ç¼“å­˜å…¨å°ºå¯¸ï¼›</strong></p><p><strong>GlideåŠŸèƒ½å…¨é¢ï¼Œæ“…é•¿å¤§å‹å›¾ç‰‡æµï¼Œä½“ç§¯è¾ƒå¤§ï¼›</strong></p><p><strong>Frescoå†…å­˜ä¼˜åŒ–ï¼Œå‡å°‘oomï¼Œä½“ç§¯æ›´å¤§ã€‚</strong></p><p><strong>å¦‚ä½•å¤„ç†å¤§å›¾ï¼šBitmapFactory.Optionsï¼ŒæŠŠinJustDecodeBoundsè¿™ä¸ªå±æ€§è®¾ä¸ºtrueï¼Œè®¡ç®—inSampleSizeã€‚å‚è€ƒæ–‡ç« ï¼šå®˜æ–¹æ¨èæ–¹æ³•ï¼Œå¦‚ä½•æœ‰æ•ˆç‡çš„åŠ è½½å¤§å›¾Bitmap - æœˆæ¯›æ¯›çš„ä¸“æ  - CSDNåšå®¢</strong></p><h4 id="19-Handleræœºåˆ¶"><a href="#19-Handleræœºåˆ¶" class="headerlink" title="19.Handleræœºåˆ¶"></a>19.Handleræœºåˆ¶</h4><p><strong>ä¸»çº¿ç¨‹ä¸èƒ½è¿›è¡Œè€—æ—¶æ“ä½œï¼Œå­çº¿ç¨‹ä¸èƒ½æ›´æ–°UIï¼ŒHandlerå®ç°çº¿ç¨‹é—´é€šä¿¡ï¼Œå°†è¦å‘é€çš„æ¶ˆæ¯ä¿å­˜åˆ°Messageä¸­ï¼ŒHandlerè°ƒç”¨sendMessage()æ–¹æ³•å°†messageå‘é€åˆ°MessageQueueï¼ŒLooperå¯¹è±¡ä¸æ–­è°ƒç”¨loop()æ–¹æ³•ï¼Œä¸æ–­ä»MessageQueueä¸­å–å‡ºmessageäº¤ç»™handlerå¤„ç†ï¼Œä»è€Œå®ç°çº¿ç¨‹é—´çš„é€šä¿¡ã€‚</strong></p><p>ä¸»çº¿ç¨‹handlerä¸éœ€è¦è°ƒç”¨Looper.prepare()ï¼ŒLooper.loop()ï¼Œé€šè¿‡sendMessageå°†messageæ·»åŠ åˆ°messagequeueã€‚</p><p>å­çº¿ç¨‹å¯ä»¥new Handlerã€‚</p><p><strong>æ€»ç»“ï¼šå½“åˆ›å»ºHandleræ—¶å°†é€šè¿‡ThreadLocalåœ¨å½“å‰çº¿ç¨‹ç»‘å®šä¸€ä¸ªLooperå¯¹è±¡ï¼Œè€ŒLooperæŒæœ‰MessageQueueå¯¹è±¡ã€‚æ‰§è¡ŒHandler.sendMessage(Message)æ–¹æ³•å°†ä¸€ä¸ªå¾…å¤„ç†çš„Messageæ’å…¥åˆ°MessageQueueä¸­ï¼Œè¿™æ—¶å€™é€šè¿‡Looper.loop()æ–¹æ³•è·å–åˆ°é˜Ÿåˆ—ä¸­Messageï¼Œç„¶åå†äº¤ç”±Handler.handleMessage(Message)æ¥å¤„ç†ã€‚</strong></p><h4 id="20-æ€§èƒ½ä¼˜åŒ–æŠ€å·§"><a href="#20-æ€§èƒ½ä¼˜åŒ–æŠ€å·§" class="headerlink" title="20.æ€§èƒ½ä¼˜åŒ–æŠ€å·§"></a>20.æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h4><p>å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–ï¼Œå¸ƒå±€ä¼˜åŒ–ï¼Œå†…å­˜ã€ç”µé‡ã€APPå¤§å°ä¼˜åŒ–ã€åˆ—è¡¨æ»‘åŠ¨ä¼˜åŒ–ç­‰ç­‰ã€‚</p><p>æ€§èƒ½ä¼˜åŒ–å·¥å…·ï¼šTraceViewã€Hierarchy Viewerã€‚</p><h4 id="21-ANRï¼ˆApplication-Not-Respondingï¼‰"><a href="#21-ANRï¼ˆApplication-Not-Respondingï¼‰" class="headerlink" title="21.ANRï¼ˆApplication Not Respondingï¼‰"></a>21.ANRï¼ˆApplication Not Respondingï¼‰</h4><p>æ‰©å±•æ–‡é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/54f945a15acb" target="_blank" rel="noopener">æ·±å…¥ç†è§£ANR - ç®€ä¹¦</a></p><p>Androidåº”ç”¨ç¨‹åºæœ‰ä¸€æ®µæ—¶é—´å“åº”ä¸å¤Ÿçµæ•ï¼Œç³»ç»Ÿä¼šå‘ç”¨æˆ·æ˜¾ç¤ºåº”ç”¨ç¨‹åºæ— å“åº”ï¼ˆANRï¼šApplication Not Respondingï¼‰å¯¹è¯æ¡†ã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©â€œç­‰å¾…â€è€Œè®©ç¨‹åºç»§ç»­è¿è¡Œï¼Œä¹Ÿå¯ä»¥é€‰æ‹©â€œå¼ºåˆ¶å…³é—­â€ã€‚æ‰€ä»¥ä¸€ä¸ªæµç•…çš„åˆç†çš„åº”ç”¨ç¨‹åºä¸­ä¸èƒ½å‡ºç°ANRï¼Œè€Œè®©ç”¨æˆ·æ¯æ¬¡éƒ½è¦å¤„ç†è¿™ä¸ªå¯¹è¯æ¡†ã€‚å› æ­¤ï¼Œåœ¨ç¨‹åºé‡Œå¯¹å“åº”æ€§èƒ½çš„è®¾è®¡å¾ˆé‡è¦ï¼Œè¿™æ ·ç³»ç»Ÿä¸ä¼šæ˜¾ç¤ºANRç»™ç”¨æˆ·ã€‚<strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨androidä¸­Activityçš„æœ€é•¿æ‰§è¡Œæ—¶é—´æ˜¯5ç§’ï¼ŒBroadcastReceiverçš„æœ€é•¿æ‰§è¡Œæ—¶é—´åˆ™æ˜¯10ç§’ã€‚</strong></p><p>åŸå› ï¼š<strong>ä¸»çº¿ç¨‹åšè€—æ—¶æ“ä½œï¼›ä¸»çº¿ç¨‹è¢«å…¶ä»–çº¿ç¨‹é”ï¼›CPUè¢«å…¶ä»–è¿›ç¨‹å ç”¨ï¼Œè¯¥è¿›ç¨‹æ²¡æœ‰åˆ†é…CPUèµ„æºï¼›OnReceiverè¿‡å¤šæ“ä½œï¼ŒIOæ“ä½œï¼Œå¦‚æ•°æ®åº“ã€æ–‡ä»¶ã€ç½‘ç»œ</strong>ã€‚</p><h4 id="22-è‡ªå®šä¹‰View"><a href="#22-è‡ªå®šä¹‰View" class="headerlink" title="22.è‡ªå®šä¹‰View"></a>22.è‡ªå®šä¹‰View</h4><p>æ‰©å±•æ–‡é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/705a6cb6bfee" target="_blank" rel="noopener">Androidè‡ªå®šä¹‰Viewå…¨è§£ - ç®€ä¹¦</a></p><p>è‡ªå®šä¹‰ç»„åˆæ§ä»¶  å¤šä¸ªæ§ä»¶ç»„åˆæˆä¸ºä¸€ä¸ªæ–°çš„æ§ä»¶ï¼Œæ–¹ä¾¿å¤šå¤„å¤ç”¨</p><p>ç»§æ‰¿ç³»ç»ŸViewæ§ä»¶  ç»§æ‰¿è‡ªTextViewç­‰ç³»ç»Ÿæ§ä»¶ï¼Œåœ¨ç³»ç»Ÿæ§ä»¶çš„åŸºç¡€åŠŸèƒ½ä¸Šè¿›è¡Œæ‰©å±•</p><p>ç»§æ‰¿View  ä¸å¤ç”¨ç³»ç»Ÿæ§ä»¶é€»è¾‘ï¼Œç»§æ‰¿Viewè¿›è¡ŒåŠŸèƒ½å®šä¹‰</p><p>ç»§æ‰¿ç³»ç»ŸViewGroup  ç»§æ‰¿è‡ªLinearLayoutç­‰ç³»ç»Ÿæ§ä»¶ï¼Œåœ¨ç³»ç»Ÿæ§ä»¶çš„åŸºç¡€åŠŸèƒ½ä¸Šè¿›è¡Œæ‰©å±•</p><p>ç»§æ‰¿ViewViewGroup  ä¸å¤ç”¨ç³»ç»Ÿæ§ä»¶é€»è¾‘ï¼Œç»§æ‰¿ViewGroupè¿›è¡ŒåŠŸèƒ½å®šä¹‰</p><p> <strong>Viewç»˜åˆ¶æµç¨‹åŸºæœ¬ç”±measure()ã€layout()ã€draw()è¿™ä¸ªä¸‰ä¸ªå‡½æ•°å®Œæˆ</strong></p><p>å‡½æ•°ä½œç”¨ç›¸å…³æ–¹æ³•</p><p><strong>measure()æµ‹é‡Viewçš„å®½é«˜measure(),setMeasuredDimension(),onMeasure()</strong></p><p><strong>layout()è®¡ç®—å½“å‰Viewä»¥åŠå­Viewçš„ä½ç½®layout(),onLayout(),setFrame()</strong></p><p><strong>draw()è§†å›¾çš„ç»˜åˆ¶å·¥ä½œdraw(),onDraw()</strong></p><p><strong>è‡ªå®šä¹‰Viewçš„æ³¨æ„äº‹é¡¹   å‚è€ƒæ–‡ç« ï¼šAndroidè‡ªå®šä¹‰Viewæ³¨æ„äº‹é¡¹ - ç®€ä¹¦</strong></p><p><strong>â‘ éœ€è¦åœ¨onMeasureæ–¹æ³•ä¸­å¤„ç†wrap_contentçš„æ–¹æ³•ï¼Œè®©Viewæ”¯æŒwrap_contentï¼›</strong></p><p><strong>â‘¡é¿å…paddingå’Œå­å…ƒç´ çš„marginå¤±æ•ˆï¼Œè®©Viewæ”¯æŒpaddingï¼›</strong></p><p><strong>â‘¢å°½é‡ä¸è¦åœ¨Viewä¸­ä½¿ç”¨Handlerï¼ŒViewä¸­å·²æä¾›äº†postç³»åˆ—æ–¹æ³•ï¼Œå¯æ›¿ä»£Handlerä½œç”¨ï¼›</strong></p><p><strong>â‘£é¿å…é€ æˆå†…å­˜æ³„æ¼ï¼ŒViewä¸­å¦‚æœæœ‰çº¿ç¨‹æˆ–è€…åŠ¨ç”»ï¼Œéœ€è¦åŠæ—¶åœæ­¢ã€‚</strong></p><h4 id="23-MVCã€MVPã€MVVMä¸‰ç§æ¶æ„è®¾è®¡"><a href="#23-MVCã€MVPã€MVVMä¸‰ç§æ¶æ„è®¾è®¡" class="headerlink" title="23.MVCã€MVPã€MVVMä¸‰ç§æ¶æ„è®¾è®¡"></a>23.MVCã€MVPã€MVVMä¸‰ç§æ¶æ„è®¾è®¡</h4><p>æ‰©å±•æ–‡é“¾æ¥ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Flihaoxiang123%2Farticle%2Fdetails%2F78977181" target="_blank" rel="noopener">Androidé«˜ç²¾æˆ˜äº‰ï¼ˆMVCã€MVPã€MVVMï¼‰ - lihaoxiang123çš„åšå®¢ - CSDNåšå®¢</a></p><p>MVCå…¨åæ˜¯Model View Controllerï¼Œå¦‚å›¾ï¼Œæ˜¯æ¨¡å‹(model)ï¼è§†å›¾(view)ï¼æ§åˆ¶å™¨(controller)çš„ç¼©å†™ï¼Œä¸€ç§è½¯ä»¶è®¾è®¡å…¸èŒƒï¼Œç”¨ä¸€ç§ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ã€ç•Œé¢æ˜¾ç¤ºåˆ†ç¦»çš„æ–¹æ³•ç»„ç»‡ä»£ç ï¼Œåœ¨æ”¹è¿›å’Œä¸ªæ€§åŒ–å®šåˆ¶ç•Œé¢åŠç”¨æˆ·äº¤äº’çš„åŒæ—¶ï¼Œä¸éœ€è¦é‡æ–°ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚</p><p>å…¶ä¸­Må±‚å¤„ç†æ•°æ®ï¼Œä¸šåŠ¡é€»è¾‘ç­‰ï¼›Vå±‚å¤„ç†ç•Œé¢çš„æ˜¾ç¤ºç»“æœï¼›Cå±‚èµ·åˆ°æ¡¥æ¢çš„ä½œç”¨ï¼Œæ¥æ§åˆ¶Vå±‚å’ŒMå±‚é€šä¿¡ä»¥æ­¤æ¥è¾¾åˆ°åˆ†ç¦»è§†å›¾æ˜¾ç¤ºå’Œä¸šåŠ¡é€»è¾‘å±‚ã€‚</p><p>MVPä»æ›´æ—©çš„MVCæ¡†æ¶æ¼”å˜è¿‡æ¥ï¼Œä¸MVCæœ‰ä¸€å®šçš„ç›¸ä¼¼æ€§ï¼šController/Presenterè´Ÿè´£é€»è¾‘çš„å¤„ç†ï¼ŒModelæä¾›æ•°æ®ï¼ŒViewè´Ÿè´£æ˜¾ç¤ºã€‚</p><p>MVPæ¡†æ¶ç”±3éƒ¨åˆ†ç»„æˆï¼šViewè´Ÿè´£æ˜¾ç¤ºï¼ŒPresenterè´Ÿè´£é€»è¾‘å¤„ç†ï¼ŒModelæä¾›æ•°æ®ã€‚åœ¨MVPæ¨¡å¼é‡Œé€šå¸¸åŒ…å«3ä¸ªè¦ç´ ï¼ˆåŠ ä¸ŠView interfaceæ˜¯4ä¸ªï¼‰ï¼š</p><p>View:è´Ÿè´£ç»˜åˆ¶UIå…ƒç´ ã€ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’(åœ¨Androidä¸­ä½“ç°ä¸ºActivity)</p><p>Model:è´Ÿè´£å­˜å‚¨ã€æ£€ç´¢ã€æ“çºµæ•°æ®(æœ‰æ—¶ä¹Ÿå®ç°ä¸€ä¸ªModel interfaceç”¨æ¥é™ä½è€¦åˆ)</p><p>Presenter:ä½œä¸ºViewä¸Modeläº¤äº’çš„ä¸­é—´çº½å¸¦ï¼Œå¤„ç†ä¸ç”¨æˆ·äº¤äº’çš„è´Ÿè´£é€»è¾‘ã€‚</p><p>View interface:éœ€è¦Viewå®ç°çš„æ¥å£ï¼ŒViewé€šè¿‡View interfaceä¸Presenterè¿›è¡Œäº¤äº’ï¼Œé™ä½è€¦åˆï¼Œæ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•</p><p>MVC ä¸MVPçš„åŒºåˆ«</p><p>ï¼ˆæœ€ä¸»è¦åŒºåˆ«ï¼‰<strong>Viewä¸Modelå¹¶ä¸ç›´æ¥äº¤äº’ï¼Œè€Œæ˜¯é€šè¿‡ä¸Presenteräº¤äº’æ¥ä¸Modelé—´æ¥äº¤äº’ã€‚è€Œåœ¨MVCä¸­Viewå¯ä»¥ä¸Modelç›´æ¥äº¤äº’</strong></p><p><strong>é€šå¸¸Viewä¸Presenteræ˜¯ä¸€å¯¹ä¸€çš„</strong>ï¼Œä½†å¤æ‚çš„Viewå¯èƒ½ç»‘å®šå¤šä¸ªPresenteræ¥å¤„ç†é€»è¾‘ã€‚è€ŒControlleræ˜¯åŸºäºè¡Œä¸ºçš„ï¼Œå¹¶ä¸”å¯ä»¥è¢«å¤šä¸ªViewå…±äº«ï¼ŒControllerå¯ä»¥è´Ÿè´£å†³å®šæ˜¾ç¤ºå“ªä¸ªView</p><p><strong>Presenterä¸Viewçš„äº¤äº’æ˜¯é€šè¿‡æ¥å£æ¥è¿›è¡Œçš„ï¼Œæ›´æœ‰åˆ©äºæ·»åŠ å•å…ƒæµ‹è¯•ã€‚</strong></p><p>åœ¨MVPä¸­ï¼ŒActivityçš„ä»£ç ä¸è‡ƒè‚¿ï¼›</p><p>åœ¨MVPä¸­ï¼ŒModel(IUserModelçš„å®ç°ç±»)çš„æ”¹åŠ¨ä¸ä¼šå½±å“Activity(View)ï¼Œä¸¤è€…ä¹Ÿäº’ä¸å¹²æ¶‰ï¼Œè€Œåœ¨MVCä¸­ä¼šï¼›</p><p>åœ¨MVPä¸­ï¼ŒIUserViewè¿™ä¸ªæ¥å£å¯ä»¥å®ç°æ–¹ä¾¿åœ°å¯¹Presenterçš„æµ‹è¯•ï¼›</p><p>åœ¨MVPä¸­ï¼ŒUserPresenterå¯ä»¥ç”¨äºå¤šä¸ªè§†å›¾ï¼Œä½†æ˜¯åœ¨MVCä¸­çš„Activityå°±ä¸è¡Œã€‚</p><p>MVVMå¯ä»¥ç®—æ˜¯MVPçš„å‡çº§ç‰ˆï¼Œå…¶ä¸­çš„VMæ˜¯ViewModelçš„ç¼©å†™ï¼ŒViewModelå¯ä»¥ç†è§£æˆæ˜¯Viewçš„æ•°æ®æ¨¡å‹å’ŒPresenterçš„åˆä½“ï¼ŒViewModelå’ŒViewä¹‹é—´çš„äº¤äº’é€šè¿‡Data Bindingå®Œæˆï¼Œè€ŒData Bindingå¯ä»¥å®ç°åŒå‘çš„äº¤äº’ï¼Œè¿™å°±ä½¿å¾—è§†å›¾å’Œæ§åˆ¶å±‚ä¹‹é—´çš„è€¦åˆç¨‹åº¦è¿›ä¸€æ­¥é™ä½ï¼Œå…³æ³¨ç‚¹åˆ†ç¦»æ›´ä¸ºå½»åº•ï¼ŒåŒæ—¶å‡è½»äº†Activityçš„å‹åŠ›ã€‚</p><h4 id="24-APP-å¯åŠ¨æµç¨‹"><a href="#24-APP-å¯åŠ¨æµç¨‹" class="headerlink" title="24.APP å¯åŠ¨æµç¨‹"></a>24.APP å¯åŠ¨æµç¨‹</h4><p>ç‚¹å‡»æ¡Œé¢å›¾æ ‡ï¼Œlauncherè¿›ç¨‹å¯åŠ¨ä¸»Activityä»¥Binderæ–¹å¼å‘é€ç»™AMSæœåŠ¡ï¼Œäº¤ä»˜ç»™ActivityManagerServiceå¤„ç†Intentå’Œflagä¿¡æ¯ï¼Œé€šè¿‡prepareMainLooper()æ–¹æ³•loopå¤„ç†æ¶ˆæ¯</p><h4 id="25-æ’ä»¶åŒ–"><a href="#25-æ’ä»¶åŒ–" class="headerlink" title="25.æ’ä»¶åŒ–"></a>25.æ’ä»¶åŒ–</h4><p><strong>è§£é™¤ä»£ç è€¦åˆï¼Œæ’ä»¶æ”¯æŒçƒ­æ’æ‹”ï¼Œé™é»˜å‡çº§ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³65kå±æ€§å’Œæ–¹æ³•çš„bugï¼Œè¿›è¡Œè‡ªå®šä¹‰classLoaderã€‚</strong></p><p>æ’ä»¶åŒ–å’Œçƒ­ä¿®å¤éƒ½æ˜¯åŠ¨æ€åŠ è½½æŠ€æœ¯ï¼Œä½¿ç”¨åœºæ™¯ä¸åŒï¼Œ<strong>çƒ­ä¿®å¤ä¸ºè§£å†³çº¿ä¸Šé—®é¢˜æˆ–è€…å°åŠŸèƒ½æ›´æ–°ï¼Œæ’ä»¶åŒ–è§£å†³åº”ç”¨ä¸Šçš„å¤§é—®é¢˜ã€‚</strong></p><p><strong>ç»„ä»¶åŒ–ï¼šä¸ºäº†è§£è€¦ï¼ŒæŠŠå¤æ‚ç³»ç»Ÿæ‹†åˆ†æˆå¤šä¸ªç»„ä»¶ï¼Œåˆ†ç¦»ç»„ä»¶è¾¹ç•Œå’Œè´£ä»»ï¼Œä¾¿äºç‹¬ç«‹å‡çº§å’Œç»´æŠ¤ã€‚</strong></p><p>26.Kotlin æ˜¯ä¸€ä¸ªç”¨äºç°ä»£<strong>å¤šå¹³å°åº”ç”¨çš„é™æ€ç¼–ç¨‹è¯­è¨€</strong>ï¼Œç”± <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fbaike.baidu.com%2Fitem%2FJetBrains" target="_blank" rel="noopener">JetBrains</a> å¼€å‘ã€‚Kotlinå¯ä»¥ç¼–è¯‘æˆJavaå­—èŠ‚ç ï¼Œä¹Ÿå¯ä»¥ç¼–è¯‘æˆJavaScriptï¼Œæ–¹ä¾¿åœ¨æ²¡æœ‰JVMçš„è®¾å¤‡ä¸Šè¿è¡Œã€‚Kotlinå·²æ­£å¼æˆä¸ºAndroidå®˜æ–¹æ”¯æŒå¼€å‘è¯­è¨€ã€‚</p><p>React Native (ç®€ç§°RN)æ˜¯Facebookäº2015å¹´4æœˆå¼€æºçš„è·¨å¹³å°ç§»åŠ¨åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œæ˜¯Facebookæ—©å…ˆå¼€æºçš„JSæ¡†æ¶ React åœ¨åŸç”Ÿç§»åŠ¨åº”ç”¨å¹³å°çš„è¡ç”Ÿäº§ç‰©ï¼Œç›®å‰æ”¯æŒiOSå’Œå®‰å“ä¸¤å¤§å¹³å°ã€‚RNä½¿ç”¨Javascriptè¯­è¨€ï¼Œç±»ä¼¼äºHTMLçš„JSXï¼Œä»¥åŠCSSæ¥å¼€å‘ç§»åŠ¨åº”ç”¨ï¼Œå› æ­¤ç†Ÿæ‚‰Webå‰ç«¯å¼€å‘çš„æŠ€æœ¯äººå‘˜åªéœ€å¾ˆå°‘çš„å­¦ä¹ å°±å¯ä»¥è¿›å…¥ç§»åŠ¨åº”ç”¨å¼€å‘é¢†åŸŸã€‚ <strong>flutterã€‚</strong></p><h4 id="27-Framework-å·¥ä½œåŸç†"><a href="#27-Framework-å·¥ä½œåŸç†" class="headerlink" title="27.Framework å·¥ä½œåŸç†"></a>27.Framework å·¥ä½œåŸç†</h4><p><strong>Android ç³»ç»Ÿå¯¹Linuxã€kernelã€libåº“ç­‰å°è£…ï¼Œæä¾›WMSã€AMSã€binderæœºåˆ¶ï¼Œhandler-messageæœºåˆ¶ç­‰æ–¹å¼ï¼Œä¾›APPä½¿ç”¨ã€‚Framework å°±æ˜¯æä¾›APPç”Ÿå­˜ç¯å¢ƒã€‚</strong></p><h4 id="28-Android-å±å¹•é€‚é…"><a href="#28-Android-å±å¹•é€‚é…" class="headerlink" title="28.Android å±å¹•é€‚é…"></a>28.Android å±å¹•é€‚é…</h4><p>å„ç§dpæ–‡ä»¶ï¼Œä½¿ç”¨å„ç§å°ºå¯¸å±å¹•</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722160920.png" alt></p><p><strong>å¸ƒå±€æ–‡ä»¶ä¸­viewè®¾ç½®é«˜å®½æ—¶ä¸é™å®šå¤§å°ï¼Œå°½é‡ä½¿ç”¨wrap_contentï¼Œmatch_parentï¼›ä»£ç ä¸­è®¾ç½®é«˜å®½å‰å¯è·å–å±å¹•å¤§å°ï¼Œå¦‚æœæ˜¯çº¿æ€§å¸ƒå±€å¯è®¾ç½®viewåœ¨LinearLayoutçš„weightï¼›å•ä½dpé€‚é…å±å¹•ï¼Œå•ä½spé€‚ç”¨å­—ä½“ï¼Œå¤šå›¾ç‰‡ï¼Œå¤šå¸ƒå±€ã€‚</strong></p><h4 id="29-äº‹ä»¶åˆ†å‘æœºåˆ¶"><a href="#29-äº‹ä»¶åˆ†å‘æœºåˆ¶" class="headerlink" title="29.äº‹ä»¶åˆ†å‘æœºåˆ¶"></a>29.äº‹ä»¶åˆ†å‘æœºåˆ¶</h4><p>dispatchTouchEvent() è´Ÿè´£äº‹ä»¶åˆ†å‘ã€‚å½“ç‚¹å‡»äº‹ä»¶äº§ç”Ÿåï¼Œäº‹ä»¶é¦–å…ˆä¼ é€’ç»™å½“å‰Activityï¼Œè°ƒç”¨Activityçš„dispatchTouchEvent()æ–¹æ³•ï¼Œè¿”å›å€¼ä¸ºtrueåˆ™è¡¨ç¤ºViewæˆ–å­Viewæ¶ˆè´¹äº†æ­¤äº‹ä»¶ï¼Œå¦‚æœè¿”å›trueï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰æ¶ˆè´¹äº‹ä»¶ï¼Œå¹¶è°ƒç”¨çˆ¶Viewçš„onTouchEventæ–¹æ³•ã€‚</p><p>onTouchEvent()ç”¨äºå¤„ç†äº‹ä»¶ï¼Œè¿”å›å€¼å†³å®šå½“å‰æ§ä»¶æ˜¯å¦æ¶ˆè´¹äº†è¿™ä¸ªäº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å½“å‰æ§ä»¶åœ¨<strong>è°ƒç”¨çˆ¶Viewçš„onTouchEventæ–¹æ³•</strong>å®ŒTouchäº‹ä»¶åï¼Œæ˜¯å¦è¿˜å…è®¸Touchäº‹ä»¶ç»§ç»­å‘ä¸Šï¼ˆçˆ¶æ§ä»¶ï¼‰ä¼ é€’ï¼Œä¸€ä½†è¿”å›Trueï¼Œåˆ™çˆ¶æ§ä»¶ä¸ç”¨æ“å¿ƒè‡ªå·±æ¥å¤„ç†Touchäº‹ä»¶ã€‚è¿”å›trueï¼Œåˆ™å‘ä¸Šä¼ é€’ç»™çˆ¶æ§ä»¶ã€‚</p><p>onInterceptTouchEvent() ViewGroupçš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå¤„ç†äº‹ä»¶ï¼ˆç±»ä¼¼äºé¢„å¤„ç†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸å¤„ç†ï¼‰å¹¶æ”¹å˜äº‹ä»¶çš„ä¼ é€’æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯å†³å®šæ˜¯å¦å…è®¸Touchäº‹ä»¶ç»§ç»­å‘ä¸‹ï¼ˆå­æ§ä»¶ï¼‰ä¼ é€’ï¼Œä¸€ä½†è¿”å›Trueï¼ˆä»£è¡¨äº‹ä»¶åœ¨å½“å‰çš„viewGroupä¸­ä¼šè¢«å¤„ç†ï¼‰ï¼Œåˆ™å‘ä¸‹ä¼ é€’ä¹‹è·¯è¢«æˆªæ–­ï¼ˆæ‰€æœ‰å­æ§ä»¶å°†æ²¡æœ‰æœºä¼šå‚ä¸Touchäº‹ä»¶ï¼‰ï¼ŒåŒæ—¶æŠŠäº‹ä»¶ä¼ é€’ç»™å½“å‰çš„æ§ä»¶çš„onTouchEvent()å¤„ç†ï¼›è¿”å›falseï¼Œåˆ™æŠŠäº‹ä»¶äº¤ç»™å­æ§ä»¶çš„onInterceptTouchEvent()ã€‚</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722160945.png" alt></p><p>äº‹ä»¶åˆ†å‘æœºåˆ¶åŸç†å›¾</p><p>å½“ä¸€ä¸ªTouchäº‹ä»¶(è§¦æ‘¸äº‹ä»¶ä¸ºä¾‹)åˆ°è¾¾æ ¹èŠ‚ç‚¹ï¼Œå³Acitivtyçš„ViewGroupæ—¶ï¼Œå®ƒä¼šä¾æ¬¡ä¸‹å‘ï¼Œä¸‹å‘çš„è¿‡ç¨‹æ˜¯è°ƒç”¨å­View(ViewGroup)çš„dispatchTouchEventæ–¹æ³•å®ç°çš„ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ViewGroupéå†å®ƒåŒ…å«ç€çš„å­Viewï¼Œè°ƒç”¨æ¯ä¸ªViewçš„dispatchTouchEventæ–¹æ³•ï¼Œè€Œå½“å­Viewä¸ºViewGroupæ—¶ï¼Œåˆä¼šé€šè¿‡è°ƒç”¨ViwGroupçš„dispatchTouchEventæ–¹æ³•ç»§ç»­è°ƒç”¨å…¶å†…éƒ¨çš„Viewçš„dispatchTouchEventæ–¹æ³•ã€‚ä¸Šè¿°ä¾‹å­ä¸­çš„æ¶ˆæ¯ä¸‹å‘é¡ºåºæ˜¯è¿™æ ·çš„ï¼šâ‘ -â‘¡-â‘¤-â‘¥-â‘¦-â‘¢-â‘£ã€‚dispatchTouchEventæ–¹æ³•åªè´Ÿè´£äº‹ä»¶çš„åˆ†å‘ï¼Œå®ƒæ‹¥æœ‰booleanç±»å‹çš„è¿”å›å€¼ï¼Œå½“è¿”å›ä¸ºtrueæ—¶ï¼Œé¡ºåºä¸‹å‘ä¼šä¸­æ–­ã€‚</p><p>å°ç»“ï¼šonInterceptTouchEvent()é»˜è®¤è¿”å›falseï¼Œä¸åšæˆªè·ã€‚è¿”å›trueä¹‹åï¼Œäº‹ä»¶æµçš„åç«¯æ§ä»¶å°±æ²¡æœ‰æœºä¼šå¤„ç†touchäº‹ä»¶ã€‚viewçš„onTouchEvent()è¿”å›äº†falseï¼Œé‚£ä¹ˆè¯¥äº‹ä»¶å°†è¢«ä¼ é€’è‡³å…¶ä¸Šä¸€å±‚æ¬¡çš„viewçš„onTouchEvent()å¤„ç†ï¼Œå¦‚æœonTouchEvent()è¿”å›äº†trueï¼Œé‚£ä¹ˆåç»­äº‹ä»¶å°†å¯ä»¥ç»§ç»­ä¼ é€’ç»™è¯¥viewçš„onTouchEvent()å¤„ç†ã€‚</p><h4 id="30-Android-åŠ¨ç”»åˆ†ç±»ï¼šè§†å›¾ï¼Œå±æ€§ï¼Œå¸§ï¼Œgifã€‚"><a href="#30-Android-åŠ¨ç”»åˆ†ç±»ï¼šè§†å›¾ï¼Œå±æ€§ï¼Œå¸§ï¼Œgifã€‚" class="headerlink" title="30.Android åŠ¨ç”»åˆ†ç±»ï¼šè§†å›¾ï¼Œå±æ€§ï¼Œå¸§ï¼Œgifã€‚"></a>30.Android åŠ¨ç”»åˆ†ç±»ï¼šè§†å›¾ï¼Œå±æ€§ï¼Œå¸§ï¼Œgifã€‚</h4><h4 id="31-Android-è¿›ç¨‹"><a href="#31-Android-è¿›ç¨‹" class="headerlink" title="31.Android è¿›ç¨‹"></a>31.Android è¿›ç¨‹</h4><p>ä¸€èˆ¬å¤§ä½“åˆ†ä¸º<strong>å‰å°è¿›ç¨‹ï¼Œåå°è¿›ç¨‹ï¼Œå¯è§è¿›ç¨‹ï¼ŒæœåŠ¡è¿›ç¨‹ï¼Œç©ºè¿›ç¨‹</strong>è¿™äº”å¤§è¿›ç¨‹ã€‚å…¶ä¸­<strong>ç©ºè¿›ç¨‹ä¼˜å…ˆçº§æœ€ä½</strong>ï¼Œè°ƒç”¨startService()è®©serviceæ‰€åœ¨è¿›ç¨‹æˆä¸ºå‰å°è¿›ç¨‹ï¼Œserviceçš„onDestory()é‡Œé‡æ–°å¯åŠ¨è‡ªå·±å¯é¿å…åå°è¿›ç¨‹è¢«æ€æ­»ã€‚</p><p><strong>ä¸€ä¸ªåº”ç”¨å…è®¸å¤šä¸ªè¿›ç¨‹</strong>ï¼Œåœ¨æ¸…å•æ–‡ä»¶é…ç½®çš„serviceä¸ºä¸€ä¸ªè¿›ç¨‹ï¼ŒAndroid:processå°±å¯ä»¥é…ç½®ï¼›</p><p><strong>å¤šè¿›ç¨‹ä¼šå¼•èµ·çš„å¼‚å¸¸</strong>ï¼šé™æ€æˆå‘˜å’Œå•ä¾‹æ¨¡å¼ä¼šå¤±æ•ˆï¼Œçº¿ç¨‹åŒæ­¥æœºåˆ¶å®Œå…¨å¤±æ•ˆï¼ŒSharedPreferenceså¯é æ€§ä¸‹é™ï¼ŒApplicationä¼šå¤šæ¬¡åˆ›å»ºã€‚</p><h4 id="32-Android-äº”å¤§å­˜å‚¨æ–¹å¼"><a href="#32-Android-äº”å¤§å­˜å‚¨æ–¹å¼" class="headerlink" title="32.Android äº”å¤§å­˜å‚¨æ–¹å¼"></a>32.Android äº”å¤§å­˜å‚¨æ–¹å¼</h4><p>ä½¿ç”¨SharedPreferenceså­˜å‚¨æ•°æ®ï¼› æ–‡ä»¶å­˜å‚¨æ•°æ®ï¼›SQLiteæ•°æ®åº“å­˜å‚¨æ•°æ®ï¼›ä½¿ç”¨ContentProviderå­˜å‚¨æ•°æ®ï¼›ç½‘ç»œå­˜å‚¨æ•°æ®ã€‚</p><p>å½“APPæ²¡æœ‰è·å–æ–‡ä»¶å­˜å‚¨æƒé™æ—¶ï¼Œå½“éœ€è¦å­˜å‚¨å¤§æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä¿å­˜åœ¨APP-data-cacheç›®å½•é‡Œã€‚</p><p><strong>ContentProvider</strong>ï¼šæŠ½è±¡ç±»ï¼Œä¸ºä¸åŒåº”ç”¨æ•°æ®æä¾›æ•°æ®å…±äº«ï¼Œæä¾›ç»Ÿä¸€æ¥å£ï¼Œ<strong>é€šè¿‡uriæ ‡è¯†è¦è®¿é—®çš„æ•°æ®ã€‚</strong></p><h4 id="33-å±å¹•æ—‹è½¬Activityç”Ÿå‘½å‘¨æœŸ"><a href="#33-å±å¹•æ—‹è½¬Activityç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="33.å±å¹•æ—‹è½¬Activityç”Ÿå‘½å‘¨æœŸ"></a>33.å±å¹•æ—‹è½¬Activityç”Ÿå‘½å‘¨æœŸ</h4><p>å‚è€ƒæ–‡ç« é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/8c40829905ec" target="_blank" rel="noopener">Activityæ¨ªç«–å±åˆ‡æ¢ç”Ÿå‘½å‘¨æœŸå˜åŒ– - ç®€ä¹¦</a></p><p>1ã€ä¸è®¾ç½®Activityçš„android:configChangesæ—¶ï¼Œåˆ‡å±ä¼šé‡æ–°è°ƒç”¨å„ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåˆ‡æ¨ªå±æ—¶ä¼šæ‰§è¡Œ1æ¬¡ï¼Œåˆ‡ç«–å±æ—¶ä¼šæ‰§è¡Œ1æ¬¡</p><p>2ã€è®¾ç½®Activityçš„android:configChanges=â€orientationâ€æ—¶ï¼Œåˆ‡å±è¿˜æ˜¯ä¼šé‡æ–°è°ƒç”¨å„ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåˆ‡æ¨ªã€ç«–å±æ—¶åªä¼šæ‰§è¡Œä¸€æ¬¡</p><p>3ã€è®¾ç½®Activityçš„android:configChanges=â€orientation|keyboardHidden|screenSizeâ€æ—¶ï¼Œåˆ‡å±ä¸ä¼šé‡æ–°è°ƒç”¨å„ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåªä¼šæ‰§è¡ŒonConfigurationChangedæ–¹æ³•</p><p>4ã€è®¾ç½®Activityçš„android:configChanges=â€orientation|keyboardHidden|screenSizeâ€æ—¶ï¼Œåˆ‡å±åˆ‡è®°è¦åŠ ä¸ŠscreenSize,å¦åˆ™4.0ç‰ˆæœ¬ä»¥ä¸Šç”Ÿå‘½å‘¨æœŸä¸ç”Ÿæ•ˆ</p><h4 id="34-Activity-å››å¤§å¯åŠ¨æ¨¡å¼"><a href="#34-Activity-å››å¤§å¯åŠ¨æ¨¡å¼" class="headerlink" title="34.Activity å››å¤§å¯åŠ¨æ¨¡å¼"></a>34.Activity å››å¤§å¯åŠ¨æ¨¡å¼</h4><p><strong>standard å¯åŠ¨æ¨¡å¼</strong></p><p> Activity é»˜è®¤çš„å¯åŠ¨æ¨¡å¼ï¼Œæ¯æ¬¡ startActivity éƒ½ä¼šåœ¨æ ˆé¡¶åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œåœ¨åŒä¸€ä¸ªä»»åŠ¡ä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªActivity çš„å®ä¾‹ã€‚</p><p><strong>singleTop å¯åŠ¨æ¨¡å¼</strong></p><p><strong>æ ˆé¡¶å¤ç”¨</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦å¯åŠ¨ singleTop æ¨¡å¼çš„ Activityï¼Œå¦‚æœå®ƒæ°å¥½åœ¨å½“å‰æ ˆé¡¶ï¼Œé‚£ä¹ˆç›´æ¥å¤ç”¨ï¼Œæ‰§è¡Œå…¶ onNewIntent æ–¹æ³•ã€‚å¦åˆ™ï¼Œå°±é‡æ–°åˆ›å»ºä¸€ä¸ªå®ä¾‹å…¥æ ˆã€‚</p><p>singleTask å¯åŠ¨æ¨¡å¼</p><p>åœ¨ç³»ç»Ÿä¸­<strong>åªæœ‰ä¸€ä¸ªå®ä¾‹</strong>ï¼Œå½“å†æ¬¡å¯åŠ¨è¯¥ Activity æ—¶ï¼Œä¼šé‡ç”¨å·²å­˜åœ¨çš„ä»»åŠ¡å’Œå®ä¾‹ï¼Œå¹¶ä¸”ä¼šè°ƒç”¨è¿™ä¸ªå®ä¾‹çš„ onNewIntent()æ–¹æ³•ï¼Œå°† Intent å®ä¾‹ä¼ é€’åˆ°è¯¥å®ä¾‹ä¸­ã€‚</p><p>singleInstance å¯åŠ¨æ¨¡å¼</p><p><strong>æ€»æ˜¯åœ¨æ–°çš„ä»»åŠ¡ä¸­å¼€å¯ï¼Œå¹¶ä¸”è¿™ä¸ªæ–°çš„ä»»åŠ¡ä¸­æœ‰ä¸”åªæœ‰è¿™ä¸€ä¸ªå®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´è¢«è¯¥å®ä¾‹å¯åŠ¨çš„å…¶ä»– Activity ä¼šè‡ªåŠ¨è¿è¡Œäºå¦ä¸€ä¸ªä»»åŠ¡ä¸­ã€‚</strong>å½“å†æ¬¡å¯åŠ¨è¯¥ Activity çš„å®ä¾‹æ—¶ï¼Œä¼šé‡ç”¨å·²å­˜åœ¨çš„ä»»åŠ¡å’Œå®ä¾‹ã€‚å¹¶ä¸”ä¼šè°ƒç”¨è¿™ä¸ªå®ä¾‹çš„onNewIntent()æ–¹æ³•ï¼Œå°† Intent å®ä¾‹ä¼ é€’åˆ°è¯¥å®ä¾‹ä¸­ã€‚</p><p>æ€»ç»“ï¼š<strong>â‘ standardæ¯ä¸€æ¬¡éƒ½ä¼šåˆ›å»ºæ–°çš„å®ä¾‹ï¼›â‘¡singleTopæ ˆé¡¶å¤ç”¨ã€‚å’Œstandardç›¸ä¼¼ï¼Œä½†æ˜¯å¦‚æœæ ˆé¡¶å·²æœ‰å®ä¾‹ï¼Œå¤ç”¨è¯¥å®ä¾‹ï¼Œå›è°ƒonNewIntent()æ–¹æ³•ï¼›â‘¢singleTaskæ ˆå†…å¤ç”¨ã€‚æŸ¥æ‰¾æ ˆå†…æœ‰æ²¡æœ‰è¯¥å®ä¾‹ï¼Œæœ‰åˆ™å¤ç”¨å›è°ƒonNewIntent()æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ–°å»ºActivityï¼Œå¹¶å…¥æ ˆï¼›â‘£singleInstanceå•ä¾‹æ¨¡å¼ï¼Œå…¨å±€å”¯ä¸€ã€‚å…·å¤‡singleTaskæ‰€æœ‰ç‰¹æ€§ï¼Œç‹¬å ä¸€ä¸ªä»»åŠ¡æ ˆã€‚</strong></p><h4 id="35-CPUæ˜¯ä¸€ä¸ªæœ‰å¤šåŠŸèƒ½çš„ä¼˜ç§€é¢†å¯¼è€…ï¼Œå®ƒçš„ä¼˜ç‚¹åœ¨äºè°ƒåº¦ã€ç®¡ç†ã€åè°ƒèƒ½åŠ›å¼ºï¼Œè®¡ç®—èƒ½åŠ›åˆ™ä½äºå…¶æ¬¡ï¼Œè€ŒGPUç›¸å½“äºä¸€ä¸ªèƒ½æ¥å—CPUè°ƒåº¦çš„â€œæ‹¥æœ‰å¼ºå¤§è®¡ç®—èƒ½åŠ›â€çš„å‘˜å·¥ï¼ŒGPUæä¾›äº†å¤šæ ¸å¹¶è¡Œè®¡ç®—çš„åŸºç¡€ç»“æ„ï¼Œä¸”æ ¸å¿ƒæ•°éå¸¸å¤šï¼Œå¯æ”¯æ’‘å¤§é‡æ•°æ®çš„å¹¶è¡Œæ“ä½œï¼Œæ‹¥æœ‰æ›´é«˜çš„è®¿å­˜é€Ÿåº¦ï¼Œæ›´é«˜çš„æµ®ç‚¹è¿ç®—èƒ½åŠ›ã€‚"><a href="#35-CPUæ˜¯ä¸€ä¸ªæœ‰å¤šåŠŸèƒ½çš„ä¼˜ç§€é¢†å¯¼è€…ï¼Œå®ƒçš„ä¼˜ç‚¹åœ¨äºè°ƒåº¦ã€ç®¡ç†ã€åè°ƒèƒ½åŠ›å¼ºï¼Œè®¡ç®—èƒ½åŠ›åˆ™ä½äºå…¶æ¬¡ï¼Œè€ŒGPUç›¸å½“äºä¸€ä¸ªèƒ½æ¥å—CPUè°ƒåº¦çš„â€œæ‹¥æœ‰å¼ºå¤§è®¡ç®—èƒ½åŠ›â€çš„å‘˜å·¥ï¼ŒGPUæä¾›äº†å¤šæ ¸å¹¶è¡Œè®¡ç®—çš„åŸºç¡€ç»“æ„ï¼Œä¸”æ ¸å¿ƒæ•°éå¸¸å¤šï¼Œå¯æ”¯æ’‘å¤§é‡æ•°æ®çš„å¹¶è¡Œæ“ä½œï¼Œæ‹¥æœ‰æ›´é«˜çš„è®¿å­˜é€Ÿåº¦ï¼Œæ›´é«˜çš„æµ®ç‚¹è¿ç®—èƒ½åŠ›ã€‚" class="headerlink" title="35.CPUæ˜¯ä¸€ä¸ªæœ‰å¤šåŠŸèƒ½çš„ä¼˜ç§€é¢†å¯¼è€…ï¼Œå®ƒçš„ä¼˜ç‚¹åœ¨äºè°ƒåº¦ã€ç®¡ç†ã€åè°ƒèƒ½åŠ›å¼ºï¼Œè®¡ç®—èƒ½åŠ›åˆ™ä½äºå…¶æ¬¡ï¼Œè€ŒGPUç›¸å½“äºä¸€ä¸ªèƒ½æ¥å—CPUè°ƒåº¦çš„â€œæ‹¥æœ‰å¼ºå¤§è®¡ç®—èƒ½åŠ›â€çš„å‘˜å·¥ï¼ŒGPUæä¾›äº†å¤šæ ¸å¹¶è¡Œè®¡ç®—çš„åŸºç¡€ç»“æ„ï¼Œä¸”æ ¸å¿ƒæ•°éå¸¸å¤šï¼Œå¯æ”¯æ’‘å¤§é‡æ•°æ®çš„å¹¶è¡Œæ“ä½œï¼Œæ‹¥æœ‰æ›´é«˜çš„è®¿å­˜é€Ÿåº¦ï¼Œæ›´é«˜çš„æµ®ç‚¹è¿ç®—èƒ½åŠ›ã€‚"></a><strong>35.CPUæ˜¯ä¸€ä¸ªæœ‰å¤šåŠŸèƒ½çš„ä¼˜ç§€é¢†å¯¼è€…ï¼Œå®ƒçš„ä¼˜ç‚¹åœ¨äºè°ƒåº¦ã€ç®¡ç†ã€åè°ƒèƒ½åŠ›å¼ºï¼Œè®¡ç®—èƒ½åŠ›åˆ™ä½äºå…¶æ¬¡ï¼Œè€ŒGPUç›¸å½“äºä¸€ä¸ªèƒ½æ¥å—CPUè°ƒåº¦çš„â€œæ‹¥æœ‰å¼ºå¤§è®¡ç®—èƒ½åŠ›â€çš„å‘˜å·¥ï¼ŒGPUæä¾›äº†å¤šæ ¸å¹¶è¡Œè®¡ç®—çš„åŸºç¡€ç»“æ„ï¼Œä¸”æ ¸å¿ƒæ•°éå¸¸å¤šï¼Œå¯æ”¯æ’‘å¤§é‡æ•°æ®çš„å¹¶è¡Œæ“ä½œï¼Œæ‹¥æœ‰æ›´é«˜çš„è®¿å­˜é€Ÿåº¦ï¼Œæ›´é«˜çš„æµ®ç‚¹è¿ç®—èƒ½åŠ›ã€‚</strong></h4><h4 id="36-UIå¡é¡¿åŸå› "><a href="#36-UIå¡é¡¿åŸå› " class="headerlink" title="36.UIå¡é¡¿åŸå› "></a>36.UIå¡é¡¿åŸå› </h4><p>æ¯16msç»˜åˆ¶ä¸€æ¬¡Activityï¼Œå¦‚æœç”±äºä¸€äº›åŸå› å¯¼è‡´äº†æˆ‘ä»¬çš„é€»è¾‘ã€CPUè€—æ—¶ã€GPUè€—æ—¶å¤§äº16ms(<strong>åº”ç”¨å¡é¡¿çš„æ ¹æºå°±åœ¨äº16mså†…ä¸èƒ½å®Œæˆç»˜åˆ¶æ¸²æŸ“åˆæˆè¿‡ç¨‹,16mséœ€è¦å®Œæˆè§†å›¾æ ‘çš„æ‰€æœ‰æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶æ¸²æŸ“åŠåˆæˆ</strong>)ï¼ŒUIå°±æ— æ³•å®Œæˆä¸€æ¬¡ç»˜åˆ¶ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå¡é¡¿ã€‚<strong>â‘ å†…å­˜æŠ–åŠ¨é—®é¢˜ï¼Œâ‘¡æ–¹æ³•è€—æ—¶ï¼Œâ‘¢viewæœ¬èº«å¡é¡¿ã€‚</strong></p><p><strong>è§£å†³åŠæ³•ï¼šä¿®æ”¹æ–¹æ³•ï¼Œä½¿å…¶ä¸è€—æ—¶ï¼Œæ”¾åˆ°å­çº¿ç¨‹ä¸­ï¼Œå¦‚ç½‘ç»œè®¿é—®ï¼Œå¤§æ–‡ä»¶æ“ä½œç­‰ï¼Œé˜²æ­¢ANRï¼Œé¿å…GPUè¿‡åº¦ç»˜åˆ¶ã€‚</strong></p><h4 id="37-Applicationçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#37-Applicationçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="37.Applicationçš„ç”Ÿå‘½å‘¨æœŸ"></a><strong>37.Applicationçš„ç”Ÿå‘½å‘¨æœŸ</strong></h4><p><strong>å‚è€ƒæ–‡ç« ï¼šAndroidä¸­Applicationçš„ç”¨é€”åŠç”Ÿå‘½å‘¨æœŸ_YYå°çˆ¬è™«_æ–°æµªåšå®¢</strong></p><p>â‘ onCreate0 åœ¨åˆ›å»ºåº”ç”¨ç¨‹åºæ—¶åˆ›å»ºï¼›</p><p>â‘¡onTerminate()  åœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸‹æ‰§è¡Œã€‚å½“ç»ˆæ­¢åº”ç”¨ç¨‹åºå¯¹è±¡æ—¶è°ƒç”¨ï¼Œä¸ä¿è¯ä¸€å®šè¢«è°ƒç”¨ï¼Œå½“ç¨‹åºæ˜¯è¢«å†…æ ¸ç»ˆæ­¢ä»¥ä¾¿ä¸ºå…¶ä»–åº”ç”¨ç¨‹åºé‡Šæ”¾èµ„æºï¼Œé‚£ä¹ˆå°†ä¸ä¼šæé†’ï¼Œå¹¶ä¸”ä¸è°ƒç”¨åº”ç”¨ç¨‹åºçš„å¯¹è±¡çš„onTerminateæ–¹æ³•è€Œç›´æ¥ç»ˆæ­¢è¿›ç¨‹ï¼›</p><p>â‘¢onLowMemory() ä½å†…å­˜æ—¶æ‰§è¡Œã€‚å¥½çš„åº”ç”¨ç¨‹åºä¸€èˆ¬ä¼šåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢é‡Šæ”¾ä¸€äº›ä¸å¿…è¦çš„èµ„æºæ¥åº”ä»˜å½“åå°ç¨‹åºå·²ç»ç»ˆæ­¢ï¼Œå‰å°åº”ç”¨ç¨‹åºå†…å­˜è¿˜ä¸å¤Ÿæ—¶çš„æƒ…å†µï¼›</p><p>â‘£onConfigurationChanged(Configuration newConfig) é…ç½®æ”¹å˜æ—¶è§¦å‘è¿™ä¸ªæ–¹æ³•ã€‚</p><p>â‘¤onTrimMemory(int level) ç¨‹åºåœ¨è¿›è¡Œå†…å­˜æ¸…ç†æ—¶æ‰§è¡Œã€‚</p><h4 id="38-å¦‚ä½•é¿å…å› å¼•å…¥çš„å¼€æºåº“å¯¼è‡´çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ï¼Ÿ"><a href="#38-å¦‚ä½•é¿å…å› å¼•å…¥çš„å¼€æºåº“å¯¼è‡´çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ï¼Ÿ" class="headerlink" title="38.å¦‚ä½•é¿å…å› å¼•å…¥çš„å¼€æºåº“å¯¼è‡´çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ï¼Ÿ"></a>38.å¦‚ä½•é¿å…å› å¼•å…¥çš„å¼€æºåº“å¯¼è‡´çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ï¼Ÿ</h4><p>ç”±äºé¡¹ç›®å¼•å…¥äº†å¤ªå¤šç¬¬ä¸‰æ–¹å¼€æºåº“ï¼ŒAndroid APPæœ‰65536æ–¹æ³•æ•°çš„é—®é¢˜ï¼Œå¯ä½¿ç”¨multidexè§£å†³ã€‚<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fplugins.jetbrains.com%2Fplugin%2F8076%3Fpr%3Dandroidstudio" target="_blank" rel="noopener">Android Methods Count</a>æ’ä»¶å¯ä»¥é«˜æ•ˆç»Ÿè®¡Androidå¼€æºåº“çš„æ–¹æ³•æ•°ã€‚</p><h4 id="39-ç®€å•çš„éŸ³é¢‘-è§†é¢‘æ ¼å¼"><a href="#39-ç®€å•çš„éŸ³é¢‘-è§†é¢‘æ ¼å¼" class="headerlink" title="39.ç®€å•çš„éŸ³é¢‘/è§†é¢‘æ ¼å¼"></a><strong>39.ç®€å•çš„éŸ³é¢‘/è§†é¢‘æ ¼å¼</strong></h4><p><strong>PCM</strong>ï¼š<strong>è„‰å†²ç¼–ç è°ƒåˆ¶</strong>ï¼Œç”±äºŒè¿›åˆ¶æ•°å­—ä¿¡å·å¯¹å…‰æºè¿›è¡Œé€šæ–­è°ƒåˆ¶äº§ç”Ÿï¼Œæ²¡æœ‰å‹ç¼©çš„ç¼–ç æ–¹å¼ã€‚</p><p><strong>WAV</strong>ï¼š<strong>æ— æŸéŸ³é¢‘æ–‡ä»¶æ ¼å¼</strong>ï¼ŒPCMæ˜¯æ— æŸWAVæ–‡ä»¶ä¸­éŸ³é¢‘æ•°æ®çš„ä¸€ç§ç¼–ç æ–¹å¼ï¼Œä½†æ˜¯WAVè¿˜å¯ä»¥ç”¨å…¶å®ƒç¼–ç ã€‚</p><p><strong>AVI</strong>ï¼šéŸ³è§†é¢‘äº¤é”™ï¼Œè°ƒç”¨æ–¹ä¾¿ï¼Œå›¾åƒè´¨é‡å¥½ï¼Œå‹ç¼©æ ‡å‡†å¯é€‰ã€‚</p><p><strong>WMV</strong>ï¼šå¯æ‰©å……çš„åª’ä½“ç±»å‹ï¼Œæœ¬åœ°æˆ–ç½‘ç»œå›æ”¾ï¼Œæµä¼˜å…ˆçº§åŒ–ã€‚</p><p><strong>3GP</strong>ï¼š3Gæµåª’ä½“ï¼Œé…åˆ3Gç½‘ç»œé«˜é€Ÿä¼ è¾“è€Œå¼€å‘ã€‚</p><p><strong>FLV</strong>ï¼šæ–‡ä»¶å°ï¼ŒåŠ è½½é€Ÿåº¦å¿«ï¼Œç”¨äºç½‘ç»œè§‚çœ‹è§†é¢‘ã€‚</p><p><strong>MP4</strong>ï¼šéŸ³è§†é¢‘å‹ç¼©ç¼–ç æ ‡å‡†ã€‚</p><h4 id="40-çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•"><a href="#40-çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•" class="headerlink" title="40.çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•"></a>40.çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•</h4><p>è½¬è½½æ–‡ç« ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.cnblogs.com%2Fxiaoxi%2Fp%2F7679470.html" target="_blank" rel="noopener">å¤šçº¿ç¨‹åŒæ­¥çš„äº”ç§æ–¹æ³• - å¹³å‡¡å¸Œ - åšå®¢å›­</a></p><p><strong>â‘ synchronized</strong>  å³æœ‰synchronizedå…³é”®å­—ä¿®é¥°çš„æ–¹æ³•ã€‚ ç”±äºjavaçš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå†…ç½®é”ï¼Œå½“ç”¨æ­¤å…³é”®å­—ä¿®é¥°æ–¹æ³•æ—¶ï¼Œå†…ç½®é”ä¼šä¿æŠ¤æ•´ä¸ªæ–¹æ³•ã€‚åœ¨è°ƒç”¨è¯¥æ–¹æ³•å‰ï¼Œéœ€è¦è·å¾—å†…ç½®é”ï¼Œå¦åˆ™å°±å¤„äºé˜»å¡çŠ¶æ€ï¼›</p><p><strong>â‘¡åŒæ­¥ä»£ç å—</strong>  å³æœ‰synchronizedå…³é”®å­—ä¿®é¥°çš„è¯­å¥å—ã€‚è¢«è¯¥å…³é”®å­—ä¿®é¥°çš„è¯­å¥å—ä¼šè‡ªåŠ¨è¢«åŠ ä¸Šå†…ç½®é”ï¼Œä»è€Œå®ç°åŒæ­¥ï¼›</p><p><strong>â‘¢ä½¿ç”¨ç‰¹æ®Šå˜é‡Volatile</strong> </p><p>ï¼ˆ1ï¼‰volatileå…³é”®å­—ä¸ºåŸŸå˜é‡çš„è®¿é—®æä¾›äº†ä¸€ç§å…é”æœºåˆ¶ï¼›</p><p>ï¼ˆ2ï¼‰ä½¿ç”¨volatileä¿®é¥°åŸŸç›¸å½“äºå‘Šè¯‰è™šæ‹Ÿæœºè¯¥åŸŸå¯èƒ½ä¼šè¢«å…¶ä»–çº¿ç¨‹æ›´æ–°ï¼›</p><p>ï¼ˆ3ï¼‰å› æ­¤æ¯æ¬¡ä½¿ç”¨è¯¥åŸŸå°±è¦é‡æ–°è®¡ç®—ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¯„å­˜å™¨ä¸­çš„å€¼ï¼›</p><p>ï¼ˆ4ï¼‰volatileä¸ä¼šæä¾›ä»»ä½•åŸå­æ“ä½œï¼Œå®ƒä¹Ÿä¸èƒ½ç”¨æ¥ä¿®é¥°finalç±»å‹çš„å˜é‡ã€‚</p><p>â‘£<strong>ä½¿ç”¨é‡å…¥é”</strong></p><p>åœ¨JavaSE5.0ä¸­æ–°å¢äº†ä¸€ä¸ªjava.util.concurrentåŒ…æ¥æ”¯æŒåŒæ­¥ã€‚ReentrantLockç±»æ˜¯å¯é‡å…¥ã€äº’æ–¥ã€å®ç°äº†Lockæ¥å£çš„é”ï¼Œ å®ƒä¸ä½¿ç”¨synchronizedæ–¹æ³•å’Œå—å…·æœ‰ç›¸åŒçš„åŸºæœ¬è¡Œä¸ºå’Œè¯­ä¹‰ï¼Œå¹¶ä¸”æ‰©å±•äº†å…¶èƒ½åŠ›ï¼›</p><p><strong>â‘¤ä½¿ç”¨å±€éƒ¨å˜é‡ï¼›</strong></p><p><strong>â‘¥ä½¿ç”¨é˜»å¡é˜Ÿåˆ—ã€‚</strong></p><p><strong>çº¿ç¨‹sleep()å’Œwait()çš„åŒºåˆ«</strong></p><p><strong>sleep()ä¸é‡Šæ”¾åŒæ­¥é”ï¼Œè‡ªåŠ¨å”¤é†’ï¼Œéœ€è¦try-catchï¼Œçº¿ç¨‹æ–¹æ³•ã€‚</strong></p><p><strong>wait()é‡Šæ”¾åŒæ­¥é”ï¼Œéœ€è¦notifyå”¤é†’ï¼Œæ˜¯objectæ–¹æ³•ã€‚</strong></p><p><strong><em>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿå¦‚ä½•ä¸­æ–­ï¼Ÿ</em></strong></p><p>ç”Ÿå‘½å‘¨æœŸï¼šæ–‡ç« è½¬è½½ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.cnblogs.com%2Fwzy330782%2Fp%2F5456923.html" target="_blank" rel="noopener">å¤šçº¿ç¨‹â€”â€”çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ - ç§¯_è·¬æ­¥ - åšå®¢å›­</a></p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722161023.png" alt></p><p><strong>â‘  æ–°å»ºçŠ¶æ€(New Thread)</strong>ï¼šåœ¨Javaè¯­è¨€ä¸­ä½¿ç”¨new æ“ä½œç¬¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹åï¼Œè¯¥çº¿ç¨‹ä»…ä»…æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå®ƒå…·å¤‡ç±»çº¿ç¨‹çš„ä¸€äº›ç‰¹å¾ï¼Œä½†æ­¤æ—¶ç³»ç»Ÿæ²¡æœ‰ä¸ºå…¶åˆ†é…èµ„æºï¼Œè¿™æ—¶çš„çº¿ç¨‹å¤„äºåˆ›å»ºçŠ¶æ€ã€‚</p><p>çº¿ç¨‹å¤„äºåˆ›å»ºçŠ¶æ€æ—¶ï¼Œå¯é€šè¿‡Threadç±»çš„æ–¹æ³•æ¥è®¾ç½®å„ç§å±æ€§ï¼Œå¦‚çº¿ç¨‹çš„ä¼˜å…ˆçº§(setPriority)ã€çº¿ç¨‹å(setName)å’Œçº¿ç¨‹çš„ç±»å‹(setDaemon)ç­‰ã€‚</p><p><strong>â‘¡ å°±ç»ªçŠ¶æ€(Runnable)</strong>ï¼šä½¿ç”¨start()æ–¹æ³•å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹åï¼Œç³»ç»Ÿä¸ºè¯¥çº¿ç¨‹åˆ†é…äº†é™¤CPUå¤–çš„æ‰€éœ€èµ„æºï¼Œä½¿è¯¥çº¿ç¨‹å¤„äºå°±ç»ªçŠ¶æ€ã€‚æ­¤å¤–ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹æ‰§è¡Œäº†yield()æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè¢«æš‚æ—¶å‰¥å¤ºCPUèµ„æºï¼Œé‡æ–°è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚</p><p><strong>â‘¢ è¿è¡ŒçŠ¶æ€(Running)</strong>ï¼šJavaè¿è¡Œç³»ç»Ÿé€šè¿‡è°ƒåº¦é€‰ä¸­ä¸€ä¸ªå¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹ï¼Œä½¿å…¶å æœ‰CPUå¹¶è½¬ä¸ºè¿è¡ŒçŠ¶æ€ã€‚æ­¤æ—¶ï¼Œç³»ç»ŸçœŸæ­£æ‰§è¡Œçº¿ç¨‹çš„run()æ–¹æ³•ã€‚</p><p>a) å¯ä»¥é€šè¿‡Threadç±»çš„isAliveæ–¹æ³•æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å¤„äºå°±ç»ª/è¿è¡ŒçŠ¶æ€ï¼šå½“çº¿ç¨‹å¤„äºå°±ç»ª/è¿è¡ŒçŠ¶æ€æ—¶ï¼ŒisAliveè¿”å›trueï¼Œå½“isAliveè¿”å›falseæ—¶ï¼Œå¯èƒ½çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼Œä¹Ÿå¯èƒ½å¤„äºåœæ­¢çŠ¶æ€ã€‚</p><p><strong>â‘£ é˜»å¡å’Œå”¤é†’çº¿ç¨‹</strong></p><p>é˜»å¡çŠ¶æ€(Blocked)ï¼šä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å› æŸäº›åŸå› ä¸èƒ½ç»§ç»­è¿è¡Œæ—¶ï¼Œå°±è¿›å…¥é˜»å¡ çŠ¶æ€ã€‚è¿™äº›åŸå› åŒ…æ‹¬ï¼š</p><p>â€‹              a)å½“æ‰§è¡Œäº†æŸä¸ªçº¿ç¨‹å¯¹è±¡çš„sleep()ç­‰é˜»å¡ç±»å‹çš„æ–¹æ³•æ—¶ï¼Œè¯¥çº¿ç¨‹å¯¹è±¡ä¼šè¢«ç½®å…¥ä¸€ä¸ªé˜»å¡é›†å†…ï¼Œç­‰å¾…è¶…æ—¶è€Œè‡ªåŠ¨è‹é†’ã€‚</p><p>â€‹              b)å½“å¤šä¸ªçº¿ç¨‹è¯•å›¾è¿›å…¥æŸä¸ªåŒæ­¥åŒºåŸŸæ—¶ï¼Œæ²¡èƒ½è¿›å…¥è¯¥åŒæ­¥åŒºåŸŸçš„çº¿ç¨‹ä¼šè¢«ç½®å…¥é”å®šé›†ï¼Œç›´åˆ°è·å¾—è¯¥åŒæ­¥åŒºåŸŸçš„é”ï¼Œè¿›å…¥å°±ç»ªçŠ¶æ€ã€‚</p><p>â€‹              c)å½“çº¿ç¨‹æ‰§è¡Œäº†æŸä¸ªå¯¹è±¡çš„wait()æ–¹æ³•æ—¶ï¼Œçº¿ç¨‹ä¼šè¢«ç½®å…¥è¯¥å¯¹è±¡çš„ç­‰å¾…é›†ä¸­ï¼ŒçŸ¥é“æ‰§è¡Œäº†è¯¥å¯¹è±¡çš„notify()æ–¹æ³•wait()/notify()æ–¹æ³•çš„æ‰§è¡Œè¦æ±‚çº¿ç¨‹é¦–å…ˆè·å¾—è¯¥å¯¹è±¡çš„é”ã€‚</p><p><strong>â‘¤ æ­»äº¡çŠ¶æ€(Dead)</strong>ï¼šçº¿ç¨‹åœ¨run()æ–¹æ³•æ‰§è¡Œç»“æŸåè¿›å…¥æ­»äº¡çŠ¶æ€ã€‚æ­¤å¤–ï¼Œå¦‚æœçº¿ç¨‹æ‰§è¡Œäº†interrupt()æˆ–stop()æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä¹Ÿä¼šä»¥å¼‚å¸¸é€€å‡ºçš„æ–¹å¼è¿›å…¥æ­»äº¡çŠ¶æ€ã€‚</p><p><strong>ç»ˆæ­¢çº¿ç¨‹çš„ä¸‰ç§æ–¹æ³•</strong></p><p>â‘  ä½¿ç”¨é€€å‡ºæ ‡å¿—ï¼Œä½¿çº¿ç¨‹æ­£å¸¸é€€å‡ºï¼Œä¹Ÿå°±æ˜¯å½“runæ–¹æ³•å®Œæˆåçº¿ç¨‹ç»ˆæ­¢ï¼Œæ¨èä½¿ç”¨ã€‚</p><p>â‘¡ ä½¿ç”¨stopæ–¹æ³•å¼ºåˆ¶ç»ˆæ­¢çº¿ç¨‹(è¿™ä¸ªæ–¹æ³•ä¸æ¨èä½¿ç”¨ï¼Œå› ä¸ºstopå’Œsuppendã€resumeä¸€æ ·ï¼Œä¹Ÿå¯èƒ½å‘ç”Ÿä¸å¯é¢„æ–™çš„ç»“æœ)ã€‚</p><p>â‘¢ ä½¿ç”¨interruptæ–¹æ³•ä¸­æ–­çº¿ç¨‹ã€‚</p><h4 id="41-çº¿ç¨‹å®‰å…¨çš„å•ä¾‹"><a href="#41-çº¿ç¨‹å®‰å…¨çš„å•ä¾‹" class="headerlink" title="41.çº¿ç¨‹å®‰å…¨çš„å•ä¾‹"></a>41.çº¿ç¨‹å®‰å…¨çš„å•ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingleInstance instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleInstance <span class="title">getInstance</span><span class="params">(SingleInstance instance)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (SingleInstance.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> SingleInstance();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="42-Serializable-åºåˆ—åŒ–æ¥å£ï¼Œå¼€é”€å¤§ï¼Œå»ºè®®ä½¿ç”¨ï¼Œjavaæ–¹æ³•ï¼›"><a href="#42-Serializable-åºåˆ—åŒ–æ¥å£ï¼Œå¼€é”€å¤§ï¼Œå»ºè®®ä½¿ç”¨ï¼Œjavaæ–¹æ³•ï¼›" class="headerlink" title="42.Serializable åºåˆ—åŒ–æ¥å£ï¼Œå¼€é”€å¤§ï¼Œå»ºè®®ä½¿ç”¨ï¼Œjavaæ–¹æ³•ï¼›"></a>42.Serializable åºåˆ—åŒ–æ¥å£ï¼Œå¼€é”€å¤§ï¼Œå»ºè®®ä½¿ç”¨ï¼Œjavaæ–¹æ³•ï¼›</h4><p> Parcelelable ä½¿ç”¨éº»çƒ¦ï¼Œæ•ˆç‡é«˜ï¼Œå¤šç”¨äºå†…å­˜ï¼ŒAndroidæ–¹æ³•ã€‚</p><h4 id="43-Serviceå¯åŠ¨æ–¹å¼å’Œç”Ÿå‘½å‘¨æœŸ"><a href="#43-Serviceå¯åŠ¨æ–¹å¼å’Œç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="43.Serviceå¯åŠ¨æ–¹å¼å’Œç”Ÿå‘½å‘¨æœŸ"></a>43.Serviceå¯åŠ¨æ–¹å¼å’Œç”Ÿå‘½å‘¨æœŸ</h4><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722161217.png" alt></p><p>â‘ startService()ï¼šå¼€å¯ï¼Œè°ƒç”¨è€…é€€å‡ºåServiceä»åœ¨ï¼›<br> ç”Ÿå‘½å‘¨æœŸï¼šonCreate()â€“onStartCommand()â€“onDestory()<br> é€šè¿‡startServiceå¯åŠ¨åï¼Œserviceä¼šä¸€ç›´æ— é™æœŸè¿è¡Œä¸‹å»ï¼Œåªæœ‰å¤–éƒ¨è°ƒç”¨äº†stopService()æˆ–stopSelf()æ–¹æ³•æ—¶ï¼Œè¯¥Serviceæ‰ä¼šåœæ­¢è¿è¡Œå¹¶é”€æ¯ã€‚<br> â‘¡bindService()ï¼šå¼€å¯ï¼Œè°ƒç”¨è€…é€€å‡ºåServiceéšå³é€€å‡ºã€‚<br> ç”Ÿå‘½å‘¨æœŸï¼šonCreate()â€“onBind()â€“onUnBind()â€“onDestory()<br> â‘ +â‘¡ çš„ç”Ÿå‘½å‘¨æœŸï¼šonCreate()â€“onStartCommand()â€“onBind()â€“onUnBind()â€“onDestory()</p><h4 id="44-Android-å¸¸è§å¸ƒå±€"><a href="#44-Android-å¸¸è§å¸ƒå±€" class="headerlink" title="44.Android å¸¸è§å¸ƒå±€"></a>44.Android å¸¸è§å¸ƒå±€</h4><p> FrameLayout ï¼ˆæ¡†æ¶å¸ƒå±€ï¼‰ã€LinearLayoutï¼ˆçº¿æ€§å¸ƒå±€ï¼‰ã€AbsoluteLayoutï¼ˆç»å¯¹å¸ƒå±€ï¼‰ã€RelativeLayoutï¼ˆç›¸å¯¹å¸ƒå±€ï¼‰ã€TableLayoutï¼ˆè¡¨æ ¼å¸ƒå±€ï¼‰</p><h4 id="45-Httpæ˜¯æœåŠ¡å±‚ï¼Œå€ŸåŠ©HttpClientå’ŒHttpUrlConnectionå»ºç«‹çŸ­è¿æ¥ï¼Œè¯·æ±‚ä¸€æ¬¡åæ–­å¼€ï¼Œéœ€è¦é‡è¿æ—¶æ‰è¿ã€‚"><a href="#45-Httpæ˜¯æœåŠ¡å±‚ï¼Œå€ŸåŠ©HttpClientå’ŒHttpUrlConnectionå»ºç«‹çŸ­è¿æ¥ï¼Œè¯·æ±‚ä¸€æ¬¡åæ–­å¼€ï¼Œéœ€è¦é‡è¿æ—¶æ‰è¿ã€‚" class="headerlink" title="45.Httpæ˜¯æœåŠ¡å±‚ï¼Œå€ŸåŠ©HttpClientå’ŒHttpUrlConnectionå»ºç«‹çŸ­è¿æ¥ï¼Œè¯·æ±‚ä¸€æ¬¡åæ–­å¼€ï¼Œéœ€è¦é‡è¿æ—¶æ‰è¿ã€‚"></a>45.Httpæ˜¯æœåŠ¡å±‚ï¼Œå€ŸåŠ©HttpClientå’ŒHttpUrlConnectionå»ºç«‹çŸ­è¿æ¥ï¼Œè¯·æ±‚ä¸€æ¬¡åæ–­å¼€ï¼Œéœ€è¦é‡è¿æ—¶æ‰è¿ã€‚</h4><p> â‘ HttpClientï¼šå¼€æºæ¡†æ¶ï¼Œæ— å°è£…ï¼ŒåŸå§‹ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œå¼€å‘å¿«ï¼Œå®ç°æ¯”è¾ƒç¨³å®šï¼ŒAndroidåºŸå¼ƒï¼ŒAndroid 6.0åˆ é™¤ï¼›<br> â‘¡HttpUrlConnectionï¼šå¯¹ç½‘ç»œè¯·æ±‚æ²¡æœ‰HttpClientå°è£…å½»åº•ï¼ŒAndroid2.2ä¹‹å‰å­˜åœ¨bugï¼Œæ‰€ä»¥2.2ä¹‹å‰ç”¨HttpClientï¼Œä¹‹åç”¨å®¹æ˜“ä¼˜åŒ–çš„HttpUrlConnectionï¼Œå¼€æºæ¡†æ¶ï¼Œå°è£…äº†è¯·æ±‚å¤´ã€å‚æ•°ã€å†…å®¹ä½“ã€å“åº”åœ¨I/Oæµï¼Œæ¥å£ä¸­ç»Ÿä¸€å°æˆäº†HttpGet/HttpPostï¼Œå‡å°‘äº†æ“ä½œçš„ç¹çæ€§ï¼Œè®¿é—®é€Ÿåº¦å¿«ã€‚</p><p>Httpsæ˜¯ä»¥å®‰å…¨ä¸ºç›®æ ‡çš„Httpé€šé“ï¼Œç®€å•è®²å°±æ˜¯Httpçš„å®‰å…¨ç‰ˆï¼Œå³Httpä¸‹åŠ å…¥SSLå±‚ï¼Œå®‰å…¨åŸºç¡€æ˜¯SSLï¼ŒåŠ å¯†çš„è¯¦ç»†å†…å®¹æ˜¯SSLï¼Œä½œç”¨ï¼šå»ºç«‹ä¸€ä¸ªä¿¡æ¯å®‰å…¨é€šé“ï¼Œæ¥ä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨ã€ç¡®è®¤ç½‘ç«™çš„å®‰å…¨æ€§ã€‚</p><p>Volleyï¼šé€‚åˆå¤„ç†æ•°æ®é‡å°ï¼Œé€šä¿¡é¢‘ç¹çš„ç½‘ç»œæ“ä½œï¼Œå†…éƒ¨å°è£…äº†å¼‚æ­¥æ“ä½œï¼Œå¯ç›´æ¥åœ¨çº¿ç¨‹æ‰§è¡Œå¹¶å¤„ç†ç»“æœï¼ŒåŒæ—¶å¯ä»¥å–æ¶ˆï¼Œå®¹æ˜“æ‰©å±•ï¼Œä½†æ˜¯ä¸é€‚åˆå¤§æ•°æ®è¯·æ±‚ï¼Œæ¯”å¦‚ä¸‹è½½è¡¨ç°ç³Ÿç³•ï¼Œä¸æ”¯æŒhttpsï¼Œandroid2.2åŠä»¥ä¸‹ç”¨HttpClientï¼Œandroid2.3åŠä»¥ä¸Šç”¨HttpUrlConnectionã€‚</p><p>OkHttpï¼šä¸“æ³¨äºæå‡ç½‘ç»œè¿æ¥æ•ˆç‡çš„Httpå®¢æˆ·ç«¯ï¼Œèƒ½å¤Ÿå®ç°IPå’Œç«¯å£çš„è¯·æ±‚é‡ç”¨ä¸€ä¸ªsocketï¼Œå¤§å¤§é™ä½äº†è¿æ¥æ—¶é—´ï¼Œä¹Ÿé™ä½äº†æœåŠ¡å™¨çš„å‹åŠ›ï¼Œå¯¹Httpå’Œhttpséƒ½æœ‰è‰¯å¥½çš„æ”¯æŒï¼Œä¸ç”¨æ‹…å¿ƒappç‰ˆæœ¬æ›´æ¢çš„å›°æ‰°ï¼Œä½†æ˜¯okHttpè¯·æ±‚æ˜¯åœ¨çº¿ç¨‹é‡Œæ‰§è¡Œï¼Œä¸èƒ½ç›´æ¥åˆ·æ–°UIï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†ã€‚</p><p>æ€»ç»“ï¼šåœ¨é¡¹ç›®å®é™…è¿ç”¨ä¸­ï¼Œè§†æƒ…å†µé€‰æ‹©ç½‘ç»œè¯·æ±‚æ–¹å¼ï¼Œä¹Ÿå¯ä»¥Volley+OkHttpæ­é…ä½¿ç”¨ã€‚å¼‚æ­¥å›è°ƒç”¨Volleyï¼Œç½‘ç»œè¯·æ±‚åº•å±‚ç”¨OkHttp</p><p>RxJava + Retrofit3 + OkHttp3<br> â‘ RxJava ä¸»è¦ç”¨æ¥å®ç°çº¿ç¨‹åˆ‡æ¢ï¼Œæˆ‘ä»¬åˆ¶å®šè®¢é˜…åœ¨å“ªä¸€ä¸ªçº¿ç¨‹ï¼Œè§‚å¯Ÿåœ¨å“ªä¸ªçº¿ç¨‹ï¼Œé€šè¿‡æ“ä½œç¬¦è¿›è¡Œæ•°æ®å˜æ¢ï¼Œæ•´ä¸ªè¿‡ç¨‹æ˜¯é”®å¼çš„ï¼Œç®€åŒ–é€»è¾‘ã€‚<br> â‘¡Retrofit æ˜¯ç½‘ç»œè¯·æ±‚çš„ä¸€ä¸ªæ¶å­ï¼Œç”¨å®ƒè®¾ç½®ä¸€äº›å‚æ•°å’Œè¯·æ±‚Urlã€‚<br> â‘¢OkHttpæ˜¯ç½‘ç»œè¯·æ±‚çš„å†…æ ¸ï¼Œå®é™…çš„ç½‘ç»œè¯·æ±‚æ˜¯å®ƒå‘å‡ºæ¥çš„ã€‚</p><p>TCP æ˜¯ç½‘ç»œå±‚ï¼Œæ»‘åŠ¨çª—å£åè®®ï¼Œæ‹¥å¡æ§åˆ¶ï¼Œå¯é è¿æ¥å€ŸåŠ©socketé•¿è¿æ¥ï¼Œéœ€è¦3æ¬¡æ¡æ‰‹ï¼Œç¬¬å››æ¬¡å–æ¶ˆè¿æ¥ï¼Œç”»é¢ä¼˜å…ˆã€‚<br> UDPï¼šä¸å…³å¿ƒæ•°æ®æ˜¯å¦åˆ°è¾¾ï¼Œæ˜¯å¦é˜»å¡ï¼Œä¸å¯é è¿æ¥ï¼Œæµç•…ä¼˜å…ˆã€‚</p><h4 id="46-å¦‚ä½•èŠ‚çœå†…å­˜ä½¿ç”¨ï¼Œä¸»åŠ¨å›æ”¶å†…å­˜ï¼Ÿ"><a href="#46-å¦‚ä½•èŠ‚çœå†…å­˜ä½¿ç”¨ï¼Œä¸»åŠ¨å›æ”¶å†…å­˜ï¼Ÿ" class="headerlink" title="46.å¦‚ä½•èŠ‚çœå†…å­˜ä½¿ç”¨ï¼Œä¸»åŠ¨å›æ”¶å†…å­˜ï¼Ÿ"></a>46.å¦‚ä½•èŠ‚çœå†…å­˜ä½¿ç”¨ï¼Œä¸»åŠ¨å›æ”¶å†…å­˜ï¼Ÿ</h4><p> ç­”ï¼šå°½é‡å¤šä½¿ç”¨å†…éƒ¨ç±»ï¼Œæé«˜ç¨‹åºæ•ˆç‡ï¼Œå›æ”¶å·²ä½¿ç”¨çš„èµ„æºï¼Œåˆç†ä½¿ç”¨ç¼“å­˜ï¼Œåˆç†è®¾ç½®å˜é‡çš„ä½œç”¨èŒƒå›´ã€‚</p><h4 id="47-Activityå¦‚ä½•ç”ŸæˆViewï¼Ÿ"><a href="#47-Activityå¦‚ä½•ç”ŸæˆViewï¼Ÿ" class="headerlink" title="47.Activityå¦‚ä½•ç”ŸæˆViewï¼Ÿ"></a>47.Activityå¦‚ä½•ç”ŸæˆViewï¼Ÿ</h4><p> ç­”ï¼šActivityæ‰§è¡Œåœ¨attch()æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªPhoneWindowï¼ˆWindowçš„å­ç±»ï¼‰ï¼Œåœ¨onCreate()æ–¹æ³•çš„setContentView()æ–¹æ³•ä¸­ï¼Œåˆ›å»ºDecorViewï¼ŒDecorViewçš„addView()æ–¹æ³•ï¼ŒæŠŠlayoutå¸ƒå±€åŠ è½½å‡ºæ¥ã€‚é€šè¿‡onDraw()ç”»å‡ºæ¥ï¼Œç”»Viewä¹‹å‰è°ƒç”¨onMeasure()æ–¹æ³•è®¡ç®—æ˜¾ç¤ºçš„å¤§å°ã€‚</p><h4 id="48-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ"><a href="#48-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ" class="headerlink" title="48.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ"></a>48.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ</h4><p> â‘ æ›´å¥½åœ°åˆ©ç”¨CPUèµ„æºï¼›â‘¡è¿›ç¨‹é—´æ•°æ®ä¸èƒ½æ•°æ®å…±äº«ï¼Œçº¿ç¨‹å¯ä»¥ï¼›â‘¢ç³»ç»Ÿåˆ›å»ºè¿›ç¨‹éœ€è¦ä¸ºè¯¥è¿›ç¨‹é‡æ–°åˆ†é…ç³»ç»Ÿèµ„æºï¼Œåˆ›å»ºçº¿ç¨‹ä»£ä»·è¾ƒå°ï¼›â‘£Javaè¯­è¨€å†…ç½®äº†å¤šçº¿ç¨‹åŠŸèƒ½æ”¯æŒï¼Œç®€åŒ–äº†javaå¤šçº¿ç¨‹ç¼–ç¨‹ã€‚</p><p>çº¿ç¨‹æ± æ˜¯ä¸€ç§å¤šçº¿ç¨‹å¤„ç†å½¢å¼ï¼Œå¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œåœ¨åˆ›å»ºçº¿ç¨‹åè‡ªåŠ¨å¯åŠ¨è¿™äº›ä»»åŠ¡ï¼Œçº¿ç¨‹æ± çº¿ç¨‹æ˜¯åå°çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä½¿ç”¨é»˜è®¤çš„å †æ ˆå¤§å°ï¼Œä»¥ä¼˜å…ˆçº§æ‰§è¡Œã€‚</p><h4 id="49-ç°åœºä¿æŠ¤"><a href="#49-ç°åœºä¿æŠ¤" class="headerlink" title="49.ç°åœºä¿æŠ¤"></a>49.ç°åœºä¿æŠ¤</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSaveInstanceState</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onSaveInstanceState(savedInstanceState);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRestoreInstanceState</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onRestoreInstanceState(savedInstanceState);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åœºæ™¯ï¼šâ‘ è¿›ç¨‹è¢«å¼‚å¸¸æ€æ­»ï¼›â‘¡ç³»ç»Ÿé…ç½®å‘ç”Ÿå˜åŒ–ï¼ˆæ¯”å¦‚æ¨ªç«–å±åˆ‡èŠ±æ¢ï¼‰ã€‚<br> å½“Activityå¤„äºonPause() ï¼ŒonStop() ï¼ŒonDestroy() ä¸‰ç§çŠ¶æ€æ—¶ç¨‹åºå¯èƒ½ä¼šè¢«Androidç³»ç»Ÿå›æ”¶æ‰ï¼Œè¿™æ—¶å¯èƒ½ä¼šé€ æˆç”¨æˆ·åœ¨ç¨‹åºå½“ä¸­çš„æ•°æ®æˆ–è€…ä¿®æ”¹ä¸¢å¤±ã€‚äºæ˜¯æˆ‘ä»¬éœ€è¦â€ç°åœºä¿æŠ¤â€ï¼Œå½“ä¸‹æ¬¡é‡å¯ç¨‹åºæˆ–activityæ—¶æ¢å¤ä¸Šä¸€æ¬¡çš„æ•°æ®ã€‚<br> å› æ­¤Androidæä¾›äº†onSaveInstanceState(Bundlout State)æ–¹æ³•ä¼šåœ¨ç¨‹åºè¢«å›æ”¶å‰è¿›è¡Œè°ƒç”¨ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯onSaveInstanceState()æ–¹æ³•åªé€‚åˆä¿å­˜ç¬æ€æ•°æ®, æ¯”å¦‚UIæ§ä»¶çš„çŠ¶æ€, æˆå‘˜å˜é‡çš„å€¼ç­‰ï¼Œè€Œä¸åº”è¯¥ç”¨æ¥ä¿å­˜æŒä¹…åŒ–æ•°æ®ã€‚onRestoreInstanceStateæ–¹æ³•ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯onSaveInstanceStateæ–¹æ³•å’ŒonRestoreInstanceStateæ–¹æ³•â€œä¸ä¸€å®šâ€æ˜¯æˆå¯¹çš„è¢«è°ƒç”¨çš„ï¼ŒonRestoreInstanceStateè¢«è°ƒç”¨çš„å‰ææ˜¯ï¼Œactivity Aâ€œç¡®å®â€è¢«ç³»ç»Ÿé”€æ¯äº†ï¼Œè€Œå¦‚æœä»…ä»…æ˜¯åœç•™åœ¨æœ‰è¿™ç§å¯èƒ½æ€§çš„æƒ…å†µä¸‹ï¼Œåˆ™è¯¥æ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ï¼Œä¾‹å¦‚ï¼Œå½“æ­£åœ¨æ˜¾ç¤ºactivity Açš„æ—¶å€™ï¼Œç”¨æˆ·æŒ‰ä¸‹HOMEé”®å›åˆ°ä¸»ç•Œé¢ï¼Œç„¶åç”¨æˆ·ç´§æ¥ç€åˆè¿”å›åˆ°activity Aï¼Œè¿™ç§æƒ…å†µä¸‹activity Aä¸€èˆ¬ä¸ä¼šå› ä¸ºå†…å­˜çš„åŸå› è¢«ç³»ç»Ÿé”€æ¯ï¼Œæ•…activity Açš„onRestoreInstanceStateæ–¹æ³•ä¸ä¼šè¢«æ‰§è¡Œã€‚</p><h4 id="50-å†…å­˜æº¢å‡ºï¼Œå†…å­˜æ³„æ¼"><a href="#50-å†…å­˜æº¢å‡ºï¼Œå†…å­˜æ³„æ¼" class="headerlink" title="50.å†…å­˜æº¢å‡ºï¼Œå†…å­˜æ³„æ¼"></a>50.å†…å­˜æº¢å‡ºï¼Œå†…å­˜æ³„æ¼</h4><p> å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰ï¼šç¨‹åºåœ¨ç”³è¯·å†…å­˜æ—¶ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ä½¿ç”¨ã€‚<br> åŸå› ï¼šåŠ è½½å¯¹è±¡è¿‡å¤§ï¼Œç›¸å¯¹èµ„æºè¾ƒå¤šï¼Œæ¥ä¸åŠåŠ è½½ã€‚<br> è§£å†³åŠæ³•ï¼šå†…å­˜å¼•ç”¨ä¸Šåšå¤„ç†ï¼Œæ¯”å¦‚ç”¨è½¯å¼•ç”¨ï¼›å›¾ç‰‡åŠ è½½æ—¶å¤„ç†ï¼ˆå‹ç¼©ç­‰ï¼‰ï¼›åŠ¨æ€å›æ”¶å†…å­˜ï¼›ä¼˜åŒ–å†…å­˜åˆ†é…ï¼Œè‡ªå®šä¹‰å †å†…å­˜å¤§å°ï¼Œé¿å…ä½¿ç”¨Enumï¼Œå‡å°‘BitMapçš„å†…å­˜å ç”¨ï¼Œå†…å­˜å¯¹è±¡é‡å¤ä½¿ç”¨ï¼Œé¿å…å¯¹è±¡çš„å†…å­˜æ³„æ¼ã€‚<br> å†…å­˜æ³„æ¼ï¼ˆmemory leakï¼‰ï¼š ç¨‹åºåœ¨ç”³è¯·å†…å­˜åï¼Œæ— æ³•é‡Šæ”¾å·²ç”³è¯·çš„å†…å­˜ç©ºé—´ï¼Œä¸€æ¬¡æ³„æ¼å±å®³å¯å¿½ç•¥ï¼Œä½†æ¨ç§¯ä¸¥é‡æœ€ç»ˆä¼šå¯¼è‡´OOMï¼›</p><p>handleræ³„éœ²ï¼šæ¶ˆæ¯å¼•ç”¨äº†handlerå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åˆéšæ€§åœ°æŒæœ‰äº†Activityå¯¹è±¡ï¼Œå½“å‘ç”ŸGCæ—¶ä»¥ä¸ºmessage-handler-activityçš„å¼•ç”¨é“¾å¯¼è‡´Activityæ— æ³•è¢«å›æ”¶ï¼Œå³å‘ç”Ÿæ³„æ¼ï¼Œç®€å•æ¥è¯´å°±æ˜¯handlerå¯¹activityå¼ºå¼•ç”¨å¯¼è‡´çš„GCï¼Œæ— æ³•åŠæ—¶å›æ”¶Activityã€‚ï¼ˆPSï¼šGCåƒåœ¾å›æ”¶ï¼Œå½“å †å†…å­˜é‡Œçš„å¯¹è±¡æ²¡æœ‰å¼•ç”¨æŒ‡å‘æ—¶ï¼ŒGCå›æ”¶ã€‚ï¼‰</p><p>è§£å†³åŠæ³•ï¼šæ–¹æ³•ä¸€ï¼šé€šè¿‡ç¨‹åºé€»è¾‘æ¥è¿›è¡Œä¿æŠ¤ã€‚</p><p>1.åœ¨å…³é—­Activityçš„æ—¶å€™åœæ‰ä½ çš„åå°çº¿ç¨‹ã€‚çº¿ç¨‹åœæ‰äº†ï¼Œå°±ç›¸å½“äºåˆ‡æ–­äº†Handlerå’Œå¤–éƒ¨è¿æ¥çš„çº¿ï¼ŒActivityè‡ªç„¶ä¼šåœ¨åˆé€‚çš„æ—¶å€™è¢«å›æ”¶ã€‚</p><p>2.å¦‚æœä½ çš„Handleræ˜¯è¢«delayçš„MessageæŒæœ‰äº†å¼•ç”¨ï¼Œé‚£ä¹ˆä½¿ç”¨ç›¸åº”çš„Handlerçš„removeCallbacks()æ–¹æ³•ï¼ŒæŠŠæ¶ˆæ¯å¯¹è±¡ä»æ¶ˆæ¯é˜Ÿåˆ—ç§»é™¤å°±è¡Œäº†ã€‚</p><p>æ–¹æ³•äºŒï¼šå°†Handlerå£°æ˜ä¸ºé™æ€ç±»ã€‚</p><p>PS:åœ¨Java ä¸­ï¼Œéé™æ€çš„å†…éƒ¨ç±»å’ŒåŒ¿åå†…éƒ¨ç±»éƒ½ä¼šéšå¼åœ°æŒæœ‰å…¶å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œé™æ€çš„å†…éƒ¨ç±»ä¸ä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ã€‚</p><p>é™æ€ç±»ä¸æŒæœ‰å¤–éƒ¨ç±»çš„å¯¹è±¡ï¼Œæ‰€ä»¥ä½ çš„Activityå¯ä»¥éšæ„è¢«å›æ”¶ã€‚ç”±äºHandlerä¸å†æŒæœ‰å¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯¼è‡´ç¨‹åºä¸å…è®¸ä½ åœ¨Handlerä¸­æ“ä½œActivityä¸­çš„å¯¹è±¡äº†ã€‚æ‰€ä»¥ä½ éœ€è¦åœ¨Handlerä¸­å¢åŠ ä¸€ä¸ªå¯¹Activityçš„å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ã€‚<br> WebViewæ³„æ¼ï¼šåˆ›å»ºçš„å¯¹è±¡æ²¡æœ‰åœ¨åˆé€‚çš„æ—¶é—´é”€æ¯ï¼Œåˆ™ä¸€ç›´å­˜åœ¨å†…å­˜é‡Œè€—è´¹å†…å­˜ç©ºé—´ï¼ŒWebViewä¸å»ºè®®åœ¨xmlæ–‡ä»¶ä¸­æŒ‡æ˜ï¼Œå› ä¸ºä¸€ç›´å­˜åœ¨ä¸èƒ½å¯¹å…¶é”€æ¯ï¼Œåº”è¯¥åœ¨ä»£ç ä¸­åˆ›å»ºWebViewï¼Œé€šè¿‡addView()çš„æ–¹å¼åŠ å…¥layoutï¼Œåœ¨Activity çš„onDestory()æ–¹æ³•ä¸­éœ€è¦é”€æ¯ï¼Œå…ˆå°†åŠ è½½çš„å†…å®¹ç½®ä¸ºnullï¼ŒwebView.destroy();</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">WebView mWebView = <span class="keyword">new</span> WebView(getApplicationContext());</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span>( mWebView!=<span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">           ViewParent parent = mWebView.getParent();</span><br><span class="line">           <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">               ((ViewGroup) parent).removeView(mWebView);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           mWebView.stopLoading();</span><br><span class="line">           <span class="comment">// é€€å‡ºæ—¶è°ƒç”¨æ­¤æ–¹æ³•ï¼Œç§»é™¤ç»‘å®šçš„æœåŠ¡ï¼Œå¦åˆ™æŸäº›ç‰¹å®šç³»ç»Ÿä¼šæŠ¥é”™</span></span><br><span class="line">           mWebView.getSettings().setJavaScriptEnabled(<span class="keyword">false</span>);</span><br><span class="line">           mWebView.clearHistory();</span><br><span class="line">           mWebView.clearView();</span><br><span class="line">           mWebView.removeAllViews();</span><br><span class="line">           mWebView.destroy();</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">super</span>.onDestroy();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="51-JNIå’ŒNDK"><a href="#51-JNIå’ŒNDK" class="headerlink" title="51.JNIå’ŒNDK"></a>51.JNIå’ŒNDK</h4><p>â€‹     <strong>JNIæ˜¯Javaè°ƒç”¨Native è¯­è¨€çš„ä¸€ç§ç‰¹æ€§ï¼Œå±äºJavaï¼ŒJavaæœ¬åœ°æ¥å£ï¼Œä½¿Javaä¸æœ¬åœ°å…¶ä»–ç±»å‹è¯­è¨€äº¤äº’ï¼ˆC++ï¼‰</strong></p><p>â€‹       å®ç°æ­¥éª¤ï¼š<strong>åœ¨Javaä¸­å£°æ˜Nativeæ–¹æ³•ï¼Œç¼–è¯‘è¯¥æ–‡ä»¶å¾—åˆ°.classæ–‡ä»¶ï¼Œé€šè¿‡javahå‘½ä»¤å¯¼å‡ºJNIå¤´æ–‡ä»¶ï¼ˆ.hæ–‡ä»¶ï¼‰ï¼Œä½¿ç”¨Javaéœ€è¦äº¤äº’çš„æœ¬åœ°ä»£ç å®ç°å­å•ŠJavaä¸­å£°æ˜çš„Nativeæ–¹æ³•ï¼Œç¼–è¯‘soæ–‡ä»¶ï¼Œé€šè¿‡Javaæ‰§è¡ŒJavaç¨‹åºï¼Œæœ€ç»ˆå®ç°Javaè°ƒç”¨æœ¬åœ°ä»£ç </strong></p><hr><p>â€‹     <strong>NDKï¼ˆNative Develop Kitï¼‰ï¼šAndroidå¼€å‘å·¥å…·åŒ…ï¼Œå±äºAndroidã€‚</strong></p><p>â€‹     ä½œç”¨ï¼šå¿«é€Ÿå¼€å‘Cã€C++åŠ¨æ€åº“ï¼Œå¹¶è‡ªåŠ¨å°†soæ–‡ä»¶å’Œåº”ç”¨æ‰“åŒ…æˆAPKï¼Œå³å¯é€šè¿‡NDKåœ¨Androidä¸­ä½¿ç”¨JNIä¸æœ¬åœ°ä»£ç ï¼ˆCã€C++ï¼‰äº¤äº’ï¼ˆAndroidå¼€å‘éœ€è¦æœ¬åœ°ä»£ç Cã€C++å®ç°ï¼‰</p><p>â€‹      ç‰¹ç‚¹ï¼šè¿è¡Œæ•ˆç‡é«˜ï¼Œä»£ç å®‰å…¨æ€§é«˜ï¼ŒåŠŸèƒ½æ‹“å±•æ€§å¥½ï¼Œæ˜“äºä»£ç å¤ç”¨å’Œç§»æ¤ã€‚</p><p>â€‹      ä½¿ç”¨æ­¥éª¤ï¼š<strong>â‘ é…ç½®NDKç¯å¢ƒï¼›â‘¡åˆ›å»ºAndroidé¡¹ç›®ï¼Œå¹¶äºNDKè¿›è¡Œå…³è”ï¼›â‘¢åœ¨Androidé¡¹ç›®ä¸­å£°æ˜æ‰€éœ€è°ƒç”¨çš„Nativeæ–¹æ³•ï¼›â‘£ä½¿ç”¨è¯¥Nativeæ–¹æ³•ï¼›â‘¤é€šè¿‡NDK buildå‘½ä»¤ç¼–è¯‘äº§ç”Ÿsoæ–‡ä»¶ï¼›â‘¥ç¼–è¯‘ASå·¥ç¨‹ï¼Œå®ç°è°ƒç”¨æœ¬åœ°ä»£ç ã€‚</strong></p><p>â€‹    <strong>JNIå’ŒNDKçš„å…³ç³»ï¼šJNIå®ç°ç›®çš„ï¼ŒNDKæ˜¯Androidå®ç°JNIçš„æ‰‹æ®µï¼Œå³åœ¨ASå¼€å‘ç¯å¢ƒä¸­é€šè¿‡NDKä»è€Œå®ç°JNIåŠŸèƒ½ã€‚</strong></p><h4 id="52-å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼åŠå…¶å®ç°æ€æƒ³å’Œä½œç”¨"><a href="#52-å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼åŠå…¶å®ç°æ€æƒ³å’Œä½œç”¨" class="headerlink" title="52.å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼åŠå…¶å®ç°æ€æƒ³å’Œä½œç”¨"></a><strong>52.å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼åŠå…¶å®ç°æ€æƒ³å’Œä½œç”¨</strong></h4><p><strong>è½¬è½½æ–‡ç« ï¼š23ç§è®¾è®¡æ¨¡å¼å…¨è§£æ - codeTao - åšå®¢å›­</strong></p><p><strong>â‘ å•ä¾‹æ¨¡å¼ï¼š</strong>å•ä¾‹å¯¹è±¡èƒ½ä¿è¯åœ¨ä¸€ä¸ªJVMä¸­ï¼Œè¯¥å¯¹è±¡åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ã€‚</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722161310.png" alt></p><p><strong>â‘¡å·¥å‚æ¨¡å¼</strong></p><p>ä¸€ä¸ªæŠ½è±¡äº§å“ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“äº§å“ç±»ã€‚ ä¸€ä¸ªæŠ½è±¡å·¥å‚ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“å·¥å‚ç±»ã€‚æ¯ä¸ªå…·ä½“å·¥å‚ç±»åªèƒ½åˆ›å»ºä¸€ä¸ªå…·ä½“äº§å“ç±»çš„å®ä¾‹ã€‚</p><p>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šå¤šä¸ªæŠ½è±¡äº§å“ç±»ï¼Œæ¯ä¸ªæŠ½è±¡äº§å“ç±»å¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“äº§å“ç±»ã€‚ ä¸€ä¸ªæŠ½è±¡å·¥å‚ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“å·¥å‚ç±»ã€‚ æ¯ä¸ªå…·ä½“å·¥å‚ç±»å¯ä»¥åˆ›å»ºå¤šä¸ªå…·ä½“äº§å“ç±»çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºçš„æ˜¯ä¸€ä¸ªäº§å“çº¿ä¸‹çš„å¤šä¸ªäº§å“ã€‚ </p><p><strong>â‘¢é€‚é…å™¨æ¨¡å¼</strong></p><p>å°†æŸä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£è¡¨ç¤ºï¼Œç›®çš„æ˜¯æ¶ˆé™¤ç”±äºæ¥å£ä¸åŒ¹é…æ‰€é€ æˆçš„ç±»çš„å…¼å®¹æ€§é—®é¢˜ã€‚ä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼šç±»çš„é€‚é…å™¨æ¨¡å¼ã€å¯¹è±¡çš„é€‚é…å™¨æ¨¡å¼ã€æ¥å£çš„é€‚é…å™¨æ¨¡å¼ã€‚</p><p><strong>â‘£è£…é¥°æ¨¡å¼ï¼ˆDecoratorï¼‰</strong></p><p>é¡¾åæ€ä¹‰ï¼Œè£…é¥°æ¨¡å¼å°±æ˜¯ç»™ä¸€ä¸ªå¯¹è±¡å¢åŠ ä¸€äº›æ–°çš„åŠŸèƒ½ï¼Œè€Œä¸”æ˜¯åŠ¨æ€çš„ï¼Œè¦æ±‚è£…é¥°å¯¹è±¡å’Œè¢«è£…é¥°å¯¹è±¡å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œè£…é¥°å¯¹è±¡æŒæœ‰è¢«è£…é¥°å¯¹è±¡çš„å®ä¾‹ã€‚</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722161327.png" alt></p><p>Sourceç±»æ˜¯è¢«è£…é¥°ç±»ï¼ŒDecoratorç±»æ˜¯ä¸€ä¸ªè£…é¥°ç±»ï¼Œå¯ä»¥ä¸ºSourceç±»åŠ¨æ€çš„æ·»åŠ ä¸€äº›åŠŸèƒ½ã€‚</p><p>è£…é¥°å™¨æ¨¡å¼çš„åº”ç”¨åœºæ™¯ï¼š</p><p>1ã€éœ€è¦æ‰©å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½ã€‚</p><p>2ã€åŠ¨æ€çš„ä¸ºä¸€ä¸ªå¯¹è±¡å¢åŠ åŠŸèƒ½ï¼Œè€Œä¸”è¿˜èƒ½åŠ¨æ€æ’¤é”€ã€‚ï¼ˆç»§æ‰¿ä¸èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œç»§æ‰¿çš„åŠŸèƒ½æ˜¯é™æ€çš„ï¼Œä¸èƒ½åŠ¨æ€å¢åˆ ã€‚ï¼‰</p><p>ç¼ºç‚¹ï¼šäº§ç”Ÿè¿‡å¤šç›¸ä¼¼çš„å¯¹è±¡ï¼Œä¸æ˜“æ’é”™ï¼</p><p><strong>â‘¤ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰</strong>ï¼šå¤šä¸€ä¸ªä»£ç†ç±»å‡ºæ¥ï¼Œæ›¿åŸå¯¹è±¡è¿›è¡Œä¸€äº›æ“ä½œã€‚</p><p><strong>â‘¥æ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰</strong>ï¼šæ¡¥æ¥æ¨¡å¼å°±æ˜¯æŠŠäº‹ç‰©å’Œå…¶å…·ä½“å®ç°åˆ†å¼€ï¼Œä½¿ä»–ä»¬å¯ä»¥å„è‡ªç‹¬ç«‹çš„å˜åŒ–ã€‚æ¡¥æ¥çš„ç”¨æ„æ˜¯ï¼š<strong>å°†æŠ½è±¡åŒ–ä¸å®ç°åŒ–è§£è€¦ï¼Œä½¿å¾—äºŒè€…å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚</strong></p><p><strong>â‘¦è§‚å¯Ÿè€…æ¨¡å¼</strong>ï¼šä¸€ä¸ªç›®æ ‡ç‰©ä»¶ç®¡ç†æ‰€æœ‰ç›¸ä¾äºå®ƒçš„è§‚å¯Ÿè€…ç‰©ä»¶ï¼Œå¹¶ä¸”åœ¨å®ƒæœ¬èº«çš„çŠ¶æ€æ”¹å˜æ—¶ä¸»åŠ¨å‘å‡ºé€šçŸ¥ã€‚è¿™é€šå¸¸é€è¿‡å‘¼å«å„è§‚å¯Ÿè€…æ‰€æä¾›çš„æ–¹æ³•æ¥å®ç°ã€‚æ­¤ç§æ¨¡å¼é€šå¸¸è¢«ç”¨æ¥å®ç°äº‹ä»¶å¤„ç†ç³»ç»Ÿã€‚</p><p><strong>â‘§è®¿é—®è€…æ¨¡å¼</strong>ï¼šä¸€ç§åˆ†ç¦»å¯¹è±¡æ•°æ®ç»“æ„ä¸è¡Œä¸ºçš„æ–¹æ³•ï¼Œé€šè¿‡è¿™ç§åˆ†ç¦»ï¼Œå¯è¾¾åˆ°ä¸ºä¸€ä¸ªè¢«è®¿é—®è€…åŠ¨æ€æ·»åŠ æ–°çš„æ“ä½œè€Œæ— éœ€åšå…¶å®ƒçš„ä¿®æ”¹çš„æ•ˆæœã€‚</p><h4 id="53-HashMapã€-HashTableã€HashSetçš„å¼‚åŒ"><a href="#53-HashMapã€-HashTableã€HashSetçš„å¼‚åŒ" class="headerlink" title="53.HashMapã€ HashTableã€HashSetçš„å¼‚åŒ"></a>53.HashMapã€ HashTableã€HashSetçš„å¼‚åŒ</h4><p>è½¬è½½æ–‡ç« ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.cnblogs.com%2Fywl925%2Fp%2F3865269.html" target="_blank" rel="noopener">HashSet HashTable HashMapçš„åŒºåˆ« åŠå…¶Javaé›†åˆä»‹ç» - ywl925 - åšå®¢å›­</a></p><p>â‘ HashSetæ˜¯Setçš„ä¸€ä¸ªå®ç°ç±»ï¼ŒHashMapæ˜¯Mapçš„ä¸€ä¸ªå®ç°ç±»ï¼ŒåŒæ—¶HashMapæ˜¯HashTableçš„æ›¿ä»£å“</p><p>â‘¡HashSetä»¥å¯¹è±¡ä½œä¸ºå…ƒç´ ï¼Œè€ŒHashMapä»¥(key-value)çš„ä¸€ç»„å¯¹è±¡ä½œä¸ºå…ƒç´ ï¼Œä¸”HashSetæ‹’ç»æ¥å—é‡å¤çš„å¯¹è±¡ã€‚HashMapå¯ä»¥çœ‹ä½œä¸‰ä¸ªè§†å›¾ï¼škeyçš„Setï¼Œvalueçš„Collectionï¼ŒEntryçš„Setã€‚ è¿™é‡ŒHashSetå°±æ˜¯å…¶å®å°±æ˜¯HashMapçš„ä¸€ä¸ªè§†å›¾ã€‚</p><p>HashSetå†…éƒ¨å°±æ˜¯ä½¿ç”¨HashMapå®ç°çš„ï¼Œå’ŒHashMapä¸åŒçš„æ˜¯å®ƒä¸éœ€è¦Keyå’ŒValueä¸¤ä¸ªå€¼ã€‚</p><p>HashMapæ˜¯ä¸€ä¸ªæ•°ç»„å’Œé“¾è¡¨çš„ç»“åˆä½“ï¼Œæ–°åŠ å…¥çš„æ”¾åœ¨é“¾å¤´ï¼Œé‡å¤çš„keyä¸åŒçš„alueè¢«æ–°valueæ›¿ä»£</p><p>â‘¢ç»§æ‰¿ä¸åŒ</p><p>public class Hashtable extends Dictionary&lt;&gt; implements Map&lt;&gt;</p><p>public class HashMap  extends AbstractMap&lt;&gt; implements Map&lt;&gt;</p><p>â‘£HashTable æ–¹æ³•åŒæ­¥ï¼Œè€ŒHashMapéœ€è¦è‡ªå·±å¢åŠ åŒæ­¥å¤„ç†ã€‚</p><p>â‘¤HashTableä¸­ï¼Œkeyå’Œvalueéƒ½ä¸å…è®¸å‡ºç°nullå€¼ã€‚</p><p>åœ¨HashMapä¸­ï¼Œnullå¯ä»¥ä½œä¸ºé”®ï¼Œè¿™æ ·çš„é”®åªæœ‰ä¸€ä¸ªï¼›å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªé”®æ‰€å¯¹åº”çš„å€¼ä¸ºnullã€‚ç”¨containsKey()æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŸä¸ªé”®ã€‚</p><p>â‘¥ä¸¤ä¸ªéå†æ–¹å¼çš„å†…éƒ¨å®ç°ä¸Šä¸åŒã€‚</p><p>HashTableã€HashMapéƒ½ä½¿ç”¨äº† Iteratorã€‚è€Œç”±äºå†å²åŸå› ï¼ŒHashTableè¿˜ä½¿ç”¨äº†Enumerationçš„æ–¹å¼ ã€‚</p><p>â‘¦å“ˆå¸Œå€¼çš„ä½¿ç”¨ä¸åŒ</p><p>HashTableç›´æ¥ä½¿ç”¨å¯¹è±¡çš„hashCodeï¼ŒHashTableä¸­hashæ•°ç»„é»˜è®¤å¤§å°æ˜¯11ï¼Œå¢åŠ çš„æ–¹å¼æ˜¯ old*2+1ã€‚</p><p>è€ŒHashMapé‡æ–°è®¡ç®—hashå€¼ï¼ŒHashMapä¸­hashæ•°ç»„çš„é»˜è®¤å¤§å°æ˜¯16ï¼Œè€Œä¸”ä¸€å®šæ˜¯2çš„æŒ‡æ•°ã€‚</p><p>å¦‚ä½•å®ç°HashMapçº¿ç¨‹åŒæ­¥ï¼Ÿ</p><p>â‘ ä½¿ç”¨ java.util.Hashtable ç±»ï¼Œæ­¤ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>â‘¡ä½¿ç”¨ java.util.concurrent.ConcurrentHashMapï¼Œæ­¤ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>â‘¢ä½¿ç”¨ java.util.Collections.synchronizedMap() æ–¹æ³•åŒ…è£… HashMap objectï¼Œå¾—åˆ°çº¿ç¨‹å®‰å…¨çš„Mapï¼Œå¹¶åœ¨æ­¤Mapä¸Šè¿›è¡Œæ“ä½œã€‚</p><h4 id="54-Android-ä¸­å†…å­˜æ³„æ¼åŸå› åŠä¼˜åŒ–æ–¹æ¡ˆï¼Ÿ"><a href="#54-Android-ä¸­å†…å­˜æ³„æ¼åŸå› åŠä¼˜åŒ–æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="54.Android ä¸­å†…å­˜æ³„æ¼åŸå› åŠä¼˜åŒ–æ–¹æ¡ˆï¼Ÿ"></a>54.Android ä¸­å†…å­˜æ³„æ¼åŸå› åŠä¼˜åŒ–æ–¹æ¡ˆï¼Ÿ</h4><p>æ–‡ç« è½¬è½½ï¼š<a href="https://www.jianshu.com/p/abee7c186bfa" target="_blank" rel="noopener">Android ä¸­å†…å­˜æ³„æ¼çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆ - ç®€ä¹¦</a></p><p>â‘ <strong>éé™æ€å†…éƒ¨ç±»é€ æˆçš„å†…å­˜æ³„æ¼</strong>  éé™æ€ç±»ä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œå¦‚æœè¿™ä¸ªå†…éƒ¨ç±»æ¯”å¤–éƒ¨ç±»çš„ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œåœ¨å¤–éƒ¨ç±»è¢«é”€æ¯æ—¶ï¼Œå†…éƒ¨ç±»æ— æ³•å›æ”¶ï¼Œå³é€ æˆå†…å­˜æ³„æ¼ï¼›</p><p><strong>â‘¡å¤–éƒ¨ç±»ä¸­æŒæœ‰éé™æ€å†…éƒ¨ç±»çš„é™æ€å¯¹è±¡</strong>  ä¿æŒä¸€è‡´çš„ç”Ÿå‘½å‘¨æœŸï¼Œå°†å†…éƒ¨ç±»å¯¹è±¡æ”¹æˆéé™æ€ï¼›</p><p>â‘¢<strong>Handler æˆ– Runnable ä½œä¸ºéé™æ€å†…éƒ¨ç±»</strong>  Handler å’Œ Runnable ä½œä¸ºåŒ¿åå†…éƒ¨ç±»ï¼Œéƒ½ä¼šæŒæœ‰ Activity çš„å¼•ç”¨ï¼Œç”±äº Handler å’Œ Runnable çš„ç”Ÿå‘½å‘¨æœŸæ¯” Activity é•¿ï¼Œå¯¼è‡´Activity æ— æ³•è¢«å›æ”¶ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ã€‚  è§£å†³åŠæ³•ï¼šå°†Handler å’Œ Runnable å®šä¹‰ä¸ºé™æ€å†…éƒ¨ç±»ï¼Œåœ¨Activity çš„onDestory()æ–¹æ³•ä¸­è°ƒç”¨Handler çš„ removeCallbacks æ–¹æ³•æ¥ç§»é™¤ Messageã€‚</p><p>è¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå¦‚æœ Handler æˆ–è€… Runnable ä¸­æŒæœ‰ Context å¯¹è±¡ï¼Œé‚£ä¹ˆå³ä½¿ä½¿ç”¨é™æ€å†…éƒ¨ç±»ï¼Œè¿˜æ˜¯ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ã€‚è§£å†³åŠæ³•ï¼šä½¿ç”¨å¼±å¼•ç”¨</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722161341.png" alt></p><p>â‘£å…¶ä»–å†…å­˜æ³„æ¼æƒ…å†µï¼šæ¯”å¦‚BraodcastReceiver æœªæ³¨é”€ï¼ŒInputStream æœªå…³é—­ï¼Œå†ä»£ç ä¸­å¤šæ³¨æ„æ³¨é”€æˆ–å…³é—­ã€‚</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722161424.png" alt></p><h4 id="55-LeakCanaryå†…å­˜ä¼˜åŒ–"><a href="#55-LeakCanaryå†…å­˜ä¼˜åŒ–" class="headerlink" title="55.LeakCanaryå†…å­˜ä¼˜åŒ–"></a>55.LeakCanaryå†…å­˜ä¼˜åŒ–</h4><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.jianshu.com/p/261e70f3083f" target="_blank" rel="noopener">LeakCanaryåŸç†è§£æ - ç®€ä¹¦</a></p><p>â‘ é¡¹ç›®å¦‚ä½•ä½¿ç”¨LeakCanary</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722161409.png" alt></p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722161434.png" alt></p><p>LeakCanary.enableDisplayLeakActivity(context);å†…å­˜æº¢å‡ºå›¾æ ‡ï¼Œå›¾æ ‡ä»¥é€šçŸ¥çš„å½¢å¼æ˜¾ç¤ºå†…å­˜æº¢å‡º</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722161447.png" alt></p><p>â‘¡å·¥ä½œæœºåˆ¶</p><p>LeakCanary.install() ä¼šè¿”å›ä¸€ä¸ªé¢„å®šä¹‰çš„ <strong>RefWatcher</strong>ï¼ŒåŒæ—¶ä¹Ÿä¼šå¯ç”¨ä¸€ä¸ª <strong>ActivityRefWatcher</strong>ï¼Œç”¨äºè‡ªåŠ¨ç›‘æ§è°ƒç”¨Activity.onDestroy() ä¹‹åæ³„éœ²çš„ activityã€‚</p><p>1.RefWatcher.watch() åˆ›å»ºä¸€ä¸ª <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fsquare%2Fleakcanary%2Fblob%2Fmaster%2Flibrary%2Fleakcanary-watcher%2Fsrc%2Fmain%2Fjava%2Fcom%2Fsquareup%2Fleakcanary%2FKeyedWeakReference.java" target="_blank" rel="noopener">KeyedWeakReference</a> åˆ°è¦è¢«ç›‘æ§çš„å¯¹è±¡ã€‚</p><p>2.ç„¶ååœ¨åå°çº¿ç¨‹æ£€æŸ¥å¼•ç”¨æ˜¯å¦è¢«æ¸…é™¤ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè°ƒç”¨GCã€‚</p><p>3.å¦‚æœå¼•ç”¨è¿˜æ˜¯æœªè¢«æ¸…é™¤ï¼ŒæŠŠ heap å†…å­˜ dump åˆ° APP å¯¹åº”çš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ª .hprof æ–‡ä»¶ä¸­ã€‚</p><p>4.åœ¨å¦å¤–ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ HeapAnalyzerService æœ‰ä¸€ä¸ª HeapAnalyzer ä½¿ç”¨<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fsquare%2Fhaha" target="_blank" rel="noopener">HAHA</a> è§£æè¿™ä¸ªæ–‡ä»¶ã€‚</p><p>5.å¾—ç›Šäºå”¯ä¸€çš„ reference key, HeapAnalyzer æ‰¾åˆ° KeyedWeakReferenceï¼Œå®šä½å†…å­˜æ³„éœ²ã€‚</p><p>6.HeapAnalyzer è®¡ç®— <em>åˆ° GC roots çš„æœ€çŸ­å¼ºå¼•ç”¨è·¯å¾„</em>ï¼Œå¹¶ç¡®å®šæ˜¯å¦æ˜¯æ³„éœ²ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œå»ºç«‹å¯¼è‡´æ³„éœ²çš„å¼•ç”¨é“¾ã€‚</p><p>7.å¼•ç”¨é“¾ä¼ é€’åˆ° APP è¿›ç¨‹ä¸­çš„ DisplayLeakServiceï¼Œ å¹¶ä»¥é€šçŸ¥çš„å½¢å¼å±•ç¤ºå‡ºæ¥ã€‚</p><h4 id="56-å¤šçº¿ç¨‹ã€çº¿ç¨‹æ± "><a href="#56-å¤šçº¿ç¨‹ã€çº¿ç¨‹æ± " class="headerlink" title="56.å¤šçº¿ç¨‹ã€çº¿ç¨‹æ± "></a>56.å¤šçº¿ç¨‹ã€çº¿ç¨‹æ± </h4><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.cnblogs.com%2Fwxd0108%2Fp%2F5479442.html" target="_blank" rel="noopener">Javaä¸­çš„å¤šçº¿ç¨‹ä½ åªè¦çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† - Givefine - åšå®¢å›­</a></p><p>çº¿ç¨‹çš„å¹¶è¡Œå’Œå¹¶å‘</p><p>å¹¶è¡Œï¼šå¤šä¸ªcpuå®ä¾‹æˆ–è€…å¤šå°æœºå™¨åŒæ—¶æ‰§è¡Œä¸€æ®µå¤„ç†é€»è¾‘ï¼Œæ˜¯çœŸæ­£çš„åŒæ—¶ã€‚</p><p>å¹¶å‘ï¼šé€šè¿‡cpuè°ƒåº¦ç®—æ³•ï¼Œè®©ç”¨æˆ·çœ‹ä¸Šå»åŒæ—¶æ‰§è¡Œï¼Œå®é™…ä¸Šä»cpuæ“ä½œå±‚é¢ä¸æ˜¯çœŸæ­£çš„åŒæ—¶ã€‚å¹¶å‘å¾€å¾€åœ¨åœºæ™¯ä¸­æœ‰å…¬ç”¨çš„èµ„æºï¼Œé‚£ä¹ˆé’ˆå¯¹è¿™ä¸ªå…¬ç”¨çš„èµ„æºå¾€å¾€äº§ç”Ÿç“¶é¢ˆï¼Œæˆ‘ä»¬ä¼šç”¨TPSæˆ–è€…QPSæ¥ååº”è¿™ä¸ªç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚</p><p>çº¿ç¨‹å®‰å…¨ï¼šå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº›çº¿ç¨‹åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„è°ƒåº¦å’Œäº¤æ›¿æ‰§è¡Œï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥ï¼Œæˆ–è€…åœ¨è°ƒç”¨æ–¹è¿›è¡Œä»»ä½•å…¶ä»–æ“ä½œï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºéƒ½å¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>çº¿ç¨‹åŒæ­¥ï¼šå³å½“æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å¯¹å†…å­˜è¿›è¡Œæ“ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹éƒ½ä¸å¯ä»¥å¯¹è¿™ä¸ªå†…å­˜åœ°å€è¿›è¡Œæ“ä½œï¼Œç›´åˆ°è¯¥çº¿ç¨‹å®Œæˆæ“ä½œï¼Œ å…¶ä»–çº¿ç¨‹æ‰èƒ½å¯¹è¯¥å†…å­˜åœ°å€è¿›è¡Œæ“ä½œï¼Œè€Œå…¶ä»–çº¿ç¨‹åˆå¤„äºç­‰å¾…çŠ¶æ€ï¼Œå®ç°çº¿ç¨‹åŒæ­¥çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä¸´ç•ŒåŒºå¯¹è±¡å°±æ˜¯å…¶ä¸­ä¸€ç§ã€‚</p><hr><p>Javaé€šè¿‡Executorsæä¾›å››ç§çº¿ç¨‹æ± ï¼ˆfrom ç™¾åº¦ï¼‰</p><p><strong>newCachedThreadPool</strong>â€”â€”åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹ã€‚</p><p><strong>newFixedThreadPool</strong>â€”â€”åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œå¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼Œè¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚</p><p><strong>newScheduledThreadPool</strong>â€”â€”åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚</p><p><strong>newSingleThreadExecutor</strong>â€”â€”åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.cnblogs.com%2Fdolphin0520%2Fp%2F3932921.html" target="_blank" rel="noopener">Javaå¹¶å‘ç¼–ç¨‹ï¼šçº¿ç¨‹æ± çš„ä½¿ç”¨ - Matrixæµ·å­ - åšå®¢å›­</a></p><p><strong>â‘ çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åˆå§‹åŒ–</strong></p><p>åˆ›å»ºçº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¸­æ²¡æœ‰çº¿ç¨‹ï¼Œéœ€è¦æäº¤ä»»åŠ¡æ‰ä¼šåˆ›å»ºçº¿ç¨‹ã€‚</p><p>prestartCoreThread()ï¼šåˆå§‹åŒ–ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼›</p><p>prestartAllCoreThreads()ï¼šåˆå§‹åŒ–æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹</p><p><strong>â‘¡workQueueï¼Œä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜æ”¾ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡</strong></p><p>workQueueçš„ç±»å‹ä¸ºBlockingQueue<runnable>ï¼Œé€šå¸¸å¯ä»¥å–ä¸‹é¢ä¸‰ç§ç±»å‹ï¼š</runnable></p><p>ã€€ã€€1ï¼‰ArrayBlockingQueueï¼šåŸºäºæ•°ç»„çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—åˆ›å»ºæ—¶å¿…é¡»æŒ‡å®šå¤§å°ï¼›</p><p>ã€€ã€€2ï¼‰LinkedBlockingQueueï¼šåŸºäºé“¾è¡¨çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œå¦‚æœåˆ›å»ºæ—¶æ²¡æœ‰æŒ‡å®šæ­¤é˜Ÿåˆ—å¤§å°ï¼Œåˆ™é»˜è®¤ä¸ºInteger.MAX_VALUEï¼›</p><p>ã€€ã€€3ï¼‰SynchronousQueueï¼šè¿™ä¸ªé˜Ÿåˆ—æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒä¸ä¼šä¿å­˜æäº¤çš„ä»»åŠ¡ï¼Œè€Œæ˜¯å°†ç›´æ¥æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æ¥çš„ä»»åŠ¡ã€‚</p><p><strong>â‘¢ä»»åŠ¡æ‹’ç»ç­–ç•¥</strong></p><p>å½“çº¿ç¨‹æ± çš„ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å·²æ»¡æˆ–çº¿ç¨‹æ•°ç›®è¾¾åˆ°maximumPoolSizeï¼Œè¿˜æœ‰ä»»åŠ¡æ¥æ—¶ä¼šé‡‡ç”¨ä»»åŠ¡æ‹’ç»ç­–ç•¥</p><p>1ï¼‰ThreadPoolExecutor.AbortPolicy:ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚</p><p>2ï¼‰ThreadPoolExecutor.DiscardPolicyï¼šä¹Ÿæ˜¯ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>3ï¼‰ThreadPoolExecutor.DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰</p><p>4ï¼‰ThreadPoolExecutor.CallerRunsPolicyï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡</p><p><strong>â‘£çº¿ç¨‹æ± çš„å…³é—­</strong></p><p>1ï¼‰shutdown()ï¼šä¸ä¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œè€Œæ˜¯è¦ç­‰æ‰€æœ‰ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œåæ‰ç»ˆæ­¢ï¼Œä½†å†ä¹Ÿä¸ä¼šæ¥å—æ–°çš„ä»»åŠ¡</p><p>2ï¼‰shutdownNow()ï¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œå¹¶å°è¯•æ‰“æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸”æ¸…ç©ºä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ï¼Œè¿”å›å°šæœªæ‰§è¡Œçš„ä»»åŠ¡</p><p><strong>â‘¤çº¿ç¨‹æ± å®¹é‡çš„åŠ¨æ€è°ƒæ•´</strong></p><p>1ï¼‰setCorePoolSizeï¼šè®¾ç½®æ ¸å¿ƒæ± å¤§å°</p><p>2ï¼‰setMaximumPoolSizeï¼šè®¾ç½®çº¿ç¨‹æ± æœ€å¤§èƒ½åˆ›å»ºçš„çº¿ç¨‹æ•°ç›®å¤§å°</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722161503.png" alt></p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.cnblogs.com%2Fsuperfj%2Fp%2F7544971.html" target="_blank" rel="noopener">ç”±æµ…å…¥æ·±ç†è§£Javaçº¿ç¨‹æ± åŠçº¿ç¨‹æ± çš„å¦‚ä½•ä½¿ç”¨ - Janti - åšå®¢å›­</a></p><p>corePoolSize :çº¿ç¨‹æ± çš„æ ¸å¿ƒæ± å¤§å°ï¼Œåœ¨åˆ›å»ºçº¿ç¨‹æ± ä¹‹åï¼Œçº¿ç¨‹æ± é»˜è®¤æ²¡æœ‰ä»»ä½•çº¿ç¨‹ã€‚</p><p>å½“æœ‰ä»»åŠ¡è¿‡æ¥çš„æ—¶å€™æ‰ä¼šå»åˆ›å»ºåˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚æ¢ä¸ªè¯´æ³•ï¼Œçº¿ç¨‹æ± åˆ›å»ºä¹‹åï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸º0ï¼Œå½“ä»»åŠ¡è¿‡æ¥å°±ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œï¼Œç›´åˆ°çº¿ç¨‹æ•°è¾¾åˆ°corePoolSizeä¹‹åï¼Œå°±ä¼šè¢«åˆ°è¾¾çš„ä»»åŠ¡æ”¾åœ¨é˜Ÿåˆ—ä¸­ã€‚ï¼ˆæ³¨æ„æ˜¯åˆ°è¾¾çš„ä»»åŠ¡ï¼‰ã€‚æ¢å¥æ›´ç²¾ç‚¼çš„è¯ï¼šcorePoolSizeè¡¨ç¤ºå…è®¸çº¿ç¨‹æ± ä¸­å…è®¸åŒæ—¶è¿è¡Œçš„æœ€å¤§çº¿ç¨‹æ•°ã€‚</p><p>å¦‚æœæ‰§è¡Œäº†çº¿ç¨‹æ± çš„prestartAllCoreThreads()æ–¹æ³•ï¼Œçº¿ç¨‹æ± ä¼šæå‰åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹ã€‚</p><p>maximumPoolSize :çº¿ç¨‹æ± å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œä»–è¡¨ç¤ºæœ€å¤§èƒ½åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹ã€‚maximumPoolSizeè‚¯å®šæ˜¯å¤§äºç­‰äºcorePoolSizeã€‚</p><p>keepAliveTime :è¡¨ç¤ºçº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ—¶æœ€å¤šä¿æŒå¤šä¹…ç„¶ååœæ­¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°å¤§äºcorePoolSizeæ—¶ï¼ŒkeepAliveTimeæ‰ä¼šèµ·ä½œç”¨ã€‚æ¢å¥è¯è¯´ï¼Œå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å¤§äºcorePoolSizeï¼Œå¹¶ä¸”ä¸€ä¸ªçº¿ç¨‹ç©ºé—²æ—¶é—´è¾¾åˆ°äº†keepAliveTimeï¼Œé‚£ä¹ˆå°±æ˜¯shutdownã€‚</p><p>Unit:keepAliveTimeçš„å•ä½ã€‚</p><p>workQueueï¼šä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°è¶…è¿‡å®ƒçš„corePoolSizeçš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—è¿›è¡Œé˜»å¡ç­‰å¾…ã€‚é€šè¿‡workQueueï¼Œçº¿ç¨‹æ± å®ç°äº†é˜»å¡åŠŸèƒ½</p><p>threadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹ã€‚</p><p>handler :è¡¨ç¤ºå½“æ‹’ç»å¤„ç†ä»»åŠ¡æ—¶çš„ç­–ç•¥ã€‚</p><p>åœ¨java docä¸­ï¼Œå¹¶ä¸æå€¡æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ThreadPoolExecutorï¼Œè€Œæ˜¯ä½¿ç”¨Executorsç±»ä¸­æä¾›çš„<strong>å‡ ä¸ªé™æ€æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹æ± </strong>ï¼š</p><p>Executors.newCachedThreadPool(); //åˆ›å»ºä¸€ä¸ªç¼“å†²æ± ï¼Œç¼“å†²æ± å®¹é‡å¤§å°ä¸ºInteger.MAX_VALUE</p><p>Executors.newSingleThreadExecutor(); //åˆ›å»ºå®¹é‡ä¸º1çš„ç¼“å†²æ± </p><p>Executors.newFixedThreadPool(int); //åˆ›å»ºå›ºå®šå®¹é‡å¤§å°çš„ç¼“å†²æ± </p><h4 id="57-è…¾è®¯-Bugly"><a href="#57-è…¾è®¯-Bugly" class="headerlink" title="57.è…¾è®¯ Bugly"></a>57.è…¾è®¯ Bugly</h4><p>è…¾è®¯å…¬å¸ä¸ºç§»åŠ¨å¼€å‘è€…å¼€æ”¾çš„æœåŠ¡ä¹‹ä¸€ï¼Œé¢å‘ç§»åŠ¨å¼€å‘è€…æä¾›ä¸“ä¸šçš„ <strong>Crash ç›‘æ§ã€å´©æºƒåˆ†æ</strong>ç­‰è´¨é‡è·Ÿè¸ªæœåŠ¡ã€‚Bugly èƒ½å¸®åŠ©ç§»åŠ¨äº’è”ç½‘å¼€å‘è€…æ›´åŠæ—¶åœ°å‘ç°æŒæ§å¼‚å¸¸ï¼Œæ›´å…¨é¢çš„äº†è§£å®šä½å¼‚å¸¸ï¼Œæ›´é«˜æ•ˆçš„ä¿®å¤è§£å†³å¼‚å¸¸ã€‚</p><p>é’ˆå¯¹ç§»åŠ¨åº”ç”¨ï¼Œè…¾è®¯ Bugly æä¾›äº†ä¸“ä¸šçš„ Crashã€Android ANR ( application not response)ã€iOS å¡é¡¿ç›‘æ§å’Œè§£å†³æ–¹æ¡ˆã€‚ç§»åŠ¨å¼€å‘è€… ( Android / iOS ) å¯ä»¥é€šè¿‡ç›‘æ§ï¼Œå¿«é€Ÿå‘ç°ç”¨æˆ·åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°çš„ Crash (å´©æºƒ)ã€Android ANR å’Œ iOS å¡é¡¿ï¼Œå¹¶æ ¹æ®ä¸ŠæŠ¥çš„ä¿¡æ¯å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ã€‚</p><h4 id="58-Glide"><a href="#58-Glide" class="headerlink" title="58.Glide"></a>58.Glide</h4><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fbumptech%2Fglide" target="_blank" rel="noopener">github åœ°å€</a></p><p>é¡¹ç›®ä¾èµ–Glideï¼Œåœ¨app build.gradle ä¸­é…ç½® compileâ€™com.github.bumptech.glide:glide:3.7.0â€™</p><p>ä½¿ç”¨glide3.7ç‰ˆæœ¬ï¼Œæ›´é«˜ç‰ˆæœ¬æˆ–å‡ºç°å¼‚å¸¸ï¼šError:Failed to resolve: com.android.support:support-annotations:27.0.2</p><p><strong>Glideç¼“å­˜æœºåˆ¶</strong></p><p>å†…å­˜å­˜ç¼“å­˜çš„ è¯»å­˜éƒ½åœ¨Engineç±»ä¸­å®Œæˆã€‚å†…å­˜ç¼“å­˜ä½¿ç”¨å¼±å¼•ç”¨å’ŒLruCacheç»“åˆå®Œæˆçš„,å¼±å¼•ç”¨æ¥ç¼“å­˜çš„æ˜¯æ­£åœ¨ä½¿ç”¨ä¸­çš„å›¾ç‰‡ã€‚å›¾ç‰‡å°è£…ç±»Resourceså†…éƒ¨æœ‰ä¸ªè®¡æ•°å™¨åˆ¤æ–­æ˜¯è¯¥å›¾ç‰‡å¦æ­£åœ¨ä½¿ç”¨ã€‚</p><p><strong>Glideå†…å­˜ç¼“å­˜çš„æµç¨‹</strong></p><p>è¯»ï¼šæ˜¯å…ˆä»lruCacheå–ï¼Œå–ä¸åˆ°å†ä»å¼±å¼•ç”¨ä¸­å–ï¼›</p><p>å­˜ï¼šå†…å­˜ç¼“å­˜å–ä¸åˆ°ï¼Œä»ç½‘ç»œæ‹‰å–å›æ¥å…ˆæ”¾åœ¨å¼±å¼•ç”¨é‡Œï¼Œæ¸²æŸ“å›¾ç‰‡ï¼Œå›¾ç‰‡å¯¹è±¡Resourcesä½¿ç”¨è®¡æ•°åŠ ä¸€ï¼›</p><p>æ¸²æŸ“å®Œå›¾ç‰‡ï¼Œå›¾ç‰‡å¯¹è±¡Resourcesä½¿ç”¨è®¡æ•°å‡ä¸€ï¼Œå¦‚æœè®¡æ•°ä¸º0ï¼Œå›¾ç‰‡ç¼“å­˜ä»å¼±å¼•ç”¨ä¸­åˆ é™¤ï¼Œæ”¾å…¥lruCacheç¼“å­˜ã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://www.jianshu.com/p/7ce7b02988a4" target="_blank" rel="noopener">Googleæ¨èâ€”â€”Glideä½¿ç”¨è¯¦è§£ - ç®€ä¹¦</a></p><p><a href="https://www.jianshu.com/p/17644406396b" target="_blank" rel="noopener">Glide ç³»åˆ—(å››) Glideç¼“å­˜æœºåˆ¶ - é‡ç”Ÿçš„å®‰å“å…½ - ç®€ä¹¦</a></p><h4 id="59-Fresco"><a href="#59-Fresco" class="headerlink" title="59.Fresco"></a>59.Fresco</h4><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Ffacebook%2Ffresco" target="_blank" rel="noopener">github åœ°å€</a></p><p>é¡¹ç›®ä¾èµ–Glideï¼Œåœ¨app build.gradle ä¸­é…ç½®ï¼šimplementationâ€™com.facebook.fresco:fresco:1.9.0â€™</p><p><a href="https://github.com/desmond1121/Fresco-Source-Analysis" target="_blank" rel="noopener">https://github.com/desmond1121/Fresco-Source-Analysis</a></p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.jianshu.com/p/3b143cf39013" target="_blank" rel="noopener">Frescoçš„ä½¿ç”¨å°ç»“ - ç®€ä¹¦</a></p><p><a href="https://blog.csdn.net/yw59792649/article/details/78921025" target="_blank" rel="noopener">https://blog.csdn.net/yw59792649/article/details/78921025</a></p><h4 id="60-React-Native"><a href="#60-React-Native" class="headerlink" title="60.React Native"></a>60.React Native</h4><p><strong>æ··åˆå¼€å‘æŠ€æœ¯ç§»åŠ¨å¼€å‘-æ··åˆAppä»‹ç» - Primise7çš„åšå®¢ - CSDNåšå®¢</strong></p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722161536.png" alt></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;é¢è¯•å¤§çº²&quot;&gt;&lt;a href=&quot;#é¢è¯•å¤§çº²&quot; class=&quot;headerlink&quot; title=&quot;é¢è¯•å¤§çº²&quot;&gt;&lt;/a&gt;é¢è¯•å¤§çº²&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;javaåŸºç¡€ã€é¢å‘å¯¹è±¡ã€é›†åˆã€çº¿ç¨‹ä½¿ç”¨ï¼›&lt;/li&gt;
&lt;li&gt;Android æœºå‹é€‚é…ã€SDKé€‚é…ã€å†…å­˜ä¼˜åŒ–ã€å†…å­˜æº¢å‡ºã€å†…å­˜æ³„æ¼ï¼›&lt;/li&gt;
&lt;li&gt;MVC/MVP/MVVMçš„ä½¿ç”¨åœºæ™¯ï¼›&lt;/li&gt;
&lt;li&gt;äº†è§£å¹¶èƒ½ä½¿ç”¨æœ€æ–°æµè¡Œå¼€æºåº“RXjava+Retrofit+OKHttpã€Glideã€EventBusç­‰ï¼›&lt;/li&gt;
&lt;li&gt;JNIåŠNDKçš„ä½¿ç”¨ã€ç†Ÿæ‚‰Frameworkã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="é¢è¯•" scheme="https://zhangmiao.cc/categories/Android/%E9%9D%A2%E8%AF%95/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="é¢è¯•" scheme="https://zhangmiao.cc/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>Androidé¢è¯•é¢˜é›†</title>
    <link href="https://zhangmiao.cc/posts/4a3cde30.html"/>
    <id>https://zhangmiao.cc/posts/4a3cde30.html</id>
    <published>2019-07-02T06:36:57.000Z</published>
    <updated>2019-07-22T09:18:42.537Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Javaéƒ¨åˆ†</strong><br><strong>Androidéƒ¨åˆ†</strong><br><strong>æ•°æ®ç»“æ„ä¸ç®—æ³•éƒ¨åˆ†</strong><br><strong>å¸¸ç”¨çš„å¼€æºåº“éƒ¨åˆ†</strong><br><strong>è®¡ç®—æœºç½‘ç»œè®¤è¯†</strong></p><a id="more"></a><h2 id="1-Javaéƒ¨åˆ†"><a href="#1-Javaéƒ¨åˆ†" class="headerlink" title="1.Javaéƒ¨åˆ†"></a><strong>1.Javaéƒ¨åˆ†</strong></h2><h3 id="1-1-æ“ä½œç³»ç»Ÿç›¸å…³"><a href="#1-1-æ“ä½œç³»ç»Ÿç›¸å…³" class="headerlink" title="1.1 æ“ä½œç³»ç»Ÿç›¸å…³"></a>1.1 æ“ä½œç³»ç»Ÿç›¸å…³</h3><ul><li>1.ä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿ</li><li>2.ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Œä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿ</li></ul><h3 id="1-2-JDK-amp-JVM-amp-JRE"><a href="#1-2-JDK-amp-JVM-amp-JRE" class="headerlink" title="1.2 JDK&amp;JVM&amp;JRE"></a>1.2 JDK&amp;JVM&amp;JRE</h3><ul><li>1.JDK &amp; JVM &amp; JREåˆ†åˆ«æ˜¯ä»€ä¹ˆä»¥åŠå®ƒä»¬çš„åŒºåˆ«ï¼Ÿ</li><li>2.è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆJavaå¯ä»¥è·¨å¹³å°ï¼Ÿ</li></ul><h3 id="1-3-é¢å‘è¿‡ç¨‹-amp-é¢å‘å¯¹è±¡"><a href="#1-3-é¢å‘è¿‡ç¨‹-amp-é¢å‘å¯¹è±¡" class="headerlink" title="1.3 é¢å‘è¿‡ç¨‹ &amp; é¢å‘å¯¹è±¡"></a>1.3 é¢å‘è¿‡ç¨‹ &amp; é¢å‘å¯¹è±¡</h3><ul><li>1.ä»€ä¹ˆæ˜¯é¢å‘è¿‡ç¨‹ &amp; ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ &amp; åŒºåˆ«ï¼Ÿ</li><li>2.ç»™æˆ‘è¯´è¯´Javaé¢å‘å¯¹è±¡çš„ç‰¹å¾ä»¥åŠè®²è®²ä½ ä»£ç ä¸­å‡¸æ˜¾è¿™äº›ç‰¹å¾çš„ç»éªŒã€‚</li><li>3.ä»€ä¹ˆæ˜¯é‡è½½ &amp; ä»€ä¹ˆæ˜¯é‡å†™ &amp; åŒºåˆ«ã€‚</li><li>4.è°ˆè°ˆä½ å¯¹thiså’Œsuperçš„è®¤è¯†ã€‚</li><li>5.æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«ã€‚</li><li>6.é™æ€å±æ€§å’Œé™æ€æ–¹æ³•èƒ½è¢«ç»§æ‰¿å—ï¼Ÿé™æ€æ–¹æ³•åˆæ˜¯å¦èƒ½è¢«é‡å†™å‘¢ï¼Ÿ</li><li>7.ç»™æˆ‘è¯´è¯´æƒé™ä¿®é¥°ç¬¦ç‰¹æ€§ã€‚</li><li>8.ç»™æˆ‘è°ˆè°ˆJavaä¸­çš„å†…éƒ¨ç±»ã€‚</li><li>9.é—­åŒ…å’Œå†…éƒ¨ç±»çš„åŒºåˆ«ï¼Ÿ</li><li>10.Javaå¤šæ€çš„å®ç°æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>11.è°ˆè°ˆä½ å¯¹å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„è®¤è¯†ï¼Ÿ</li><li>12.staticå…³é”®å­—çš„ä½œç”¨ï¼Ÿ</li><li>13.finalå…³é”®å­—çš„ä½œç”¨ã€‚</li></ul><h3 id="1-4-å…«å¤§åŸºæœ¬æ•°æ®ç±»å‹-amp-å¼•ç”¨ç±»å‹"><a href="#1-4-å…«å¤§åŸºæœ¬æ•°æ®ç±»å‹-amp-å¼•ç”¨ç±»å‹" class="headerlink" title="1.4 å…«å¤§åŸºæœ¬æ•°æ®ç±»å‹&amp;å¼•ç”¨ç±»å‹"></a>1.4 å…«å¤§åŸºæœ¬æ•°æ®ç±»å‹&amp;å¼•ç”¨ç±»å‹</h3><ul><li>1.è¯´è¯´Javaä¸­çš„8å¤§åŸºæœ¬ç±»å‹ &amp; å†…å­˜ä¸­å æœ‰çš„å­—èŠ‚ &amp; ä»€ä¹ˆæ˜¯å¼•ç”¨ç±»å‹ï¼Ÿ</li><li>2.ä»€ä¹ˆæ˜¯æ‹†ç®± &amp; è£…ç®±ï¼Œèƒ½ç»™æˆ‘ä¸¾æ —å­å—ï¼Ÿ</li></ul><h3 id="1-5-æ•°ç»„"><a href="#1-5-æ•°ç»„" class="headerlink" title="1.5 æ•°ç»„"></a>1.5 æ•°ç»„</h3><ul><li>1.èƒ½è¯´è¯´å¤šç»´æ•°ç»„åœ¨å†…å­˜ä¸Šæ˜¯æ€ä¹ˆå­˜å‚¨çš„å—ï¼Ÿ</li><li>2.ä½ å¯¹æ•°ç»„äºŒæ¬¡å°è£…è¿‡å—ï¼Ÿè¯´è¯´å°è£…äº†ä»€ä¹ˆ</li></ul><h3 id="1-6-Javaå¼‚å¸¸"><a href="#1-6-Javaå¼‚å¸¸" class="headerlink" title="1.6 Javaå¼‚å¸¸"></a>1.6 Javaå¼‚å¸¸</h3><ul><li>1.è¯´è¯´Javaå¼‚å¸¸ä½“ç³»ä¸»è¦ç”¨æ¥å¹²ä»€ä¹ˆçš„ &amp; å¼‚å¸¸ä½“ç³»ï¼Ÿ</li><li>2.Errorå’ŒExceptionçš„åŒºåˆ«ï¼Ÿ</li><li>3.è¯´è¯´è¿è¡Œæ—¶å¼‚å¸¸å’Œéè¿è¡Œæ—¶å¼‚å¸¸çš„åŒºåˆ«ï¼Ÿ</li><li>4.å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªå¼‚å¸¸ï¼Ÿ</li><li>5.throwå’Œthrows çš„åŒºåˆ«ï¼Ÿ</li><li>6.try{}catch{}finally{}å¯ä»¥æ²¡æœ‰finallyå—ï¼Ÿ</li><li>7.finallyè¯­å—æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</li><li>8.returnåœ¨try{}catch{}finally{}ä¸­æ‰§è¡Œå…·æœ‰å“ªäº›è§„åˆ™ï¼Ÿ</li><li>9.ç»™æˆ‘ä¾‹ä¸¾è‡³å°‘5ä¸ªå¸¸è§çš„è¿è¡Œæ—¶å¼‚å¸¸ã€‚</li></ul><h3 id="1-7-NIO-BIO-AIO"><a href="#1-7-NIO-BIO-AIO" class="headerlink" title="1.7 NIO/BIO/AIO"></a>1.7 NIO/BIO/AIO</h3><ul><li>1.NIOæ˜¯ä»€ä¹ˆ &amp; BIOæ˜¯ä»€ä¹ˆ &amp; AIOæ˜¯ä»€ä¹ˆ &amp; å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ</li><li>2.IOæŒ‰ç…§æ–¹å‘å’Œæ•°æ®ç±»å‹åˆ’åˆ†èƒ½åˆ’åˆ†ä¸ºå“ªäº›æ•°æ®æµï¼Ÿ</li><li>3.èƒ½ç»™æˆ‘è¯´è¯´NIOæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿå¹³å¸¸å¼€å‘ä¸­ä½¿ç”¨è¿‡å—ï¼Ÿ</li></ul><h3 id="1-8-é›†åˆ-å®¹å™¨"><a href="#1-8-é›†åˆ-å®¹å™¨" class="headerlink" title="1.8 é›†åˆ(å®¹å™¨)"></a>1.8 é›†åˆ(å®¹å™¨)</h3><ul><li>1.è¯´è¯´Javaä¸­é›†åˆçš„æ¡†æ¶ï¼Ÿ</li><li>2.Collection &amp; MapåŒºåˆ«</li><li>3.è°ˆè°ˆä½ å¸¸ç”¨çš„é›†åˆ &amp; å®ƒä»¬åº•å±‚çš„å®ç°æ–¹å¼ &amp; ä¼˜ç¼ºç‚¹ &amp; ä½¿ç”¨åœºæ™¯ã€‚</li><li>4.Mapçš„éå†æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</li><li>5.ç»™æˆ‘è¯´è¯´ArrayListçš„æ‰©å®¹æœºåˆ¶.</li><li>6.ä»€ä¹ˆæ˜¯æ·±æ‹·è´ &amp; æµ…æ‹·è´ &amp; å¦‚ä½•æ·±æ‹·è´ä¸€ä¸ªListé›†åˆ.</li><li>7.Setæ˜¯å¦‚ä½•ç¡®ä¿å®ƒçš„å”¯ä¸€æ€§çš„ã€‚</li><li>8.ä½ è§‰å¾—HashMapçš„å…ƒç´ é¡ºåºå’Œä»€ä¹ˆæœ‰å…³ï¼Ÿ</li><li>9.Javaä¸­HashMapå¦‚ä½•è§£å†³å“ˆå¸Œç¢°æ’çš„ï¼Ÿ</li><li>10.ConcurrentHashMapå¦‚ä½•å®ç°å¹¶å‘è®¿é—®çš„ï¼Ÿ</li><li>11.è°ˆè°ˆJavaé›†åˆä¸­é‚£äº›çº¿ç¨‹å®‰å…¨çš„é›†åˆ &amp; å®ç°åŸç†ã€‚</li><li>12.è¯´è¯´æœ‰å“ªäº›é›†åˆèƒ½åŠ å…¥null,å“ªäº›ä¸èƒ½åŠ å…¥null,ä¸ºä»€ä¹ˆï¼Ÿ</li><li>13.è¯´è¯´LinkedHashMapåŸç†ã€‚</li><li>14.Collection å’Œ Collectionsçš„åŒºåˆ«ï¼Ÿ</li><li>15.æ¯”è¾ƒä¸€ä¸‹ArrayMapå’ŒHashMapã€‚</li><li>16.è¯´è¯´HashMapçš„åŸç†ã€‚</li></ul><h3 id="1-9-çº¿ç¨‹"><a href="#1-9-çº¿ç¨‹" class="headerlink" title="1.9 çº¿ç¨‹"></a>1.9 çº¿ç¨‹</h3><ul><li>1.ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚</li><li>2.Javaä¸­åˆ›å»ºçº¿ç¨‹çš„2ç§æ–¹å¼ &amp; åŒºåˆ«ï¼Ÿ</li><li>3.ç»™æˆ‘è¯´è¯´çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚</li><li>4.çº¿ç¨‹æ­»é”çš„åŸå›  &amp; ä¸¾ä¸ªæ —å­ &amp; å¦‚ä½•é¿å…æ­»é”ã€‚</li><li>5.Synchronizedæ”¾åœ¨é™æ€æ–¹æ³•å’Œéé™æ€æ–¹æ³•ä¸Šçš„é”å¯¹è±¡åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>6.å¦‚ä½•åœæ­¢æ‰ä¸€ä¸ªçº¿ç¨‹ï¼Ÿ</li><li>7.ç»™æˆ‘è¯´è¯´çº¿ç¨‹æ± çš„ç§ç±» &amp; ç‰¹ç‚¹ &amp; å†…éƒ¨åŸç† &amp; å¹³æ—¶å½“ä¸­ä½¿ç”¨æ¡ˆä¾‹ã€‚</li><li>8.ç»™æˆ‘è°ˆè°ˆä½ æ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹æ•°æ®å®‰å…¨é—®é¢˜çš„ï¼Ÿ</li><li>9.wait()å’Œsleep()çš„åŒºåˆ«ï¼Ÿ</li><li>10.ä»€ä¹ˆæ˜¯å…¬å¹³é”&amp;éå…¬å¹³é”&amp;åŒºåˆ«ï¼Ÿ</li><li>11.ç»™æˆ‘è®²è®²çº¿ç¨‹é—´é€šä¿¡</li><li>12.volatileå…³é”®å­—æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼ŸåŸç†æ˜¯ä»€ä¹ˆ</li><li>13.è¯´è¯´ä½¿ç”¨5ä¸ªçº¿ç¨‹å»è®¡ç®—ä¸€ä¸ªæ•°ç»„ä¹‹å’Œçš„æ€è·¯ã€‚</li><li>14.è°ˆè°ˆçº¿ç¨‹é˜»å¡çš„åŸå› æœ‰å“ªäº›ï¼Ÿ</li><li>15.è°ˆè°ˆä½ å¯¹notifyçš„ç†è§£ï¼Ÿ</li><li>16.ä½ è§‰å¾—Lockå’ŒSynchronizedçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>17.è°ˆè°ˆä½ å¯¹ReentrantLockçš„è®¤è¯†ã€‚</li><li>18.è°ƒç”¨run()å’Œstart()çš„åŒºåˆ«ï¼Ÿ</li><li>19.transientå…³é”®å­—çš„ç”¨æ³• &amp; ä½œç”¨ &amp; åŸç†ã€‚</li><li>20.çº¿ç¨‹æ± çš„ç§ç±»  &amp; å·¥ä½œåŸç† &amp; ThreadPoolExecutorçš„å·¥ä½œç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</li><li>21.ThreadLocaläº†è§£å—ï¼Ÿè¯´è¯´åŸç†ã€‚</li><li>22.æƒè¡¡å¤šçº¿ç¨‹çš„æ€§èƒ½ã€‚</li><li>23.å¦‚ä½•ç†è§£åŒæ­¥å’Œå¼‚æ­¥ï¼Œé˜»å¡å’Œéé˜»å¡ã€‚</li></ul><h3 id="1-10-æ³›å‹"><a href="#1-10-æ³›å‹" class="headerlink" title="1.10 æ³›å‹"></a>1.10 æ³›å‹</h3><ul><li>1.ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li><li>2.è¯´è¯´Javaä¸­æ³›å‹çš„å·¥ä½œæœºåˆ¶ï¼Ÿ</li><li>3.åœ¨æ³›å‹ç§extendså’Œsuperå…³é”®å­—çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</li></ul><h3 id="1-11-åå°„"><a href="#1-11-åå°„" class="headerlink" title="1.11 åå°„"></a>1.11 åå°„</h3><ul><li>1.ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ</li><li>2.å¦‚ä½•è·å–ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡ &amp; æˆå‘˜æ–¹æ³• &amp; æ³¨è§£ä¿¡æ¯ &amp; â€¦ã€‚</li><li>3.é€šå¸¸åœ¨é¡¹ç›®å½“ä¸­ç”¨åˆ°åå°„å¤šå—ï¼Ÿéƒ½æ˜¯ç”¨æ¥å¹²å˜›ï¼Ÿ</li></ul><h3 id="1-12-æ³¨è§£"><a href="#1-12-æ³¨è§£" class="headerlink" title="1.12 æ³¨è§£"></a>1.12 æ³¨è§£</h3><ul><li>1.ä»€ä¹ˆæ˜¯æ³¨è§£ &amp; å®ƒå’Œæ³¨é‡Šçš„åŒºåˆ«ï¼Ÿ</li><li>2.æ³¨è§£çš„å·¥ä½œæœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ</li></ul><h3 id="1-13-Socketç¼–ç¨‹"><a href="#1-13-Socketç¼–ç¨‹" class="headerlink" title="1.13 Socketç¼–ç¨‹"></a>1.13 Socketç¼–ç¨‹</h3><ul><li>1.ä»€ä¹ˆæ˜¯Socketç¼–ç¨‹ï¼Ÿ</li><li>2.ä»€ä¹ˆæ˜¯TCP,ä»€ä¹ˆæ˜¯UDP,äºŒè€…ä¹‹é—´åŒºåˆ«å¦‚ä½•ï¼Ÿ</li></ul><h3 id="1-14-è®¾è®¡æ¨¡å¼"><a href="#1-14-è®¾è®¡æ¨¡å¼" class="headerlink" title="1.14 è®¾è®¡æ¨¡å¼"></a>1.14 è®¾è®¡æ¨¡å¼</h3><ul><li>1.è¯´è¯´è®¾è®¡æ¨¡å¼çš„å…­å¤§åŸåˆ™ã€‚</li><li>2.è¯·è®²è®²ä½ ä¼šä½¿ç”¨çš„ä¸€äº›è®¾è®¡æ¨¡å¼ï¼Ÿ</li><li>3.è¯·è¯´è¯´å•ä¾‹æ¨¡å¼ &amp; ä½ é¡¹ç›®ä¸­å¸¸ç”¨çš„å•ä¾‹æ¨¡å¼ã€‚</li><li>4.æ‡’æ±‰å•ä¾‹æ¨¡å¼ä¸ºä»€ä¹ˆè¦åŠ volaitleï¼Ÿ</li><li>5.èƒ½å¦ç»™æˆ‘è¯´è¯´Androidä¸­è‡³å°‘3ä¸ªç”¨åˆ°è®¾è®¡æ¨¡å¼çš„æ —å­ï¼Ÿ</li></ul><h3 id="1-15-JVMç›¸å…³"><a href="#1-15-JVMç›¸å…³" class="headerlink" title="1.15 JVMç›¸å…³"></a>1.15 JVMç›¸å…³</h3><ul><li>1.ä»€ä¹ˆæ˜¯classæ–‡ä»¶ï¼Ÿ</li><li>2.Javaä»£ç æ‰§è¡Œæµç¨‹ï¼Ÿ</li><li>3.Javaå†…å­˜ç»“æ„ &amp; å†…å­˜æ¨¡å‹ã€‚</li><li>4.GCå›æ”¶æœºåˆ¶ã€‚</li><li>5.Javaè™šæ‹Ÿæœºæ˜¯å¦‚ä½•åŠ è½½ä¸€ä¸ªç±»çš„ï¼Ÿ</li><li>6.ç»™æˆ‘è°ˆè°ˆç±»åŠ è½½å™¨ã€‚</li><li>7.è°ˆè°ˆstaticç¼–è¯‘è¿è¡Œæ—¶çš„æµç¨‹ï¼Œåœ¨è™šæ‹Ÿæœºä¸­å¦‚ä½•ä¿å­˜çš„ï¼Ÿ</li><li>8.è¯´è¯´Javaç§çš„4ç§å¼•ç”¨ä»¥åŠç”¨æ³•ï¼Ÿ</li><li>9.å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯æ­»äº¡çš„ï¼Ÿ</li><li>10.ä»£ç ä¸­ç›´æ¥è°ƒç”¨System.gc()ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</li><li>11.ä¸€ä¸ªå¼ºå¼•ç”¨ç›´æ¥è¢«nullèµ‹å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ä¼šè¢«ç«‹åˆ»å›æ”¶å—ï¼Ÿ</li><li>12.String a = â€œaâ€+â€bâ€+â€câ€;åœ¨å†…å­˜ä¸­åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ</li><li>13.è°ˆè°ˆä½ å¯¹å­—ç¬¦é›†çš„ç†è§£ã€‚</li><li>14.å¸¸è§çš„ç¼–ç æ ¼å¼æœ‰å“ªäº›ï¼Ÿ</li><li>15.utf-8ä¸­çš„ä¸­æ–‡å å‡ ä¸ªå­—èŠ‚ï¼Ÿintå‹å å‡ ä¸ªå­—èŠ‚ï¼Ÿ</li><li>16.è°ˆè°ˆä½ å¯¹é€»è¾‘åœ°å€å’Œç‰©ç†åœ°å€çš„ç†è§£ï¼Ÿ</li><li>17.ä½ çŸ¥é“å¯¹è±¡ä»€ä¹ˆæ—¶å€™ä¼šå›è°ƒfinalizeæ–¹æ³•å—ï¼Ÿ</li></ul><h3 id="1-16-å…¶å®ƒJavaéƒ¨åˆ†æœ‰å…³é¢è¯•é¢˜"><a href="#1-16-å…¶å®ƒJavaéƒ¨åˆ†æœ‰å…³é¢è¯•é¢˜" class="headerlink" title="1.16 å…¶å®ƒJavaéƒ¨åˆ†æœ‰å…³é¢è¯•é¢˜"></a>1.16 å…¶å®ƒJavaéƒ¨åˆ†æœ‰å…³é¢è¯•é¢˜</h3><ul><li>1.ä¸ºä»€ä¹ˆå±€éƒ¨å†…éƒ¨ç±»è®¿é—®å±€éƒ¨å˜é‡éœ€è¦final?</li><li>2.Stringã€StringBufferã€StringBuilderã€CharSequenceçš„åŒºåˆ«ã€‚</li><li>3.equalså’Œ==çš„åŒºåˆ«ï¼Ÿ</li><li>4.å…³äºå­—ç¬¦ä¸²çš„æ‹¼æ¥ä½ åœ¨é¡¹ç›®ä¸­å¸¸å¸¸æ€ä¹ˆæ“ä½œçš„ï¼Ÿä¸ºä»€ä¹ˆä¸èƒ½ç”¨â€œ+â€çš„æ–¹å¼è¿›è¡Œæ‹¼æ¥å‘¢ï¼Ÿ</li><li>5.ä»€ä¹ˆæ˜¯Callback,è®²è®²ä½ é¡¹ç›®ä¸­ä½¿ç”¨çš„ä¸€äº›æœ‰å…³Callbackçš„æ —å­ã€‚</li><li>6.retrun &amp; break &amp; continue åŒºåˆ«ï¼Ÿ</li><li>7.å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å›æ–‡å­—ç¬¦ä¸²ï¼Ÿ</li><li>8.final,finally,finalizeçš„åŒºåˆ«ï¼Ÿ</li><li>9.ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç† &amp; ä»€ä¹ˆæ˜¯é™æ€ä»£ç†ï¼Ÿ</li><li>10.Stringä¸ºä»€ä¹ˆä¼šåŠ finalï¼Ÿ</li><li>11.OOMå¯ä»¥try{}catch{}å—ï¼Ÿ</li><li>12.ç»™æˆ‘è°ˆè°ˆæ­£åˆ™è¡¨è¾¾å¼ã€‚</li><li>13.å¦‚ä½•å°†Stringè½¬æˆint?</li><li>14.è°ˆè°ˆä½ å¯¹Stringçš„ç†è§£ã€‚</li><li>15.ä½ å¦‚ä½•ç†è§£åºåˆ—åŒ–ï¼Ÿæœ‰å“ªäº›æ–¹å¼åºåˆ—åŒ–ï¼Ÿ</li><li>16.è°ˆè°ˆä½ å¯¹ä¾èµ–æ³¨å…¥çš„ç†è§£ã€‚</li><li>17.ç»™æˆ‘è°ˆè°ˆä½ å¯¹åˆ†æ´¾çš„ç†è§£ã€‚</li></ul><h2 id="2-Android-éƒ¨åˆ†"><a href="#2-Android-éƒ¨åˆ†" class="headerlink" title="2.Android éƒ¨åˆ†"></a><strong>2.Android éƒ¨åˆ†</strong></h2><ul><li>å››å¤§ç»„ä»¶æ˜¯å“ªå››ä¸ªï¼ŸABCS(Activity,Braodcast,ContentProvider,Service)</li></ul><h3 id="2-1-Activity"><a href="#2-1-Activity" class="headerlink" title="2.1 Activity"></a>2.1 Activity</h3><ul><li>1.Activityæ˜¯ä»€ä¹ˆï¼Ÿ</li><li>2.å…¸å‹æƒ…å†µä¸‹çš„Activityç”Ÿå‘½å‘¨æœŸï¼Ÿ</li><li>3.å¼‚å¸¸æƒ…å†µä¸‹çš„Activityçš„ç”Ÿå‘½å‘¨æœŸ &amp; æ•°æ®å¦‚ä½•ä¿å­˜å’Œæ¢å¤ï¼Ÿ</li><li>4.ä»Activity Aè·³è½¬åˆ°Activity Bä¹‹åï¼Œç„¶åå†ç‚¹å‡»backå»ºä¹‹åï¼Œå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸè°ƒç”¨æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>5.å¦‚ä½•ç»Ÿè®¡Activityçš„å·¥ä½œæ—¶é—´ï¼Ÿ</li><li>6.ç»™æˆ‘è¯´è¯´Activityçš„å¯åŠ¨æ¨¡å¼ &amp; ä½¿ç”¨åœºæ™¯ã€‚</li><li>7.å¦‚ä½•åœ¨ä»»æ„ä½ç½®å…³æ‰åº”ç”¨æ‰€æœ‰Activity &amp; å¦‚ä½•åœ¨ä»»æ„ä½ç½®å…³æ‰æŒ‡å®šçš„Activityï¼Ÿ</li><li>8.Activityçš„å¯åŠ¨æµç¨‹(ä»æºç è§’åº¦è§£æ)ï¼Ÿ</li><li>9.å¯åŠ¨ä¸€ä¸ªå…¶å®ƒåº”ç”¨çš„Activityçš„ç”Ÿå‘½å‘¨æœŸåˆ†æã€‚</li><li>10.Activityä»»åŠ¡æ ˆæ˜¯ä»€ä¹ˆï¼Ÿåœ¨é¡¹ç›®ä¸­æœ‰ç”¨åˆ°å®ƒå—ï¼Ÿè¯´ç»™æˆ‘å¬å¬</li><li>11.ä»€ä¹ˆæƒ…å†µä¸‹Activityä¸èµ°onDestory?</li><li>12.ä»€ä¹ˆæƒ…å†µä¸‹Activityä¼šå•ç‹¬æ‰§è¡ŒonPause?</li><li>13.a-&gt;b-&gt;cç•Œé¢ï¼Œå…¶ä¸­bæ˜¯SingleInstanceçš„ï¼Œé‚£ä¹ˆcç•Œé¢ç‚¹backè¿”å›aç•Œé¢ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li><li>14.å¦‚æœä¸€ä¸ªActivityå¼¹å‡ºä¸€ä¸ªDialog,é‚£ä¹ˆè¿™ä¸ªAcitvityä¼šå›è°ƒå“ªäº›ç”Ÿå‘½å‘¨æœŸå‡½æ•°å‘¢ï¼Ÿ</li><li>15.Activityä¹‹é—´å¦‚ä½•é€šä¿¡ &amp; Activityå’ŒFragmentä¹‹é—´é€šä¿¡ &amp; Activityå’ŒServiceä¹‹é—´é€šä¿¡ï¼Ÿ</li><li>16.è¯´è¯´Activityæ¨ªç«–å±åˆ‡æ¢çš„ç”Ÿå‘½å‘¨æœŸã€‚</li><li>17.å‰å°åˆ‡æ¢åˆ°åå°ï¼Œç„¶ååœ¨å›åˆ°å‰å°æ—¶Activityçš„ç”Ÿå‘½å‘¨æœŸã€‚</li><li>18.ä¸‹æ‹‰çŠ¶æ€æ æ—¶Activityçš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ</li><li>19.Activityä¸Fragmentçš„ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒï¼Ÿ</li><li>20.äº†è§£å“ªäº›Activityå¸¸ç”¨çš„æ ‡è®°ä½Flagsï¼Ÿ</li><li>21.è°ˆè°ˆéšå¼å¯åŠ¨å’Œæ˜¾ç¤ºå¯åŠ¨Activityçš„æ–¹å¼ï¼Ÿ</li><li>22.Activityç”¨Intentä¼ é€’æ•°æ®å’ŒBundleä¼ é€’æ•°æ®çš„åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆä¸ç”¨HashMapå‘¢ï¼Ÿ</li><li>23.åœ¨éšå¼å¯åŠ¨ä¸­Intentå¯ä»¥è®¾ç½®å¤šä¸ªaction,å¤šä¸ªcategoryå— &amp; é¡ºä¾¿è®²è®²å®ƒä»¬çš„åŒ¹é…è§„åˆ™ï¼Ÿ</li><li>24.Activityå¯ä»¥è®¾ç½®ä¸ºå¯¹è¯æ¡†çš„å½¢å¼å—ï¼Ÿ</li><li>25.å¦‚ä½•ç»™Activityè®¾ç½®è¿›å…¥å’Œé€€å‡ºçš„åŠ¨ç”»ï¼Ÿ</li><li>26.Activityä½¿ç”¨Intentä¼ é€’æ•°æ®æ˜¯å¦æœ‰é™åˆ¶ &amp; å¦‚æœä¼ é€’ä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ï¼Œä¾‹å¦‚ä¸€ä¸ªå¤æ‚çš„æ§ä»¶å¯¹è±¡åº”è¯¥æ€ä¹ˆåšï¼Ÿ</li></ul><h3 id="2-2-BroadcastReceiver"><a href="#2-2-BroadcastReceiver" class="headerlink" title="2.2 BroadcastReceiver"></a>2.2 BroadcastReceiver</h3><ul><li>1.å¹¿æ’­æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>2.å¹¿æ’­çš„æ³¨å†Œæ–¹å¼æœ‰å“ªäº›ï¼Ÿ</li><li>3.å¹¿æ’­çš„åˆ†ç±» &amp; ç‰¹æ€§ &amp; ä½¿ç”¨åœºæ™¯ï¼Ÿ</li><li>4.è¯´è¯´ç³»ç»Ÿå¹¿æ’­å’Œæœ¬åœ°å¹¿æ’­çš„åŸç† &amp; åŒºåˆ« &amp; ä½¿ç”¨åœºæ™¯ã€‚</li><li>5.æœ‰ä¸¤ä¸ªåº”ç”¨æ³¨å†Œäº†ä¸€æ ·çš„å¹¿æ’­ï¼Œä¸€ä¸ªæ˜¯é™æ€ï¼Œä¸€ä¸ªæ˜¯åŠ¨æ€ï¼Œè¿ä¼˜å…ˆçº§ä¹Ÿä¸€æ ·ï¼Œé‚£ä¹ˆå½“å¹¿æ’­ä»ç³»ç»Ÿå‘å‡ºæ¥åï¼Œå“ªä¸ªåº”ç”¨å…ˆæ¥æ”¶åˆ°å¹¿æ’­ï¼Ÿ</li></ul><h3 id="2-3-ContentProvider"><a href="#2-3-ContentProvider" class="headerlink" title="2.3 ContentProvider"></a>2.3 ContentProvider</h3><ul><li>1.ä»€ä¹ˆæ˜¯å†…å®¹æä¾›è€…ï¼Ÿ</li><li>2.è¯´è¯´å¦‚ä½•åˆ›å»ºè‡ªå·±åº”ç”¨çš„å†…å®¹æä¾›è€… &amp; ä½¿ç”¨åœºæ™¯ã€‚</li><li>3.è¯´è¯´ContentProviderçš„åŸç†ã€‚</li><li>4.ContentProvider,ContentResolver,ContentObserverä¹‹é—´çš„å…³ç³»ï¼Ÿ</li><li>5.è¯´è¯´ContentProviderçš„æƒé™ç®¡ç†ã€‚</li></ul><h3 id="2-4-Service"><a href="#2-4-Service" class="headerlink" title="2.4 Service"></a>2.4 Service</h3><ul><li>1.ä»€ä¹ˆæ˜¯Service?</li><li>2.è¯´è¯´Serviceçš„ç”Ÿå‘½å‘¨æœŸã€‚</li><li>3.Serviceå’ŒThreadçš„åŒºåˆ«ï¼Ÿ</li><li>4.Android 5.0ä»¥ä¸Šçš„éšå¼å¯åŠ¨é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆã€‚</li><li>5.ç»™æˆ‘è¯´è¯´Serviceä¿æ´»æ–¹æ¡ˆ</li><li>6.IntentServiceæ˜¯ä»€ä¹ˆ &amp; åŸç† &amp; ä½¿ç”¨åœºæ™¯ &amp; å’ŒServiceçš„åŒºåˆ«ã€‚</li><li>7.åˆ›å»ºä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹çš„Serviceåº”è¯¥æ€æ ·åšï¼Ÿ</li><li>8.Serviceå’ŒActivityä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿ</li><li>9.è¯´è¯´ä½ äº†è§£çš„ç³»ç»ŸServiceã€‚</li><li>10.è°ˆè°ˆä½ å¯¹ActivityManagerServiceçš„ç†è§£ã€‚</li><li>11.åœ¨Activtiyä¸­åˆ›å»ºä¸€ä¸ªThreadå’Œåœ¨ä¸€ä¸ªServiceä¸­åˆ›å»ºä¸€ä¸ªThreadçš„åŒºåˆ«ï¼Ÿ</li></ul><h3 id="2-5-Handler"><a href="#2-5-Handler" class="headerlink" title="2.5 Handler"></a>2.5 Handler</h3><ul><li>1.å­çº¿ç¨‹ä¸€å®šä¸èƒ½æ›´æ–°UIå—ï¼Ÿ</li><li>2.ç»™æˆ‘è¯´è¯´Handlerçš„åŸç†</li><li>3.Handlerå¯¼è‡´çš„å†…å­˜æ³„éœ²ä½ æ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ</li><li>4.å¦‚ä½•ä½¿ç”¨Handlerè®©å­çº¿ç¨‹å’Œå­çº¿ç¨‹é€šä¿¡ï¼Ÿ</li><li>5.ä½ èƒ½ç»™æˆ‘è¯´è¯´Handlerçš„è®¾è®¡åŸç†ï¼Ÿ</li><li>6.HandlerThreadæ˜¯ä»€ä¹ˆ &amp; åŸç† &amp; ä½¿ç”¨åœºæ™¯ï¼Ÿ</li><li>7.IdleHandleræ˜¯ä»€ä¹ˆï¼Ÿ</li><li>8.ä¸€ä¸ªçº¿ç¨‹èƒ½å¦åˆ›å»ºå¤šä¸ªHandler,Handlerå’ŒLooperä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Ÿ</li><li>9.ä¸ºä»€ä¹ˆAndroidç³»ç»Ÿä¸å»ºè®®å­çº¿ç¨‹è®¿é—®UIï¼Ÿ</li><li>10.Looperæ­»å¾ªç¯ä¸ºä»€ä¹ˆä¸ä¼šå¯¼è‡´åº”ç”¨å¡æ­»ï¼Ÿ</li><li>11.ä½¿ç”¨Handlerçš„postDealyåæ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ</li><li>12.å¯ä»¥åœ¨å­çº¿ç¨‹ç›´æ¥newä¸€ä¸ªHandlerå‡ºæ¥å—ï¼Ÿ</li><li>13.Messageå¯¹è±¡åˆ›å»ºçš„æ–¹å¼æœ‰å“ªäº› &amp; åŒºåˆ«ï¼Ÿ</li></ul><h3 id="2-6-AsyncTask"><a href="#2-6-AsyncTask" class="headerlink" title="2.6 AsyncTask"></a>2.6 AsyncTask</h3><ul><li>1.AsyncTaskæ˜¯ä»€ä¹ˆï¼Ÿèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜</li><li>2.ç»™æˆ‘è°ˆè°ˆAsyncTaskçš„ä¸‰ä¸ªæ³›å‹å‚æ•°ä½œç”¨ &amp; å®ƒçš„ä¸€äº›æ–¹æ³•ä½œç”¨ã€‚</li><li>3.ç»™æˆ‘è¯´è¯´AsyncTaskçš„åŸç†ã€‚</li><li>4.ä½ è§‰å¾—AsyncTaskæœ‰ä¸è¶³ä¹‹å¤„å—ï¼Ÿ</li></ul><h3 id="2-7-Fragment"><a href="#2-7-Fragment" class="headerlink" title="2.7 Fragment"></a>2.7 Fragment</h3><ul><li>1.Androidä¸­v4åŒ…ä¸‹Fragmentå’ŒappåŒ…ä¸‹Fragmentçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>2.Fragmentçš„ç”Ÿå‘½å‘¨æœŸ &amp; è¯·ç»“åˆActivityçš„ç”Ÿå‘½å‘¨æœŸå†ä¸€èµ·è¯´è¯´ã€‚</li><li>3.è¯´è¯´Fragmentå¦‚ä½•è¿›è¡Œæ‡’åŠ è½½ã€‚</li><li>4.ViewPager + Fragmentç»“åˆä½¿ç”¨ä¼šå‡ºç°å†…å­˜æ³„æ¼å— &amp; å¦‚ä½•è§£å†³ï¼Ÿ</li><li>5.Fragmentå¦‚ä½•å’ŒActivityè¿›è¡Œé€šä¿¡ &amp; Fragmentä¹‹é—´å¦‚ä½•è¿›è¡Œé€šä¿¡ï¼Ÿ</li><li>6.ç»™æˆ‘è°ˆè°ˆFragment3ç§åˆ‡æ¢çš„æ–¹å¼ä»¥åŠåŒºåˆ« &amp; ä½¿ç”¨åœºæ™¯ã€‚</li><li>7.getFragmentManager,getSupportFragmentManager,getChildFragmentManagerä¹‹é—´çš„åŒºåˆ«ï¼Ÿ</li><li>8.FragmentPagerAdapterå’ŒFragmentStatePagerAdapteråŒºåˆ«ï¼Ÿ</li><li>9.Fragmentå¦‚ä½•å®ç°ç±»ä¼¼Activityæ ˆçš„å‹æ ˆå’Œå‡ºæ ˆæ•ˆæœçš„ï¼Ÿ</li></ul><h3 id="2-8-åºåˆ—åŒ–"><a href="#2-8-åºåˆ—åŒ–" class="headerlink" title="2.8 åºåˆ—åŒ–"></a>2.8 åºåˆ—åŒ–</h3><ul><li>1.ä»€ä¹ˆæ˜¯åºåˆ—åŒ– &amp; èƒ½ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ</li><li>2.Androidä¸­åºåˆ—åŒ–æ–¹å¼æœ‰å‡ ç§ï¼Ÿè¯´è¯´å®ƒä»¬çš„åŒºåˆ«ã€‚</li><li>3.å¦‚æœæƒ³è¦åºåˆ—åŒ–çš„ç±»ä¸­æŸäº›å­—æ®µä¸åºåˆ—åŒ–ï¼Œé‚£ä¹ˆåº”è¯¥æ€ä¹ˆåšï¼Ÿ</li></ul><h3 id="2-9-IPC"><a href="#2-9-IPC" class="headerlink" title="2.9 IPC"></a>2.9 IPC</h3><ul><li>1.è¯´è¯´ä½ å¯¹Androidå¤šè¿›ç¨‹å¼€å‘çš„è®¤è¯†ï¼Ÿ</li><li>2.Androidä¸­è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</li><li>3.ä»€ä¹ˆæ˜¯AIDL?å¦‚ä½•åˆ›å»ºä¸€ä¸ªAIDLã€‚</li></ul><h3 id="2-10-æ–‡ä»¶å­˜å‚¨"><a href="#2-10-æ–‡ä»¶å­˜å‚¨" class="headerlink" title="2.10 æ–‡ä»¶å­˜å‚¨"></a>2.10 æ–‡ä»¶å­˜å‚¨</h3><ul><li>1.è¯´è¯´Androidä¸­æ•°æ®æŒä¹…åŒ–çš„æ–¹å¼ &amp; ä½¿ç”¨åœºæ™¯ã€‚</li><li>2.æ¥è§¦è¿‡MMKVå—ï¼Ÿè¯´è¯´SharedPreferenceå’Œå®ƒçš„åŒºåˆ«ã€‚</li><li>3.ç¬¬ä¸‰æ–¹æ•°æ®åº“æ¡†æ¶ç”¨è¿‡å“ªäº›ï¼Ÿæœ‰æ²¡æœ‰è‡ªå·±å°è£…è¿‡ä¸€ä¸ªSQLiteçš„åº“ï¼Ÿ</li><li>4.SQLiteæ˜¯çº¿ç¨‹å®‰å…¨çš„å— &amp; SharedPreferenceæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</li><li>5.è¯·ç®€å•çš„ç»™æˆ‘è¯´è¯´ä»€ä¹ˆæ˜¯ä¸‰çº§ç¼“å­˜ï¼Ÿ</li><li>6.SharedPreferenceçš„applyå’Œcommitçš„åŒºåˆ«ã€‚</li><li>7.è°ˆè°ˆä½ å¯¹SQLiteäº‹åŠ¡çš„è®¤è¯†ã€‚</li><li>8.åƒå¥‡ç™¾æ€ªçš„SQLè¯­å¥è€ƒå¯Ÿã€‚</li><li>9.SharePreferenceè·¨è¿›ç¨‹ä½¿ç”¨ä¼šæ€ä¹ˆæ ·ï¼Ÿå¦‚ä½•ä¿è¯è·¨è¿›ç¨‹ä½¿ç”¨å®‰å…¨ï¼Ÿ</li><li>10.è°ˆè°ˆSQLiteå‡çº§è¦æ³¨æ„å“ªäº›åœ°æ–¹ï¼Ÿ</li></ul><h3 id="2-11-ListView-amp-RecyclerView"><a href="#2-11-ListView-amp-RecyclerView" class="headerlink" title="2.11 ListView &amp; RecyclerView"></a>2.11 ListView &amp; RecyclerView</h3><ul><li>1.ListViewæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨ï¼Ÿ</li><li>2.RecyclerViewæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨ï¼Ÿå¦‚ä½•è¿”å›ä¸ä¸€æ ·çš„Itemã€‚</li><li>3.ListViewå’ŒRecycyclerViewçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>4.åˆ†åˆ«è®²è®²ä½ å¯¹ListView &amp; RecyclerViewçš„ä¼˜åŒ–ç»éªŒã€‚</li><li>5.ç»™æˆ‘è¯´è¯´RecyclerViewçš„å›æ”¶å¤ç”¨æœºåˆ¶</li><li>6.è¯´è¯´ä½ æ˜¯å¦‚ä½•ç»™ListView &amp; RecyclerViewåŠ ä¸Šæ‹‰åˆ·æ–° &amp; ä¸‹æ‹‰åŠ è½½æ›´å¤šæœºåˆ¶ã€‚</li><li>7.è°ˆè°ˆä½ æ˜¯å¦‚ä½•å¯¹ListView &amp; RecycleViewè¿›è¡Œå±€éƒ¨åˆ·æ–°çš„ï¼Ÿ</li><li>8.è°ˆè°ˆå¦‚ä½•è¿›è¡Œåˆ†é¡µåŠ è½½ï¼Ÿ</li><li>9.ScrollViewä¸‹åµŒå¥—ä¸€ä¸ªListViewé€šå¸¸ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li><li>10.ä¸€ä¸ªListViewæˆ–è€…ä¸€ä¸ªRecyclerViewåœ¨æ˜¾ç¤ºæ–°é—»æ•°æ®çš„æ—¶å€™ï¼Œå‡ºç°å›¾ç‰‡é”™ä½ï¼Œå¯èƒ½çš„åŸå› æœ‰å“ªäº› &amp; å¦‚ä½•è§£å†³ï¼Ÿ</li></ul><h3 id="2-12-å›¾ç‰‡ç¼–ç¨‹"><a href="#2-12-å›¾ç‰‡ç¼–ç¨‹" class="headerlink" title="2.12 å›¾ç‰‡ç¼–ç¨‹"></a>2.12 å›¾ç‰‡ç¼–ç¨‹</h3><ul><li>1.ä½ å¯¹Bitmapäº†è§£å—ï¼Ÿå®ƒåœ¨å†…å­˜ä¸­å¦‚ä½•å­˜åœ¨ï¼Ÿ</li><li>2.æœ‰å…³Bitmapå¯¼è‡´OOMçš„åŸå› çŸ¥é“å—ï¼Ÿå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</li><li>3.ç»™æˆ‘è°ˆè°ˆå›¾ç‰‡å‹ç¼©ã€‚</li><li>4.LruCache &amp; DiskLruCacheåŸç†ã€‚</li><li>5.è¯´è¯´ä½ å¹³å¸¸ä¼šä½¿ç”¨çš„ä¸€äº›ç¬¬ä¸‰æ–¹å›¾ç‰‡åŠ è½½åº“,æœ€å¥½ç»™æˆ‘è°ˆè°ˆå®ƒçš„åŸç†ã€‚</li><li>6.å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªå›¾ç‰‡åŠ è½½åº“ï¼Œä½ ä¼šå¦‚ä½•è®¾è®¡ï¼Ÿ</li><li>7.æœ‰ä¸€å¼ éå¸¸å¤§çš„å›¾ç‰‡,ä½ å¦‚ä½•å»åŠ è½½è¿™å¼ å¤§å›¾ç‰‡ï¼Ÿ</li><li>8.ä½ çŸ¥é“Androidä¸­å¤„ç†å›¾ç‰‡çš„ä¸€äº›åº“å—(OpenCv &amp; GPUImage â€¦)ï¼Ÿ</li><li>9.å¦‚ä½•è®¡ç®—ä¸€å¼ å›¾ç‰‡åœ¨å†…å­˜ä¸­å ç”¨çš„å¤§å°ï¼Ÿ</li></ul><h3 id="2-13-WebView"><a href="#2-13-WebView" class="headerlink" title="2.13 WebView"></a>2.13 WebView</h3><ul><li>1.WebViewæ˜¯ä»€ä¹ˆï¼Ÿ</li><li>2.WebViewä¼šå¯¼è‡´å†…å­˜æ³„éœ²å—ï¼ŸåŸå› æ˜¯ä»€ä¹ˆï¼Ÿè§£å†³æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</li><li>3.ä½ çŸ¥é“Hybridå¼€å‘å—ï¼Ÿè¯´è¯´ä½ çš„ç›¸å…³ç»éªŒã€‚</li><li>4.è¯´è¯´WebSettings &amp; WebViewClient &amp; WebChromeClientè¿™ä¸‰ä¸ªç±»çš„ä½œç”¨ &amp; ç”¨æ³•ã€‚</li><li>5.è¯´è¯´ä½ äº†è§£çš„Hybridæ¡†æ¶ã€‚</li></ul><h3 id="2-14-ViewPager"><a href="#2-14-ViewPager" class="headerlink" title="2.14 ViewPager"></a>2.14 ViewPager</h3><ul><li>1.ä»€ä¹ˆæ˜¯ViewPager?è¯´è¯´å®ƒçš„é‚£äº›é€‚é…å™¨ã€‚</li><li>2.ä½ äº†è§£ViewPager2å—ï¼Ÿå’ŒViewPager 1æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ</li><li>3.ViewPager + Fragmentç»“åˆä½¿ç”¨å­˜åœ¨çš„å†…å­˜æ³„æ¼çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</li></ul><h3 id="2-15-Viewäº‹ä»¶åˆ†å‘æœºåˆ¶"><a href="#2-15-Viewäº‹ä»¶åˆ†å‘æœºåˆ¶" class="headerlink" title="2.15 Viewäº‹ä»¶åˆ†å‘æœºåˆ¶"></a>2.15 Viewäº‹ä»¶åˆ†å‘æœºåˆ¶</h3><ul><li>1.ä»€ä¹ˆæ˜¯äº‹ä»¶åˆ†å‘æœºåˆ¶ï¼Ÿä¸»è¦ç”¨æ¥è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li><li>2.ç»™æˆ‘è¯´è¯´äº‹ä»¶åˆ†å‘çš„æµç¨‹ &amp; ä½ é¡¹ç›®è§£å†³äº‹ä»¶å†²çªçš„ä¸€äº›æ¡ˆä¾‹ã€‚</li><li>3.å¤šç‚¹è§¦æ‘¸äº‹ä»¶å¹³æ—¶æ¥è§¦è¿‡å—ï¼Ÿå¦‚ä½•ç›‘å¬ç”¨æˆ·ç¬¬äºŒä¸ªæ‰‹æŒ‡ï¼Œç¬¬ä¸‰ä¸ªâ€¦ï¼Ÿ</li><li>4.OnTouchListener &amp; OnTouchEvent &amp; onClickListenerä¸‰è€…ä¹‹é—´çš„å…³ç³»ï¼Ÿ</li><li>5.è°ˆè°ˆä½ å¯¹MotionEventçš„è®¤è¯†ï¼ŸCanceläº‹ä»¶æ˜¯ä»€ä¹ˆæƒ…å†µä¸‹è§¦å‘çš„ï¼Ÿ</li><li>6.èƒ½ç»™æˆ‘è°ˆè°ˆAndroidä¸­åæ ‡ä½“ç³»å—ï¼Ÿ</li></ul><h3 id="2-16-Viewç»˜åˆ¶æœºåˆ¶"><a href="#2-16-Viewç»˜åˆ¶æœºåˆ¶" class="headerlink" title="2.16 Viewç»˜åˆ¶æœºåˆ¶"></a>2.16 Viewç»˜åˆ¶æœºåˆ¶</h3><ul><li>1.è¯´è¯´Viewç»˜åˆ¶æµç¨‹ã€‚</li><li>2.è¯´è¯´Activity Viewæ ‘ç»“æ„ã€‚</li><li>3.è‡ªå®šä¹‰Viewçš„æ–¹å¼æœ‰å“ªäº›?ç»™æˆ‘è¯´è¯´ä½ ä¹‹å‰é¡¹ç›®ä¸­çš„æ¡ˆä¾‹ã€‚</li><li>4.invalidateå’Œpostvalidateçš„åŒºåˆ«ï¼Ÿ</li><li>5.è¯´è¯´ä½ åœ¨è‡ªå®šä¹‰Viewæ—¶å¸¸å¸¸é‡å†™çš„ä¸€äº›æ–¹æ³•ï¼Ÿ</li><li>6.è¯´è¯´è‡ªå®šä¹‰Viewä¸­å¦‚ä½•è‡ªå®šä¹‰å±æ€§ï¼Ÿ</li><li>7.requestLayout(),onLayout(),onDraw(),drawChild()åŒºåˆ«å’Œè”ç³»ï¼Ÿ</li><li>8.å¦‚ä½•è®¡ç®—å‡ºä¸€ä¸ªViewçš„åµŒå¥—å±‚çº§ï¼Ÿ</li><li>9.è‡ªå®šä¹‰Viewå¦‚ä½•è€ƒè™‘æœºå‹é€‚é…ï¼Ÿ</li></ul><h3 id="2-17-å¸ƒå±€"><a href="#2-17-å¸ƒå±€" class="headerlink" title="2.17 å¸ƒå±€"></a>2.17 å¸ƒå±€</h3><ul><li>1.è¯´è¯´Androidä¸­æœ‰å“ªäº›å¸ƒå±€ &amp; ç‰¹ç‚¹ã€‚</li><li>2.ä½ çŸ¥é“å¸ƒå±€æ–‡ä»¶åˆ°æ§ä»¶å¯¹è±¡çš„è¿‡ç¨‹å—ï¼Ÿ</li><li>3.æœ‰è¿™ä¹ˆä¸€ä¸ªå¸ƒå±€éœ€æ±‚ï¼Œä¸€ä¸ªæ–‡æœ¬æ§ä»¶æ”¾åœ¨å±å¹•ä¸€åŠçš„ä¸€åŠçš„ä¸­é—´ä½ç½®ï¼Œä½ å¦‚ä½•è¿›è¡Œå¸ƒå±€ï¼Ÿ</li><li>4.LinearLayout,FrameLayout,RelativeLayoutæ€§èƒ½å¯¹æ¯”ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li></ul><h3 id="2-18-Binder"><a href="#2-18-Binder" class="headerlink" title="2.18 Binder"></a>2.18 Binder</h3><ul><li>1.ä»€ä¹ˆæ˜¯Binderï¼Ÿç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ</li><li>2.ç»™æˆ‘å…·ä½“è®²è®²Binderæœºåˆ¶ã€‚</li></ul><h3 id="2-19-åŠ¨ç”»æœºåˆ¶"><a href="#2-19-åŠ¨ç”»æœºåˆ¶" class="headerlink" title="2.19 åŠ¨ç”»æœºåˆ¶"></a>2.19 åŠ¨ç”»æœºåˆ¶</h3><ul><li>1.Androidä¸­çš„åŠ¨ç”»åˆ†ä¸ºå“ªäº›ç§ç±» &amp; ç‰¹ç‚¹ &amp; ç¼ºç‚¹ã€‚</li><li>2.çŸ¥é“SVG &amp; çŸ¢é‡åŠ¨ç”»å—ï¼Ÿ</li><li>3.ç»™æˆ‘è¯´è¯´è½¬åœºåŠ¨ç”»ã€‚</li><li>4.ç»™æˆ‘è°ˆè°ˆæ’å€¼å™¨ &amp; ä¼°å€¼å™¨ çš„ä½œç”¨ã€‚</li><li>5.è¯´è¯´AndroidåŠ¨ç”»æ¡†æ¶å®ç°çš„åŸç†ã€‚</li></ul><h3 id="2-20-JNI"><a href="#2-20-JNI" class="headerlink" title="2.20 JNI"></a>2.20 JNI</h3><ul><li>1.ä»€ä¹ˆæ˜¯JNI?å®ƒä¸»è¦ç”¨æ¥å¹²ä»€ä¹ˆã€‚</li><li>2.Java Nativeæ–¹æ³•å¦‚ä½•å’ŒNativeå‡½æ•°è¿›è¡Œç»‘å®šçš„ï¼Ÿ</li><li>3.JNIå¦‚ä½•å®ç°æ•°æ®ä¼ é€’ï¼Ÿ</li><li>4.å¦‚ä½•å…¨å±€æ•è·Nativeå‘ç”Ÿçš„å¼‚å¸¸ï¼Ÿ</li><li>5.åªæœ‰C/C++èƒ½ç¼–å†™Nativeåº“å—ï¼Ÿ</li></ul><h3 id="2-21-Window-amp-Appliction-amp-Context"><a href="#2-21-Window-amp-Appliction-amp-Context" class="headerlink" title="2.21 Window &amp; Appliction &amp; Context"></a>2.21 Window &amp; Appliction &amp; Context</h3><ul><li>1.è¯´è¯´ä½ å¯¹Androidä¸­Windowçš„ç†è§£ã€‚</li><li>2.è¯´è¯´ä½ å¯¹Applicationçš„ç†è§£ &amp; ç”Ÿå‘½å‘¨æœŸã€‚</li><li>3.Androidä¸­æœ‰å“ªäº›ä¸Šä¸‹æ–‡ &amp; åŒºåˆ« &amp; ä½œç”¨ã€‚</li><li>4.è°ˆè°ˆä½ å¯¹Androidä¸­Contextçš„ç†è§£ã€‚</li></ul><h3 id="2-22-é€šçŸ¥"><a href="#2-22-é€šçŸ¥" class="headerlink" title="2.22 é€šçŸ¥"></a>2.22 é€šçŸ¥</h3><ul><li>1.Android 8.0å¦‚ä½•é€‚é…é€šçŸ¥ï¼Ÿ</li><li>2.è‡ªå®šä¹‰é€šçŸ¥æµç¨‹ï¼Ÿ</li></ul><h3 id="2-23-å¯¹è¯æ¡†-Dialog-amp-DialogFragment-amp-PopWindow"><a href="#2-23-å¯¹è¯æ¡†-Dialog-amp-DialogFragment-amp-PopWindow" class="headerlink" title="2.23 å¯¹è¯æ¡†(Dialog &amp; DialogFragment &amp; PopWindow)"></a>2.23 å¯¹è¯æ¡†(Dialog &amp; DialogFragment &amp; PopWindow)</h3><ul><li>1.è¯´è¯´Androidä¸­å¯¹è¯æ¡†å¯ä»¥ç”¨å“ªäº›æ–¹å¼å®Œæˆï¼Ÿ</li></ul><h3 id="2-24-è“ç‰™"><a href="#2-24-è“ç‰™" class="headerlink" title="2.24 è“ç‰™"></a>2.24 è“ç‰™</h3><ul><li>1.è¯´è¯´æœ€æ–°çš„è“ç‰™ç‰ˆæœ¬ï¼Ÿæ–°ç‰ˆæœ¬çš„ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿ</li></ul><h3 id="2-25-å†·å¯åŠ¨-amp-çƒ­å¯åŠ¨"><a href="#2-25-å†·å¯åŠ¨-amp-çƒ­å¯åŠ¨" class="headerlink" title="2.25 å†·å¯åŠ¨&amp;çƒ­å¯åŠ¨"></a>2.25 å†·å¯åŠ¨&amp;çƒ­å¯åŠ¨</h3><ul><li>1.ä»€ä¹ˆæ˜¯å†·å¯åŠ¨ &amp; ä»€ä¹ˆæ˜¯çƒ­å¯åŠ¨ &amp; å®ƒä»¬çš„æµç¨‹ï¼Ÿ</li><li>2.å¦‚ä½•ä¼˜åŒ–å†·å¯åŠ¨ï¼Ÿ</li><li>3.å¯åŠ¨é¡µç™½å±ï¼Œé»‘å±ï¼Œå¤ªæ…¢å¦‚ä½•è§£å†³ï¼Ÿ</li></ul><h3 id="2-26-æ‚¬æµ®çª—"><a href="#2-26-æ‚¬æµ®çª—" class="headerlink" title="2.26 æ‚¬æµ®çª—"></a>2.26 æ‚¬æµ®çª—</h3><ul><li>1.åœ¨åšæ‚¬æµ®çª—çš„æ—¶å€™ä½ é‡åˆ°äº†ä»€ä¹ˆå›°éš¾(ä¸»è¦æŒ‡æ‚¬æµ®çª—æƒé™é€‚é…)ï¼Ÿ</li><li>2.å¦‚ä½•åˆ¶ä½œä¸€ä¸ªæ‚¬æµ®çª—ï¼Ÿ</li></ul><h3 id="2-27-Androidç‰ˆæœ¬"><a href="#2-27-Androidç‰ˆæœ¬" class="headerlink" title="2.27 Androidç‰ˆæœ¬"></a>2.27 Androidç‰ˆæœ¬</h3><ul><li>1.æœ€æ–°çš„Androidç‰ˆæœ¬å¤šå°‘çŸ¥é“å—ï¼Ÿæœ‰å“ªäº›ç‰¹æ€§</li><li>2.è¯´è¯´æ›´æ–°è¾ƒå¤§çš„Androidç‰ˆæœ¬ã€‚</li></ul><h3 id="2-28-Android-Studio"><a href="#2-28-Android-Studio" class="headerlink" title="2.28 Android Studio"></a>2.28 Android Studio</h3><ul><li>1.ä½ ç°åœ¨æ¯”è¾ƒå¸¸ç”¨Android Studioé‚£ä¸ªç‰ˆæœ¬ &amp; ç”¨çš„Gradleç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ</li><li>2.å¦‚ä½•ç†è§£gradle?</li><li>3.è¯´è¯´Android Studioä¸­å¤§è‡´é¡¹ç›®ç»“æ„ï¼Ÿ</li><li>4.æ··æ·†æ˜¯ä»€ä¹ˆ &amp; ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œæ··æ·† &amp; æ··æ·†çš„åŸç† &amp; ä¸ºä»€ä¹ˆJavaåå°„å¸¸å¸¸ä¼šå’Œæ··æ·†å†²çªï¼Ÿ</li></ul><h3 id="2-29-UIå¡é¡¿ä¼˜åŒ–"><a href="#2-29-UIå¡é¡¿ä¼˜åŒ–" class="headerlink" title="2.29 UIå¡é¡¿ä¼˜åŒ–"></a>2.29 UIå¡é¡¿ä¼˜åŒ–</h3><ul><li>1.ANRæ˜¯ä»€ä¹ˆï¼Ÿå¯¼è‡´åŸå› æœ‰å“ªäº›ï¼Ÿ</li><li>2.è°ˆè°ˆä½ é¡¹ç›®ä¸­é¿å…ANRçš„ä¸€äº›ç»éªŒã€‚</li><li>3.åˆ†åˆ«è¯´è¯´Activity &amp; BroadcastReceiver &amp; Sericeæœ€é•¿å¯è€—æ—¶æ—¶é—´ä¸ºå¤šå°‘ï¼Ÿ</li></ul><h3 id="2-30-å†…å­˜ä¼˜åŒ–"><a href="#2-30-å†…å­˜ä¼˜åŒ–" class="headerlink" title="2.30 å†…å­˜ä¼˜åŒ–"></a>2.30 å†…å­˜ä¼˜åŒ–</h3><ul><li>1.ä»€ä¹ˆæ˜¯OOM &amp; ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ &amp; ä»€ä¹ˆæ˜¯å†…å­˜æŠ–åŠ¨ï¼Ÿ</li><li>2.è°ˆè°ˆä½ é¡¹ç›®ä¸­å†…å­˜ä¼˜åŒ–çš„ä¸€äº›ç»éªŒã€‚</li></ul><h3 id="2-31-å±å¹•é€‚é…"><a href="#2-31-å±å¹•é€‚é…" class="headerlink" title="2.31 å±å¹•é€‚é…"></a>2.31 å±å¹•é€‚é…</h3><ul><li>1.è¯´è¯´Androidä¸­ä¸€äº›å±å¹•å•ä½ã€‚</li><li>2.è°ˆè°ˆä½ é¡¹ç›®ä¸­çš„ä¸€äº›å±å¹•é€‚é…çš„ç»éªŒã€‚</li><li>3.ä»Šæ—¥å¤´æ¡çš„è½»é‡çº§é€‚é…æ–¹æ¡ˆäº†è§£å— &amp; ç»™æˆ‘è¯´è¯´åŸç†ã€‚</li></ul><h3 id="2-32-å¤šæ¸ é“æ‰“åŒ…-amp-apkç­¾å"><a href="#2-32-å¤šæ¸ é“æ‰“åŒ…-amp-apkç­¾å" class="headerlink" title="2.32 å¤šæ¸ é“æ‰“åŒ… &amp; apkç­¾å"></a>2.32 å¤šæ¸ é“æ‰“åŒ… &amp; apkç­¾å</h3><ul><li>1.apkä¸ºä»€ä¹ˆéœ€è¦ç­¾åï¼Ÿ</li><li>2.å¤šæ¸ é“æ‰“åŒ…æ˜¯ä»€ä¹ˆ &amp; æœ‰ç±»ä¼¼ç»éªŒå—ï¼Ÿ</li><li>3.ç®€è¿°å¤šæ¸ é“æ‰“åŒ…åŠåŸç†å’Œå¸¸ç”¨æ“ä½œï¼Ÿ</li></ul><h3 id="2-33-é¡¹ç›®æ¶æ„"><a href="#2-33-é¡¹ç›®æ¶æ„" class="headerlink" title="2.33 é¡¹ç›®æ¶æ„"></a>2.33 é¡¹ç›®æ¶æ„</h3><ul><li>1.è¯´è¯´ä½ ç”¨è¿‡çš„é¡¹ç›®æ¶æ„ï¼Ÿ</li><li>2.åˆ†åˆ«ç»™æˆ‘è¯´è¯´MVC,MVP,MVVMç‰¹ç‚¹å’ŒåŒºåˆ«ã€‚</li><li>3.ä»¥ç™»é™†ç•Œé¢ä¸ºä¾‹å­,è®¾è®¡MVPæ¶æ„ã€‚</li><li>4.è°ˆè°ˆAndroidManifest.xmlæ–‡ä»¶çš„ç†è§£ã€‚</li></ul><h3 id="2-34-Androidå‰æ²¿çŸ¥è¯†"><a href="#2-34-Androidå‰æ²¿çŸ¥è¯†" class="headerlink" title="2.34 Androidå‰æ²¿çŸ¥è¯†"></a>2.34 Androidå‰æ²¿çŸ¥è¯†</h3><ul><li>1.è°·æ­Œæ–°å‡ºçš„FlutterçŸ¥é“å—ï¼Ÿ</li><li>2.è°·æ­Œæ–°å‡ºçš„å®˜æ–¹å¼€å‘è¯­è¨€Kotlinäº†è§£å— &amp; å’ŒJavaç›¸æ¯”å®ƒæœ‰å“ªäº›ç‰¹ç‚¹ã€‚</li><li>3.è°ˆè°ˆKotlinä¸­åç¨‹çš„è®¤è¯†ï¼Ÿ</li></ul><h3 id="2-35-éŸ³è§†é¢‘å¼€å‘-é«˜è–ª"><a href="#2-35-éŸ³è§†é¢‘å¼€å‘-é«˜è–ª" class="headerlink" title="2.35 éŸ³è§†é¢‘å¼€å‘(é«˜è–ª)"></a>2.35 éŸ³è§†é¢‘å¼€å‘(é«˜è–ª)</h3><ul><li>1.ä¹‹å‰æœ‰è¿‡éŸ³è§†é¢‘å¼€å‘ç»éªŒå— &amp; è¯´è¯´ç”¨å“ªäº›å¼€æºæ¶å­å¼€å‘çš„ã€‚</li><li>2.FFmpengäº†è§£è¿‡å—ï¼Ÿ</li><li>3.Androidä¸­æ’­æ”¾è§†é¢‘éŸ³é¢‘çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</li><li>4.Androidä¸­æ’­æ”¾ç½‘ç»œåœ°å€è§†é¢‘æœ‰å“ªäº›å‡ºè‰²çš„å¼€æºåº“ï¼Ÿ</li><li>5.æµåª’ä½“æœåŠ¡å™¨äº†è§£å—ï¼Ÿ</li><li>6.è°ˆè°ˆä½ å¯¹ç¼–ç æ ¼å¼çš„ç†è§£ã€‚</li><li>7.MediaPlayerå’ŒSoundPoolçš„åŒºåˆ«ï¼Ÿ</li><li>8.è§†é¢‘ç¡¬è§£ç å’Œè½¯è§£ç çš„åŒºåˆ«ï¼Ÿ</li></ul><h3 id="2-36-å…¶å®ƒAndroidéƒ¨åˆ†æœ‰å…³é¢è¯•é¢˜"><a href="#2-36-å…¶å®ƒAndroidéƒ¨åˆ†æœ‰å…³é¢è¯•é¢˜" class="headerlink" title="2.36 å…¶å®ƒAndroidéƒ¨åˆ†æœ‰å…³é¢è¯•é¢˜"></a>2.36 å…¶å®ƒAndroidéƒ¨åˆ†æœ‰å…³é¢è¯•é¢˜</h3><ul><li>1.è¯´è¯´ä¸€ä¸ªappçš„å¯åŠ¨æµç¨‹(ä»æºç è§’åº¦è®²è§£)ã€‚</li><li>2.ä½ çŸ¥é“æ— è®ºæ˜¯Kotlinæˆ–è€…æ˜¯Java,ç¨‹åºè¿è¡Œçš„ä¸»è¦å…¥å£éƒ½æ˜¯main()æ–¹æ³•ï¼Œé‚£ä¹ˆAndroidçš„mainæ–¹æ³•åœ¨å“ªé‡Œï¼Ÿ</li><li>3.Android HockæŠ€æœ¯äº†è§£å—ï¼Ÿ</li><li>4.ç®€è¿°Androidä¸­çš„åŠ å›ºå’Œä½¿ç”¨å¹³å°ï¼Ÿ</li><li>5.è°ˆè°ˆä½ å¯¹Apkç˜¦èº«çš„ç»éªŒï¼Ÿ</li><li>6.ä¸ºä»€ä¹ˆå­çº¿ç¨‹ä¸èƒ½æ›´æ–°UIï¼Ÿ</li><li>7.ä½ çŸ¥é“å¦‚ä½•å®šä½å†…å­˜æ³„æ¼å—ï¼Ÿ</li><li>8.è¯´è¯´System.exit(0),onDestory(),Activity.finish()çš„åŒºåˆ«ï¼Ÿ</li><li>9.åœ¨OnResumeæˆ–è€…ä¹‹å‰è·å–Viewçš„å®½é«˜ä¸ºå¤šå°‘ &amp; ä¸ºä»€ä¹ˆï¼Ÿ</li><li>10.Art &amp; Dvm åŒºåˆ«ï¼Œç‰¹åˆ«æ˜¯è°ˆè°ˆGCçš„åŒºåˆ«ã€‚</li><li>11.è¯´è¯´ä½ ç”¨çš„äºŒç»´ç æ¡†æ¶ &amp; æœ‰è¿‡ä¼˜åŒ–ç»éªŒå—ï¼Ÿ</li><li>12.è°ˆè°ˆAppå¤šè¿›ç¨‹çš„å¥½å¤„ &amp; ç¼ºç‚¹ã€‚</li><li>13.è¯´è¯´AMSæ˜¯æ€ä¹ˆæ‰¾åˆ°å¯åŠ¨æŒ‡å®šçš„Activityï¼Ÿ</li><li>14.Viewçš„getWidthå’ŒgetMeasureWidthæœ‰å•¥åŒºåˆ«ï¼Ÿ</li><li>15.æœ‰æ’ä»¶åŒ–æˆ–è€…çƒ­ä¿®å¤ç»éªŒå—ï¼Ÿè¯´è¯´å®ƒçš„åŸç†ã€‚</li><li>16.æ–­ç‚¹ç»­ä¼ äº†è§£å—ï¼Ÿè°ˆè°ˆä½ æ˜¯å¦‚ä½•é€šè¿‡å¤šçº¿ç¨‹å®ç°æ–­ç‚¹ç»­ä¼ çš„ã€‚</li><li>17.ç»™æˆ‘è°ˆè°ˆä½ å¯¹SurfaceViewçš„è®¤è¯†ã€‚</li><li>18.ä»€ä¹ˆæƒ…å†µä¸‹ä½ ä¼šä½¿ç”¨åˆ°ScrollViewã€‚</li><li>19.ä½ç‰ˆæœ¬SDKå¦‚ä½•ä½¿ç”¨é«˜ç‰ˆæœ¬APIï¼Ÿ</li><li>20.AlertDialog,PopWindow,Activityä¹‹é—´çš„åŒºåˆ«ï¼Ÿ</li><li>21.Applicationå’ŒActivity,Contextçš„åŒºåˆ«ï¼Ÿ</li><li>22.è°ˆè°ˆAndroidä¸­å¤šçº¿ç¨‹é€šä¿¡æ–¹å¼ï¼Ÿ</li><li>23.è¯´è¯´Androidå¤§ä½“çš„æ¶æ„å›¾ï¼Œè¯•ç€ç”»å‡ºæ¥ã€‚</li><li>24.çŸ¥é“SpareArrayå—ï¼Ÿ</li><li>25.Activityé™¤äº†setContentViewå¯ä»¥è®¾ç½®å¸ƒå±€ï¼Œè¿˜æœ‰å…¶å®ƒæ–¹å¼å—ï¼Ÿ</li><li>26.Androidä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºåˆ†é…çš„å†…å­˜å¤§å°ä¸ºå¤šå°‘ï¼Ÿ</li><li>27.Androidè¿›ç¨‹ä¿æ´»æ–¹æ¡ˆï¼Ÿ</li><li>28.è°ˆè°ˆAndroidç³»ç»Ÿå®‰è£…apkçš„è¿‡ç¨‹ï¼Ÿ</li><li>29.Activity,Window,Viewä¸‰è€…çš„å…³ç³»ï¼Ÿ</li><li>30.ActivityThread,ActivityManagerService,WindowManagerServiceçš„å·¥ä½œåŸç†ï¼Ÿ</li><li>31.PackageManagerServiceçš„å·¥ä½œåŸç†ï¼Ÿ</li><li>32.PowerManagerServiceçš„å·¥ä½œåŸç†ï¼Ÿ</li><li>33.åœ¨æ¡Œé¢ç‚¹å‡»ä¸€ä¸ªæœªå¯åŠ¨çš„Appçš„æµç¨‹ &amp; ç‚¹å‡»ä¸€ä¸ªå·²å¯åŠ¨çš„Appçš„æµç¨‹ï¼Ÿ</li><li>34.Androidä¸­è¿›ç¨‹åˆ†ä¸ºå“ªäº›ç§ç±»ï¼Ÿ</li><li>35.ä»€ä¹ˆæ˜¯åŸ‹ç‚¹ï¼Œæ‡‚ç‚¹å®ƒçš„åŸç†å—ï¼Ÿ</li><li>36.è¿›ç¨‹å’ŒApplicationç”Ÿå‘½å‘¨æœŸä¹‹é—´çš„å…³ç³»ï¼Ÿ</li><li>37.Appç›¸äº’å”¤é†’çš„æœ‰å“ªäº›æ–¹å¼ï¼Ÿ</li><li>38.Androidä¸­å¦‚ä½•å¼€å¯å¤šè¿›ç¨‹ï¼Ÿåº”ç”¨æ˜¯å¦å¯ä»¥å¼€å¯Nä¸ªè¿›ç¨‹ï¼Ÿ</li><li>39.è°ˆè°ˆæ¶ˆæ¯æ¨é€çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</li><li>40.è°ˆè°ˆä½ å¯¹Rootæƒé™çš„ç†è§£ã€‚</li><li>41.è°ˆè°ˆé¡¹ç›®å¦‚ä½•è¿›è¡Œå›½é™…åŒ–ï¼Ÿ</li><li>42.è°ˆè°ˆä½ å¯¹Intentå’ŒIntentFilterçš„ç†è§£ã€‚</li><li>43.ä¸€æ¡æœ€é•¿çš„çŸ­ä¿¡æ¯çº¦å å¤šå°‘byteï¼Ÿ</li></ul><h2 id="3-ç®—æ³•ä¸æ•°æ®ç»“æ„éƒ¨åˆ†"><a href="#3-ç®—æ³•ä¸æ•°æ®ç»“æ„éƒ¨åˆ†" class="headerlink" title="3.ç®—æ³•ä¸æ•°æ®ç»“æ„éƒ¨åˆ†"></a><strong>3.ç®—æ³•ä¸æ•°æ®ç»“æ„éƒ¨åˆ†</strong></h2><h3 id="3-1-å¤æ‚åº¦åˆ†æ"><a href="#3-1-å¤æ‚åº¦åˆ†æ" class="headerlink" title="3.1 å¤æ‚åº¦åˆ†æ"></a>3.1 å¤æ‚åº¦åˆ†æ</h3><ul><li>1.ä»€ä¹ˆæ˜¯æ—¶é—´å¤æ‚åº¦ &amp; ä»€ä¹ˆæ˜¯ç©ºé—´å¤æ‚åº¦ï¼Ÿ</li><li>2.æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦ä¹‹é—´å­˜åœ¨ä»€ä¹ˆè”ç³»ï¼Ÿ</li></ul><h3 id="3-2-æ•°ç»„"><a href="#3-2-æ•°ç»„" class="headerlink" title="3.2 æ•°ç»„"></a>3.2 æ•°ç»„</h3><ul><li>1.è°ˆè°ˆä½ å¯¹æ•°ç»„çš„ç†è§£ã€‚</li></ul><h3 id="3-3-é“¾è¡¨"><a href="#3-3-é“¾è¡¨" class="headerlink" title="3.3 é“¾è¡¨"></a>3.3 é“¾è¡¨</h3><ul><li>1.ä»€ä¹ˆæ˜¯å•é“¾è¡¨ &amp; åŒå‘é“¾è¡¨ &amp; å¾ªç¯é“¾è¡¨ &amp; åŒå‘å¾ªç¯é“¾è¡¨ &amp; é™æ€é“¾è¡¨ã€‚</li><li>2.åè½¬ä¸€ä¸ªé“¾è¡¨æœ‰å“ªäº›æ–¹å¼ï¼Ÿ</li><li>3.å¦‚ä½•åˆ¤æ–­é“¾è¡¨æœ‰ç¯ï¼Ÿ</li><li>4.ç”¨Javaè¯­è¨€è®¾è®¡ä¸€ä¸ªLinkedListã€‚</li></ul><h3 id="3-4-å †"><a href="#3-4-å †" class="headerlink" title="3.4 å †"></a>3.4 å †</h3><ul><li>1.å¦‚ä½•ç†è§£å †ï¼Ÿ</li></ul><h3 id="3-5-æ ˆ"><a href="#3-5-æ ˆ" class="headerlink" title="3.5 æ ˆ"></a>3.5 æ ˆ</h3><ul><li>1.ä»€ä¹ˆæ˜¯æ ˆ &amp; æ ˆçš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>2.ä»€ä¹ˆæ˜¯é¡ºåºæ ˆ &amp; é“¾å¼æ ˆï¼Ÿ</li><li>3.ä½ æœ‰æ²¡æœ‰åŸºäºæ ˆå°è£…çš„ä¸šåŠ¡ç±»ï¼Ÿ</li><li>4.ä½ èƒ½ç”¨æ ˆå®ç°é˜Ÿåˆ—å—ï¼Ÿ</li><li>5.å¦‚ä½•å®ç°æµè§ˆå™¨å‰è¿›å’Œåé€€åŠŸèƒ½ï¼Ÿ</li></ul><h3 id="3-6-é˜Ÿåˆ—"><a href="#3-6-é˜Ÿåˆ—" class="headerlink" title="3.6 é˜Ÿåˆ—"></a>3.6 é˜Ÿåˆ—</h3><ul><li>1.ä»€ä¹ˆæ˜¯é˜Ÿåˆ— &amp; é˜Ÿåˆ—çš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>2.ä»€ä¹ˆæ˜¯ä¼˜å…ˆé˜Ÿåˆ—ï¼Ÿ</li><li>3.ä»€ä¹ˆæ˜¯åŒç«¯é˜Ÿåˆ— &amp; é˜»å¡é˜Ÿåˆ—?</li><li>4.ä½ èƒ½ç”¨é˜Ÿåˆ—å®ç°æ ˆå—ï¼Ÿ</li></ul><h3 id="3-7-æ•£åˆ—è¡¨"><a href="#3-7-æ•£åˆ—è¡¨" class="headerlink" title="3.7 æ•£åˆ—è¡¨"></a>3.7 æ•£åˆ—è¡¨</h3><ul><li>1.ä»€ä¹ˆæ˜¯æ•£åˆ—å‡½æ•°ï¼Ÿ</li><li>2.ä»€ä¹ˆæ˜¯æ•£åˆ—å†²çªï¼Ÿè§£å†³çš„æ–¹å¼æœ‰å“ªäº›ï¼ŸJavaä¸­çš„HashMapè§£å†³æ–¹å¼é‡‡ç”¨çš„å“ªä¸€ç§ï¼Ÿ</li><li>3.ä»€ä¹ˆæ˜¯æ•£åˆ—è¡¨çš„åŠ¨æ€æ‰©å®¹ï¼Ÿ</li><li>4.ä»€ä¹ˆæ˜¯ä½å›¾ï¼Ÿ</li></ul><h3 id="3-8-æ ‘"><a href="#3-8-æ ‘" class="headerlink" title="3.8 æ ‘"></a>3.8 æ ‘</h3><ul><li>1.ä»€ä¹ˆæ˜¯äºŒå‰æ ‘ï¼Ÿ</li><li>2.ä»€ä¹ˆæ˜¯å…ˆåºéå† &amp; ä¸­åºéå† &amp; ååºéå†ã€‚</li><li>3.ä»€ä¹ˆæ˜¯å¤šè·¯æŸ¥æ‰¾æ ‘ï¼Ÿ</li><li>4.ä»€ä¹ˆæ˜¯çº¢é»‘æ ‘ï¼Ÿ</li></ul><h3 id="3-9-æ’åº"><a href="#3-9-æ’åº" class="headerlink" title="3.9 æ’åº"></a>3.9 æ’åº</h3><ul><li>1.ç»™æˆ‘è¯´è¯´ä½ ä¼šçš„æ’åº &amp; å¤æ‚åº¦å¦‚ä½•ï¼Ÿ</li><li>2.ç°åœ¨æœ‰10ä¸‡æ¡æ•°æ®éœ€è¦è¿›è¡Œæ’åºï¼Œä½ ä¼šé€‰æ‹©ä»€ä¹ˆæ’åºï¼Ÿ</li></ul><h3 id="3-10-æŸ¥æ‰¾"><a href="#3-10-æŸ¥æ‰¾" class="headerlink" title="3.10 æŸ¥æ‰¾"></a>3.10 æŸ¥æ‰¾</h3><ul><li>1.è¯´è¯´ä½ çŸ¥é“çš„æŸ¥æ‰¾ç®—æ³• &amp; å¤æ‚åº¦å¦‚ä½•ï¼Ÿ</li></ul><h3 id="3-11-é€’å½’-amp-å›æº¯ç®—æ³•"><a href="#3-11-é€’å½’-amp-å›æº¯ç®—æ³•" class="headerlink" title="3.11 é€’å½’&amp;å›æº¯ç®—æ³•"></a>3.11 é€’å½’&amp;å›æº¯ç®—æ³•</h3><ul><li>1.ä»€ä¹ˆæ˜¯é€’å½’ &amp; ä»€ä¹ˆæ˜¯å›æº¯ï¼Ÿ</li></ul><h3 id="3-12-è´ªå¿ƒç®—æ³•"><a href="#3-12-è´ªå¿ƒç®—æ³•" class="headerlink" title="3.12 è´ªå¿ƒç®—æ³•"></a>3.12 è´ªå¿ƒç®—æ³•</h3><ul><li>1.ä»€ä¹ˆæ˜¯è´ªå¿ƒç®—æ³•ï¼Ÿ</li></ul><h3 id="3-13-å…¶å®ƒæœ‰å…³ç®—æ³•ä¸æ•°æ®ç»“æ„çš„é¢è¯•é¢˜"><a href="#3-13-å…¶å®ƒæœ‰å…³ç®—æ³•ä¸æ•°æ®ç»“æ„çš„é¢è¯•é¢˜" class="headerlink" title="3.13 å…¶å®ƒæœ‰å…³ç®—æ³•ä¸æ•°æ®ç»“æ„çš„é¢è¯•é¢˜"></a>3.13 å…¶å®ƒæœ‰å…³ç®—æ³•ä¸æ•°æ®ç»“æ„çš„é¢è¯•é¢˜</h3><ul><li>1.ä»€ä¹ˆæ˜¯å›¾ï¼Ÿå¯ä»¥è§£å†³ä¸€äº›ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li><li>2.æ—¶é’ˆèµ°ä¸€åœˆï¼Œæ—¶é’ˆåˆ†é’ˆé‡åˆå‡ æ¬¡ï¼Ÿ</li><li>3.æœ‰ä¸€ä¸ªä¸å‡åŒ€çš„ç»³å­çƒ§å®Œè¦1ä¸ªå°æ—¶ï¼Œå¦‚ä½•ç®—å‡º1å°æ—¶15åˆ†é’Ÿï¼Ÿ</li><li>4.æ±‚1000ä»¥å†…çš„æ°´ä»™èŠ±æ•°ä»¥åŠ40äº¿ä»¥å†…çš„æ°´ä»™èŠ±æ•°ï¼Ÿ</li><li>5.æ•°æ®æ€ä¹ˆå‹ç¼©ï¼Œæ•°æ®çš„å®‰å…¨ã€‚</li><li>6.è°ˆè°ˆä½ å¯¹å¯¹ç§°åŠ å¯† &amp; éå¯¹ç§°åŠ å¯†çš„ç†è§£ã€‚</li></ul><h2 id="4-å¸¸ç”¨çš„å¼€æºåº“éƒ¨åˆ†"><a href="#4-å¸¸ç”¨çš„å¼€æºåº“éƒ¨åˆ†" class="headerlink" title="4.å¸¸ç”¨çš„å¼€æºåº“éƒ¨åˆ†"></a><strong>4.å¸¸ç”¨çš„å¼€æºåº“éƒ¨åˆ†</strong></h2><h3 id="4-1-å¼‚æ­¥é€šä¿¡"><a href="#4-1-å¼‚æ­¥é€šä¿¡" class="headerlink" title="4.1 å¼‚æ­¥é€šä¿¡"></a>4.1 å¼‚æ­¥é€šä¿¡</h3><ul><li>1.RxJavaç”¨æ³• &amp; RxJava2ç”¨æ³• &amp; åŸç† &amp;ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼ï¼Ÿ</li><li>2.EventBusç”¨æ³• &amp; åŸç†ã€‚</li></ul><h3 id="4-2-ç½‘ç»œ"><a href="#4-2-ç½‘ç»œ" class="headerlink" title="4.2 ç½‘ç»œ"></a>4.2 ç½‘ç»œ</h3><ul><li>1.OkHttpç”¨æ³• &amp; æºç åˆ†æã€‚</li><li>2.Retrofitç”¨æ³• &amp; æºç åˆ†æã€‚</li><li>3.Volleyç”¨æ³• &amp; ç¼ºç‚¹ã€‚</li></ul><h3 id="4-3-ä¾èµ–æ³¨å…¥"><a href="#4-3-ä¾èµ–æ³¨å…¥" class="headerlink" title="4.3 ä¾èµ–æ³¨å…¥"></a>4.3 ä¾èµ–æ³¨å…¥</h3><ul><li>1.ButterKnifeç”¨æ³• &amp; åŸç†ã€‚</li><li>2.Dagger2ç”¨æ³• &amp; åŸç†ã€‚</li></ul><h3 id="4-4-å›¾ç‰‡åŠ è½½"><a href="#4-4-å›¾ç‰‡åŠ è½½" class="headerlink" title="4.4 å›¾ç‰‡åŠ è½½"></a>4.4 å›¾ç‰‡åŠ è½½</h3><ul><li>1.Glideç”¨æ³• &amp; åŸç†ã€‚</li><li>2.Picassoç”¨æ³• &amp; åŸç†ã€‚</li><li>3.Frescoç”¨æ³• &amp; åŸç†ã€‚</li></ul><h3 id="4-5-æ•°æ®åº“"><a href="#4-5-æ•°æ®åº“" class="headerlink" title="4.5 æ•°æ®åº“"></a>4.5 æ•°æ®åº“</h3><ul><li>1.GreenDaoã€‚</li><li>2.LitePalã€‚</li><li>3.OrmLiteã€‚</li><li>4.DBFlowã€‚</li><li>5.Realmã€‚</li></ul><h3 id="4-6-å…¶å®ƒ"><a href="#4-6-å…¶å®ƒ" class="headerlink" title="4.6 å…¶å®ƒ"></a>4.6 å…¶å®ƒ</h3><ul><li>1.åˆ†äº«ä½ è§‰å¾—æ¯”è¾ƒå¥½ç”¨çš„å¼€æºåº“ã€‚</li><li>2.è‡ªå·±æœ‰å°è£…åº“å—ï¼Ÿç»™æˆ‘è¯´è¯´ä½ æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ</li><li>3.ä½ æ˜¯å¦‚ä½•è®¾è®¡ä¸€ä¸ªç½‘ç»œè¯·æ±‚æ¡†æ¶çš„ï¼Ÿ</li></ul><h2 id="5-è®¡ç®—æœºç½‘ç»œéƒ¨åˆ†"><a href="#5-è®¡ç®—æœºç½‘ç»œéƒ¨åˆ†" class="headerlink" title="5.è®¡ç®—æœºç½‘ç»œéƒ¨åˆ†"></a><strong>5.è®¡ç®—æœºç½‘ç»œéƒ¨åˆ†</strong></h2><ul><li>1.ç»™æˆ‘ä»‹ç»5å±‚ç½‘ç»œæ¨¡å‹ã€‚</li><li>2.Http/Httpsåè®®å·¥ä½œåœ¨å“ªä¸€å±‚ï¼Ÿ</li><li>3.TCP/UDPåè®®å·¥ä½œåœ¨å“ªä¸€å±‚ï¼Ÿ</li><li>4.ç»™æˆ‘è¯´è¯´ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ã€‚</li><li>5.ä»€ä¹ˆæ˜¯è¯·æ±‚å¤´ &amp; å“åº”å¤´ ? è¯´è¯´è¯·æ±‚å¤´ä¸­ä¸€äº›é‡è¦çš„å­—æ®µã€‚</li><li>6.ä»€ä¹ˆæ˜¯Cookie &amp; Sessionã€‚</li><li>7.çŸ¥é“ä»€ä¹ˆæ˜¯å¿ƒè·³æ£€æµ‹å—ï¼Ÿ</li><li>8.Httpå’ŒHttpsçš„åŒºåˆ«ï¼Ÿ</li><li>9.åŠ å¯†åè®®TLS/SSLåŠ å¯†è¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</li><li>10.ä»€ä¹ˆæ˜¯DNS &amp; ä½œç”¨æ˜¯ä»€ä¹ˆ &amp;å·¥ä½œæœºåˆ¶ï¼Ÿ</li><li>11.æµè§ˆå™¨è®¿é—®ä¸€ä¸ªurlç½‘å€æ‰€ç»å†çš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>12.Socketæ˜¯åè®®å—ï¼ŸWebSocketæ˜¯åè®®å—ï¼Ÿå®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>13.Jsonè§£ææ–¹å¼æœ‰å“ªäº›ï¼Ÿæ¯”è¾ƒå®ƒä»¬çš„ä¼˜åŠ£åŠ¿ã€‚</li><li>14.XMLè§£ææ–¹å¼æœ‰å“ªäº›ï¼Ÿæ¯”è¾ƒå®ƒä»¬çš„ä¼˜åŠ£åŠ¿ã€‚</li><li>15.http1.x &amp; http 2.0åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>16.è¯´è¯´HTTPç¼“å­˜çš„åŸç†ã€‚</li><li>17.å¦‚æœæœ‰ä¸ª100Må¤§çš„æ–‡ä»¶ï¼Œéœ€è¦ä¸Šä¼ è‡³æœåŠ¡å™¨ä¸­ï¼Œè€ŒæœåŠ¡å™¨formè¡¨å•æœ€å¤§åªèƒ½ä¸Šä¼ 2M,å¯ä»¥ä½¿ç”¨ä»€ä¹ˆæ–¹æ³•ï¼Ÿ</li><li>18.è¯´è¯´ä½ é¡¹ç›®ä¸­å³æ—¶é€šè®¯çš„æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;Javaéƒ¨åˆ†&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;Androidéƒ¨åˆ†&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;æ•°æ®ç»“æ„ä¸ç®—æ³•éƒ¨åˆ†&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;å¸¸ç”¨çš„å¼€æºåº“éƒ¨åˆ†&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;è®¡ç®—æœºç½‘ç»œè®¤è¯†&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="é¢è¯•" scheme="https://zhangmiao.cc/categories/Android/%E9%9D%A2%E8%AF%95/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="é¢è¯•" scheme="https://zhangmiao.cc/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>AndroidçŸ¥è¯†é—´è®°ï¼Œå¿«é€Ÿå›é¡¾å„ç§çŸ¥è¯†</title>
    <link href="https://zhangmiao.cc/posts/97843d21.html"/>
    <id>https://zhangmiao.cc/posts/97843d21.html</id>
    <published>2019-07-01T06:45:30.000Z</published>
    <updated>2019-07-22T06:56:59.753Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç›®å½•ï¼š"><a href="#ç›®å½•ï¼š" class="headerlink" title="ç›®å½•ï¼š"></a><strong>ç›®å½•ï¼š</strong></h3><ul><li><p>ç½‘ç»œ</p></li><li><p>Java åŸºç¡€&amp;å®¹å™¨&amp;åŒæ­¥&amp;è®¾è®¡æ¨¡å¼</p></li><li><p>Java è™šæ‹Ÿæœº&amp;å†…å­˜ç»“æ„&amp;GC&amp;ç±»åŠ è½½&amp;å››ç§å¼•ç”¨&amp;åŠ¨æ€ä»£ç†</p></li><li><p>Android åŸºç¡€&amp;æ€§èƒ½ä¼˜åŒ–&amp;Framwork</p></li><li><p>Android æ¨¡å—åŒ–&amp;çƒ­ä¿®å¤&amp;çƒ­æ›´æ–°&amp;æ‰“åŒ…&amp;æ··æ·†&amp;å‹ç¼©</p></li><li><p>éŸ³è§†é¢‘&amp;FFmpeg&amp;æ’­æ”¾å™¨</p></li></ul><a id="more"></a><h3 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h3><h4 id="ç½‘ç»œåè®®æ¨¡å‹"><a href="#ç½‘ç»œåè®®æ¨¡å‹" class="headerlink" title="ç½‘ç»œåè®®æ¨¡å‹"></a><strong>ç½‘ç»œåè®®æ¨¡å‹</strong></h4><p>åº”ç”¨å±‚ï¼šè´Ÿè´£å¤„ç†ç‰¹å®šçš„åº”ç”¨ç¨‹åºç»†èŠ‚</p><p>HTTPã€FTPã€DNS</p><p>ä¼ è¾“å±‚ï¼šä¸ºä¸¤å°ä¸»æœºæä¾›ç«¯åˆ°ç«¯çš„åŸºç¡€é€šä¿¡<br>TCPã€UDP</p><p>ç½‘ç»œå±‚ï¼šæ§åˆ¶åˆ†ç»„ä¼ è¾“ã€è·¯ç”±é€‰æ‹©ç­‰<br>IP</p><p>é“¾è·¯å±‚ï¼šæ“ä½œç³»ç»Ÿè®¾å¤‡é©±åŠ¨ç¨‹åºã€ç½‘å¡ç›¸å…³æ¥å£</p><p>#### </p><h4 id="TCP-å’Œ-UDP-åŒºåˆ«"><a href="#TCP-å’Œ-UDP-åŒºåˆ«" class="headerlink" title="TCP å’Œ UDP åŒºåˆ«"></a><strong>TCP å’Œ UDP åŒºåˆ«</strong></h4><p>TCP è¿æ¥ï¼›å¯é ï¼›æœ‰åºï¼›é¢å‘å­—èŠ‚æµï¼›é€Ÿåº¦æ…¢ï¼›è¾ƒé‡é‡ï¼›å…¨åŒå·¥ï¼›é€‚ç”¨äºæ–‡ä»¶ä¼ è¾“ã€æµè§ˆå™¨ç­‰</p><ul><li>å…¨åŒå·¥ï¼šA ç»™ B å‘æ¶ˆæ¯çš„åŒæ—¶ï¼ŒB ä¹Ÿèƒ½ç»™ A å‘</li><li>åŠåŒå·¥ï¼šA ç»™ B å‘æ¶ˆæ¯çš„åŒæ—¶ï¼ŒB ä¸èƒ½ç»™ A å‘</li></ul><p>UDP æ— è¿æ¥ï¼›ä¸å¯é ï¼›æ— åºï¼›é¢å‘æŠ¥æ–‡ï¼›é€Ÿåº¦å¿«ï¼›è½»é‡ï¼›é€‚ç”¨äºå³æ—¶é€šè®¯ã€è§†é¢‘é€šè¯ç­‰</p><h4 id="TCP-ä¸‰æ¬¡æ¡æ‰‹"><a href="#TCP-ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="TCP ä¸‰æ¬¡æ¡æ‰‹"></a><strong>TCP ä¸‰æ¬¡æ¡æ‰‹</strong></h4><ol><li>Aï¼šä½ èƒ½å¬åˆ°å—ï¼Ÿ</li><li>Bï¼šæˆ‘èƒ½å¬åˆ°ï¼Œä½ èƒ½å¬åˆ°å—ï¼Ÿ</li><li>Aï¼šæˆ‘èƒ½å¬åˆ°ï¼Œå¼€å§‹å§</li></ol><p>A å’Œ B ä¸¤æ–¹éƒ½è¦èƒ½ç¡®ä¿ï¼šæˆ‘è¯´çš„è¯ï¼Œä½ èƒ½å¬åˆ°ï¼›ä½ è¯´çš„è¯ï¼Œæˆ‘èƒ½å¬åˆ°ã€‚æ‰€ä»¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹</p><h4 id="TCP-å››æ¬¡æŒ¥æ‰‹"><a href="#TCP-å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="TCP å››æ¬¡æŒ¥æ‰‹"></a><strong>TCP å››æ¬¡æŒ¥æ‰‹</strong></h4><ol><li>Aï¼šæˆ‘è¯´å®Œäº†</li><li>Bï¼šæˆ‘çŸ¥é“äº†ï¼Œç­‰ä¸€ä¸‹ï¼Œæˆ‘å¯èƒ½è¿˜æ²¡è¯´å®Œ</li><li>Bï¼šæˆ‘ä¹Ÿè¯´å®Œäº†</li><li>Aï¼šæˆ‘çŸ¥é“äº†ï¼Œç»“æŸå§</li></ol><p>B æ”¶åˆ° A ç»“æŸçš„æ¶ˆæ¯å B å¯èƒ½è¿˜æ²¡è¯´å®Œï¼Œæ²¡æ³•ç«‹å³å›å¤ç»“æŸæ ‡ç¤ºï¼Œåªèƒ½ç­‰è¯´å®Œåå†å‘Šè¯‰ A ï¼šæˆ‘è¯´å®Œäº†ã€‚</p><h4 id="POST-å’Œ-GET-åŒºåˆ«"><a href="#POST-å’Œ-GET-åŒºåˆ«" class="headerlink" title="POST å’Œ GET åŒºåˆ«"></a><strong>POST å’Œ GET åŒºåˆ«</strong></h4><p>Get å‚æ•°æ”¾åœ¨ url ä¸­ï¼›Post å‚æ•°æ”¾åœ¨ request Body ä¸­</p><p>Get å¯èƒ½ä¸å®‰å…¨ï¼Œå› ä¸ºå‚æ•°æ”¾åœ¨ url ä¸­</p><h4 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a><strong>HTTPS</strong></h4><ol><li>HTTP æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ˜æ–‡ä¼ è¾“ï¼›HTTPS ä½¿ç”¨ SSL åè®®å¯¹ HTTP ä¼ è¾“æ•°æ®è¿›è¡Œäº†åŠ å¯†</li><li>HTTP é»˜è®¤ 80 ç«¯å£ï¼›HTTPS é»˜è®¤ 443 ç«¯å£</li><li>ä¼˜ç‚¹ï¼šå®‰å…¨</li><li>ç¼ºç‚¹ï¼šè´¹æ—¶ã€SSL è¯ä¹¦æ”¶è´¹ï¼ŒåŠ å¯†èƒ½åŠ›è¿˜æ˜¯æœ‰é™çš„ï¼Œä½†æ˜¯æ¯” HTTP å¼ºå¤šäº†</li></ol><h3 id="Java-åŸºç¡€-amp-å®¹å™¨-amp-åŒæ­¥-amp-è®¾è®¡æ¨¡å¼"><a href="#Java-åŸºç¡€-amp-å®¹å™¨-amp-åŒæ­¥-amp-è®¾è®¡æ¨¡å¼" class="headerlink" title="Java åŸºç¡€&amp;å®¹å™¨&amp;åŒæ­¥&amp;è®¾è®¡æ¨¡å¼"></a>Java åŸºç¡€&amp;å®¹å™¨&amp;åŒæ­¥&amp;è®¾è®¡æ¨¡å¼</h3><h4 id="StringBuilderã€StringBufferã€-ã€String-concat-é“¾æ¥å­—ç¬¦ä¸²ï¼š"><a href="#StringBuilderã€StringBufferã€-ã€String-concat-é“¾æ¥å­—ç¬¦ä¸²ï¼š" class="headerlink" title="StringBuilderã€StringBufferã€+ã€String.concat é“¾æ¥å­—ç¬¦ä¸²ï¼š"></a><strong>StringBuilderã€StringBufferã€+ã€String.concat é“¾æ¥å­—ç¬¦ä¸²ï¼š</strong></h4><ul><li>StringBuffer çº¿ç¨‹å®‰å…¨ï¼ŒStringBuilder çº¿ç¨‹ä¸å®‰å…¨</li><li>+å®é™…ä¸Šæ˜¯ç”¨ StringBuilder æ¥å®ç°çš„ï¼Œæ‰€ä»¥éå¾ªç¯ä½“å¯ä»¥ç›´æ¥ç”¨ +ï¼Œå¾ªç¯ä½“ä¸è¡Œï¼Œå› ä¸ºä¼šé¢‘ç¹åˆ›å»º StringBuilder</li><li>String.concat å®è´¨æ˜¯ new String ï¼Œæ•ˆç‡ä¹Ÿä½ï¼Œè€—æ—¶æ’åºï¼šStringBuilder &lt; StringBuffer &lt; concat &lt; +</li></ul><h4 id><a href="#" class="headerlink" title=" "></a> </h4><h4 id="Java-æ³›å‹æ“¦é™¤"><a href="#Java-æ³›å‹æ“¦é™¤" class="headerlink" title="Java æ³›å‹æ“¦é™¤"></a><strong>Java æ³›å‹æ“¦é™¤</strong></h4><ul><li>ä¿®é¥°æˆå‘˜å˜é‡ç­‰ç±»ç»“æ„ç›¸å…³çš„æ³›å‹ä¸ä¼šè¢«æ“¦é™¤</li><li>å®¹å™¨ç±»æ³›å‹ä¼šè¢«æ“¦é™¤</li></ul><h4 id="ArrayListã€LinkedList"><a href="#ArrayListã€LinkedList" class="headerlink" title="ArrayListã€LinkedList"></a><strong>ArrayListã€LinkedList</strong></h4><p>ArrayList</p><ul><li>åŸºäºæ•°ç»„å®ç°ï¼ŒæŸ¥æ‰¾å¿«ï¼šo(1)ï¼Œå¢åˆ æ…¢ï¼šo(n)</li><li>åˆå§‹å®¹é‡ä¸º10ï¼Œæ‰©å®¹é€šè¿‡ System.arrayCopy æ–¹æ³•</li></ul><p>LinkedList</p><ul><li>åŸºäºåŒå‘é“¾è¡¨å®ç°ï¼ŒæŸ¥æ‰¾æ…¢ï¼šo(n)ï¼Œå¢åˆ å¿«ï¼šo(1)</li><li>å°è£…äº†é˜Ÿåˆ—å’Œæ ˆçš„è°ƒç”¨</li></ul><h4 id="HashMap-ã€HashTable"><a href="#HashMap-ã€HashTable" class="headerlink" title="HashMap ã€HashTable"></a><strong>HashMap ã€HashTable</strong></h4><p>HashMap</p><ul><li>åŸºäºæ•°ç»„å’Œé“¾è¡¨å®ç°ï¼Œæ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“ï¼›é“¾è¡¨æ˜¯ä¸ºè§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„</li><li>å½“å‘ç”Ÿå“ˆå¸Œå†²çªä¸”é“¾è¡¨ size å¤§äºé˜ˆå€¼æ—¶ä¼šæ‰©å®¹ï¼ŒJAVA 8 ä¼šå°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘æé«˜æ€§èƒ½<br>å…è®¸ key/value ä¸º null</li></ul><p>HashTable</p><ul><li>æ•°æ®ç»“æ„å’Œ HashMap ä¸€æ ·</li><li>ä¸å…è®¸ value ä¸º null</li><li>çº¿ç¨‹å®‰å…¨</li></ul><h4 id="ArrayMapã€SparseArray"><a href="#ArrayMapã€SparseArray" class="headerlink" title="ArrayMapã€SparseArray"></a><strong>ArrayMapã€SparseArray</strong></h4><p>ArrayMap</p><ul><li>åŸºäºä¸¤ä¸ªæ•°ç»„å®ç°ï¼Œä¸€ä¸ªå­˜æ”¾ hashï¼›ä¸€ä¸ªå­˜æ”¾é”®å€¼å¯¹ã€‚æ‰©å®¹çš„æ—¶å€™åªéœ€è¦æ•°ç»„æ‹·è´ï¼Œä¸éœ€è¦é‡å»ºå“ˆå¸Œè¡¨</li><li>å†…å­˜åˆ©ç”¨ç‡é«˜</li><li>ä¸é€‚åˆå­˜å¤§é‡æ•°æ®ï¼Œå› ä¸ºä¼šå¯¹ key è¿›è¡ŒäºŒåˆ†æ³•æŸ¥æ‰¾ï¼ˆ1000ä»¥ä¸‹ï¼‰</li></ul><p>SparseArray</p><ul><li>åŸºäºä¸¤ä¸ªæ•°ç»„å®ç°ï¼Œint åš key</li><li>å†…å­˜åˆ©ç”¨ç‡é«˜</li><li>ä¸é€‚åˆå­˜å¤§é‡æ•°æ®ï¼Œå› ä¸ºä¼šå¯¹ key è¿›è¡ŒäºŒåˆ†æ³•æŸ¥æ‰¾ï¼ˆ1000ä»¥ä¸‹ï¼‰</li></ul><h4 id="volatile-å…³é”®å­—"><a href="#volatile-å…³é”®å­—" class="headerlink" title="volatile å…³é”®å­—"></a><strong>volatile å…³é”®å­—</strong></h4><ul><li><p>åªèƒ½ç”¨æ¥ä¿®é¥°å˜é‡ï¼Œé€‚ç”¨ä¿®é¥°å¯èƒ½è¢«å¤šçº¿ç¨‹åŒæ—¶è®¿é—®çš„å˜é‡</p></li><li><p>ç›¸å½“äºè½»é‡çº§çš„ synchronizedï¼Œvolatitle èƒ½ä¿è¯æœ‰åºæ€§ï¼ˆç¦ç”¨æŒ‡ä»¤é‡æ’åºï¼‰ã€å¯è§æ€§ï¼›åè€…è¿˜èƒ½ä¿è¯åŸå­æ€§</p></li><li><p>å˜é‡ä½äºä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå˜é‡åœ¨è‡ªå·±çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­æœ‰ä»½æ‹·è´ï¼Œçº¿ç¨‹ç›´æ¥æ“ä½œçš„æ˜¯è¿™ä¸ªæ‹·è´</p></li><li><p>è¢« volatile ä¿®é¥°çš„å˜é‡æ”¹å˜åä¼šç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œä¿æŒå˜é‡çš„å¯è§æ€§.</p></li></ul><p>åŒé‡æ£€æŸ¥å•ä¾‹ï¼Œä¸ºä»€ä¹ˆè¦åŠ  volatileï¼Ÿ</p><ul><li>volatileæƒ³è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æƒ³è¦ä½¿ç”¨instanceï¼Œå‘ç°instance!=nullï¼Œä½†æ˜¯å®é™…ä¸Šinstanceè¿˜æœªåˆå§‹åŒ–å®Œæ¯•è¿™ä¸ªé—®é¢˜</li><li>å°†instance =newInstance();æ‹†åˆ†ä¸º3å¥è¯æ˜¯ã€‚1.åˆ†é…å†…å­˜2.åˆå§‹åŒ–3.å°†instanceæŒ‡å‘åˆ†é…çš„å†…å­˜ç©º</li><li>volatileå¯ä»¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œç¡®ä¿å…ˆæ‰§è¡Œ2ï¼Œåæ‰§è¡Œ3</li></ul><p><strong>wait å’Œ sleep</strong></p><ul><li>sleep æ˜¯ Thread çš„é™æ€æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨</li><li>wait æ˜¯ Object çš„æˆå‘˜æ–¹æ³•ï¼Œåªèƒ½åœ¨ synchronized ä»£ç å—ä¸­è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ¥ IllegalMonitorStateException éæ³•ç›‘æ§çŠ¶æ€å¼‚å¸¸</li><li>sleep ä¸ä¼šé‡Šæ”¾å…±äº«èµ„æºé”ï¼Œwait ä¼šé‡Šæ”¾å…±äº«èµ„æºé”</li></ul><p><strong>lock å’Œ synchronized</strong></p><ul><li>synchronized æ˜¯ Java å…³é”®å­—ï¼Œå†…ç½®ç‰¹æ€§ï¼›Lock æ˜¯ä¸€ä¸ªæ¥å£</li><li>synchronized ä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼›lock éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ï¼Œæ‰€ä»¥éœ€è¦å†™åˆ° try catch å—ä¸­å¹¶åœ¨ finally ä¸­é‡Šæ”¾é”</li><li>synchronized æ— æ³•ä¸­æ–­ç­‰å¾…é”ï¼›lock å¯ä»¥ä¸­æ–­</li><li>Lock å¯ä»¥æé«˜å¤šä¸ªçº¿ç¨‹è¿›è¡Œè¯»/å†™æ“ä½œçš„æ•ˆç‡</li><li>ç«äº‰èµ„æºæ¿€çƒˆæ—¶ï¼Œlock çš„æ€§èƒ½ä¼šæ˜æ˜¾çš„ä¼˜äº synchronized</li></ul><p><strong>å¯é‡å…¥é”</strong></p><ul><li>å®šä¹‰ï¼šå·²ç»è·å–åˆ°é”åï¼Œå†æ¬¡è°ƒç”¨åŒæ­¥ä»£ç å—/å°è¯•è·å–é”æ—¶ä¸å¿…é‡æ–°å»ç”³è¯·é”ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œç›¸å…³ä»£ç </li><li>ReentrantLock å’Œ synchronized éƒ½æ˜¯å¯é‡å…¥é”</li></ul><p><strong>å…¬å¹³é”</strong></p><ul><li>å®šä¹‰ï¼šç­‰å¾…æ—¶é—´æœ€ä¹…çš„çº¿ç¨‹ä¼šä¼˜å…ˆè·å¾—é”</li><li>éå…¬å¹³é”æ— æ³•ä¿è¯å“ªä¸ªçº¿ç¨‹è·å–åˆ°é”ï¼Œsynchronized å°±æ˜¯éå…¬å¹³é”</li><li>ReentrantLock é»˜è®¤æ—¶éå…¬å¹³é”ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”</li></ul><p><strong>ä¹è§‚é”å’Œæ‚²è§‚é”</strong></p><ul><li>æ‚²è§‚é”ï¼šçº¿ç¨‹ä¸€æ—¦å¾—åˆ°é”ï¼Œå…¶ä»–çº¿ç¨‹å°±æŒ‚èµ·ç­‰å¾…ï¼Œé€‚ç”¨äºå†™å…¥æ“ä½œé¢‘ç¹çš„åœºæ™¯ï¼›synchronized å°±æ˜¯æ‚²è§‚é”</li><li>ä¹è§‚é”ï¼šå‡è®¾æ²¡æœ‰å†²çªï¼Œä¸åŠ é”ï¼Œæ›´æ–°æ•°æ®æ—¶åˆ¤æ–­è¯¥æ•°æ®æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸçš„è¯åˆ™ä¸è¿›è¡Œæ•°æ®æ›´æ–°ï¼Œé€‚ç”¨äºè¯»å–æ“ä½œé¢‘ç¹çš„åœºæ™¯</li><li>ä¹è§‚é” CASï¼šCompare And Swapï¼Œæ›´æ–°æ•°æ®æ—¶å…ˆæ¯”è¾ƒåŸå€¼æ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰åˆ™è¡¨ç¤ºæ•°æ®è¿‡å»ï¼Œä¸è¿›è¡Œæ•°æ®æ›´æ–°</li><li>ä¹è§‚é”å®ç°ï¼šAtomicIntegerã€AtomicLongã€AtomicBoolean</li></ul><p><strong>æ­»é” 4 ä¸ªå¿…è¦æ¡ä»¶</strong></p><ul><li>äº’æ–¥</li><li>å æœ‰ä¸”ç­‰å¾…</li><li>ä¸å¯æŠ¢å </li><li>å¾ªç¯ç­‰å¾…</li></ul><p><strong>synchronized åŸç†</strong></p><ul><li>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç›‘è§†å™¨é”ï¼šmonitorï¼ŒåŒæ­¥ä»£ç å—ä¼šæ‰§è¡Œ  monitorenter å¼€å§‹ï¼Œmotnitorexit ç»“æŸ</li><li>wait/notify å°±ä¾èµ– monitor ç›‘è§†å™¨ï¼Œæ‰€ä»¥åœ¨éåŒæ­¥ä»£ç å—ä¸­æ‰§è¡Œä¼šæŠ¥ IllegalMonitorStateException å¼‚å¸¸</li></ul><h3 id="Java-è™šæ‹Ÿæœº-amp-å†…å­˜ç»“æ„-amp-GC-amp-ç±»åŠ è½½-amp-å››ç§å¼•ç”¨-amp-åŠ¨æ€ä»£ç†"><a href="#Java-è™šæ‹Ÿæœº-amp-å†…å­˜ç»“æ„-amp-GC-amp-ç±»åŠ è½½-amp-å››ç§å¼•ç”¨-amp-åŠ¨æ€ä»£ç†" class="headerlink" title="Java è™šæ‹Ÿæœº&amp;å†…å­˜ç»“æ„&amp;GC&amp;ç±»åŠ è½½&amp;å››ç§å¼•ç”¨&amp;åŠ¨æ€ä»£ç†"></a>Java è™šæ‹Ÿæœº&amp;å†…å­˜ç»“æ„&amp;GC&amp;ç±»åŠ è½½&amp;å››ç§å¼•ç”¨&amp;åŠ¨æ€ä»£ç†</h3><h4 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a><strong>JVM</strong></h4><ul><li>å®šä¹‰ï¼šå¯ä»¥ç†è§£æˆä¸€ä¸ªè™šæ„çš„è®¡ç®—æœºï¼Œè§£é‡Šè‡ªå·±çš„å­—èŠ‚ç æŒ‡ä»¤é›†æ˜ å°„åˆ°æœ¬åœ° CPU æˆ– OS çš„æŒ‡ä»¤é›†ï¼Œä¸Šå±‚åªéœ€å…³æ³¨ Class æ–‡ä»¶ï¼Œä¸æ“ä½œç³»ç»Ÿæ— å…³ï¼Œå®ç°è·¨å¹³å°</li><li>Kotlin å°±æ˜¯èƒ½è§£é‡Šæˆ Class æ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥è·‘åœ¨ JVM ä¸Š</li></ul><h4 id="JVM-å†…å­˜æ¨¡å‹"><a href="#JVM-å†…å­˜æ¨¡å‹" class="headerlink" title="JVM å†…å­˜æ¨¡å‹"></a><strong>JVM å†…å­˜æ¨¡å‹</strong></h4><ul><li>Java å¤šçº¿ç¨‹ä¹‹é—´æ˜¯é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æœ¬åœ°å†…å­˜</li><li>å…±äº«å˜é‡å­˜æ”¾äºä¸»å†…å­˜ä¸­ï¼Œçº¿ç¨‹ä¼šæ‹·è´ä¸€ä»½å…±äº«å˜é‡åˆ°æœ¬åœ°å†…å­˜</li><li>volatile å…³é”®å­—å°±æ˜¯ç»™å†…å­˜æ¨¡å‹æœåŠ¡çš„ï¼Œç”¨æ¥ä¿è¯å†…å­˜å¯è§æ€§å’Œé¡ºåºæ€§</li></ul><h4 id="JVM-å†…å­˜ç»“æ„"><a href="#JVM-å†…å­˜ç»“æ„" class="headerlink" title="JVM å†…å­˜ç»“æ„"></a><strong>JVM å†…å­˜ç»“æ„</strong></h4><p>çº¿ç¨‹ç§æœ‰ï¼š</p><ul><li>ç¨‹åºè®¡æ•°å™¨ï¼šè®°å½•æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼Œè‹¥æ­£åœ¨æ‰§è¡Œ Native æ–¹æ³•åˆ™ä¸ºç©º</li><li>è™šæ‹Ÿæœºæ ˆï¼šæ‰§è¡Œæ–¹æ³•æ—¶æŠŠæ–¹æ³•æ‰€éœ€æ•°æ®å­˜ä¸ºä¸€ä¸ªæ ˆå¸§å…¥æ ˆï¼Œæ‰§è¡Œå®Œåå‡ºæ ˆ</li><li>æœ¬åœ°æ–¹æ³•æ ˆï¼šåŒè™šæ‹Ÿæœºæ ˆï¼Œä½†æ˜¯é’ˆå¯¹çš„æ˜¯ Native æ–¹æ³•</li></ul><p>çº¿ç¨‹å…±äº«ï¼š</p><ul><li>å †ï¼šå­˜å‚¨ Java å®ä¾‹ï¼ŒGC ä¸»è¦åŒºåŸŸï¼Œåˆ†ä»£æ”¶é›† GC æ–¹æ³•ä¼šå§å †åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£</li><li>æ–¹æ³•åŒºï¼šå­˜å‚¨ç±»ä¿¡æ¯ï¼Œå¸¸é‡æ± ï¼Œé™æ€å˜é‡ç­‰æ•°æ®</li></ul><h4 id="GC"><a href="#GC" class="headerlink" title="GC"></a><strong>GC</strong></h4><h4 id="å›æ”¶åŒºåŸŸï¼šåªé’ˆå¯¹å †ã€æ–¹æ³•åŒºï¼›çº¿ç¨‹ç§æœ‰åŒºåŸŸæ•°æ®ä¼šéšçº¿ç¨‹ç»“æŸé”€æ¯ï¼Œä¸ç”¨å›æ”¶"><a href="#å›æ”¶åŒºåŸŸï¼šåªé’ˆå¯¹å †ã€æ–¹æ³•åŒºï¼›çº¿ç¨‹ç§æœ‰åŒºåŸŸæ•°æ®ä¼šéšçº¿ç¨‹ç»“æŸé”€æ¯ï¼Œä¸ç”¨å›æ”¶" class="headerlink" title="å›æ”¶åŒºåŸŸï¼šåªé’ˆå¯¹å †ã€æ–¹æ³•åŒºï¼›çº¿ç¨‹ç§æœ‰åŒºåŸŸæ•°æ®ä¼šéšçº¿ç¨‹ç»“æŸé”€æ¯ï¼Œä¸ç”¨å›æ”¶"></a>å›æ”¶åŒºåŸŸï¼šåªé’ˆå¯¹å †ã€æ–¹æ³•åŒºï¼›çº¿ç¨‹ç§æœ‰åŒºåŸŸæ•°æ®ä¼šéšçº¿ç¨‹ç»“æŸé”€æ¯ï¼Œä¸ç”¨å›æ”¶</h4><h4 id="å›æ”¶ç±»å‹ï¼š"><a href="#å›æ”¶ç±»å‹ï¼š" class="headerlink" title="å›æ”¶ç±»å‹ï¼š"></a><strong>å›æ”¶ç±»å‹ï¼š</strong></h4><p>1.å †ä¸­çš„å¯¹è±¡</p><ul><li><p>åˆ†ä»£æ”¶é›† GC æ–¹æ³•ä¼šå§å †åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£ã€è€å¹´ä»£</p></li><li><p>æ–°ç”Ÿä»£ï¼šæ–°å»ºå°å¯¹è±¡ä¼šè¿›å…¥æ–°ç”Ÿä»£ï¼›é€šè¿‡å¤åˆ¶ç®—æ³•å›æ”¶å¯¹è±¡</p></li><li><p>è€å¹´ä»£ï¼šæ–°å»ºå¤§å¯¹è±¡åŠè€å¯¹è±¡ä¼šè¿›å…¥è€å¹´ä»£ï¼›é€šè¿‡æ ‡è®°-æ¸…é™¤ç®—æ³•å›æ”¶å¯¹è±¡</p></li></ul><p>2.æ–¹æ³•åŒºä¸­çš„ç±»ä¿¡æ¯ã€å¸¸é‡æ± </p><p><strong>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶ï¼š</strong></p><p>1.å¼•ç”¨è®¡æ•°æ³•<br>ç¼ºç‚¹ï¼šå¾ªç¯å¼•ç”¨</p><p>2.å¯è¾¾æ€§åˆ†ææ³•<br>å®šä¹‰ï¼šä» GC ROOT å¼€å§‹æœç´¢ï¼Œä¸å¯è¾¾çš„å¯¹è±¡éƒ½æ˜¯å¯ä»¥è¢«å›æ”¶çš„</p><p><strong>GC ROOT</strong> </p><p>1.è™šæ‹Ÿæœºæ ˆ/æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡<br>2.æ–¹æ³•åŒºä¸­å¸¸é‡/é™æ€å˜é‡å¼•ç”¨çš„å¯¹è±¡</p><h4 id="å››ç§å¼•ç”¨"><a href="#å››ç§å¼•ç”¨" class="headerlink" title="å››ç§å¼•ç”¨"></a><strong>å››ç§å¼•ç”¨</strong></h4><ul><li>å¼ºå¼•ç”¨ï¼šä¸ä¼šè¢«å›æ”¶</li><li>è½¯å¼•ç”¨ï¼šå†…å­˜ä¸è¶³æ—¶ä¼šè¢«å›æ”¶</li><li>å¼±å¼•ç”¨ï¼šgc æ—¶ä¼šè¢«å›æ”¶</li><li>è™šå¼•ç”¨ï¼šæ— æ³•é€šè¿‡è™šå¼•ç”¨å¾—åˆ°å¯¹è±¡ï¼Œå¯ä»¥ç›‘å¬å¯¹è±¡çš„å›æ”¶</li></ul><h4 id="ClassLoader"><a href="#ClassLoader" class="headerlink" title="ClassLoader"></a><strong>ClassLoader</strong></h4><p>ç±»çš„ç”Ÿå‘½å‘¨æœŸï¼š<br>1.åŠ è½½ï¼›2.éªŒè¯ï¼›3.å‡†å¤‡ï¼›4.è§£æï¼›5.åˆå§‹åŒ–ï¼›6.ä½¿ç”¨ï¼›7.å¸è½½</p><p>ç±»åŠ è½½è¿‡ç¨‹ï¼š</p><p>1.åŠ è½½ï¼šè·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼›ç”Ÿæˆæ–¹æ³•åŒºçš„è¿è¡Œæ—¶å­˜å‚¨ç»“æ„ï¼›åœ¨å†…å­˜ä¸­ç”Ÿæˆ Class å¯¹è±¡<br>2.éªŒè¯ï¼šç¡®ä¿è¯¥ Class å­—èŠ‚æµç¬¦åˆè™šæ‹Ÿæœºè¦æ±‚<br>3.å‡†å¤‡ï¼šåˆå§‹åŒ–é™æ€å˜é‡<br>4.è§£æï¼šå°†å¸¸é‡æ± çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨<br>5.åˆå§‹åŒ–ï¼šæ‰§è¡Œé™æ€å—ä»£ç ã€ç±»å˜é‡èµ‹å€¼</p><p>ç±»åŠ è½½æ—¶æœºï¼š</p><p>1.å®ä¾‹åŒ–å¯¹è±¡<br>2.è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•<br>3.è°ƒç”¨ç±»çš„é™æ€å˜é‡ï¼ˆæ”¾å…¥å¸¸é‡æ± çš„å¸¸é‡é™¤å¤–ï¼‰</p><p>ç±»åŠ è½½å™¨ï¼šè´Ÿè´£åŠ è½½ class æ–‡ä»¶</p><p>åˆ†ç±»ï¼š</p><p>1.å¼•å¯¼ç±»åŠ è½½å™¨ - æ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨<br>2.æ‹“å±•ç±»åŠ è½½å™¨ - ç»§æ‰¿è‡ªå¼•å¯¼ç±»åŠ è½½å™¨<br>3.ç³»ç»Ÿç±»åŠ è½½å™¨ - ç»§æ‰¿è‡ªæ‹“å±•ç±»åŠ è½½å™¨</p><p><strong>åŒäº²å§”æ‰˜æ¨¡å‹ï¼š</strong></p><p>å½“è¦åŠ è½½ä¸€ä¸ª class æ—¶ï¼Œä¼šå…ˆé€å±‚å‘ä¸Šè®©çˆ¶åŠ è½½å™¨å…ˆåŠ è½½ï¼ŒåŠ è½½å¤±è´¥æ‰ä¼šè‡ªå·±åŠ è½½</p><p>ä¸ºä»€ä¹ˆå«åŒäº²ï¼Ÿä¸è€ƒè™‘è‡ªå®šä¹‰åŠ è½½å™¨ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨éœ€è¦ç½‘ä¸Šè¯¢é—®ä¸¤å±‚ï¼Œæ‰€ä»¥å«åŒäº²</p><p>åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªç±»æ—¶ï¼Œé™¤äº†ç±»ä¿¡æ¯ï¼Œè¿˜å¿…é¡»æ—¶åŒä¸€ä¸ªç±»åŠ è½½å™¨</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>é˜²æ­¢é‡å¤åŠ è½½ï¼Œçˆ¶åŠ è½½å™¨åŠ è½½è¿‡äº†å°±æ²¡å¿…è¦åŠ è½½äº†</li><li>å®‰å…¨ï¼Œé˜²æ­¢ç¯¡æ”¹æ ¸å¿ƒåº“ç±»</li></ul><h4 id="åŠ¨æ€ä»£ç†åŸç†åŠå®ç°"><a href="#åŠ¨æ€ä»£ç†åŸç†åŠå®ç°" class="headerlink" title="åŠ¨æ€ä»£ç†åŸç†åŠå®ç°"></a><strong>åŠ¨æ€ä»£ç†åŸç†åŠå®ç°</strong></h4><ul><li>InvocationHandler æ¥å£ï¼ŒåŠ¨æ€ä»£ç†ç±»éœ€è¦å®ç°è¿™ä¸ªæ¥å£</li><li>Proxy.newProxyInstanceï¼Œç”¨äºåŠ¨æ€åˆ›å»ºä»£ç†å¯¹è±¡</li><li>Retrofit åº”ç”¨ï¼š Retrofit é€šè¿‡åŠ¨æ€ä»£ç†ï¼Œä¸ºæˆ‘ä»¬å®šä¹‰çš„è¯·æ±‚æ¥å£éƒ½ç”Ÿæˆä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œå®ç°è¯·æ±‚</li></ul><h3 id="Android-åŸºç¡€-amp-æ€§èƒ½ä¼˜åŒ–-amp-Framwork"><a href="#Android-åŸºç¡€-amp-æ€§èƒ½ä¼˜åŒ–-amp-Framwork" class="headerlink" title="Android åŸºç¡€&amp;æ€§èƒ½ä¼˜åŒ–&amp;Framwork"></a>Android åŸºç¡€&amp;æ€§èƒ½ä¼˜åŒ–&amp;Framwork</h3><h4 id="Activity-å¯åŠ¨æ¨¡å¼"><a href="#Activity-å¯åŠ¨æ¨¡å¼" class="headerlink" title="Activity å¯åŠ¨æ¨¡å¼"></a><strong>Activity å¯åŠ¨æ¨¡å¼</strong></h4><ul><li>standard æ ‡å‡†æ¨¡å¼</li><li>singleTop æ ˆé¡¶å¤ç”¨æ¨¡å¼ï¼Œ<br>* æ¨é€ç‚¹å‡»æ¶ˆæ¯ç•Œé¢</li><li>singleTask æ ˆå†…å¤ç”¨æ¨¡å¼ï¼Œ<br>* é¦–é¡µ</li><li>singleInstance å•ä¾‹æ¨¡å¼ï¼Œå•ç‹¬ä½äºä¸€ä¸ªä»»åŠ¡æ ˆä¸­<br>* æ‹¨æ‰“ç”µè¯ç•Œé¢<br>ç»†èŠ‚ï¼š<br>* taskAffinityï¼šä»»åŠ¡ç›¸å…³æ€§ï¼Œç”¨äºæŒ‡å®šä»»åŠ¡æ ˆåç§°ï¼Œé»˜è®¤ä¸ºåº”ç”¨åŒ…å<br>* allowTaskReparentingï¼šå…è®¸è½¬ç§»ä»»åŠ¡æ ˆ</li></ul><h4 id="View-å·¥ä½œåŸç†"><a href="#View-å·¥ä½œåŸç†" class="headerlink" title="View å·¥ä½œåŸç†"></a><strong>View å·¥ä½œåŸç†</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* DecorView (FrameLayout)</span><br><span class="line">   * LinearLayout</span><br><span class="line">       * titlebar</span><br><span class="line">       * Content</span><br><span class="line">       * è°ƒç”¨ setContentView è®¾ç½®çš„ View</span><br></pre></td></tr></table></figure><p>ViewRoot çš„ performTraversals æ–¹æ³•è°ƒç”¨è§¦å‘å¼€å§‹ View çš„ç»˜åˆ¶ï¼Œç„¶åä¼šä¾æ¬¡è°ƒç”¨:</p><ul><li>performMeasureï¼šéå† View çš„ measure æµ‹é‡å°ºå¯¸</li><li>performLayoutï¼šéå† View çš„ layout ç¡®å®šä½ç½®</li><li>performDrawï¼šéå† View çš„ draw ç»˜åˆ¶</li></ul><p>#### </p><h4 id="äº‹ä»¶åˆ†å‘æœºåˆ¶"><a href="#äº‹ä»¶åˆ†å‘æœºåˆ¶" class="headerlink" title="äº‹ä»¶åˆ†å‘æœºåˆ¶"></a><strong>äº‹ä»¶åˆ†å‘æœºåˆ¶</strong></h4><ul><li>ä¸€ä¸ª MotionEvent äº§ç”Ÿåï¼ŒæŒ‰ Activity -&gt; Window -&gt; decorView -&gt; View é¡ºåºä¼ é€’ï¼ŒView ä¼ é€’è¿‡ç¨‹å°±æ˜¯äº‹ä»¶åˆ†å‘ï¼Œä¸»è¦ä¾èµ–ä¸‰ä¸ªæ–¹æ³•:</li><li>dispatchTouchEventï¼šç”¨äºåˆ†å‘äº‹ä»¶ï¼Œåªè¦æ¥å—åˆ°ç‚¹å‡»äº‹ä»¶å°±ä¼šè¢«è°ƒç”¨ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ¶ˆè€—äº†å½“å‰äº‹ä»¶</li><li>onInterceptTouchEventï¼šç”¨äºåˆ¤æ–­æ˜¯å¦æ‹¦æˆªäº‹ä»¶ï¼Œå½“ ViewGroup ç¡®å®šè¦æ‹¦æˆªäº‹ä»¶åï¼Œè¯¥äº‹ä»¶åºåˆ—éƒ½ä¸ä¼šå†è§¦å‘è°ƒç”¨æ­¤ ViewGroup çš„ onIntercept</li><li>onTouchEventï¼šç”¨äºå¤„ç†äº‹ä»¶ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦å¤„ç†äº†å½“å‰äº‹ä»¶ï¼Œæœªå¤„ç†åˆ™ä¼ é€’ç»™çˆ¶å®¹å™¨å¤„ç†</li><li>ç»†èŠ‚ï¼š<ul><li>ä¸€ä¸ªäº‹ä»¶åºåˆ—åªèƒ½è¢«ä¸€ä¸ª View æ‹¦æˆªä¸”æ¶ˆè€—</li><li>View æ²¡æœ‰ onIntercept æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨ onTouchEvent å¤„ç†</li><li>OnTouchListener ä¼˜å…ˆçº§æ¯” OnTouchEvent é«˜ï¼ŒonClickListener ä¼˜å…ˆçº§æœ€ä½</li><li>requestDisallowInterceptTouchEvent å¯ä»¥å±è”½çˆ¶å®¹å™¨ onIntercet æ–¹æ³•çš„è°ƒç”¨</li></ul></li></ul><h4 id="-1"><a href="#-1" class="headerlink" title=" "></a> </h4><h4 id="Window-ã€-WindowManagerã€WMSã€SurfaceFlinger"><a href="#Window-ã€-WindowManagerã€WMSã€SurfaceFlinger" class="headerlink" title="Window ã€ WindowManagerã€WMSã€SurfaceFlinger"></a><strong>Window ã€ WindowManagerã€WMSã€SurfaceFlinger</strong></h4><ul><li>Windowï¼šæŠ½è±¡æ¦‚å¿µä¸æ˜¯å®é™…å­˜åœ¨çš„ï¼Œè€Œæ˜¯ä»¥ View çš„å½¢å¼å­˜åœ¨ï¼Œé€šè¿‡ PhoneWindow å®ç°</li><li>WindowManagerï¼šå¤–ç•Œè®¿é—® Window çš„å…¥å£ï¼Œå†…éƒ¨ä¸ WMS äº¤äº’æ˜¯ä¸ª IPC è¿‡ç¨‹</li><li>WMSï¼šç®¡ç†çª—å£ Surface çš„å¸ƒå±€å’Œæ¬¡åºï¼Œä½œä¸ºç³»ç»Ÿçº§æœåŠ¡å•ç‹¬è¿è¡Œåœ¨ä¸€ä¸ªè¿›ç¨‹</li><li>SurfaceFlingerï¼šå°† WMS ç»´æŠ¤çš„çª—å£æŒ‰ä¸€å®šæ¬¡åºæ··åˆåæ˜¾ç¤ºåˆ°å±å¹•ä¸Š</li></ul><h4 id="-2"><a href="#-2" class="headerlink" title=" "></a> </h4><h4 id="View-åŠ¨ç”»ã€å¸§åŠ¨ç”»åŠå±æ€§åŠ¨ç”»"><a href="#View-åŠ¨ç”»ã€å¸§åŠ¨ç”»åŠå±æ€§åŠ¨ç”»" class="headerlink" title="View åŠ¨ç”»ã€å¸§åŠ¨ç”»åŠå±æ€§åŠ¨ç”»"></a><strong>View åŠ¨ç”»ã€å¸§åŠ¨ç”»åŠå±æ€§åŠ¨ç”»</strong></h4><p>View åŠ¨ç”»ï¼š</p><p>* ä½œç”¨å¯¹è±¡æ˜¯ Viewï¼Œå¯ç”¨ xml å®šä¹‰ï¼Œå»ºè®® xml å®ç°æ¯”è¾ƒæ˜“è¯»<br>* æ”¯æŒå››ç§æ•ˆæœï¼šå¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬ã€é€æ˜åº¦</p><p>å¸§åŠ¨ç”»ï¼š</p><p>* é€šè¿‡ AnimationDrawable å®ç°ï¼Œå®¹æ˜“ OOM</p><p>å±æ€§åŠ¨ç”»ï¼š</p><ul><li>å¯ä½œç”¨äºä»»ä½•å¯¹è±¡ï¼Œå¯ç”¨ xml å®šä¹‰ï¼ŒAndroid 3 å¼•å…¥ï¼Œå»ºè®®ä»£ç å®ç°æ¯”è¾ƒçµæ´»</li><li>åŒ…æ‹¬ ObjectAnimatorã€ValuetAnimatorã€AnimatorSet</li><li>æ—¶é—´æ’å€¼å™¨ï¼šæ ¹æ®æ—¶é—´æµé€çš„ç™¾åˆ†æ¯”è®¡ç®—å½“å‰å±æ€§æ”¹å˜çš„ç™¾åˆ†æ¯”</li><li>ç³»ç»Ÿé¢„ç½®åŒ€é€Ÿã€åŠ é€Ÿã€å‡é€Ÿç­‰æ’å€¼å™¨</li><li>ç±»å‹ä¼°å€¼å™¨ï¼šæ ¹æ®å½“å‰å±æ€§æ”¹å˜çš„ç™¾åˆ†æ¯”è®¡ç®—æ”¹å˜åçš„å±æ€§å€¼</li><li>ç³»ç»Ÿé¢„ç½®æ•´å‹ã€æµ®ç‚¹ã€è‰²å€¼ç­‰ç±»å‹ä¼°å€¼å™¨</li><li>ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼š</li><li>é¿å…ä½¿ç”¨å¸§åŠ¨ç”»ï¼Œå®¹æ˜“OOM</li><li>ç•Œé¢é”€æ¯æ—¶åœæ­¢åŠ¨ç”»ï¼Œé¿å…å†…å­˜æ³„æ¼</li><li>å¼€å¯ç¡¬ä»¶åŠ é€Ÿï¼Œæé«˜åŠ¨ç”»æµç•…æ€§ ï¼Œç¡¬ä»¶åŠ é€Ÿï¼š</li><li>å°† cpu ä¸€éƒ¨åˆ†å·¥ä½œåˆ†æ‹…ç»™ gpu ï¼Œä½¿ç”¨ gpu å®Œæˆç»˜åˆ¶å·¥ä½œ</li><li>ä»å·¥ä½œåˆ†æ‘Šå’Œç»˜åˆ¶æœºåˆ¶ä¸¤ä¸ªæ–¹é¢ä¼˜åŒ–äº†ç»˜åˆ¶é€Ÿåº¦</li></ul><h4 id="Handlerã€MessageQueueã€Looper"><a href="#Handlerã€MessageQueueã€Looper" class="headerlink" title="Handlerã€MessageQueueã€Looper"></a><strong>Handlerã€MessageQueueã€Looper</strong></h4><ul><li>Handlerï¼šå¼€å‘ç›´æ¥æ¥è§¦çš„ç±»ï¼Œå†…éƒ¨æŒæœ‰ MessageQueue å’Œ Looper</li><li>MessageQueueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå†…éƒ¨é€šè¿‡å•é“¾è¡¨å­˜å‚¨æ¶ˆæ¯</li><li>Looperï¼šå†…éƒ¨æŒæœ‰ MessageQueueï¼Œå¾ªç¯æŸ¥çœ‹æ˜¯å¦æœ‰æ–°æ¶ˆæ¯ï¼Œæœ‰å°±å¤„ç†ï¼Œæ²¡å°±é˜»å¡</li><li>å¦‚ä½•å®ç°é˜»å¡ï¼šé€šè¿‡ nativePollOnce æ–¹æ³•ï¼ŒåŸºäº Linux epoll äº‹ä»¶ç®¡ç†æœºåˆ¶</li><li>ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹ä¸ä¼šå› ä¸º Looper é˜»å¡ï¼šç³»ç»Ÿæ¯ 16ms ä¼šå‘é€ä¸€ä¸ªåˆ·æ–° UI æ¶ˆæ¯å”¤é†’</li></ul><h4 id="-3"><a href="#-3" class="headerlink" title=" "></a> </h4><h4 id="MVCã€MVPã€MVVM"><a href="#MVCã€MVPã€MVVM" class="headerlink" title="MVCã€MVPã€MVVM"></a><strong>MVCã€MVPã€MVVM</strong></h4><ul><li>MVPï¼šModelï¼šå¤„ç†æ•°æ®ï¼›Viewï¼šæ§åˆ¶è§†å›¾ï¼›Presenterï¼šåˆ†ç¦» Activity å’Œ Model</li><li>MVVMï¼šModelï¼šå¤„ç†è·å–ä¿å­˜æ•°æ®ï¼›Viewï¼šæ§åˆ¶è§†å›¾ï¼›ViewModelï¼šæ•°æ®å®¹å™¨<br>* ä½¿ç”¨ Jetpack ç»„ä»¶æ¶æ„çš„ LiveDataã€ViewModel ä¾¿æ·å®ç° MVVM</li></ul><h4 id="-4"><a href="#-4" class="headerlink" title=" "></a> </h4><h4 id="Serializableã€Parcelable"><a href="#Serializableã€Parcelable" class="headerlink" title="Serializableã€Parcelable"></a><strong>Serializableã€Parcelable</strong></h4><ul><li>Serializable ï¼šJava åºåˆ—åŒ–æ–¹å¼ï¼Œé€‚ç”¨äºå­˜å‚¨å’Œç½‘ç»œä¼ è¾“ï¼ŒserialVersionUID ç”¨äºç¡®å®šååºåˆ—åŒ–å’Œç±»ç‰ˆæœ¬æ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´æ—¶ååºåˆ—åŒ–å›å¤±è´¥</li><li>Parcelable ï¼šAndroid åºåˆ—åŒ–æ–¹å¼ï¼Œé€‚ç”¨äºç»„ä»¶é€šä¿¡æ•°æ®ä¼ é€’ï¼Œæ€§èƒ½é«˜ï¼Œå› ä¸ºä¸åƒ Serializable ä¸€æ ·æœ‰å¤§é‡åå°„æ“ä½œï¼Œé¢‘ç¹ GC</li></ul><h4 id="-5"><a href="#-5" class="headerlink" title=" "></a> </h4><h4 id="Binder"><a href="#Binder" class="headerlink" title="Binder"></a><strong>Binder</strong></h4><ul><li>Android è¿›ç¨‹é—´é€šä¿¡çš„ä¸­æµç ¥æŸ±ï¼ŒåŸºäºå®¢æˆ·ç«¯-æœåŠ¡ç«¯é€šä¿¡æ–¹å¼</li><li>ä½¿ç”¨ mmap ä¸€æ¬¡æ•°æ®æ‹·è´å®ç° IPCï¼Œä¼ ç»Ÿ IPCï¼šç”¨æˆ·Aç©ºé—´-&gt;å†…æ ¸-&gt;ç”¨æˆ·Bç©ºé—´ï¼›mmap å°†å†…æ ¸ä¸ç”¨æˆ·Bç©ºé—´æ˜ å°„ï¼Œå®ç°ç›´æ¥ä»ç”¨æˆ·Aç©ºé—´-&gt;ç”¨æˆ·Bç©ºé—´</li><li>BinderPool å¯é¿å…åˆ›å»ºå¤š Service</li></ul><h4 id="-6"><a href="#-6" class="headerlink" title=" "></a> </h4><h4 id="IPC-æ–¹å¼"><a href="#IPC-æ–¹å¼" class="headerlink" title="IPC æ–¹å¼"></a><strong>IPC æ–¹å¼</strong></h4><ul><li>Intent extrasã€Bundleï¼šè¦æ±‚ä¼ é€’æ•°æ®èƒ½è¢«åºåˆ—åŒ–ï¼Œå®ç° Parcelableã€Serializable ï¼Œé€‚ç”¨äºå››å¤§ç»„ä»¶é€šä¿¡</li><li>æ–‡ä»¶å…±äº«ï¼šé€‚ç”¨äºäº¤æ¢ç®€å•çš„æ•°æ®å®æ—¶æ€§ä¸é«˜çš„åœºæ™¯</li><li>AIDLï¼šAIDL æ¥å£å®è´¨ä¸Šæ˜¯ç³»ç»Ÿæä¾›ç»™æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿å®ç° BInder çš„å·¥å…·<ul><li>Android Interface Definition Languageï¼Œå¯å®ç°è·¨è¿›ç¨‹è°ƒç”¨æ–¹æ³•</li><li>æœåŠ¡ç«¯ï¼šå°†æš´æ¼ç»™å®¢æˆ·ç«¯çš„æ¥å£å£°æ˜åœ¨ AIDL æ–‡ä»¶ä¸­ï¼Œåˆ›å»º Service å®ç° AIDL æ¥å£å¹¶ç›‘å¬å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚</li><li>å®¢æˆ·ç«¯ï¼šç»‘å®šæœåŠ¡ç«¯ Service ï¼Œç»‘å®šæˆåŠŸåæ‹¿åˆ°æœåŠ¡ç«¯ Binder å¯¹è±¡è½¬ä¸º AIDL æ¥å£è°ƒç”¨</li><li>RemoteCallbackList å®ç°è·¨è¿›ç¨‹æ¥å£ç›‘å¬ï¼ŒåŒä¸ª Binder å¯¹è±¡åš key å­˜å‚¨å®¢æˆ·ç«¯æ³¨å†Œçš„ listener</li><li>ç›‘å¬ Binder æ–­å¼€ï¼š1.Binder.linkToDeath è®¾ç½®æ­»äº¡ä»£ç†ï¼›2. onServiceDisconnected å›è°ƒ</li></ul></li><li>Messengerï¼šåŸºäº AIDL å®ç°ï¼ŒæœåŠ¡ç«¯ä¸²è¡Œå¤„ç†ï¼Œä¸»è¦ç”¨äºä¼ é€’æ¶ˆæ¯ï¼Œé€‚ç”¨äºä½å¹¶å‘ä¸€å¯¹å¤šé€šä¿¡</li><li>ContentProviderï¼šåŸºäº Binder å®ç°ï¼Œé€‚ç”¨äºä¸€å¯¹å¤šè¿›ç¨‹é—´æ•°æ®å…±äº«</li><li>Socketï¼šTCPã€UDPï¼Œé€‚ç”¨äºç½‘ç»œæ•°æ®äº¤æ¢</li></ul><h4 id="-7"><a href="#-7" class="headerlink" title=" "></a> </h4><h4 id="Android-ç³»ç»Ÿå¯åŠ¨æµç¨‹"><a href="#Android-ç³»ç»Ÿå¯åŠ¨æµç¨‹" class="headerlink" title="Android ç³»ç»Ÿå¯åŠ¨æµç¨‹"></a><strong>Android ç³»ç»Ÿå¯åŠ¨æµç¨‹</strong></h4><ul><li>æŒ‰ç”µæºé”® -&gt; åŠ è½½å¼•å¯¼ç¨‹åº BootLoader åˆ° RAM -&gt; æ‰§è¡Œ BootLoader ç¨‹åºå¯åŠ¨å†…æ ¸ -&gt; å¯åŠ¨ init è¿›ç¨‹ -&gt; å¯åŠ¨ Zygote å’Œå„ç§å®ˆæŠ¤è¿›ç¨‹ -&gt;</li><li>å¯åŠ¨  System Server æœåŠ¡è¿›ç¨‹å¼€å¯ AMSã€WMS ç­‰ -&gt; å¯åŠ¨ Launcher åº”ç”¨è¿›ç¨‹</li></ul><p>#### </p><h4 id="App-å¯åŠ¨æµç¨‹"><a href="#App-å¯åŠ¨æµç¨‹" class="headerlink" title="App å¯åŠ¨æµç¨‹"></a><strong>App å¯åŠ¨æµç¨‹</strong></h4><ul><li>Launcher ä¸­ç‚¹å‡»ä¸€ä¸ªåº”ç”¨å›¾æ ‡ -&gt; é€šè¿‡ AMS æŸ¥æ‰¾åº”ç”¨è¿›ç¨‹ï¼Œè‹¥ä¸å­˜åœ¨å°±é€šè¿‡ Zygote è¿›ç¨‹ fork</li></ul><h4 id="-8"><a href="#-8" class="headerlink" title=" "></a> </h4><h4 id="è¿›ç¨‹ä¿æ´»"><a href="#è¿›ç¨‹ä¿æ´»" class="headerlink" title="è¿›ç¨‹ä¿æ´»"></a><strong>è¿›ç¨‹ä¿æ´»</strong></h4><ul><li>è¿›ç¨‹ä¼˜å…ˆçº§ï¼š1.å‰å°è¿›ç¨‹ ï¼›2.å¯è§è¿›ç¨‹ï¼›3.æœåŠ¡è¿›ç¨‹ï¼›4.åå°è¿›ç¨‹ï¼›5.ç©ºè¿›ç¨‹</li><li>è¿›ç¨‹è¢« kill åœºæ™¯ï¼š1.åˆ‡åˆ°åå°å†…å­˜ä¸è¶³æ—¶è¢«æ€ï¼›2.åˆ‡åˆ°åå°å‚å•†çœç”µæœºåˆ¶æ€æ­»ï¼›3.ç”¨æˆ·ä¸»åŠ¨æ¸…ç†</li><li>ä¿æ´»æ–¹å¼ï¼š<ul><li>1.Activity ææƒï¼šæŒ‚ä¸€ä¸ª 1åƒç´  Activity å°†è¿›ç¨‹ä¼˜å…ˆçº§æé«˜åˆ°å‰å°è¿›ç¨‹</li><li>2.Service ææƒï¼šå¯åŠ¨ä¸€ä¸ªå‰å°æœåŠ¡ï¼ˆAPI&gt;18ä¼šæœ‰æ­£åœ¨è¿è¡Œé€šçŸ¥æ ï¼‰</li><li>3.å¹¿æ’­æ‹‰æ´»</li><li>4.Service æ‹‰æ´»</li><li>5.JobScheduler å®šæ—¶ä»»åŠ¡æ‹‰æ´»</li><li>6.åŒè¿›ç¨‹æ‹‰æ´»</li></ul></li></ul><h4 id="-9"><a href="#-9" class="headerlink" title=" "></a> </h4><h4 id="ç½‘ç»œä¼˜åŒ–åŠæ£€æµ‹"><a href="#ç½‘ç»œä¼˜åŒ–åŠæ£€æµ‹" class="headerlink" title="ç½‘ç»œä¼˜åŒ–åŠæ£€æµ‹"></a><strong>ç½‘ç»œä¼˜åŒ–åŠæ£€æµ‹</strong></h4><ul><li>é€Ÿåº¦ï¼š1.GZIP å‹ç¼©ï¼ˆokhttp è‡ªåŠ¨æ”¯æŒï¼‰ï¼›2.Protocol Buffer æ›¿ä»£ jsonï¼›3.ä¼˜åŒ–å›¾ç‰‡/æ–‡ä»¶æµé‡ï¼›4.IP ç›´è¿çœå» DNS è§£ææ—¶é—´</li><li>æˆåŠŸç‡ï¼š1.å¤±è´¥é‡è¯•ç­–ç•¥ï¼›</li><li>æµé‡ï¼š1.GZIP å‹ç¼©ï¼ˆokhttp è‡ªåŠ¨æ”¯æŒï¼‰ï¼›2.Protocol Buffer æ›¿ä»£ jsonï¼›3.ä¼˜åŒ–å›¾ç‰‡/æ–‡ä»¶æµé‡ï¼›5.æ–‡ä»¶ä¸‹è½½æ–­ç‚¹ç»­ä¼  ï¼›6.ç¼“å­˜</li><li>åè®®å±‚çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚æ›´ä¼˜çš„ http ç‰ˆæœ¬ç­‰</li><li>ç›‘æ§ï¼šCharles æŠ“åŒ…ã€Network Monitor ç›‘æ§æµé‡</li></ul><h4 id="-10"><a href="#-10" class="headerlink" title=" "></a> </h4><h4 id="UIå¡é¡¿ä¼˜åŒ–"><a href="#UIå¡é¡¿ä¼˜åŒ–" class="headerlink" title="UIå¡é¡¿ä¼˜åŒ–"></a><strong>UIå¡é¡¿ä¼˜åŒ–</strong></h4><ul><li>å‡å°‘å¸ƒå±€å±‚çº§åŠæ§ä»¶å¤æ‚åº¦ï¼Œé¿å…è¿‡åº¦ç»˜åˆ¶</li><li>ä½¿ç”¨ includeã€mergeã€viewstub</li><li>ä¼˜åŒ–ç»˜åˆ¶è¿‡ç¨‹ï¼Œé¿å…åœ¨ Draw ä¸­é¢‘ç¹åˆ›å»ºå¯¹è±¡ã€åšè€—æ—¶æ“ä½œ</li></ul><h4 id="-11"><a href="#-11" class="headerlink" title=" "></a> </h4><h4 id="å†…å­˜æ³„æ¼åœºæ™¯åŠè§„é¿"><a href="#å†…å­˜æ³„æ¼åœºæ™¯åŠè§„é¿" class="headerlink" title="å†…å­˜æ³„æ¼åœºæ™¯åŠè§„é¿"></a><strong>å†…å­˜æ³„æ¼åœºæ™¯åŠè§„é¿</strong></h4><ul><li>1.é™æ€å˜é‡ã€å•ä¾‹å¼ºå¼•è·Ÿç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ•°æ®æˆ–èµ„æºï¼ŒåŒ…æ‹¬ EventBus</li><li>2.æ¸¸æ ‡ã€IO æµç­‰èµ„æºå¿˜è®°ä¸»åŠ¨é‡Šæ”¾</li><li>3.ç•Œé¢ç›¸å…³åŠ¨ç”»åœ¨ç•Œé¢é”€æ¯æ—¶åŠæ—¶æš‚åœ</li><li>4.å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„æ¼<br>* handler å†…éƒ¨ç±»å†…å­˜æ³„æ¼è§„é¿ï¼š1.ä½¿ç”¨é™æ€å†…éƒ¨ç±»+å¼±å¼•ç”¨ 2.ç•Œé¢é”€æ¯æ—¶æ¸…ç©ºæ¶ˆæ¯é˜Ÿåˆ—<br>* æ£€æµ‹ï¼šAndroid Studio Profiler</li></ul><h4 id="-12"><a href="#-12" class="headerlink" title=" "></a> </h4><h4 id="LeakCanary-åŸç†"><a href="#LeakCanary-åŸç†" class="headerlink" title="LeakCanary åŸç†"></a><strong>LeakCanary åŸç†</strong></h4><ul><li>é€šè¿‡å¼±å¼•ç”¨å’Œå¼•ç”¨é˜Ÿåˆ—ç›‘æ§å¯¹è±¡æ˜¯å¦è¢«å›æ”¶</li><li>æ¯”å¦‚ Activity é”€æ¯æ—¶å¼€å§‹ç›‘æ§æ­¤å¯¹è±¡ï¼Œæ£€æµ‹åˆ°æœªè¢«å›æ”¶åˆ™ä¸»åŠ¨ gc ï¼Œç„¶åç»§ç»­ç›‘æ§</li></ul><h4 id="-13"><a href="#-13" class="headerlink" title=" "></a> </h4><h4 id="OOM-åœºæ™¯åŠè§„é¿"><a href="#OOM-åœºæ™¯åŠè§„é¿" class="headerlink" title="OOM åœºæ™¯åŠè§„é¿"></a><strong>OOM åœºæ™¯åŠè§„é¿</strong></h4><ul><li>åŠ è½½å¤§å›¾ï¼šå‡å°å›¾ç‰‡</li><li>å†…å­˜æ³„æ¼ï¼šè§„é¿å†…å­˜æ³„æ¼</li></ul><h3 id="Android-æ¨¡å—åŒ–-amp-çƒ­ä¿®å¤-amp-çƒ­æ›´æ–°-amp-æ‰“åŒ…-amp-æ··æ·†-amp-å‹ç¼©"><a href="#Android-æ¨¡å—åŒ–-amp-çƒ­ä¿®å¤-amp-çƒ­æ›´æ–°-amp-æ‰“åŒ…-amp-æ··æ·†-amp-å‹ç¼©" class="headerlink" title="Android æ¨¡å—åŒ–&amp;çƒ­ä¿®å¤&amp;çƒ­æ›´æ–°&amp;æ‰“åŒ…&amp;æ··æ·†&amp;å‹ç¼©"></a>Android æ¨¡å—åŒ–&amp;çƒ­ä¿®å¤&amp;çƒ­æ›´æ–°&amp;æ‰“åŒ…&amp;æ··æ·†&amp;å‹ç¼©</h3><h4 id="Dalvik-å’Œ-ART"><a href="#Dalvik-å’Œ-ART" class="headerlink" title="Dalvik å’Œ ART"></a><strong>Dalvik å’Œ ART</strong></h4><ul><li>Dalvik<br>* è°·æ­Œè®¾è®¡ä¸“ç”¨äº Android å¹³å°çš„ Java è™šæ‹Ÿæœºï¼Œå¯ç›´æ¥è¿è¡Œ .dex æ–‡ä»¶ï¼Œé€‚åˆå†…å­˜å’Œå¤„ç†é€Ÿåº¦æœ‰é™çš„ç³»ç»Ÿ<br>* JVM æŒ‡ä»¤é›†æ˜¯åŸºäºæ ˆçš„ï¼›Dalvik æŒ‡ä»¤é›†æ˜¯åŸºäºå¯„å­˜å™¨çš„ï¼Œä»£ç æ‰§è¡Œæ•ˆç‡æ›´ä¼˜</li><li>ART<br>* Dalvik æ¯æ¬¡è¿è¡Œéƒ½è¦å°†å­—èŠ‚ç è½¬æ¢æˆæœºå™¨ç ï¼›ART åœ¨åº”ç”¨å®‰è£…æ—¶å°±ä¼šè½¬æ¢æˆæœºå™¨ç ï¼Œæ‰§è¡Œé€Ÿåº¦æ›´å¿«<br>* ART å­˜å‚¨æœºå™¨ç å ç”¨ç©ºé—´æ›´å¤§ï¼Œç©ºé—´æ¢æ—¶é—´</li></ul><h4 id="-14"><a href="#-14" class="headerlink" title=" "></a> </h4><h4 id="APK-æ‰“åŒ…æµç¨‹"><a href="#APK-æ‰“åŒ…æµç¨‹" class="headerlink" title="APK æ‰“åŒ…æµç¨‹"></a><strong>APK æ‰“åŒ…æµç¨‹</strong></h4><ul><li>1.aapt æ‰“åŒ…èµ„æºæ–‡ä»¶ç”Ÿæˆ R.java æ–‡ä»¶ï¼›aidl ç”Ÿæˆ java æ–‡ä»¶</li><li>2.å°† java æ–‡ä»¶ç¼–è¯‘ä¸º class æ–‡ä»¶</li><li>3.å°†å·¥ç¨‹åŠç¬¬ä¸‰æ–¹çš„ class æ–‡ä»¶è½¬æ¢æˆ dex æ–‡ä»¶</li><li>4.å°† dex æ–‡ä»¶ã€soã€ç¼–è¯‘è¿‡çš„èµ„æºã€åŸå§‹èµ„æºç­‰æ‰“åŒ…æˆ apk æ–‡ä»¶</li><li>5.ç­¾å</li><li>6.èµ„æºæ–‡ä»¶å¯¹é½ï¼Œå‡å°‘è¿è¡Œæ—¶å†…å­˜</li></ul><h4 id="-15"><a href="#-15" class="headerlink" title=" "></a> </h4><h4 id="App-å®‰è£…è¿‡ç¨‹"><a href="#App-å®‰è£…è¿‡ç¨‹" class="headerlink" title="App å®‰è£…è¿‡ç¨‹"></a><strong>App å®‰è£…è¿‡ç¨‹</strong></h4><ul><li>é¦–å…ˆè¦è§£å‹ APKï¼Œèµ„æºã€soç­‰æ”¾åˆ°åº”ç”¨ç›®å½•</li><li>Dalvik ä¼šå°† dex å¤„ç†æˆ ODEX ï¼›ART ä¼šå°† dex å¤„ç†æˆ OATï¼›</li><li>OAT åŒ…å« dex å’Œå®‰è£…æ—¶ç¼–è¯‘çš„æœºå™¨ç </li></ul><p>#### </p><h4 id="ç»„ä»¶åŒ–è·¯ç”±å®ç°"><a href="#ç»„ä»¶åŒ–è·¯ç”±å®ç°" class="headerlink" title="ç»„ä»¶åŒ–è·¯ç”±å®ç°"></a><strong>ç»„ä»¶åŒ–è·¯ç”±å®ç°</strong></h4><ul><li>ARouteï¼šé€šè¿‡ APT è§£æ @Route ç­‰æ³¨è§£ï¼Œç»“åˆ JavaPoet ç”Ÿæˆè·¯ç”±è¡¨ï¼Œå³è·¯ç”±ä¸ Activity çš„æ˜ å°„å…³ç³»</li></ul><h3 id="éŸ³è§†é¢‘-amp-FFmpeg-amp-æ’­æ”¾å™¨"><a href="#éŸ³è§†é¢‘-amp-FFmpeg-amp-æ’­æ”¾å™¨" class="headerlink" title="éŸ³è§†é¢‘&amp;FFmpeg&amp;æ’­æ”¾å™¨"></a>éŸ³è§†é¢‘&amp;FFmpeg&amp;æ’­æ”¾å™¨</h3><h4 id="FFmpeg"><a href="#FFmpeg" class="headerlink" title="FFmpeg"></a><strong>FFmpeg</strong></h4><p>åŸºäºå‘½ä»¤æ–¹å¼å®ç°äº†ä¸€ä¸ªéŸ³è§†é¢‘ç¼–è¾‘ Appï¼š</p><p><em><a href="https://github.com/yhaolpz/FFmpegCmd" target="_blank" rel="noopener">https://github.com/yhaolpz/FFmpegCmd</a></em></p><p>é›†æˆç¼–è¯‘äº† AACã€MP3ã€H264 ç¼–ç å™¨</p><h4 id="-16"><a href="#-16" class="headerlink" title=" "></a> </h4><h4 id="æ’­æ”¾å™¨åŸç†"><a href="#æ’­æ”¾å™¨åŸç†" class="headerlink" title="æ’­æ”¾å™¨åŸç†"></a><strong>æ’­æ”¾å™¨åŸç†</strong></h4><ul><li>è§†é¢‘æ’­æ”¾åŸç†ï¼šï¼ˆmp4ã€flvï¼‰-&gt; è§£å°è£… -&gt; ï¼ˆmp3/aacã€h264/h265ï¼‰-&gt; è§£ç  -&gt; ï¼ˆpcmã€yuvï¼‰-&gt; éŸ³è§†é¢‘åŒæ­¥ -&gt; æ¸²æŸ“æ’­æ”¾</li><li>éŸ³è§†é¢‘åŒæ­¥ï¼š<br>* é€‰æ‹©å‚è€ƒæ—¶é’Ÿæºï¼šéŸ³é¢‘æ—¶é—´æˆ³ã€è§†é¢‘æ—¶é—´æˆ³å’Œå¤–éƒ¨æ—¶é—´ä¸‰è€…é€‰æ‹©ä¸€ä¸ªä½œä¸ºå‚è€ƒæ—¶é’Ÿæºï¼ˆä¸€èˆ¬é€‰æ‹©éŸ³é¢‘ï¼Œå› ä¸ºäººå¯¹éŸ³é¢‘æ›´æ•æ„Ÿï¼Œijk é»˜è®¤ä¹Ÿæ˜¯éŸ³é¢‘ï¼‰<br>* é€šè¿‡ç­‰å¾…æˆ–ä¸¢å¸§å°†è§†é¢‘æµä¸å‚è€ƒæ—¶é’Ÿæºå¯¹é½ï¼Œå®ç°åŒæ­¥</li></ul><h4 id="-17"><a href="#-17" class="headerlink" title=" "></a> </h4><h4 id="IjkPlayer-åŸç†"><a href="#IjkPlayer-åŸç†" class="headerlink" title="IjkPlayer åŸç†"></a><strong>IjkPlayer åŸç†</strong></h4><ul><li>é›†æˆäº† MediaPlayerã€ExoPlayer å’Œ IjkPlayer ä¸‰ç§å®ç°ï¼Œå…¶ä¸­ IjkPlayer åŸºäº FFmpeg çš„ ffplay</li><li>éŸ³é¢‘è¾“å‡ºæ–¹å¼ï¼šAudioTrackã€OpenSL ESï¼›è§†é¢‘è¾“å‡ºæ–¹å¼ï¼šNativeWindowã€OpenGL ES</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ç›®å½•ï¼š&quot;&gt;&lt;a href=&quot;#ç›®å½•ï¼š&quot; class=&quot;headerlink&quot; title=&quot;ç›®å½•ï¼š&quot;&gt;&lt;/a&gt;&lt;strong&gt;ç›®å½•ï¼š&lt;/strong&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ç½‘ç»œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Java åŸºç¡€&amp;amp;å®¹å™¨&amp;amp;åŒæ­¥&amp;amp;è®¾è®¡æ¨¡å¼&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Java è™šæ‹Ÿæœº&amp;amp;å†…å­˜ç»“æ„&amp;amp;GC&amp;amp;ç±»åŠ è½½&amp;amp;å››ç§å¼•ç”¨&amp;amp;åŠ¨æ€ä»£ç†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Android åŸºç¡€&amp;amp;æ€§èƒ½ä¼˜åŒ–&amp;amp;Framwork&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Android æ¨¡å—åŒ–&amp;amp;çƒ­ä¿®å¤&amp;amp;çƒ­æ›´æ–°&amp;amp;æ‰“åŒ…&amp;amp;æ··æ·†&amp;amp;å‹ç¼©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;éŸ³è§†é¢‘&amp;amp;FFmpeg&amp;amp;æ’­æ”¾å™¨&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="é¢è¯•" scheme="https://zhangmiao.cc/categories/Android/%E9%9D%A2%E8%AF%95/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="é¢è¯•" scheme="https://zhangmiao.cc/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>Flutter â€œä¿å§†â€çº§é¡¹ç›® Demoåˆé›†</title>
    <link href="https://zhangmiao.cc/posts/60004316.html"/>
    <id>https://zhangmiao.cc/posts/60004316.html</id>
    <published>2019-05-12T05:40:05.000Z</published>
    <updated>2019-07-22T06:03:30.700Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸ºå•¥å«â€œä¿å§†â€çº§é¡¹ç›®ï¼Œå› ä¸ºæ˜¯çœŸçš„è´´å¿ƒâ€¦</p><h3 id="flutter-go"><a href="#flutter-go" class="headerlink" title="flutter go"></a>flutter go</h3><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722135152.png" alt></td><td><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722135724.png" alt></td><td><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722135809.png" alt></td></tr></tbody></table><p><em><a href="https://github.com/alibaba/flutter-go" target="_blank" rel="noopener">https://github.com/alibaba/flutter-go</a></em></p><a id="more"></a><h3 id="GSYçš„-flutter-åˆé›†"><a href="#GSYçš„-flutter-åˆé›†" class="headerlink" title="GSYçš„ flutter åˆé›†"></a>GSYçš„ flutter åˆé›†</h3><p>GSYFlutterDemo ä½œä¸ºç®€å•ç¤ºä¾‹å’Œè§£å†³æ–¹æ¡ˆ Demo ï¼Œå®ƒå¯ä»¥ç»™ä½ å­¦ä¹ å’Œå·¥ä½œä¸­æä¾›ä¸€äº›ä¾¿æ·çš„å¸®åŠ©ï¼Œæ¯”å¦‚ å¦‚ä½•è‡ªå®šä¹‰å¸ƒå±€ï¼Œå¦‚ä½•æ»šåŠ¨æ§ä»¶åˆ°æŒ‡å®š child position ï¼Œå¦‚ä½•è°ƒæ•´ Text æ§ä»¶çš„ Line Space ï¼Œå¦‚ä½•ç›‘å¬é”®ç›˜çš„å¼¹å‡ºå’Œæ”¶èµ· ç­‰ç­‰ï¼Œæ‰€ä»¥ä¾‹å­æ–¹æ¡ˆéƒ½ç‹¬ç«‹å®ç°ï¼Œæ–¹ä¾¿é˜…è¯» CV ã€‚</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722135241.png" alt></p><p>å·²æœ‰ä¾‹å­</p><ul><li>Controller ä¾‹å­</li><li>åœ†è§’ ä¾‹å­</li><li>æ»‘åŠ¨ç›‘å¬ ä¾‹å­</li><li>æ»‘åŠ¨åˆ°æŒ‡å®šä½ç½® ä¾‹å­</li><li>æ»‘åŠ¨åˆ°æŒ‡å®šä½ç½®2 ä¾‹å­</li><li>Transform ä¾‹å­</li><li>æ–‡æœ¬è¡Œé—´è· ä¾‹å­</li><li>å¤šç§ä¸‹æ‹‰åˆ·æ–° ä¾‹å­</li><li>ç»å¯¹å®šä½ ä¾‹å­</li><li>æ°”æ³¡æç¤ºæ¡† ä¾‹å­</li><li>æ ‡ç­¾Wrap ä¾‹å­</li><li>å…±äº«å…ƒç´ åŠ¨ç”» ä¾‹å­</li><li>ä¿®æ”¹çŠ¶æ€æ é¢œè‰² ä¾‹å­</li><li>ç³»ç»Ÿé”®ç›˜ç›¸å…³ ä¾‹å­</li><li>åŠ¨ç”»ç›¸å…³ ä¾‹å­</li><li>æ‚¬æµ®è§¦æ‘¸æ§ä»¶ ä¾‹å­</li><li>å…¨å±€å­—ä½“å¤§å° ä¾‹å­</li><li>å¯Œæ–‡æœ¬ ä¾‹å­</li><li>ViewPager ä¾‹å­</li><li>æ»‘åŠ¨åœé  ä¾‹å­</li><li>éªŒè¯ç è¾“å…¥æ¡† ä¾‹å­</li><li>è‡ªå®šä¹‰å¸ƒå±€ ä¾‹å­</li><li>è‡ªå®šä¹‰å¸ƒå±€äº‘è¯å›¾ ä¾‹å­</li></ul><p><em><a href="https://github.com/CarGuo/GSYFlutterDemo" target="_blank" rel="noopener">https://github.com/CarGuo/GSYFlutterDemo</a></em></p><p>é™¤æ­¤ä¹‹å¤–ï¼ŒGSY ä¹Ÿå¯¹å¤–è¾“å‡ºäº†ï¼Œå®æˆ˜ç³»åˆ—åšå®¢ï¼š</p><p><em><a href="https://juejin.im/user/582aca2ba22b9d006b59ae68/posts" target="_blank" rel="noopener">https://juejin.im/user/582aca2ba22b9d006b59ae68/posts</a></em></p><p>å®æˆ˜é¡¹ç›®ï¼š</p><p><em><a href="https://github.com/CarGuo/GSYGithubAppFlutter" target="_blank" rel="noopener">https://github.com/CarGuo/GSYGithubAppFlutter</a></em></p><h3 id="Flutter-NoteBook"><a href="#Flutter-NoteBook" class="headerlink" title="Flutter NoteBook"></a>Flutter NoteBook</h3><p>flutetr_note_bookæœ‰è®¸å¤šflutterç›¸å…³åŠŸèƒ½demoçš„é›†åˆï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©æ‚¨å¿«é€Ÿå­¦ä¹ ä¸€äº›é›¶ç¢çš„çŸ¥è¯†ï¼Œæœ¬é¡¹ç›®å°†ä¼šä¸å®šæœŸæ›´æ–°ã€‚<br><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722135024.png" alt></p><p><em><a href="https://github.com/OpenFlutter/Flutter-Notebook" target="_blank" rel="noopener">https://github.com/OpenFlutter/Flutter-Notebook</a></em></p><p>çœ‹ä»‹ç»ä¸Šå†™ï¼ŒåŸæœ¬ä½œè€…è®¡åˆ’æ˜¯æ—¥æ›´çš„ï¼Œä½†æ˜¯æ—¥æ›´çš„å‹åŠ›å¤ªå¤§äº†ã€‚</p><p>æˆ‘æ›¾ç»å°è¯•è¿‡åšè¿™æ ·çš„äº‹æƒ…ï¼Œåæ¥è¿˜æ˜¯è§‰å¾—ä¸éœ€è¦ç»™è‡ªå·±å¤ªå¤§å‹åŠ›æ‰å¥½ï¼Œæ¯”å¦‚ï¼šwanandroid ä¸Šé¢çš„æ¯æ—¥ä¸€é—®ï¼Œç°åœ¨å˜æˆäº†æ¯å‘¨ 3 é—®ã€‚</p><p>æƒ³è¦åšæŒåšä¸€ä»¶äº‹æƒ…ï¼Œè€Œä¸”æ˜¯æ²¡æœ‰æ˜æ˜¾æ”¶ç›Šçš„äº‹æƒ…ï¼Œè¿˜æ˜¯ä¿æŒä¸€ä¸ªåˆç†çš„å‘¨æœŸï¼Œä¸è¦å½±å“åˆ°è‡ªå·±æ‰è¡Œã€‚</p><p>å°±åƒè°ˆæ‹çˆ±ï¼Œå¤©å¤©è§‰å¾—æœ‰å‹åŠ›ï¼Œçƒ¦é‚£å°±ä¸é•¿ä¹…äº†~</p><p>å¥½åœ¨ä½œè€…å¹¶æ²¡æœ‰æ–­æ›´ï¼Œå¸Œæœ›ä½œè€…èƒ½åšæŒæ›´ä¹…ï¼Œæ„Ÿè°¢ã€‚</p><h3 id="flutter-app"><a href="#flutter-app" class="headerlink" title="flutter_app"></a>flutter_app</h3><p>æœ¬é¡¹ç›®åŒ…æ‹¬å„ç§åŸºæœ¬æ§ä»¶ä½¿ç”¨ï¼ˆTextã€TextFieldã€Iconã€Imageã€Listviewã€Gridviewã€Pickerã€Stepperã€Dialogã€Sliderã€Rowã€Appbarã€Sizeboxã€BottomSheetã€Chipã€Dismissibleã€FlutterLogoã€Checkã€Switchã€TabBarã€BottomNavigationBarã€Sliverç­‰ï¼‰ã€è±†ç“£ç”µå½±ã€æ¯æ—¥ä¸€æ–‡ã€å’Œå¤©æ°”ã€ç™¾å§“ç”Ÿæ´»ã€éšæœºè¯—è¯ã€è”ç³»äººã€å¥å­è¿·ã€å¥½å¥‡å¿ƒæ—¥æŠ¥ç­‰æ¿å—</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722134953.png" alt></p><p>è¿™ä¸ªé¡¹ç›®æ¯”è¾ƒå¤§çš„ç‰¹è‰²ï¼Œå°±æ˜¯æ±‡é›†äº†éå¸¸å¤šçš„å®æˆ˜ appï¼Œé‚£ä¹ˆä½ çœ‹åˆ°å“ªä¸ªé¡µé¢æ•ˆæœå°±èƒ½å»çœ‹çœ‹å®ƒçš„å®ç°ã€‚</p><p>å½“ç„¶äº†ï¼Œç°åœ¨åšå…·ä½“ app ç±»ä¼¼å¼€æºé¡¹ç›®ï¼Œæœ€éº»çƒ¦çš„å°±æ˜¯å¼€æ”¾ api äº†ï¼Œå¾ˆå¤šæŠ“å–çš„ä¸€æ–¹é¢ä¸ç¡®å®šæ˜¯å¦è¿è§„ï¼Œå¦ä¸€æ–¹é¢æåº¦ä¸ç¨³å®šï¼Œæˆ‘ä»¥å‰ç»å¸¸æ¨èå®Œæ•´é¡¹ç›®ï¼Œä½†æ˜¯ç»å¸¸è¿‡äº†ä¸€æ®µæ—¶é—´å°±ä¸èƒ½è®¿é—®äº†ã€‚</p><p>æ‰€ä»¥ï¼Œä½ ä»¬çœŸè¦ç»ƒæ‰‹ï¼Œä¸å¦¨ä½¿ç”¨ wanandroid.com çš„å¼€æ”¾ APIï¼Œç½‘ç«™å¤šæ•°æ¥å£å’Œå¼€æ”¾ API æ˜¯ä½¿ç”¨çš„ç›¸åŒçš„æ¥å£ï¼Œé™¤éè¿™ä¸ªç½‘ç«™æŒ‚äº†ï¼Œå¦åˆ™ API ä¸€ç›´å¾ˆç¨³å®šï¼Œæ•°æ®ä¹ŸåŒæ­¥æ›´æ–°ï¼Œä¹Ÿç®—æˆ‘å¯¹å¤–çš„ä¸€äº›ä»˜å‡ºå•¦ã€‚</p><p><em><a href="https://github.com/shichunlei/flutter_app" target="_blank" rel="noopener">https://github.com/shichunlei/flutter_app</a></em></p><h3 id="awesome-flutter"><a href="#awesome-flutter" class="headerlink" title="awesome-flutter"></a>awesome-flutter</h3><p>ç±»ä¼¼äºæ”¶é›†ä¸é”™çš„ Flutter åº“ï¼Œå·¥å…·ï¼Œæ–‡ç« ï¼Œå®ä¾‹ç­‰ã€‚</p><p>å› ä¸ºæ˜¯å›½å¤–å¼€å‘è€…åšçš„ï¼Œæ‰€ä»¥å…³æ³¨çš„æ›´å¤šæ˜¯å›½å¤–çš„å†…å®¹ï¼Œæ‰€ä»¥å’Œä»¥ä¸Šé¡¹ç›®åšäº’è¡¥è¿˜æ˜¯éå¸¸ä¸é”™çš„ã€‚</p><p>è¿™ä¸ªèµ„æºåˆé›†ï¼Œåˆ†ç±»éå¸¸ç»†è‡´ï¼Œæœ‰å…¥é—¨ï¼Œè¿›é˜¶ï¼›è§†é¢‘æ•™ç¨‹ç­‰ç­‰ã€‚</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722134928.png" alt></p><p><em><a href="https://github.com/Solido/awesome-flutter" target="_blank" rel="noopener">https://github.com/Solido/awesome-flutter</a></em></p><p>å¦å¤–æœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œå°±æ˜¯ä½ æƒ³çœ‹ä»€ä¹ˆæ–¹å‘æŠ€æœ¯çš„æ—¶å€™ï¼Œæœæ–­ç”¨ awesome + å…³é”®è¯ æœç´¢ã€‚</p><h3 id="awesome-kotlin"><a href="#awesome-kotlin" class="headerlink" title="awesome kotlin"></a>awesome kotlin</h3><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722134848.png" alt></p><h3 id="awesome-android"><a href="#awesome-android" class="headerlink" title="awesome android"></a>awesome android</h3><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722134825.png" alt></p><p>å­¦åˆ°äº†å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸ºå•¥å«â€œä¿å§†â€çº§é¡¹ç›®ï¼Œå› ä¸ºæ˜¯çœŸçš„è´´å¿ƒâ€¦&lt;/p&gt;
&lt;h3 id=&quot;flutter-go&quot;&gt;&lt;a href=&quot;#flutter-go&quot; class=&quot;headerlink&quot; title=&quot;flutter go&quot;&gt;&lt;/a&gt;flutter go&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722135152.png&quot; alt&gt;&lt;/td&gt;
&lt;td&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722135724.png&quot; alt&gt;&lt;/td&gt;
&lt;td&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190722135809.png&quot; alt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&quot;https://github.com/alibaba/flutter-go&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/alibaba/flutter-go&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/categories/Android/Flutter/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>FlutterPluginå¼€å‘æµç¨‹</title>
    <link href="https://zhangmiao.cc/posts/b7213cdb.html"/>
    <id>https://zhangmiao.cc/posts/b7213cdb.html</id>
    <published>2019-04-29T08:00:03.000Z</published>
    <updated>2019-05-27T08:02:01.728Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Flutter Pluginå¼€å‘æµç¨‹ï¼ŒåŒ…æ‹¬å¦‚ä½•åˆ©ç”¨Android Studioå¼€å‘ä»¥åŠå‘å¸ƒç­‰ã€‚</p></blockquote><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œç»™å¤§å®¶ä»‹ç»å¦‚ä½•å¼€å‘Flutter Pluginä¸­Androidçš„éƒ¨åˆ†ã€‚æœ‰å…³Flutterä»¥åŠFlutter Pluginçš„æ¦‚å¿µï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ä»å®˜ç½‘æŸ¥çœ‹ç›¸å…³èµ„æ–™ã€‚</p><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ç¬”è€…çš„ç¯å¢ƒæ˜¯Macä¸‹Android Studioè¿›è¡Œçš„å¼€å‘ï¼ŒASä¹Ÿæ˜¯è°·æ­Œå®˜æ¨çš„ï¼Œå®‰è£…flutteræ’ä»¶åï¼Œå¼€å‘èµ·æ¥ç›¸å¯¹äºå…¶ä»–IDEæ¥è¯´ï¼Œæ–¹ä¾¿å¾ˆå¤šï¼Œè‡ªå¸¦äº†ä¸‰ç§æ¨¡æ¿ï¼š</p><ul><li>Flutter Applicationï¼š Flutteråº”ç”¨</li><li>Flutter Pluginï¼šFlutteræ’ä»¶</li><li>Flutter Packageï¼šçº¯Dartç»„ä»¶</li></ul><p><code>Pluginå…¶å®å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Package</code>ã€‚Flutter Pluginæä¾›Androidæˆ–è€…iOSçš„åº•å±‚å°è£…ï¼Œåœ¨Flutterå±‚æä¾›ç»„ä»¶åŠŸèƒ½ï¼Œä½¿Flutterå¯ä»¥è¾ƒæ–¹ä¾¿çš„è°ƒå–Nativeçš„æ¨¡å—ã€‚å¾ˆå¤šå¹³å°ç›¸å…³æ€§æˆ–è€…å¯¹äºFlutterå®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚çš„éƒ¨åˆ†ï¼Œéƒ½å¯ä»¥å°è£…æˆPluginã€‚å…¶åŸç†å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527160122.png" alt></p><p>æ¶ˆæ¯åœ¨clientå’Œhostä¹‹é—´é€šè¿‡å¹³å°é€šé“ï¼ˆplatform channelsï¼‰æ¥è¿›è¡Œçš„ï¼Œä¹‹é—´çš„é€šè®¯éƒ½æ˜¯<code>å¼‚æ­¥</code>çš„ã€‚</p><a id="more"></a><h2 id="åˆ›å»ºç»„ä»¶"><a href="#åˆ›å»ºç»„ä»¶" class="headerlink" title="åˆ›å»ºç»„ä»¶"></a>åˆ›å»ºç»„ä»¶</h2><p>ç›´æ¥åœ¨Android Studioä¸­æ–°å»ºä¸€ä¸ªFlutter Pluginçš„å·¥ç¨‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæ¥è¿›è¡Œï¼Œä¾‹å¦‚åˆ›å»ºä¸€ä¸ªflutter_text_pluginã€‚</p><blockquote><p>flutter create â€“org com.example â€“plugin flutter_text_plugin</p></blockquote><p>å¦‚æœæƒ³æ”¯æŒswiftæˆ–è€…kotlinï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œåˆ›å»º:</p><blockquote><p>flutter create â€“org com.example â€“plugin -i swift -a kotlin flutter_text_plugin</p></blockquote><p>æ›´å¤šçš„å‚æ•°é€‰é¡¹ï¼Œå¤§å®¶å¯ä»¥ æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ï¼Œå½“ç„¶è¿˜æ˜¯æ¯”è¾ƒæ¨èç›´æ¥ç”¨ASè¿›è¡Œåˆ›å»ºï¼Œç®€å•ç›´è§‚ã€‚ç”¨ASæ‰“å¼€é¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°é¡¹ç›®çš„ç»„ç»‡ç»“æ„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line">    android</span><br><span class="line">    example</span><br><span class="line">    ios</span><br><span class="line">    lib</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>androidä»¥åŠiosæ–‡ä»¶å¤¹æ˜¯æˆ‘ä»¬å°†è¦ç¼–å†™æ’ä»¶çš„nativeå±‚çš„åœ°æ–¹ï¼Œlibæ–‡ä»¶å¤¹æ˜¯ç¼–å†™ä¸nativeå±‚æ˜ å°„çš„åœ°æ–¹ï¼Œnativeä¸flutterä¹‹é—´ä¸èƒ½ç›´æ¥é€šä¿¡ï¼Œå¿…é¡»é€šè¿‡MethodChannelæ¥é—´æ¥è°ƒç”¨ã€‚exampleæ–‡ä»¶å¤¹åˆ™æ˜¯ä¾‹å­å·¥ç¨‹ï¼Œç¼–å†™çš„æ’ä»¶å¯ä»¥ç›´æ¥åœ¨è¿™ä¸ªé¡¹ç›®ä¸­è¿›è¡ŒéªŒè¯ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦åœ¨androidç›®å½•ä¸‹è¿›è¡Œï¼Œä¹Ÿå°±æ˜¯androidéƒ¨åˆ†ã€‚</p><h2 id="ç¼–å†™Androidéƒ¨åˆ†"><a href="#ç¼–å†™Androidéƒ¨åˆ†" class="headerlink" title="ç¼–å†™Androidéƒ¨åˆ†"></a>ç¼–å†™Androidéƒ¨åˆ†</h2><p>ç”¨ASæ‰“å¼€flutter_text_plugin/androidé¡¹ç›®ï¼Œè¿™æ ·å­å¼€å‘èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚ä½†æ˜¯æ‰“å¼€è¿‡åï¼Œä¼šå‘ç°å‡ºç°äº†å¾ˆå¤šé”™è¯¯ï¼Œæç¤ºæ‰¾ä¸åˆ°flutterç›¸å…³çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬ä»”ç»†çœ‹è¿™ä¸ªé¡¹ç›®ï¼Œä¼šå‘ç°è·Ÿæˆ‘ä»¬å¹³æ—¶ç”¨ASå»ºçš„Androidé¡¹ç›®æœ‰æ‰€ä¸åŒï¼Œå°‘äº†å¾ˆå¤šéƒ¨åˆ†ï¼Œç›®å½•ä¹Ÿæœ‰æ‰€ä¸åŒã€‚è¿™æ˜¯å› ä¸ºè¿™ä¸ªandroidé¡¹ç›®ä¸éœ€è¦èƒ½å¤Ÿç›´æ¥å»è¿è¡Œï¼Œå› æ­¤å‡å°‘äº†å¾ˆå¤šä¸œè¥¿ã€‚ä½†æ˜¯å¯¹äºåˆæ¬¡æ¥è§¦çš„äººæ¥è¯´ï¼Œå¯èƒ½æ˜¯ä¸€å¤´æ‡µé€¼ï¼Œä¾‹å¦‚è¯¥å¦‚ä½•æ·»åŠ ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚ä½•æ·»åŠ proguard ruleç­‰ç­‰ã€‚</p><h3 id="å¼•å…¥flutteråº“"><a href="#å¼•å…¥flutteråº“" class="headerlink" title="å¼•å…¥flutteråº“"></a>å¼•å…¥flutteråº“</h3><p>androidæ’ä»¶å·¥ç¨‹æ˜¯æ²¡æœ‰å¼•å…¥flutteråº“çš„ï¼Œæ‰€ä»¥æ‰ä¼šå‡ºç°é”™è¯¯æç¤ºï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•å»ºç«‹ä¸€ä¸ªlibsæ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾flutteråº“ã€‚</p><p>flutteråº“å°±åœ¨æˆ‘ä»¬çš„flutter sdkä¸­ï¼Œè·¯å¾„å¦‚ä¸‹</p><blockquote><p><sdk project>/bin/cache/artifacts/engine</sdk></p></blockquote><p>engineä¸‹é¢åŒ…å«äº†å„ç§å¹³å°çš„flutteråº“ï¼Œæˆ‘ä»¬éšä¾¿æ‹·è´ä¸€ä¸ªAndroidå¹³å°çš„åº“åˆ°libsæ–‡ä»¶å¤¹ä¸‹ï¼Œå³é”®flutter.jarï¼Œå¼¹å‡ºèœå•é€‰æ‹©<code>Add As Library...</code>ã€‚</p><p>ç»è¿‡è¿™ä¸€æ­¥ï¼Œé¡¹ç›®ä¸­ä¸ä¼šå†æŠ¥é”™äº†ï¼Œä½†æ˜¯ï¼Œç”±äºæ•´ä¸ªflutter pluginåŒ…å«äº†flutteråº“ï¼Œå› æ­¤ä¸èƒ½åªæ˜¯ç®€å•çš„æ·»åŠ å°±äº†äº‹äº†ï¼Œç‚¹å‡»èœå•<code>Project Structure...</code>ï¼Œæ‰¾åˆ°flutter_text_pluginçš„Dependenciesä¸­ï¼Œå°†flutteråº“çš„Scopeä»Implementationæ”¹æˆ<code>Compile Only</code>ã€‚è‡³æ­¤ï¼Œå¼•å…¥flutteråº“çš„å·¥ä½œå®Œæˆäº†ï¼Œå¯ä»¥è¿›è¡Œæ’ä»¶çš„ç¼–å†™æ“ä½œäº†ã€‚</p><h3 id="æ·»åŠ ç¬¬ä¸‰æ–¹åº“"><a href="#æ·»åŠ ç¬¬ä¸‰æ–¹åº“" class="headerlink" title="æ·»åŠ ç¬¬ä¸‰æ–¹åº“"></a>æ·»åŠ ç¬¬ä¸‰æ–¹åº“</h3><p>æ·»åŠ ç¬¬ä¸‰æ–¹åº“æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯jaråŒ…å¼•å…¥ï¼Œå¦ä¸€ç§é€šè¿‡gradleçš„æ–¹å¼è¿›è¡Œã€‚ç”±äºè¿›è¡Œäº†ç¬¬ä¸€æ­¥flutteråº“çš„å¼•å…¥ï¼Œè¿™ä¸€æ­¥å°±ç®€å•å¤šäº†ã€‚æŸ¥çœ‹build.gradleæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°æœ€ä¸‹é¢å‡ºç°äº†å¦‚ä¸‹çš„ä¿¡æ¯ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  compileOnly files(<span class="string">'libs/flutter.jar'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™ä¸ªï¼Œæ˜¯ä¸æ˜¯å°±æ˜æœ—å¤šäº†ï¼Œæ·»åŠ é™æ€åº“ä»¥åŠæ·»åŠ åœ¨çº¿åº“éƒ½å¯ä»¥åœ¨è¿™ä¸ªåœ°æ–¹è¿›è¡Œã€‚ä¾‹å¦‚æˆ‘æ·»åŠ ä¸€ä¸ªbuglyé™æ€åº“ä»¥åŠokhttp3åº“ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  compileOnly files(<span class="string">'libs/flutter.jar'</span>)</span><br><span class="line">  implementation <span class="string">'com.squareup.okhttp3:okhttp:3.10.0'</span></span><br><span class="line">  implementation files(<span class="string">'libs/bugly_crash_release.jar'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ proguard-rule"><a href="#æ·»åŠ proguard-rule" class="headerlink" title="æ·»åŠ proguard rule"></a>æ·»åŠ proguard rule</h3><p>ç”±äºäº†buglyä»¥åŠokhttp3åº“ï¼Œå› æ­¤éœ€è¦æ·»åŠ progurad ruleã€‚æˆ‘ä»¬å‘ç°é¡¹ç›®ä¸­æ²¡æœ‰proguard-rules.proæ–‡ä»¶ï¼Œå› æ­¤è¿™ä¸€æ­¥ä¹Ÿéœ€è¦æˆ‘ä»¬è‡ªå·±å»åˆ›å»ºï¼Œåœ¨æ ¹ç›®å½•ä¸‹ï¼Œå»ºç«‹proguard-rules.proæ–‡ä»¶ï¼Œå°†æ··æ·†è§„åˆ™æ·»åŠ è¿›å»ï¼Œç„¶åä¿®æ”¹build.gradleæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ä¿¡æ¯ï¼Œè·Ÿæ™®é€šAndroidé¡¹ç›®å·®ä¸å¤šï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">    release &#123;</span><br><span class="line">      minifyEnabled <span class="keyword">true</span></span><br><span class="line">      proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">    &#125;</span><br><span class="line">    debug &#123;</span><br><span class="line">      minifyEnabled <span class="keyword">false</span></span><br><span class="line">      proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="Androidæƒé™"><a href="#Androidæƒé™" class="headerlink" title="Androidæƒé™"></a>Androidæƒé™</h3><p>æ·»åŠ äº†buglyä»¥åŠokhttp3åº“ï¼Œéœ€è¦å¯¹åº”çš„æƒé™ç”³æ˜ï¼Œæ‰èƒ½æ­£å¸¸è¿è¡Œã€‚ç›´æ¥åœ¨manifestæ–‡ä»¶ä¸‹ï¼Œæ·»åŠ å¯¹åº”çš„æƒé™</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.READ_PHONE_STATE"</span> /&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.INTERNET"</span> /&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.ACCESS_WIFI_STATE"</span> /&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.READ_LOGS"</span>/&gt;</span><br></pre></td></tr></table></figure><h3 id="æ’ä»¶å¼€å‘"><a href="#æ’ä»¶å¼€å‘" class="headerlink" title="æ’ä»¶å¼€å‘"></a>æ’ä»¶å¼€å‘</h3><p>è‡³æ­¤ï¼Œå‡†å¤‡å·¥ä½œéƒ½å·²å°±ç»ªï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ªé¡¹ç›®å½“åšä¸€ä¸ªç‹¬ç«‹çš„Androidé¡¹ç›®ï¼Œåœ¨ä¸Šé¢è¿›è¡Œå„ç§å°è£…æ“ä½œï¼Œç„¶ååœ¨FlutterTestPluginæ–‡ä»¶ä¸‹ï¼Œå°†æ¥å£æš´éœ²å‡ºæ¥ã€‚é€šè¿‡platform channelsä¸flutterå±‚å…³è”èµ·æ¥ã€‚</p><h2 id="å‘å¸ƒ"><a href="#å‘å¸ƒ" class="headerlink" title="å‘å¸ƒ"></a>å‘å¸ƒ</h2><p>å½“æ’ä»¶å¼€å‘å®Œæ¯•ï¼Œå¯ä»¥å°†æ’ä»¶å‘å¸ƒè®©å…¶ä»–äººä½¿ç”¨ï¼Œåœ¨å‘å¸ƒä¹‹å‰ï¼Œç¡®ä¿pubspec.yaml,ã€README.mdä»¥åŠCHANGELOG.mdæ–‡ä»¶çš„å†…å®¹éƒ½æ­£ç¡®å¡«å†™å®Œæ¯•ã€‚å¯ä»¥é€šè¿‡dry-runå‘½ä»¤æ¥çœ‹å‡†å¤‡æ˜¯å¦å°±ç»ªã€‚</p><blockquote><p>flutter packages pub publish â€“dry-run</p></blockquote><p>æ£€æŸ¥æ— è¯¯åï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå‘å¸ƒåˆ°<a href="https://pub.dartlang.org/" target="_blank" rel="noopener">Pub</a>ä¸Šã€‚</p><blockquote><p>flutter packages pub publish</p></blockquote><h2 id="å¦‚ä½•å¼•ç”¨"><a href="#å¦‚ä½•å¼•ç”¨" class="headerlink" title="å¦‚ä½•å¼•ç”¨"></a>å¦‚ä½•å¼•ç”¨</h2><p>å¯¹æ’ä»¶çš„å¼•ç”¨æœ‰ä¸¤ç§ï¼Œå·²ç»å‘å¸ƒçš„å’Œæœªå‘å¸ƒçš„ã€‚</p><h3 id="å¼•ç”¨å‘å¸ƒçš„åº“"><a href="#å¼•ç”¨å‘å¸ƒçš„åº“" class="headerlink" title="å¼•ç”¨å‘å¸ƒçš„åº“"></a>å¼•ç”¨å‘å¸ƒçš„åº“</h3><p>flutteré¡¹ç›®çš„å¾ˆå¤šèµ„æºç®¡ç†éƒ½åœ¨æ ¹ç›®å½•çš„pubspec.yamlä¸‹é¢ï¼Œç±»ä¼¼äºjsä¸­çš„ä¸€äº›åŒ…ç®¡ç†ä¸€æ ·ï¼Œåœ¨<code>dependencies</code>åŠ ä¸Šæˆ‘ä»¬éœ€è¦å¼•å…¥çš„åº“ï¼Œä¾‹å¦‚å¼•å…¥url_launcheråº“ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dependencies:</span><br><span class="line">  url_launcher: ^<span class="number">0.4</span><span class="number">.2</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™ä¸ªåº“åŒ…å«äº†ä¸€äº›å¹³å°ç›¸å…³çš„ä¸œè¥¿ï¼Œä¾‹å¦‚éœ€è¦åœ¨nativeå±‚è¿›è¡Œä½¿ç”¨çš„è¯ï¼Œåˆ™éœ€è¦åœ¨å¯¹åº”çš„nativeé¡¹ç›®å•ç‹¬åšå¼•ç”¨ã€‚</p><h4 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h4><p>ä¿®æ”¹android/build.gradleçš„dependencieså¤„åšå¼•ç”¨ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">        provided rootProject.findProject(<span class="string">":url_launcher"</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h4><p>ä¿®æ”¹ios/hello.podspecæ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Pod::Spec.new do |s|</span><br><span class="line">  # lines skipped</span><br><span class="line">  s.dependency &apos;url_launcher&apos;</span><br></pre></td></tr></table></figure><h4 id="å¼•ç”¨å†²çª"><a href="#å¼•ç”¨å†²çª" class="headerlink" title="å¼•ç”¨å†²çª"></a>å¼•ç”¨å†²çª</h4><p>å¼•ç”¨ä¸åŒçš„åº“å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›å†²çªï¼Œä¾‹å¦‚Aå’ŒBä¸¤ä¸ªæ’ä»¶ï¼Œéƒ½åŒ…å«äº†Cæ’ä»¶ï¼Œä½†æ˜¯æ‰€éœ€çš„ç‰ˆæœ¬ä¸åŒã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½é¿å…è¿™ç§é—®é¢˜ï¼š</p><ul><li>å°½é‡ä½¿ç”¨èŒƒå›´ç‰ˆæœ¬è€Œä¸æ˜¯æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„ç‰ˆæœ¬ã€‚</li><li>å¼ºåˆ¶ç»Ÿä¸€å†²çªçš„æ’ä»¶ç‰ˆæœ¬</li><li>å¯¹äºnativeå±‚ï¼Œandroidå¯ä»¥é€šè¿‡forceå‘½ä»¤å¼ºåˆ¶æŒ‡å®šç‰ˆæœ¬ï¼Œè€ŒiOSè¿™è¾¹ï¼ŒCocoapodsåˆ™ä¸æ”¯æŒå¼•ç”¨çš„overrideåŠŸèƒ½ã€‚</li></ul><h3 id="å¼•ç”¨æœªå‘å¸ƒçš„åº“"><a href="#å¼•ç”¨æœªå‘å¸ƒçš„åº“" class="headerlink" title="å¼•ç”¨æœªå‘å¸ƒçš„åº“"></a>å¼•ç”¨æœªå‘å¸ƒçš„åº“</h3><p>å¼•ç”¨æœªå‘å¸ƒçš„åº“æœ‰ä¸¤ç§æ–¹å¼ï¼Œé€šè¿‡æœ¬åœ°è·¯å¾„å’Œgitåœ°å€çš„æ–¹å¼ï¼š</p><h4 id="åŸºäºPathçš„å¼•ç”¨æ–¹å¼ï¼š"><a href="#åŸºäºPathçš„å¼•ç”¨æ–¹å¼ï¼š" class="headerlink" title="åŸºäºPathçš„å¼•ç”¨æ–¹å¼ï¼š"></a>åŸºäºPathçš„å¼•ç”¨æ–¹å¼ï¼š</h4><p>è¿™ç§æ–¹å¼ä¸»è¦é’ˆå¯¹æœ¬åœ°çš„æœªå‘å¸ƒçš„åº“ï¼Œå¼•ç”¨çš„è·¯å¾„å¯ä»¥æ˜¯ç›¸å¯¹æˆ–è€…ç»å¯¹è·¯å¾„ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies:</span><br><span class="line">  plugin1:</span><br><span class="line">    path: ../plugin1/</span><br></pre></td></tr></table></figure><h4 id="åŸºäºGitçš„å¼•ç”¨æ–¹å¼ï¼š"><a href="#åŸºäºGitçš„å¼•ç”¨æ–¹å¼ï¼š" class="headerlink" title="åŸºäºGitçš„å¼•ç”¨æ–¹å¼ï¼š"></a>åŸºäºGitçš„å¼•ç”¨æ–¹å¼ï¼š</h4><p>è¿™ç§æ–¹å¼é’ˆå¯¹å­˜æ”¾åœ¨gitä¸Šçš„åº“ï¼Œå…¶ä¸­pathæ˜¯å¯é€‰çš„ï¼Œå¯ä»¥å®šä½åˆ°æŸä¸ªå­ç›®å½•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies:</span><br><span class="line">  package1:</span><br><span class="line">    git:</span><br><span class="line">      url: git:<span class="comment">//github.com/flutter/packages.git</span></span><br><span class="line">      path: packages/package1</span><br></pre></td></tr></table></figure><h2 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h2><p>ç¬”è€…æ–°å»ºäº†ä¸€ä¸ªflutterå­¦ä¹ ç›¸å…³çš„é¡¹ç›®ï¼Œ<a href="https://github.com/yang7229693/flutter-study" target="_blank" rel="noopener">githubåœ°å€</a>ï¼Œé‡Œé¢åŒ…å«äº†ç¬”è€…å†™çš„å…³äºflutterå­¦ä¹ ç›¸å…³çš„ä¸€äº›æ–‡ç« ï¼ŒåæœŸä¹Ÿä¼šå®šæœŸæ›´æ–°ï¼Œä¹Ÿä¼šä¸Šä¼ ä¸€äº›å­¦ä¹ demoï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="https://blog.csdn.net/hekaiyou/article/details/72862653" target="_blank" rel="noopener">Flutterè¿›é˜¶â€”å¹³å°æ’ä»¶</a></li><li><a href="https://www.youtube.com/watch?v=tErY3QWTZSA&t=883s" target="_blank" rel="noopener">Flutter - Creating a Plugin</a></li><li><a href="https://flutter.io/flutter-for-android/" target="_blank" rel="noopener">Flutter for Android Developers</a></li><li><a href="https://flutter.io/platform-channels/" target="_blank" rel="noopener">Writing custom platform-specific code with platform channels</a></li><li><a href="https://flutter.io/developing-packages/#step-2b-add-android-platform-code-javakt" target="_blank" rel="noopener">Developing Packages &amp; Plugins</a></li><li><a href="https://flutter.io/using-packages/" target="_blank" rel="noopener">Using Packages</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Flutter Pluginå¼€å‘æµç¨‹ï¼ŒåŒ…æ‹¬å¦‚ä½•åˆ©ç”¨Android Studioå¼€å‘ä»¥åŠå‘å¸ƒç­‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œç»™å¤§å®¶ä»‹ç»å¦‚ä½•å¼€å‘Flutter Pluginä¸­Androidçš„éƒ¨åˆ†ã€‚æœ‰å…³Flutterä»¥åŠFlutter Pluginçš„æ¦‚å¿µï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ä»å®˜ç½‘æŸ¥çœ‹ç›¸å…³èµ„æ–™ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h2&gt;&lt;p&gt;ç¬”è€…çš„ç¯å¢ƒæ˜¯Macä¸‹Android Studioè¿›è¡Œçš„å¼€å‘ï¼ŒASä¹Ÿæ˜¯è°·æ­Œå®˜æ¨çš„ï¼Œå®‰è£…flutteræ’ä»¶åï¼Œå¼€å‘èµ·æ¥ç›¸å¯¹äºå…¶ä»–IDEæ¥è¯´ï¼Œæ–¹ä¾¿å¾ˆå¤šï¼Œè‡ªå¸¦äº†ä¸‰ç§æ¨¡æ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Flutter Applicationï¼š Flutteråº”ç”¨&lt;/li&gt;
&lt;li&gt;Flutter Pluginï¼šFlutteræ’ä»¶&lt;/li&gt;
&lt;li&gt;Flutter Packageï¼šçº¯Dartç»„ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;Pluginå…¶å®å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Package&lt;/code&gt;ã€‚Flutter Pluginæä¾›Androidæˆ–è€…iOSçš„åº•å±‚å°è£…ï¼Œåœ¨Flutterå±‚æä¾›ç»„ä»¶åŠŸèƒ½ï¼Œä½¿Flutterå¯ä»¥è¾ƒæ–¹ä¾¿çš„è°ƒå–Nativeçš„æ¨¡å—ã€‚å¾ˆå¤šå¹³å°ç›¸å…³æ€§æˆ–è€…å¯¹äºFlutterå®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚çš„éƒ¨åˆ†ï¼Œéƒ½å¯ä»¥å°è£…æˆPluginã€‚å…¶åŸç†å¦‚ä¸‹&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527160122.png&quot; alt&gt;&lt;/p&gt;
&lt;p&gt;æ¶ˆæ¯åœ¨clientå’Œhostä¹‹é—´é€šè¿‡å¹³å°é€šé“ï¼ˆplatform channelsï¼‰æ¥è¿›è¡Œçš„ï¼Œä¹‹é—´çš„é€šè®¯éƒ½æ˜¯&lt;code&gt;å¼‚æ­¥&lt;/code&gt;çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/categories/Android/Flutter/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutterä¸Androidçš„äº¤äº’</title>
    <link href="https://zhangmiao.cc/posts/5ae94dfd.html"/>
    <id>https://zhangmiao.cc/posts/5ae94dfd.html</id>
    <published>2019-04-29T07:46:33.000Z</published>
    <updated>2019-05-27T08:01:52.234Z</updated>
    
    <content type="html"><![CDATA[<p>Flutter è¯´åˆ°åº•åªæ˜¯ä¸€ä¸ª UI æ¡†æ¶ï¼Œå¾ˆå¤šåŠŸèƒ½éƒ½éœ€è¦é€šè¿‡åŸç”Ÿçš„ Api æ¥å®ç°ï¼Œé‚£ä¹ˆå°±ä¼šæ¶‰åŠåˆ° Flutter å’Œ Native çš„äº¤äº’ï¼Œå› ä¸ºæœ¬äººä¸æ‡‚ iOS å¼€å‘ï¼Œæ‰€ä»¥åªèƒ½è®²ä¸‹ Flutter åŒ Android çš„äº¤äº’ã€‚</p><h4 id="Android-é¡¹ç›®é…ç½®-Flutter-ä¾èµ–"><a href="#Android-é¡¹ç›®é…ç½®-Flutter-ä¾èµ–" class="headerlink" title="Android é¡¹ç›®é…ç½® Flutter ä¾èµ–"></a>Android é¡¹ç›®é…ç½® Flutter ä¾èµ–</h4><p>æ—¢ç„¶æ˜¯äº’ç›¸äº¤äº’ï¼Œé‚£ä¹ˆéœ€è¦å‡†å¤‡ä¸€ä¸ª Android é¡¹ç›®ã€‚æ¥ç€å°±éœ€è¦åˆ›å»º flutter moduleï¼Œè®© Android é¡¹ç›®ä¾èµ–ï¼Œåˆ›å»ºçš„æ–¹æ³•å¯ä»¥å‚è€ƒå®˜ç½‘ <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fwiki%2FAdd-Flutter-to-existing-apps" target="_blank" rel="noopener">Flutter Wiki</a>ï¼Œè™½ç„¶æ˜¯å®˜ç½‘æä¾›çš„æ–¹æ³•ï¼Œä½†æ˜¯å®Œå…¨æŒ‰ç…§è¿™ä¸ªæ­¥éª¤æ¥ï¼Œè¿˜æ˜¯ä¼šæœ‰å‘çš„ï¼Œè¿™è¾¹å°±æ…¢æ…¢ä¸€æ­¥æ­¥è§£å†³å‘ã€‚</p><p>å¦‚æœä½ ç”¨çš„æ˜¯ Android Studio è¿›è¡Œå¼€å‘çš„è¯ï¼Œç›´æ¥æ‰“å¼€åº•éƒ¨çš„ Terminalï¼Œç›´æ¥åˆ›å»º flutter module ä¾èµ–</p><p><code>flutter create -t module flutter_native_contact</code> è‡³äº module åå¯ä»¥éšæ„å¡«å†™ï¼Œmodule åˆ›å»ºå®Œåç»“æ„å¤§æ¦‚æ˜¯è¿™æ ·çš„</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527154756.png" alt></p><a id="more"></a><p>æ¥ç€åˆ‡æ¢åˆ° module ä¸‹çš„ .android æ–‡ä»¶å¤¹ï¼Œæ¥ç€æœ‰å‘æ¥äº†ï¼Œå®˜ç½‘æä¾›çš„æ–¹æ³•æ˜¯ <code>./gradlew flutter:assembleDebug</code> å¯èƒ½ä¼šæç¤ºå‘½ä»¤ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆç›´æ¥é€šè¿‡ <code>gradlew flutter:assembleDebug</code> æ¥è¿è¡Œï¼Œç­‰å®ƒè‡ªåŠ¨è·‘å®Œåï¼Œæ‰“å¼€æ ¹ç›®å½•ä¸‹çš„ <code>settings.gradle</code> æ–‡ä»¶ï¼ŒåŠ å…¥å®˜ç½‘æä¾›çš„ gradle ä»£ç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setBinding(<span class="keyword">new</span> Binding([gradle: <span class="keyword">this</span>]))                                 <span class="comment">// new</span></span><br><span class="line">evaluate(<span class="keyword">new</span> File(                                                      <span class="comment">// new</span></span><br><span class="line">  settingsDir.parentFile,                                               <span class="comment">// new</span></span><br><span class="line">  <span class="string">'flutter_native_contact/.android/include_flutter.groovy'</span>              <span class="comment">// new</span></span><br><span class="line">))                                                                      <span class="comment">// new</span></span><br></pre></td></tr></table></figure><p>ä½ ä»¥ä¸ºè¿™é‡Œæ²¡å‘ï¼ŒçœŸæ˜¯å›¾æ ·å›¾æ£®ç ´ï¼Œæ²¡å‘æ˜¯ä¸å¯èƒ½çš„ï¼Œç¼–è¯‘å™¨å¤§çˆ·å¯èƒ½ä¼šç»™ä½ ç”©è¿™ä¹ˆä¸ªé”™è¯¯</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527154815.png" alt></p><p>å¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºæ˜¯æ‰¾ä¸åˆ°æˆ‘ä»¬çš„æ–‡ä»¶ï¼Œæ‰€ä»¥æŠŠæ–‡ä»¶åè·¯å¾„ç»™è¡¥å…¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">evaluate(<span class="keyword">new</span> File(                                                      <span class="comment">// new</span></span><br><span class="line">  settingsDir.parentFile,                                               <span class="comment">// new</span></span><br><span class="line">  <span class="string">'FlutterNativeContactDemo/flutter_native_contact/.android/include_flutter.groovy'</span> <span class="comment">// è¿™é‡Œè¡¥å…¨è·¯å¾„</span></span><br><span class="line">))</span><br></pre></td></tr></table></figure><p>æ¥ç€æ‰“å¼€åŸæœ‰é¡¹ç›®ä¸‹ï¼ŒåŸæœ‰é¡¹ç›®ä¸‹ï¼ŒåŸæœ‰é¡¹ç›®ä¸‹çš„ app ä¸­çš„ <code>build.gradle</code> æ–‡ä»¶ï¼Œåœ¨ android ä¸‹åŠ ä¸Šå¦‚ä¸‹ä»£ç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">compileOptions &#123;</span><br><span class="line">  sourceCompatibility <span class="number">1.8</span></span><br><span class="line">  targetCompatibility <span class="number">1.8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¿…é¡»è¦åŠ ï¼Œä¸è¦é—®ä¸ºä»€ä¹ˆï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæœ€ååœ¨é¡¹ç›®ä¸‹æ·»åŠ  flutter module çš„ä¾èµ–å°±å®Œæˆäº†ã€‚è¿™ä¸ªè¿‡ç¨‹å‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ªä»€ä¹ˆé“ç†å‘¢ï¼Ÿ*ä¸è¦ä»¥ä¸ºå®˜ç½‘çš„éƒ½å¯¹ï¼Œå®˜ç½‘è®²çš„ä¹Ÿä¸æ˜¯å®Œå…¨å¯ä¿¡çš„ï¼Œæ—¶ä¸æ—¶ç»™ä½ æ¥ä¸ªå‘å°±èƒ½å¡ä½ è€åŠå¤©ã€‚</p><h4 id="åŸç”Ÿç•Œé¢åŠ è½½-Flutter-é¡µé¢"><a href="#åŸç”Ÿç•Œé¢åŠ è½½-Flutter-é¡µé¢" class="headerlink" title="åŸç”Ÿç•Œé¢åŠ è½½ Flutter é¡µé¢"></a>åŸç”Ÿç•Œé¢åŠ è½½ Flutter é¡µé¢</h4><p>é‚£ä¹ˆå¦‚ä½•åœ¨åŸç”Ÿç•Œé¢æ˜¾ç¤º Flutter ç•Œé¢å‘¢ï¼Œè¿™ä¸ªå°±éœ€è¦é€šè¿‡ FlutterView æ¥å®ç°äº†ï¼ŒFlutter è¿™ä¸ªç±»æä¾›äº† <code>createView</code> å’Œ <code>createFragment</code> ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«ç”¨äºè¿”å› FlutterView å’Œ FlutterFragment å®ä¾‹ï¼ŒFlutterFragment çš„å®ç°åŸç†ä¹Ÿæ˜¯é€šè¿‡ FlutterView æ¥å®ç°çš„ï¼Œå¯ä»¥ç®€å•çœ‹ä¸‹ FlutterFragment çš„æºç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A &#123;@link Fragment&#125; managing a &#123;@link FlutterView&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; This file is auto-generated by Flutter tooling.</span></span><br><span class="line"><span class="comment"> * DO NOT EDIT.&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">FlutterFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">  public <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">String</span> ARG_ROUTE = <span class="string">"route"</span>;</span><br><span class="line">  private <span class="built_in">String</span> mRoute = <span class="string">"/"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  public <span class="keyword">void</span> onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    <span class="comment">// è·å–ä¼ å…¥çš„è·¯ç”±å€¼ï¼Œé»˜è®¤ä¸º '/'</span></span><br><span class="line">    <span class="keyword">if</span> (getArguments() != <span class="keyword">null</span>) &#123;</span><br><span class="line">      mRoute = getArguments().getString(ARG_ROUTE);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  public FlutterView onCreateView(<span class="meta">@NonNull</span> LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) &#123;</span><br><span class="line">    <span class="comment">// æœ€åè¿˜æ˜¯æŒºè¿‡ createView æ–¹æ³•æ¥ç”Ÿæˆé¡µé¢ï¼Œåªä¸è¿‡ç›´æ¥æ”¾åœ¨ fragmentï¼Œ</span></span><br><span class="line">    <span class="comment">// æ”¾åœ¨ fragment ä¼šæ¯”ç›´æ¥ ä½¿ç”¨ FlutterView æ›´æ–¹ä¾¿ç®¡ç†ï¼Œä¾‹å¦‚å®ç° ViewPager ç­‰</span></span><br><span class="line">    <span class="keyword">return</span> Flutter.createView(getActivity(), getLifecycle(), mRoute);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="createFragment-æ–¹å¼åŠ è½½"><a href="#createFragment-æ–¹å¼åŠ è½½" class="headerlink" title="createFragment æ–¹å¼åŠ è½½"></a>createFragment æ–¹å¼åŠ è½½</h5><p>åœ¨åŸç”Ÿé¡µé¢æ˜¾ç¤º Flutter ç•Œé¢çš„ç¬¬ä¸€ç§æ–¹å¼å°±æ˜¯åŠ è½½ FlutterFragmentï¼Œçœ‹ä¸ªæ¯”è¾ƒç®€å•çš„ä¾‹å­å§</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;android.support.constraint.ConstraintLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    xmlns:app=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span></span><br><span class="line">    android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">    tools:context=<span class="string">".MainActivity"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- è¿™ä¸ªå¸ƒå±€ç”¨äºåŠ è½½ fragment --&gt;</span><br><span class="line">    &lt;FrameLayout</span><br><span class="line">        android:id=<span class="string">"@+id/fragment_container"</span></span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"match_parent"</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.design.widget.FloatingActionButton</span><br><span class="line">        android:id=<span class="string">"@+id/flutter_fragment"</span></span><br><span class="line">        android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        android:layout_marginEnd=<span class="string">"20dp"</span></span><br><span class="line">        android:layout_marginBottom=<span class="string">"50dp"</span></span><br><span class="line">        android:src=<span class="string">"@drawable/ic_add_white_36dp"</span></span><br><span class="line">        app:fabSize=<span class="string">"auto"</span></span><br><span class="line">        app:layout_constraintBottom_toBottomOf=<span class="string">"parent"</span></span><br><span class="line">        app:layout_constraintEnd_toEndOf=<span class="string">"parent"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/android.support.constraint.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ Activity å¯ä»¥ç›´æ¥é€šè¿‡è¿”å› FlutterFragment åŠ è½½åˆ° FrameLayout å³å¯</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="title">AppCompatActivity</span>() </span>&#123;</span><br><span class="line"></span><br><span class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        supportFragmentManager.beginTransaction()</span><br><span class="line">            .add(R.id.fragment_container, Flutter.createFragment(<span class="string">"route_flutter"</span>))</span><br><span class="line">            .commit()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æŠŠ Flutter é¡µé¢åŠ è½½åˆ°åŸç”Ÿç•Œé¢äº†ï¼Œä¼šé€šè¿‡ä¼ é€’çš„è·¯ç”±å€¼åœ¨ dart å±‚è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ‰€ä»¥æ¥ç€å°±éœ€è¦ç¼–å†™ Flutter ç•Œé¢</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// runApp å†…éƒ¨å€¼ä¹Ÿå¯ä»¥ç›´æ¥ä¼ å…¥ _buildWidgetForNativeRoute æ–¹æ³•</span></span><br><span class="line"><span class="comment">/// è¿™è¾¹åœ¨å¤–å±‚åµŒå¥—ä¸€å±‚ MaterialApp ä¸»è¦æ˜¯é˜²æ­¢ä¸€äº›ä¸å¿…è¦çš„éº»çƒ¦ï¼Œ</span></span><br><span class="line"><span class="comment">/// ä¾‹å¦‚ MediaQuery è¿™æ–¹é¢çš„ä½¿ç”¨ç­‰</span></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(FlutterApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlutterApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      home: _buildWidgetForNativeRoute(<span class="built_in">window</span>.defaultRouteName),</span><br><span class="line">      debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primaryColor: Color(<span class="number">0XFF008577</span>),</span><br><span class="line">        accentColor: Color(<span class="number">0xFFD81B60</span>),</span><br><span class="line">        primaryColorDark: Color(<span class="number">0xFF00574B</span>),</span><br><span class="line">        iconTheme: IconThemeData(color: Color(<span class="number">0xFFD81B60</span>)),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// è¯¥æ–¹æ³•ç”¨äºåˆ¤æ–­åŸç”Ÿç•Œé¢ä¼ é€’è¿‡æ¥çš„è·¯ç”±å€¼ï¼ŒåŠ è½½ä¸åŒçš„é¡µé¢</span></span><br><span class="line">Widget _buildWidgetForNativeRoute(<span class="built_in">String</span> route) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (route) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'route_flutter'</span>:</span><br><span class="line">      <span class="keyword">return</span> GreetFlutterPage();</span><br><span class="line">    <span class="comment">// é»˜è®¤çš„è·¯ç”±å€¼ä¸º '/'ï¼Œæ‰€ä»¥åœ¨ default æƒ…å†µä¹Ÿéœ€è¦è¿”å›é¡µé¢ï¼Œå¦åˆ™ dart ä¼šæŠ¥é”™ï¼Œè¿™é‡Œé»˜è®¤è¿”å›ç©ºé¡µé¢</span></span><br><span class="line">    <span class="keyword">default</span>: </span><br><span class="line">      <span class="keyword">return</span> Scaffold();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreetFlutterPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'NativeMessageContactPage'</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Text(</span><br><span class="line">          <span class="string">'This is a flutter fragment page'</span>,</span><br><span class="line">          style: TextStyle(fontSize: <span class="number">20.0</span>, color: Colors.black),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œåå¯ä»¥çœ‹åˆ°é¡µé¢åŠ è½½å‡ºæ¥äº†ï¼Œä¸è¿‡ä¼šæœ‰ä¸€æ®µæ—¶é—´çš„ç©ºç™½ï¼Œè¿™ä¸ªåœ¨æ­£å¼æ‰“åŒ…åå°±ä¸ä¼šå‡ºç°ï¼Œæ‰€ä»¥ä¸å¿…æ‹…å¿ƒã€‚æœ€åçš„é¡µé¢åº”è¯¥æ˜¯è¿™æ ·çš„</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527154907.png" alt></p><h5 id="createView-æ–¹å¼åŠ è½½"><a href="#createView-æ–¹å¼åŠ è½½" class="headerlink" title="createView æ–¹å¼åŠ è½½"></a>createView æ–¹å¼åŠ è½½</h5><p>æ¥ç€çœ‹ä¸‹ createView æ–¹æ³•ï¼Œè¯´ç™½äº†ï¼Œç¬¬ä¸€ç§æ–¹æ³•æœ€åè¿˜æ˜¯ä¼šé€šè¿‡è¯¥æ–¹å¼å®ç°</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line">public <span class="keyword">static</span> FlutterView createView(<span class="meta">@NonNull</span> <span class="keyword">final</span> Activity activity, <span class="meta">@NonNull</span> <span class="keyword">final</span> Lifecycle lifecycle, <span class="keyword">final</span> <span class="built_in">String</span> initialRoute) &#123;</span><br><span class="line">  <span class="comment">// äº¤äº’å‰çš„ä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œéœ€è¦å®Œæˆæ‰å¯ä»¥ç»§ç»­ä¸‹ä¸€æ­¥ï¼ŒåŒæ—¶éœ€è¦ä¿è¯å½“å‰çº¿ç¨‹ä¸ºä¸»çº¿ç¨‹</span></span><br><span class="line">  <span class="comment">// Looper.myLooper() == Looper.getMainLooper()ï¼Œå¦åˆ™ä¼šç”©ä½ ä¸€è„¸çš„ IllegalStateException </span></span><br><span class="line">  FlutterMain.startInitialization(activity.getApplicationContext());</span><br><span class="line">  FlutterMain.ensureInitializationComplete(activity.getApplicationContext(), <span class="keyword">null</span>);</span><br><span class="line">  <span class="keyword">final</span> FlutterNativeView nativeView = <span class="keyword">new</span> FlutterNativeView(activity);</span><br><span class="line">  <span class="comment">// å°† flutter é¡µé¢ç»‘å®šåˆ°ç›¸åº”çš„ activity</span></span><br><span class="line">  <span class="keyword">final</span> FlutterView flutterView = <span class="keyword">new</span> FlutterView(activity, <span class="keyword">null</span>, nativeView) &#123;</span><br><span class="line">      <span class="comment">// ......</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// å°†è·¯ç”±å€¼ä¼ åˆ° flutter å±‚ï¼Œå¹¶åŠ è½½ç›¸åº”çš„é¡µé¢ï¼Œ</span></span><br><span class="line">  <span class="keyword">if</span> (initialRoute != <span class="keyword">null</span>) &#123;</span><br><span class="line">    flutterView.setInitialRoute(initialRoute);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç»‘å®š lifecycleï¼Œæ–¹ä¾¿ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ activity ç»‘å®š</span></span><br><span class="line">  <span class="comment">// ä¸ç†Ÿæ‚‰ LifeCycle çš„åŒå­¦å¯ä»¥è‡ªè¡Œç½‘ä¸ŠæŸ¥æ‰¾èµ„æ–™</span></span><br><span class="line">  lifecycle.addObserver(<span class="keyword">new</span> LifecycleObserver() &#123;</span><br><span class="line">    <span class="meta">@OnLifecycleEvent</span>(Lifecycle.Event.ON_CREATE)</span><br><span class="line">    public <span class="keyword">void</span> onCreate() &#123;</span><br><span class="line">      <span class="comment">// é…ç½®ä¸€äº›å‚æ•°ï¼Œä¼ é€’åˆ° flutter å±‚</span></span><br><span class="line">      <span class="keyword">final</span> FlutterRunArguments arguments = <span class="keyword">new</span> FlutterRunArguments();</span><br><span class="line">      arguments.bundlePath = FlutterMain.findAppBundlePath(activity.getApplicationContext());</span><br><span class="line">      arguments.entrypoint = <span class="string">"main"</span>;</span><br><span class="line">      <span class="comment">// æœ€ç»ˆä¼šè°ƒç”¨æ–¹æ³• nativeRunBundleAndSnapshotFromLibraryï¼Œè¿™æ˜¯ä¸€ä¸ª native æ–¹æ³•ï¼Œè¿›è¡Œäº¤äº’</span></span><br><span class="line">      flutterView.runFromBundle(arguments);</span><br><span class="line">      <span class="comment">// è¿›è¡Œæ³¨å†Œ</span></span><br><span class="line">      GeneratedPluginRegistrant.registerWith(flutterView.getPluginRegistry());</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">// ......</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> flutterView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ createView æ–¹æ³•è¿”å›çš„ FlutterViewï¼Œé€šè¿‡è®¾ç½® Layoutparams å‚æ•°å°±å¯ä»¥æ·»åŠ åˆ°ç›¸åº”çš„å¸ƒå±€ä¸Šï¼Œè¿˜æœ‰ä¸€ç§ç›´æ¥é€šè¿‡ addContentView æ–¹å¼è¿›è¡ŒåŠ è½½ï¼Œè¿™é‡Œç›´æ¥ä¿®æ”¹åŸæœ‰ä»£ç ï¼Œ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        <span class="comment">// setContentView(R.layout.activity_main) ä¸éœ€è¦è¿™ä¸€æ­¥äº†</span></span><br><span class="line">        val flutterView = Flutter.createView(<span class="keyword">this</span><span class="meta">@ContactActivity</span>, lifecycle, <span class="string">"route_flutter"</span>)</span><br><span class="line">        val lp = FrameLayout.LayoutParams(FrameLayout.LayoutParams.MATCH_PARENT, FrameLayout.LayoutParams.MATCH_PARENT)</span><br><span class="line">        addContentView(flutterView, lp) <span class="comment">// ç›´æ¥åŠ è½½åˆ° activity é¡µé¢</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯é€šè¿‡è¿™æ ·åŠ è½½çš„è¯ï¼Œé‚£ä¹ˆæ•´ä¸ªé¡µé¢éƒ½æ˜¯ flutter çš„é¡µé¢ã€‚é‚£ä¹ˆä¹‹å‰çš„æ•ˆæœçš„ FAB åˆ™ä¸ä¼šè¢«åŠ è½½å‡ºæ¥äº†ï¼Œå³ä½¿æ²¡æœ‰çœç•¥ <code>setContentView(R.layout.activity_main)</code> æ–¹æ³•ï¼Œè¿™ä¸ªé¡µé¢çš„ xml å¸ƒå±€ä¹Ÿä¼šè¢«è¦†ç›–ã€‚</p><h4 id="PlantformChannel"><a href="#PlantformChannel" class="headerlink" title="PlantformChannel"></a>PlantformChannel</h4><p>é‚£ä¹ˆèƒ½å¤Ÿåœ¨åŸç”Ÿç•Œé¢æ˜¾ç¤º flutter é¡µé¢äº†ï¼Œå¦‚ä½•äº’ç›¸äº¤äº’å‘¢ï¼Œè¿™å°±éœ€è¦é€šè¿‡ PlantformChannel æ¥æ‰§è¡Œäº†ï¼ŒPlantformChannel ä¸»è¦æœ‰ä¸‰ç§ç±»å‹ï¼ŒBasicMessageChannelï¼ŒMethodChannelï¼ŒEventChannelã€‚é€šè¿‡æŸ¥çœ‹æºç å¯ä»¥å‘ç°ï¼Œä¸‰ä¸ª Channel çš„å®ç°æœºåˆ¶ç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ BinaryMessenger è¿›è¡Œä¿¡æ¯äº¤æµï¼Œæ¯ä¸ª Channel é€šè¿‡ä¼ å…¥çš„ channel name è¿›è¡ŒåŒºåˆ†ï¼Œæ‰€ä»¥åœ¨æ³¨å†Œ Channel çš„æ—¶å€™å¿…é¡»è¦ä¿è¯ channel name æ˜¯å”¯ä¸€çš„ï¼ŒåŒæ—¶éœ€è¦ä¼ å…¥ä¸€ä¸ª BinaryMessageHandler å®ä¾‹ï¼Œç”¨äºä¼ é€’ä¿¡æ¯çš„å¤„ç†ï¼Œå½“ Handler å¤„ç†å®Œä¿¡æ¯åï¼Œä¼šè¿”å›ä¸€ä¸ª resultï¼Œç„¶åé€šè¿‡ BinaryMessenger å°† result è¿”å›åˆ° Flutter å±‚ã€‚å¦‚æœéœ€è¦æ·±å…¥ç†è§£è¿™è¾¹æ¨èä¸€ç¯‡æ–‡ç« <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fjuejin.im%2Fpost%2F5b84ff6a6fb9a019f47d1cc9" target="_blank" rel="noopener">æ·±å…¥ç†è§£Flutter PlatformChannel</a></p><p>æ¥ä¸‹æ¥ç›´æ¥çœ‹ä¾‹å­å§ï¼Œåœ¨åˆ›å»º PlatformChannel çš„æ—¶å€™éœ€è¦ä¼ å…¥ä¸€ä¸ª BinaryMessenger å®ä¾‹ï¼Œé€šè¿‡æŸ¥çœ‹ FlutterView çš„æºç å¯ä»¥å‘ç°ï¼ŒFlutterView å°±æ˜¯ä¸€ä¸ª BinaryMessenger åœ¨ Android ç«¯çš„å®ç°ï¼Œæ‰€ä»¥å‘¢ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å‰é¢ä»‹ç»çš„ <code>Flutter.createView</code> æ–¹æ³•è·å–æ³¨å†Œ Channel æ—¶çš„ BinaryMessenger å®ä¾‹äº†ï¼ŒçœŸæ˜¯å¾—æ¥å…¨éƒ¨è´¹å·¥å¤«~å› ä¸ºé€šä¿¡çš„æ–¹æ³•å¯èƒ½åœ¨å¤šä¸ªç•Œé¢ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥è¿˜æ˜¯å°è£…ä¸€ä¸ªé€šç”¨ç±»æ¥å¤„ç†ä¼šæ¯”è¾ƒåˆç†</p><h5 id="BasicMessageChannel"><a href="#BasicMessageChannel" class="headerlink" title="BasicMessageChannel"></a>BasicMessageChannel</h5><blockquote><p>BasicMessageChannel ç”¨äºä¼ é€’å­—ç¬¦ä¸²å’ŒåŠç»“æ„åŒ–çš„ä¿¡æ¯ã€‚</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlutterPlugin</span>(<span class="title">private</span> <span class="title">val</span> <span class="title">flutterView</span>: <span class="title">FlutterView</span>) :<span class="title">BasicMessageChannel</span>.<span class="title">MessageHandler</span>&lt;<span class="title">Any</span>&gt;</span>&#123;</span><br><span class="line">    companion object &#123;</span><br><span class="line">        private <span class="keyword">const</span> val TAG = <span class="string">"FlutterPlugin"</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">@JvmStatic</span></span><br><span class="line">        fun registerPlugin(flutterView: FlutterView): FlutterPlugin &#123;</span><br><span class="line">            <span class="comment">// channel name éœ€è¦ä¿æŒä¸¤ä¾§ä¸€è‡´</span></span><br><span class="line">            val messageChannel =</span><br><span class="line">               BasicMessageChannel(flutterView, Constant.MESSAGE_CHANNEL_NAME, StandardMessageCodec.INSTANCE) <span class="comment">// MessageCodec æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒæ¨èçš„æ–‡ç« </span></span><br><span class="line"></span><br><span class="line">            val instance = FlutterPlugin(flutterView)</span><br><span class="line">            messageChannel.setMessageHandler(instance) <span class="comment">// æ³¨å†Œå¤„ç†çš„ Hnadler</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> instance</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override fun onMessage(`object`: Any?, reply: BasicMessageChannel.Reply&lt;Any&gt;?) &#123;</span><br><span class="line">        <span class="comment">// ç®€å•çš„å°†ä» Flutter ä¼ è¿‡æ¥çš„æ¶ˆæ¯è¿›è¡Œåå¸ï¼ŒåŒæ—¶è¿”å›è‡ªå·±çš„äº¤äº’ä¿¡æ¯</span></span><br><span class="line">        <span class="comment">// `object` ä¸­åŒ…å«çš„å°±æ˜¯ Flutter å±‚ä¼ é€’è¿‡æ¥çš„ä¿¡æ¯ï¼Œreply å®ä¾‹ç”¨äºä¼ é€’ä¿¡æ¯åˆ° Flutter å±‚</span></span><br><span class="line">        Toast.makeText(flutterView.context, `object`.toString(), Toast.LENGTH_LONG).show()</span><br><span class="line">        reply?.reply(<span class="string">"\"Hello Flutter\"--- an message from Android"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€å°±éœ€è¦æœ‰ä¸ª FlutterView ç”¨æ¥æ³¨å†Œï¼Œæ–°å»ºä¸€ä¸ª Activityï¼Œç”¨äºåŠ è½½ Flutter é¡µé¢</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContactActivity</span> : <span class="title">AppCompatActivity</span>() </span>&#123;</span><br><span class="line">    private lateinit <span class="keyword">var</span> plugin: FlutterPlugin</span><br><span class="line"></span><br><span class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¼ å…¥è·¯ç”±å€¼ï¼Œéœ€è¦åœ¨ flutter å±‚ç”Ÿæˆç›¸åº”çš„ç•Œé¢</span></span><br><span class="line">        val flutterView = Flutter.createView(<span class="keyword">this</span><span class="meta">@ContactActivity</span>, lifecycle, <span class="string">"route_contact"</span>)</span><br><span class="line">        val lp = FrameLayout.LayoutParams(FrameLayout.LayoutParams.MATCH_PARENT, FrameLayout.LayoutParams.MATCH_PARENT)</span><br><span class="line">        addContentView(flutterView, lp)</span><br><span class="line"></span><br><span class="line">        plugin = FlutterPlugin.registerPlugin(flutterView)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override fun onDestroy() &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å°±è¦åœ¨ Flutter ç•Œé¢çš„ <code>_buildWidgetForNativeRoute</code> æ–¹æ³•åŠ å…¥æ–°è·¯ç”±å€¼å¯¹åº”çš„ç•Œé¢</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Widget _buildWidgetForNativeRoute(<span class="built_in">String</span> route) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (route) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">          </span><br><span class="line">    <span class="keyword">case</span> <span class="string">'route_contact'</span>:</span><br><span class="line">      <span class="keyword">return</span> FlutterContactPage();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> Scaffold();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlutterContactPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="comment">// æ³¨å†Œå¯¹åº”çš„ channelï¼Œè¦ä¿è¯ channel name å’ŒåŸç”Ÿå±‚æ˜¯ä¸€è‡´çš„</span></span><br><span class="line">  <span class="keyword">final</span> BasicMessageChannel _messageChannel =</span><br><span class="line">      BasicMessageChannel(MESSAGE_CHANNEL_NAME, StandardMessageCodec());</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'Flutter Page'</span>),</span><br><span class="line">      ),</span><br><span class="line">      <span class="comment">// ç®€å•æ”¾ä¸€ä¸ªæŒ‰é’®ï¼Œé€šè¿‡ channel ä¼ è¾“æ¶ˆæ¯è¿‡å»ï¼ŒåŒæ—¶å°†åŸç”Ÿå±‚è¿”å›çš„æ¶ˆæ¯æ‰“å°å‡ºæ¥</span></span><br><span class="line">      body: RaisedButton(</span><br><span class="line">        onPressed: () &#123;</span><br><span class="line">          _messageChannel</span><br><span class="line">              .send(<span class="string">'"Hello Native" --- an message from flutter'</span>)</span><br><span class="line">              .then((str) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'Receive message: $str'</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        child: Text(<span class="string">'Send Message to Native'</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åçš„æ•ˆæœå°ä¼™ä¼´å¯ä»¥è‡ªè¡Œæ‰§è¡Œï¼Œç‚¹å‡»æŒ‰é’®åä¼šå¼¹å‡ºåå¸ï¼Œåå¸å†…å®¹å°±æ˜¯ Flutter ä¼ é€’çš„ä¿¡æ¯ï¼ŒåŒæ—¶åœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°ä»åŸç”Ÿå±‚è¿”å›çš„ä¿¡æ¯ã€‚</p><h5 id="MethodChannel"><a href="#MethodChannel" class="headerlink" title="MethodChannel"></a>MethodChannel</h5><blockquote><p>MethodChannel ç”¨äºä¼ é€’æ–¹æ³•è°ƒç”¨ï¼ˆmethod invocationï¼‰</p></blockquote><p>ç›´æ¥åœ¨ä¸Šè¿°ä¾‹å­ä¸­è¿›è¡Œä¿®æ”¹ï¼Œä¾‹å¦‚åœ¨ Flutter é¡µé¢ä¸­å®ç° Activity çš„ finish æ–¹æ³•ï¼Œå¹¶ä¼ é€’å‚æ•°åˆ°å‰ä¸€ä¸ªç•Œé¢ï¼Œå…ˆåš Flutter é¡µé¢çš„ä¿®æ”¹ï¼Œåœ¨ AppBar ä¸Šå¢åŠ ä¸€ä¸ªè¿”å›æŒ‰é’®ï¼Œç”¨äºè¿”å›ä¸Šå±‚é¡µé¢</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlutterContactPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="comment">// æ³¨å†Œå¯¹åº”çš„ channelï¼Œè¦ä¿è¯ channel name å’ŒåŸç”Ÿå±‚æ˜¯ä¸€è‡´çš„</span></span><br><span class="line">  <span class="keyword">final</span> BasicMessageChannel _messageChannel =</span><br><span class="line">      BasicMessageChannel(MESSAGE_CHANNEL_NAME, StandardMessageCodec());</span><br><span class="line">  <span class="keyword">final</span> MethodChannel _methodChannel = MethodChannel(METHOD_CHANNEL_NAME);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        leading: InkWell(</span><br><span class="line">          child: Padding(</span><br><span class="line">            padding: <span class="keyword">const</span> EdgeInsets.symmetric(vertical: <span class="number">20.0</span>),</span><br><span class="line">            child: Icon(Icons.arrow_back),</span><br><span class="line">          ),</span><br><span class="line">          onTap: () &#123;</span><br><span class="line">            _methodChannel</span><br><span class="line">                <span class="comment">// invokeMethod ç¬¬ä¸€ä¸ªå€¼ç”¨äºä¼ é€’æ–¹æ³•åï¼Œç¬¬äºŒä¸ªå€¼ç”¨äºä¼ é€’å‚æ•°ï¼Œ</span></span><br><span class="line">                <span class="comment">// è¿™è¾¹ç®€å•çš„ä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¼ é€’åˆ«çš„ç±»å‹ï¼Œmapï¼Œlist ç­‰ç­‰</span></span><br><span class="line">                .invokeMethod&lt;<span class="built_in">bool</span>&gt;(<span class="string">'finishActivity'</span>, <span class="string">'Finish Activity'</span>)</span><br><span class="line">                .then((result) &#123; <span class="comment">// è¿™è¾¹ä¼šè¿”å›ä¸€ä¸ªç»“æœå€¼ï¼Œé€šè¿‡åˆ¤æ–­æ˜¯å¦æˆåŠŸæ¥æ‰“å°ä¸åŒçš„ä¿¡æ¯</span></span><br><span class="line">              <span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;result ? <span class="string">'has finish'</span> : <span class="string">'not finish'</span>&#125;</span>'</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">        title: Text(<span class="string">'Flutter Page'</span>),</span><br><span class="line">      ),</span><br><span class="line">        </span><br><span class="line">      body: <span class="comment">// ...</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ FlutterPlugin è¿™ä¸ªç±»ä¸­ï¼Œåšäº›å¿…è¦çš„ä¿®æ”¹ï¼Œé¦–å…ˆéœ€è¦å®ç° <code>MethodCallHandler</code> æ¥å£ï¼Œè¯¥æ¥å£ä¸­éœ€è¦å®ç° <code>onMethodCall</code> æ–¹æ³•ï¼Œé€šè¿‡è·å–è°ƒç”¨çš„æ–¹æ³•åå’Œå‚æ•°å€¼ï¼Œè¿›è¡Œç›¸åº”çš„å¤„ç†</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlutterPlugin</span>(<span class="title">private</span> <span class="title">val</span> <span class="title">flutterView</span>: <span class="title">FlutterView</span>) :</span></span><br><span class="line"><span class="class">    <span class="title">MethodChannel</span>.<span class="title">MethodCallHandler</span>, <span class="title">BasicMessageChannel</span>.<span class="title">MessageHandler</span>&lt;<span class="title">Any</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    companion object &#123;</span><br><span class="line">        private <span class="keyword">const</span> val TAG = <span class="string">"FlutterPlugin"</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">@JvmStatic</span></span><br><span class="line">        fun registerPlugin(flutterView: FlutterView): FlutterPlugin &#123;</span><br><span class="line">            val instance = FlutterPlugin(flutterView)</span><br><span class="line">            val methodChannel = MethodChannel(flutterView, Constant.METHOD_CHANNEL_NAME)</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            messageChannel.setMessageHandler(instance)</span><br><span class="line">            <span class="keyword">return</span> instance</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// call ä¸­æºå¸¦äº† Flutter å±‚ä¼ é€’è¿‡æ¥çš„æ–¹æ³•åå’Œå‚æ•°ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">// å¯ä»¥åˆ†åˆ«é€šè¿‡ call.method å’Œ call.arguments æ¥è·å–</span></span><br><span class="line">    override fun onMethodCall(call: MethodCall?, result: MethodChannel.Result?) &#123;</span><br><span class="line">        when (call?.method) &#123;</span><br><span class="line">            <span class="string">"finishActivity"</span> -&gt; &#123;</span><br><span class="line">                val activity = flutterView.context <span class="keyword">as</span> Activity</span><br><span class="line">                val info = call.arguments.toString()</span><br><span class="line">                </span><br><span class="line">                val intent = Intent().apply &#123;</span><br><span class="line">                    putExtra(<span class="string">"info"</span>, info)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                activity.setResult(Activity.RESULT_OK, intent)</span><br><span class="line">                activity.finish()</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// æˆåŠŸæ—¶å€™é€šè¿‡ result.success è¿”å›å€¼ï¼Œ</span></span><br><span class="line">                <span class="comment">// å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œé€šè¿‡ result.error è¿”å›å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line">                <span class="comment">// Flutter é€šè¿‡ invokeMethod().then() æ¥å¤„ç†æ­£å¸¸ç»“æŸçš„é€»è¾‘</span></span><br><span class="line">                <span class="comment">// é€šè¿‡ catchError æ¥å¤„ç†å‘ç”Ÿå¼‚å¸¸çš„é€»è¾‘</span></span><br><span class="line">                result?.success(<span class="keyword">true</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœæœªæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•åï¼Œåˆ™é€šè¿‡ result.notImplemented æ¥è¿”å›å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">else</span> -&gt; result?.notImplemented()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆçš„æ•ˆæœï¼Œå½“ç‚¹å‡»è¿”å›æŒ‰é’®çš„æ—¶å€™ï¼Œä¼šå°† Flutter å±‚é€šè¿‡ invokeMethod ä¼ é€’çš„ arguments å±æ€§åå¸å‡ºæ¥ï¼ŒåŒæ—¶ï¼Œæ§åˆ¶å°ä¼šæ‰“å°å‡º â€œhas finishâ€ çš„ä¿¡æ¯</p><h5 id="EventChannel"><a href="#EventChannel" class="headerlink" title="EventChannel"></a>EventChannel</h5><blockquote><p>EventChannel ç”¨äºæ•°æ®æµï¼ˆevent streamsï¼‰çš„é€šä¿¡</p></blockquote><p>EventChannel çš„å®ç°æ–¹å¼ä¹Ÿç±»ä¼¼ï¼ŒEventChannel å¯ä»¥æŒç»­è¿”å›å¤šä¸ªä¿¡æ¯åˆ° Flutter å±‚ï¼Œåœ¨ Flutter å±‚çš„è¡¨ç°å°±æ˜¯ä¸€ä¸ª streamï¼ŒåŸç”Ÿå±‚é€šè¿‡ sink ä¸æ–­çš„æ·»åŠ æ•°æ®ï¼ŒFlutter å±‚æ¥æ”¶åˆ°æ•°æ®çš„å˜åŒ–å°±ä¼šä½œå‡ºæ–°ç›¸åº”çš„å¤„ç†ã€‚åœ¨ Android ç«¯å®ç°çŠ¶æ€çš„ç›‘å¬å¯ä»¥é€šè¿‡å¹¿æ’­æ¥å®ç°ã€‚ç›´æ¥çœ‹ä¾‹å­ï¼Œè¿˜æ˜¯ä¿®æ”¹ä¸Šè¿°ä»£ç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlutterPlugin</span>(<span class="title">private</span> <span class="title">val</span> <span class="title">flutterView</span>: <span class="title">FlutterView</span>) :</span></span><br><span class="line"><span class="class">    <span class="title">MethodChannel</span>.<span class="title">MethodCallHandler</span>, <span class="title">EventChannel</span>.<span class="title">StreamHandler</span>, <span class="title">BasicMessageChannel</span>.<span class="title">MessageHandler</span>&lt;<span class="title">Any</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">var</span> mStateChangeReceiver: BroadcastReceiver? = <span class="keyword">null</span></span><br><span class="line"></span><br><span class="line">    companion object &#123;</span><br><span class="line">        private <span class="keyword">const</span> val TAG = <span class="string">"FlutterPlugin"</span></span><br><span class="line">        <span class="keyword">const</span> val STATE_CHANGE_ACTION = <span class="string">"com.demo.plugins.action.StateChangeAction"</span></span><br><span class="line">        <span class="keyword">const</span> val STATE_VALUE = <span class="string">"com.demo.plugins.value.StateValue"</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">@JvmStatic</span></span><br><span class="line">        fun registerPlugin(flutterView: FlutterView): FlutterPlugin &#123;</span><br><span class="line">            <span class="comment">// ... </span></span><br><span class="line">            val streamChannel = EventChannel(flutterView, Constant.STREAM_CHANNEL_NAME)</span><br><span class="line"></span><br><span class="line">            val instance = FlutterPlugin(flutterView)</span><br><span class="line">            methodChannel.setMethodCallHandler(instance)</span><br><span class="line">            streamChannel.setStreamHandler(instance)</span><br><span class="line">            messageChannel.setMessageHandler(instance)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> instance</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç° StreamHandler éœ€è¦é‡å†™ onListen å’Œ onCancel æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// onListen ä¸ä¼šæ¯æ¬¡æ•°æ®æ”¹å˜å°±ä¼šè°ƒç”¨ï¼Œåªåœ¨ Flutter å±‚ï¼ŒeventChannel è®¢é˜…å¹¿æ’­</span></span><br><span class="line">    <span class="comment">// çš„æ—¶å€™è°ƒç”¨ï¼Œå½“å–æ¶ˆè®¢é˜…çš„æ—¶å€™åˆ™ä¼šè°ƒç”¨ onCancelï¼Œ</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥å½“å¼€å§‹è®¢é˜…æ•°æ®çš„æ—¶å€™ï¼Œæ³¨å†Œæ¥æ”¶æ•°æ®å˜åŒ–çš„å…³é—­ï¼Œ</span></span><br><span class="line">    <span class="comment">// åœ¨å–æ¶ˆè®¢é˜…çš„æ—¶å€™ï¼Œå°†æ³¨å†Œçš„å¹¿æ’­æ³¨é”€ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span></span><br><span class="line">    override fun onListen(argument: Any?, sink: EventChannel.EventSink?) &#123;</span><br><span class="line">        mStateChangeReceiver = createEventListener(sink)</span><br><span class="line">        flutterView.context.registerReceiver(mStateChangeReceiver, IntentFilter(STATE_CHANGE_ACTION))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override fun onCancel(argument: Any?) &#123;</span><br><span class="line">        unregisterListener()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ activity è¢«é”€æ¯çš„æ—¶å€™ï¼ŒFlutterView ä¸ä¸€å®šä¼šè°ƒç”¨é”€æ¯ç”Ÿå‘½å‘¨æœŸï¼Œæˆ–è€…ä¼šå»¶æ—¶è°ƒç”¨</span></span><br><span class="line">    <span class="comment">// è¿™å°±éœ€è¦æ‰‹åŠ¨å»æ³¨é”€ä¸€å¼€å§‹æ³¨å†Œçš„å¹¿æ’­äº†</span></span><br><span class="line">    fun unregisterListener() &#123;</span><br><span class="line">        <span class="keyword">if</span> (mStateChangeReceiver != <span class="keyword">null</span>) &#123;</span><br><span class="line">            flutterView.context.unregisterReceiver(mStateChangeReceiver)</span><br><span class="line">            mStateChangeReceiver = <span class="keyword">null</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private fun createEventListener(sink: EventChannel.EventSink?):</span><br><span class="line">            BroadcastReceiver = object : BroadcastReceiver() &#123;</span><br><span class="line"></span><br><span class="line">        override fun onReceive(context: Context?, intent: Intent?) &#123;</span><br><span class="line">            <span class="keyword">if</span> (TextUtils.equals(intent?.action, STATE_CHANGE_ACTION)) &#123;</span><br><span class="line">                <span class="comment">// è¿™è¾¹å¹¿æ’­åªåšç®€å•çš„æ¥æ”¶ä¸€ä¸ªæ•´æ•°ï¼Œç„¶åé€šè¿‡ sink ä¼ é€’åˆ° Flutter å±‚</span></span><br><span class="line">                <span class="comment">// å½“ç„¶ï¼Œsink è¿˜æœ‰ error æ–¹æ³•ï¼Œç”¨äºä¼ é€’å‘ç”Ÿçš„é”™è¯¯ä¿¡æ¯ï¼Œ</span></span><br><span class="line">                <span class="comment">// ä»¥åŠ endOfStream æ–¹æ³•ï¼Œç”¨äºç»“æŸæ¥æ”¶</span></span><br><span class="line">                <span class="comment">// åœ¨ Flutter å±‚åˆ†åˆ«æœ‰ onData å¯¹åº” success æ–¹æ³•ï¼ŒonError å¯¹åº” error æ–¹æ³•</span></span><br><span class="line">                <span class="comment">// onDone å¯¹åº” endOfStream æ–¹æ³•ï¼Œæ ¹æ®ä¸åŒçš„å›è°ƒå¤„ç†ä¸åŒçš„é€»è¾‘</span></span><br><span class="line">                sink?.success(intent?.getIntExtra(STATE_VALUE, <span class="number">-1</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ Flutter å±‚ï¼Œé€šè¿‡å¯¹ stream çš„ç›‘å¬ï¼Œå¯¹è¿”å›çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œä¸ºäº†ä½“ç°å‡ºå˜åŒ–ï¼Œè¿™è¾¹ä¿®æ”¹æˆ SatefulWidget æ¥å­˜å‚¨çŠ¶æ€</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlutterContactPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _FlutterContactPageState createState() =&gt; _FlutterContactPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_FlutterContactPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">FlutterContactPage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> MethodChannel _methodChannel = MethodChannel(METHOD_CHANNEL_NAME);</span><br><span class="line">  <span class="keyword">final</span> EventChannel _eventChannel = EventChannel(STREAM_CHANNEL_NAME);</span><br><span class="line">  <span class="keyword">final</span> BasicMessageChannel _messageChannel =</span><br><span class="line">      BasicMessageChannel(MESSAGE_CHANNEL_NAME, StandardMessageCodec());</span><br><span class="line">  StreamSubscription _subscription;</span><br><span class="line">  <span class="keyword">var</span> _receiverMessage = <span class="string">'Start receive state'</span>; <span class="comment">// åˆå§‹çš„çŠ¶æ€å€¼</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    <span class="comment">// å½“é¡µé¢ç”Ÿæˆçš„æ—¶å€™å°±å¼€å§‹ç›‘å¬æ•°æ®çš„å˜åŒ–</span></span><br><span class="line">    _subscription = _eventChannel.receiveBroadcastStream().listen((data) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _receiverMessage = <span class="string">'receive state value: $data'</span>; <span class="comment">// æ•°æ®å˜åŒ–äº†ï¼Œåˆ™ä¿®æ”¹æ•°æ®</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, onError: (e) &#123;</span><br><span class="line">      _receiverMessage = <span class="string">'process error: $e'</span>; <span class="comment">// å‘ç”Ÿé”™è¯¯åˆ™æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    &#125;, onDone: () &#123;</span><br><span class="line">      _receiverMessage = <span class="string">'receive data done'</span>; <span class="comment">// å‘é€å®Œæ¯•åˆ™ç›´æ¥æ˜¾ç¤ºå®Œæ¯•</span></span><br><span class="line">    &#125;, cancelOnError: <span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">    _subscription.cancel(); <span class="comment">// å½“é¡µé¢é”€æ¯çš„æ—¶å€™éœ€è¦å°†è®¢é˜…å–æ¶ˆï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        leading: InkWell(</span><br><span class="line">          child: Padding(</span><br><span class="line">            padding: <span class="keyword">const</span> EdgeInsets.symmetric(vertical: <span class="number">20.0</span>),</span><br><span class="line">            child: Icon(Icons.arrow_back),</span><br><span class="line">          ),</span><br><span class="line">          onTap: () &#123;</span><br><span class="line">            <span class="comment">// MethodChannel demo</span></span><br><span class="line">            _methodChannel</span><br><span class="line">                .invokeMethod&lt;<span class="built_in">bool</span>&gt;(<span class="string">'finishActivity'</span>, _receiverMessage)</span><br><span class="line">                .then((result) &#123;</span><br><span class="line">              <span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;result ? <span class="string">'has finish'</span> : <span class="string">'not finish'</span>&#125;</span>'</span>);</span><br><span class="line">            &#125;).catchError((e) &#123;</span><br><span class="line">              <span class="built_in">print</span>(<span class="string">'error happend: $e'</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">        title: Text(<span class="string">'Flutter Page'</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Padding(</span><br><span class="line">              padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">              <span class="comment">// EventChannel demoï¼Œé¡µé¢ç›´æ¥æ˜¾ç¤ºä¿¡æ¯çš„å˜åŒ–</span></span><br><span class="line">              child: Text(</span><br><span class="line">                _receiverMessage,</span><br><span class="line">                style: TextStyle(fontSize: <span class="number">20.0</span>, color: Colors.black),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            <span class="comment">// BasicMessageChannel demo</span></span><br><span class="line">            RaisedButton(</span><br><span class="line">              onPressed: () &#123;</span><br><span class="line">                _messageChannel</span><br><span class="line">                    .send(<span class="string">'"Hello Native" --- an message from flutter'</span>)</span><br><span class="line">                    .then((str) &#123;</span><br><span class="line">                  <span class="built_in">print</span>(<span class="string">'Receive message: $str'</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">              &#125;,</span><br><span class="line">              child: Text(<span class="string">'Send Message to Native'</span>),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œéœ€è¦åœ¨ Activity å±‚è°ƒç”¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ä¸æ–­çš„å‘é€å¹¿æ’­</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContactActivity</span> : <span class="title">AppCompatActivity</span>() </span>&#123;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">var</span> timer: Timer? = <span class="keyword">null</span></span><br><span class="line">    private <span class="keyword">var</span> task: TimerTask? = <span class="keyword">null</span></span><br><span class="line">    private lateinit <span class="keyword">var</span> random: Random</span><br><span class="line">    private lateinit <span class="keyword">var</span> plugin: FlutterPlugin</span><br><span class="line"></span><br><span class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line"></span><br><span class="line">        random = Random() <span class="comment">// ç”Ÿæˆéšæœºæ•´æ•°</span></span><br><span class="line">        val flutterView = Flutter.createView(<span class="keyword">this</span><span class="meta">@ContactActivity</span>, lifecycle, <span class="string">"route_contact"</span>)</span><br><span class="line">        val lp = FrameLayout.LayoutParams(FrameLayout.LayoutParams.MATCH_PARENT, FrameLayout.LayoutParams.MATCH_PARENT)</span><br><span class="line">        addContentView(flutterView, lp)</span><br><span class="line"></span><br><span class="line">        plugin = FlutterPlugin.registerPlugin(flutterView)</span><br><span class="line"></span><br><span class="line">        timer = Timer() <span class="comment">// å®šæ—¶å™¨</span></span><br><span class="line">        task = timerTask &#123; <span class="comment">// å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">            sendBroadcast(Intent(FlutterPlugin.STATE_CHANGE_ACTION).apply &#123;</span><br><span class="line">                putExtra(FlutterPlugin.STATE_VALUE, random.nextInt(<span class="number">1000</span>))</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        timer?.schedule(task, <span class="number">3000</span>, <span class="number">2000</span>) <span class="comment">// å»¶æ—¶ 3s å¼€å¯å®šæ—¶å™¨ï¼Œå¹¶ 2s å‘é€ä¸€æ¬¡å¹¿æ’­</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override fun onDestroy() &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é¡µé¢é”€æ¯çš„æ—¶å€™éœ€è¦å°†å®šæ—¶å™¨ï¼Œå®šæ—¶ä»»åŠ¡é”€æ¯</span></span><br><span class="line">        <span class="comment">// åŒæ—¶æ³¨é”€ Plugin ä¸­æ³¨å†Œçš„å¹¿æ’­ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span></span><br><span class="line">        timer?.cancel()</span><br><span class="line">        timer = <span class="keyword">null</span></span><br><span class="line"></span><br><span class="line">        task?.cancel()</span><br><span class="line">        task = <span class="keyword">null</span></span><br><span class="line"></span><br><span class="line">        plugin.unregisterListener()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åçš„å®ç°æ•ˆæœå¤§æ¦‚æ˜¯è¿™æ ·çš„</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/2888797-c604f0a652d1c172.gif" alt></p><p>Flutter åŒ Android ç«¯çš„äº¤äº’åˆ°è¿™è®²çš„å·®ä¸å¤šäº†ï¼Œå’Œ iOS çš„äº¤äº’å…¶å®ä¹Ÿç±»ä¼¼ï¼Œåªä¸è¿‡åœ¨ Android ç«¯é€šè¿‡ FlutterNativeView æ¥ä½œä¸º Binarymessenger çš„å®ç°ï¼Œåœ¨ iOS ç«¯é€šè¿‡ FlutterBinaryMessenger åè®®å®ç°ï¼ŒåŸç†æ˜¯ä¸€è‡´çš„ã€‚è‡³äº Flutter æ’ä»¶ï¼Œå…¶å®ç°ä¹Ÿæ˜¯é€šè¿‡ä»¥ä¸Šä¸‰ç§äº¤äº’æ–¹å¼æ¥å®ç°çš„ï¼Œå¯èƒ½æˆ‘ä»¬ç›®å‰é€šè¿‡ FlutterView æ¥ä½œä¸º BinaryMessenger å®ä¾‹ï¼Œæ’ä»¶ä¼šé€šè¿‡ PluginRegistry.Registrar å®ä¾‹çš„ messenger() æ–¹æ³•æ¥è·å– BinaryMessenger å®ä¾‹ã€‚</p><p>æœ€åè´´ä¸Š demo çš„åœ°å€ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fkukyxs%2FFlutterNativeContactDemo" target="_blank" rel="noopener">ContactDemo</a></p><p>éœ€è¦äº†è§£æ’ä»¶çš„å†™æ³•ä¹Ÿå¯ä»¥ç›´æ¥æŸ¥çœ‹å®˜æ–¹æä¾›çš„æ£€æµ‹ç”µé‡æ’ä»¶ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fflutter%2Fplugins%2Ftree%2Fmaster%2Fpackages%2Fbattery" target="_blank" rel="noopener">Flutter Battery Plugin</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Flutter è¯´åˆ°åº•åªæ˜¯ä¸€ä¸ª UI æ¡†æ¶ï¼Œå¾ˆå¤šåŠŸèƒ½éƒ½éœ€è¦é€šè¿‡åŸç”Ÿçš„ Api æ¥å®ç°ï¼Œé‚£ä¹ˆå°±ä¼šæ¶‰åŠåˆ° Flutter å’Œ Native çš„äº¤äº’ï¼Œå› ä¸ºæœ¬äººä¸æ‡‚ iOS å¼€å‘ï¼Œæ‰€ä»¥åªèƒ½è®²ä¸‹ Flutter åŒ Android çš„äº¤äº’ã€‚&lt;/p&gt;
&lt;h4 id=&quot;Android-é¡¹ç›®é…ç½®-Flutter-ä¾èµ–&quot;&gt;&lt;a href=&quot;#Android-é¡¹ç›®é…ç½®-Flutter-ä¾èµ–&quot; class=&quot;headerlink&quot; title=&quot;Android é¡¹ç›®é…ç½® Flutter ä¾èµ–&quot;&gt;&lt;/a&gt;Android é¡¹ç›®é…ç½® Flutter ä¾èµ–&lt;/h4&gt;&lt;p&gt;æ—¢ç„¶æ˜¯äº’ç›¸äº¤äº’ï¼Œé‚£ä¹ˆéœ€è¦å‡†å¤‡ä¸€ä¸ª Android é¡¹ç›®ã€‚æ¥ç€å°±éœ€è¦åˆ›å»º flutter moduleï¼Œè®© Android é¡¹ç›®ä¾èµ–ï¼Œåˆ›å»ºçš„æ–¹æ³•å¯ä»¥å‚è€ƒå®˜ç½‘ &lt;a href=&quot;https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fwiki%2FAdd-Flutter-to-existing-apps&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Flutter Wiki&lt;/a&gt;ï¼Œè™½ç„¶æ˜¯å®˜ç½‘æä¾›çš„æ–¹æ³•ï¼Œä½†æ˜¯å®Œå…¨æŒ‰ç…§è¿™ä¸ªæ­¥éª¤æ¥ï¼Œè¿˜æ˜¯ä¼šæœ‰å‘çš„ï¼Œè¿™è¾¹å°±æ…¢æ…¢ä¸€æ­¥æ­¥è§£å†³å‘ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ ç”¨çš„æ˜¯ Android Studio è¿›è¡Œå¼€å‘çš„è¯ï¼Œç›´æ¥æ‰“å¼€åº•éƒ¨çš„ Terminalï¼Œç›´æ¥åˆ›å»º flutter module ä¾èµ–&lt;/p&gt;
&lt;p&gt;&lt;code&gt;flutter create -t module flutter_native_contact&lt;/code&gt; è‡³äº module åå¯ä»¥éšæ„å¡«å†™ï¼Œmodule åˆ›å»ºå®Œåç»“æ„å¤§æ¦‚æ˜¯è¿™æ ·çš„&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527154756.png&quot; alt&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/categories/Android/Flutter/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutterå…¥é—¨æŒ‡å—(åå››)ä¹‹å®æˆ˜</title>
    <link href="https://zhangmiao.cc/posts/b447830c.html"/>
    <id>https://zhangmiao.cc/posts/b447830c.html</id>
    <published>2019-04-28T07:33:17.000Z</published>
    <updated>2019-05-31T08:17:27.004Z</updated>
    
    <content type="html"><![CDATA[<p>è®²å®Œäº†å¸¸ç”¨çš„éƒ¨ä»¶å’Œç½‘ç»œè¯·æ±‚åï¼Œå·®ä¸å¤šè¯¥è¿›å…¥æ•´ä½“å®æˆ˜äº†ï¼Œè¿™é‡Œæˆ‘ä»¬å°†å†™ä¸€ä¸ªæ¯”è¾ƒç†Ÿæ‚‰çš„é¡¹ç›®ï¼Œéƒ­ç¥çš„ cool weatherã€‚é¡¹ç›®å°†ä½¿ç”¨ fluro å®ç°è·¯ç”±ç®¡ç†ï¼Œdio å®ç°ç½‘ç»œè¯·æ±‚ï¼Œrxdart å®ç° BLoC è¿›è¡ŒçŠ¶æ€ç®¡ç†å’Œé€»è¾‘åˆ†ç¦»ï¼Œä½¿ç”¨æ–‡ä»¶ï¼Œshared_preferencesï¼Œsqflite å®ç°æœ¬åœ°çš„æ•°æ®æŒä¹…åŒ–ã€‚è¿™è¾¹å…ˆç»™å‡ºé¡¹ç›®çš„åœ°å€ï¼š<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fkukyxs%2Fflutter_weather" target="_blank" rel="noopener">flutter_weather</a>ï¼Œä»¥åŠæœ€åå®ç°çš„æ•ˆæœå›¾ï¼š</p><table><thead><tr><th>One</th><th>Two</th><th>Three</th></tr></thead><tbody><tr><td><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527153406.png" alt></td><td><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/2888797-50e81d7c4da87e57.gif" alt></td><td><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/2888797-eb02699bb66b1535.gif" alt></td></tr></tbody></table><a id="more"></a><p>é™¤äº† fluro åˆ«çš„åŸºæœ¬ä¸Šå‰é¢éƒ½è®²äº†ï¼Œæ‰€ä»¥åœ¨å¼€å§‹æ­£å¼çš„å®æˆ˜å‰ï¼Œå…ˆè®²ä¸‹ fluro</p><h4 id="Fluro"><a href="#Fluro" class="headerlink" title="Fluro"></a>Fluro</h4><p>fluro æ˜¯å¯¹ Navigator çš„ä¸€ä¸ªå°è£…ï¼Œæ–¹ä¾¿æ›´å¥½çš„ç®¡ç†è·¯ç”±è·³è½¬ï¼Œå½“ç„¶è¿˜å­˜åœ¨ä¸€äº›ç¼ºé™·ï¼Œä¾‹å¦‚ç›®å‰åªæ”¯æŒä¼ é€’å­—ç¬¦ä¸²ï¼Œä¸èƒ½ä¼ é€’ä¸­æ–‡ç­‰ï¼Œä½†æ˜¯è¿™äº›é—®é¢˜éƒ½ç®—ä¸ä¸Šæ˜¯å¤§é—®é¢˜ã€‚</p><p>fluro çš„ä½¿ç”¨å¾ˆç®€å•ï¼Œå¤§æ¦‚åˆ†å¦‚ä¸‹çš„æ­¥éª¤ï¼š</p><ol><li><p>åœ¨å…¨å±€å®šä¹‰ä¸€ä¸ª <code>Router</code> å®ä¾‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> router = Router();</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ <code>Router</code> å®ä¾‹å®šä¹‰è·¯å¾„å’Œå…¶å¯¹åº”çš„ <code>Handler</code> å¯¹è±¡</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¾‹å¦‚å®šä¹‰ä¸€ä¸ª CityPage çš„è·¯å¾„å’Œ Handler</span></span><br><span class="line">Handler cityHandler = Handler(handlerFunc: (_, params) &#123;</span><br><span class="line">  <span class="comment">// ä¼ é€’çš„å‚æ•°éƒ½åœ¨ params ä¸­ï¼Œparams æ˜¯ä¸€ä¸ª Map&lt;String, List&lt;String&gt;&gt; ç±»å‹å‚æ•°</span></span><br><span class="line">  <span class="built_in">String</span> cityId = params[<span class="string">'city_id'</span>]?.first; </span><br><span class="line">  <span class="keyword">return</span> BlocProvider(child: WeatherPage(city: cityId), bloc: WeatherBloc());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰è·¯ç”±çš„è·¯å¾„å’Œå‚æ•°</span></span><br><span class="line"><span class="comment">// éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¬¬ä¸€ä¸ªé¡µé¢çš„è·¯å¾„å¿…é¡»ä¸º "/"ï¼Œåˆ«çš„å¯ä¸º "/" + ä»»æ„æ‹¼æ¥</span></span><br><span class="line">router.define(<span class="string">'/city'</span>, handler: cityHandler);</span><br><span class="line"><span class="comment">// æˆ–è€…å®˜æ–¹æä¾›çš„å¦ä¸€ç§æ–¹å¼</span></span><br><span class="line">router.define(<span class="string">'/city/:city_id'</span>, handler: cityHandler);</span><br></pre></td></tr></table></figure></li><li><p>å°† <code>router</code> æ³¨å†Œåˆ° <code>MaterialApp</code> çš„ <code>onGenerateRoute</code> ä¸­</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MaterialApp(onGenerateRoute: router);</span><br></pre></td></tr></table></figure></li><li><p>æœ€åé€šè¿‡ <code>Router</code> å®ä¾‹è¿›è¡Œè·³è½¬ï¼Œå¦‚æœæœ‰å‚æ•°ä¼ é€’åˆ™ä¼šåœ¨æ–°çš„é¡µé¢æ”¶åˆ°</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.navigateTo(context, <span class="string">'/city?city_id=CN13579'</span>);</span><br><span class="line"><span class="comment">// æˆ–è€…å®˜æ–¹çš„æ–¹å¼</span></span><br><span class="line">router.navigateTo(context, <span class="string">'/city/CN13579'</span>);</span><br></pre></td></tr></table></figure></li></ol><p>åœ¨ fluro ä¸­æä¾›äº†å¤šç§è·¯ç”±åŠ¨ç”»ï¼ŒåŒ…æ‹¬ <code>fadeIn</code>ï¼Œ<code>inFromRight</code> ç­‰ã€‚è®²å®Œäº†ä½¿ç”¨ï¼Œå°±è¿›å…¥å®æˆ˜äº†ã€‚</p><h4 id="flutter-weather-å®æˆ˜"><a href="#flutter-weather-å®æˆ˜" class="headerlink" title="flutter_weather å®æˆ˜"></a>flutter_weather å®æˆ˜</h4><h5 id="å¯¼å…¥æ’ä»¶"><a href="#å¯¼å…¥æ’ä»¶" class="headerlink" title="å¯¼å…¥æ’ä»¶"></a>å¯¼å…¥æ’ä»¶</h5><p>åœ¨å¼€å§‹çš„æ—¶å€™ï¼Œå·²ç»æåˆ°äº†æ•´ä½“åŠŸèƒ½çš„å®ç°éœ€æ±‚ï¼Œæ‰€ä»¥è¿™è¾¹éœ€è¦å¯¼å…¥çš„æ’ä»¶ä»¥åŠå­˜æ”¾å›¾ç‰‡çš„æ–‡ä»¶å¤¹å¦‚ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">dependencies:</span><br><span class="line">  flutter:</span><br><span class="line">    sdk: flutter</span><br><span class="line">    </span><br><span class="line">  cupertino_icons: ^<span class="number">0.1</span><span class="number">.2</span></span><br><span class="line">  fluro: ^<span class="number">1.4</span><span class="number">.0</span></span><br><span class="line">  dio: ^<span class="number">2.1</span><span class="number">.0</span></span><br><span class="line">  shared_preferences: ^<span class="number">0.5</span><span class="number">.1</span>+<span class="number">2</span></span><br><span class="line">  sqflite: ^<span class="number">1.1</span><span class="number">.3</span></span><br><span class="line">  fluttertoast: ^<span class="number">3.0</span><span class="number">.3</span></span><br><span class="line">  rxdart: ^<span class="number">0.21</span><span class="number">.0</span></span><br><span class="line">  path_provider: <span class="number">0.5</span><span class="number">.0</span>+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">dev_dependencies:</span><br><span class="line">  flutter_test:</span><br><span class="line">    sdk: flutter</span><br><span class="line">    </span><br><span class="line">flutter:</span><br><span class="line">  uses-material-design: <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">  assets:</span><br><span class="line">    - images/</span><br></pre></td></tr></table></figure><h5 id="é¡¶å±‚é™æ€å®ä¾‹çš„å®ç°"><a href="#é¡¶å±‚é™æ€å®ä¾‹çš„å®ç°" class="headerlink" title="é¡¶å±‚é™æ€å®ä¾‹çš„å®ç°"></a>é¡¶å±‚é™æ€å®ä¾‹çš„å®ç°</h5><p>æœ‰è®¸å¤šå®ä¾‹éœ€è¦åœ¨é¡¶å±‚æ³¨å†Œï¼Œç„¶ååœ¨å…¨å±€ä½¿ç”¨ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº fluro çš„ routerï¼Œhttpï¼Œdatabase ç­‰ç­‰ã€‚åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œéœ€è¦ç”¨åˆ°çš„å°±æ˜¯è¿™ä¸‰ä¸ªå®ä¾‹ï¼Œä¼šåœ¨å…¨å±€è°ƒç”¨ï¼Œæ‰€ä»¥åœ¨å¼€å§‹å‰è¿›è¡Œåˆå§‹åŒ–ï¼Œå½“ç„¶ http å’Œ database åœ¨ä½¿ç”¨çš„æ—¶å€™åˆ›å»ºä¹Ÿå¯ä»¥ï¼Œå®Œå…¨çœ‹ä¸ªäººä¹ æƒ¯ï¼Œä½†æ˜¯ fluro çš„ç®¡ç†ç±»å¿…é¡»åœ¨ä¸€å¼€å§‹å°±æ³¨å†Œå®Œæˆã€‚é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ª <code>Application</code> ç±»ç”¨æ¥å­˜æ”¾è¿™äº›é™æ€å®ä¾‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> HttpUtils http; <span class="comment">// å…¨å±€ç½‘ç»œ</span></span><br><span class="line">  <span class="keyword">static</span> Router router; <span class="comment">// å…¨å±€è·¯ç”±</span></span><br><span class="line">  <span class="keyword">static</span> DatabaseUtils db; <span class="comment">// å…¨å±€æ•°æ®åº“</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€å°±æ˜¯å¯¹ç›¸åº”æ–¹æ³•ç±»çš„ç¼–å†™ï¼Œå…¶ä¸­ <code>HttpUtil</code> å’Œ <code>DatabaseUtils</code> åœ¨å‰é¢æœ‰è®²è¿‡ï¼Œè¿™è¾¹ä¸é‡å¤è®²ï¼Œä¼šè®²ä¸‹æ•°æ®åº“å¦‚ä½•å»ºç«‹ã€‚</p><h6 id="Fluro-è·¯ç”±ç®¡ç†ç±»"><a href="#Fluro-è·¯ç”±ç®¡ç†ç±»" class="headerlink" title="Fluro è·¯ç”±ç®¡ç†ç±»"></a>Fluro è·¯ç”±ç®¡ç†ç±»</h6><p>é¦–å…ˆï¼Œéœ€è¦çŸ¥é“ï¼Œè¯¥é¡¹ç›®çš„ç•Œé¢å¤§æ¦‚åˆ†å¦‚ä¸‹çš„ç•Œé¢(å½“ç„¶å¯å…ˆåªå®šä¹‰é¦–é¡µï¼Œå‰©ä¸‹ç”¨åˆ°äº†å†å®šä¹‰ï¼Œè¯¥é¡¹ç›®ç›¸å¯¹ç®€å•ï¼Œæ‰€ä»¥å…ˆåˆ—å‡ºæ¥)ï¼šçœé€‰æ‹©é¡µï¼Œå¸‚é€‰æ‹©é¡µï¼ŒåŒºé€‰æ‹©é¡µï¼Œå¤©æ°”å±•ç¤ºé¡µï¼Œè®¾ç½®é¡µã€‚æ‰€ä»¥ fluro çš„ç®¡ç†ç±»å¯æŒ‰å¦‚ä¸‹å®šä¹‰ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥çœ‹ `routers/routers.dart` æ–‡ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Routers</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// å„ä¸ªé¡µé¢å¯¹åº”çš„è·¯å¾„</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> root = <span class="string">'/'</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> weather = <span class="string">'/weather'</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> provinces = <span class="string">'/provinces'</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> cities = <span class="string">'/cities'</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> districts = <span class="string">'/districts'</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> settings = <span class="string">'/settings'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// è¯¥æ–¹æ³•ç”¨äºæ”¾åˆ° `main` æ–¹æ³•ä¸­å®šä¹‰æ‰€æœ‰çš„è·¯ç”±ï¼Œ</span></span><br><span class="line">  <span class="comment">/// å¯¹åº”çš„ handler å¯æ”¾åŒä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå¯æ”¾å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œçœ‹ä¸ªäººå–œå¥½</span></span><br><span class="line">  <span class="keyword">static</span> configureRouters(Router router) &#123;</span><br><span class="line">    router.notFoundHandler = notFoundHandler;</span><br><span class="line"></span><br><span class="line">    router.define(root, handler: rootHandler); <span class="comment">// é¦–é¡µ</span></span><br><span class="line"></span><br><span class="line">    router.define(weather, handler: weatherHandler); <span class="comment">// å¤©æ°”å±•ç¤ºé¡µ</span></span><br><span class="line"></span><br><span class="line">    router.define(provinces, handler: provincesHandler); <span class="comment">// çœåˆ—è¡¨é¡µ</span></span><br><span class="line"></span><br><span class="line">    router.define(cities, handler: citiesHandler); <span class="comment">// çœä¸‹å¸‚åˆ—è¡¨é¡µ</span></span><br><span class="line"></span><br><span class="line">    router.define(districts, handler: districtsHandler); <span class="comment">// å¸‚ä¸‹åŒºåˆ—è¡¨é¡µ</span></span><br><span class="line"></span><br><span class="line">    router.define(settings, handler: settingsHandler); <span class="comment">// è®¾ç½®é¡µ</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// ç”Ÿæˆå¤©æ°”æ˜¾ç¤ºé¡µé¢è·¯å¾„ï¼Œéœ€è¦ç”¨åˆ°åŸå¸‚ id</span></span><br><span class="line">  <span class="keyword">static</span> generateWeatherRouterPath(<span class="built_in">String</span> cityId) =&gt; <span class="string">'$weather?city_id=$cityId'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// ç”Ÿæˆçœä¸‹çš„å¸‚åˆ—è¡¨é¡µç›¸åº”è·¯å¾„ éœ€è¦ç”¨åˆ°çœ id åŠçœå</span></span><br><span class="line">  <span class="keyword">static</span> generateProvinceRouterPath(<span class="built_in">int</span> provinceId, <span class="built_in">String</span> name)</span><br><span class="line">                    =&gt; <span class="string">'$cities?province_id=$provinceId&amp;name=$name'</span>;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">/// ç”Ÿæˆå¸‚ä¸‹çš„åŒºåˆ—è¡¨é¡µç›¸åº”è·¯å¾„ï¼Œéœ€ç”¨åˆ°å¸‚ id åŠå¸‚å</span></span><br><span class="line">  <span class="keyword">static</span> generateCityRouterPath(<span class="built_in">int</span> provinceId, <span class="built_in">int</span> cityId, <span class="built_in">String</span> name) </span><br><span class="line">                    =&gt; <span class="string">'$districts?province_id=$provinceId&amp;city_id=$cityId&amp;name=$name'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// æŸ¥çœ‹ `routers/handler.dart` æ–‡ä»¶</span></span><br><span class="line">Handler notFoundHandler = Handler(handlerFunc: (_, params) &#123;</span><br><span class="line">  Logger(<span class="string">'RouterHandler:'</span>).log(<span class="string">'Not Found Router'</span>); <span class="comment">// å½“æ‰¾ä¸åˆ°ç›¸åº”çš„è·¯ç”±æ—¶ï¼Œæ‰“å°ä¿¡æ¯å¤„ç†</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Handler rootHandler = Handler(handlerFunc: (_, params) =&gt; SplashPage());</span><br><span class="line"></span><br><span class="line">Handler weatherHandler = Handler(handlerFunc: (_, params) &#123;</span><br><span class="line">  <span class="built_in">String</span> cityId = params[<span class="string">'city_id'</span>]?.first; <span class="comment">// è·å–ç›¸åº”çš„å‚æ•°</span></span><br><span class="line">  <span class="keyword">return</span> WeatherPage(city: cityId);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Handler provincesHandler = Handler(handlerFunc: (_, params) =&gt; ProvinceListPage());</span><br><span class="line"></span><br><span class="line">Handler citiesHandler = Handler(handlerFunc: (_, params) &#123;</span><br><span class="line">  <span class="built_in">String</span> provinceId = params[<span class="string">'province_id'</span>]?.first;</span><br><span class="line">  <span class="built_in">String</span> name = params[<span class="string">'name'</span>]?.first;</span><br><span class="line">  <span class="keyword">return</span> CityListPage(provinceId: provinceId, </span><br><span class="line">                      name: FluroConvertUtils.fluroCnParamsDecode(name));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Handler districtsHandler = Handler(handlerFunc: (_, params) &#123;</span><br><span class="line">  <span class="built_in">String</span> provinceId = params[<span class="string">'province_id'</span>]?.first;</span><br><span class="line">  <span class="built_in">String</span> cityId = params[<span class="string">'city_id'</span>]?.first;</span><br><span class="line">  <span class="built_in">String</span> name = params[<span class="string">'name'</span>]?.first;</span><br><span class="line">  <span class="keyword">return</span> DistrictListPage(provinceId: provinceId, cityId: cityId, </span><br><span class="line">                          name: FluroConvertUtils.fluroCnParamsDecode(name));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Handler settingsHandler = Handler(handlerFunc: (_, params) =&gt; SettingsPage());</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆç•Œé¢çš„è·¯ç”±åˆ°è¿™å°±ç¼–å†™å¥½äº†ï¼Œä½†æ˜¯å‰é¢æåˆ°äº† fluro ç›®å‰ä¸æ”¯æŒä¸­æ–‡çš„ä¼ é€’ï¼Œæ‰€ä»¥åœ¨ä¼ é€’ä¸­æ–‡æ—¶å€™ï¼Œéœ€è¦å…ˆè¿›è¡Œè½¬ç ï¼Œè¿™è¾¹æä¾›ä¸€ä¸ªè‡ªå·±å†™çš„æ–¹æ³•ï¼Œå°ä¼™ä¼´æœ‰æ›´å¥½çš„æ–¹æ³•ä¹Ÿå¯ä»¥ç›´æ¥åœ¨é¡¹ç›®æ issue</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// æŸ¥çœ‹ `utils/fluro_convert_util.dart` æ–‡ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FluroConvertUtils</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// fluro ä¼ é€’ä¸­æ–‡å‚æ•°å‰ï¼Œå…ˆè½¬æ¢ï¼Œfluro ä¸æ”¯æŒä¸­æ–‡ä¼ é€’</span></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">String</span> fluroCnParamsEncode(<span class="built_in">String</span> originalCn) &#123;</span><br><span class="line">    <span class="built_in">StringBuffer</span> sb = <span class="built_in">StringBuffer</span>();</span><br><span class="line">    <span class="keyword">var</span> encoded = Utf8Encoder().convert(originalCn); <span class="comment">// utf8 ç¼–ç ï¼Œä¼šç”Ÿæˆä¸€ä¸ª int åˆ—è¡¨</span></span><br><span class="line">    encoded.forEach((val) =&gt; sb.write(<span class="string">'$val,'</span>)); <span class="comment">// å°† int åˆ—è¡¨é‡æ–°è½¬æ¢æˆå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">return</span> sb.toString().substring(<span class="number">0</span>, sb.length - <span class="number">1</span>).toString();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// fluro ä¼ é€’åå–å‡ºå‚æ•°ï¼Œè§£æ</span></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">String</span> fluroCnParamsDecode(<span class="built_in">String</span> encodedCn) &#123;</span><br><span class="line">    <span class="keyword">var</span> decoded = encodedCn.split(<span class="string">'['</span>).last.split(<span class="string">']'</span>).first.split(<span class="string">','</span>); <span class="comment">// å¯¹å‚æ•°å­—ç¬¦ä¸²åˆ†å‰²</span></span><br><span class="line">    <span class="keyword">var</span> list = &lt;<span class="built_in">int</span>&gt;[];</span><br><span class="line">    decoded.forEach((s) =&gt; list.add(<span class="built_in">int</span>.parse(s.trim()))); <span class="comment">// è½¬å› int åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">return</span> Utf8Decoder().convert(list); <span class="comment">// è§£ç </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="Database-ç®¡ç†ç±»ç¼–å†™"><a href="#Database-ç®¡ç†ç±»ç¼–å†™" class="headerlink" title="Database ç®¡ç†ç±»ç¼–å†™"></a>Database ç®¡ç†ç±»ç¼–å†™</h6><p>å› ä¸ºæ•°æ®åº“çš„å¼€å¯æ˜¯ä¸€ä¸ªå¾ˆè€—èµ„æºçš„è¿‡ç¨‹ï¼Œæ‰€ä»¥è¿™è¾¹é€šè¿‡å•ä¾‹å¹¶æå–åˆ°é¡¶å±‚ã€‚åœ¨è¯¥é¡¹ç›®ä¸­ï¼Œæ•°æ®åº“ä¸»è¦ç”¨äºå­˜å‚¨åŸå¸‚ä¿¡æ¯ï¼Œå› ä¸ºåŸå¸‚ä¹‹é—´çš„å…³è”æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœé€šè¿‡ <code>shared_preferences</code> æˆ–è€…æ–‡ä»¶å­˜å‚¨ä¼šå¾ˆå¤æ‚ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// æŸ¥çœ‹ `utils/db_utils.dart` æ–‡ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DatabaseUtils</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> _dbName = <span class="string">'weather.db'</span>; <span class="comment">// æ•°æ®è¡¨å</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> _tableProvinces = <span class="string">'provinces'</span>; <span class="comment">// çœè¡¨</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> _tableCities = <span class="string">'cities'</span>; <span class="comment">// å¸‚è¡¨</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> _tableDistricts = <span class="string">'districts'</span>; <span class="comment">// åŒºè¡¨</span></span><br><span class="line">  <span class="keyword">static</span> Database _db;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> DatabaseUtils _instance;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> DatabaseUtils <span class="keyword">get</span> instance =&gt; DatabaseUtils();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// å°†æ•°æ®åº“çš„åˆå§‹åŒ–æ”¾åˆ°ç§æœ‰æ„é€ ä¸­ï¼Œå€¼å…è®¸é€šè¿‡å•ä¾‹è®¿é—®</span></span><br><span class="line">  DatabaseUtils._internal() &#123;</span><br><span class="line">    getDatabasesPath().then((path) <span class="keyword">async</span> &#123;</span><br><span class="line">      _db = <span class="keyword">await</span> openDatabase(join(path, _dbName), version: <span class="number">1</span>, onCreate: (db, version) &#123;</span><br><span class="line">        db.execute(<span class="string">'create table $_tableProvinces('</span></span><br><span class="line">            <span class="string">'id integer primary key autoincrement,'</span></span><br><span class="line">            <span class="string">'province_id integer not null unique,'</span> <span class="comment">// çœ idï¼Œid å”¯ä¸€</span></span><br><span class="line">            <span class="string">'province_name text not null'</span> <span class="comment">// çœå</span></span><br><span class="line">            <span class="string">')'</span>);</span><br><span class="line"></span><br><span class="line">        db.execute(<span class="string">'create table $_tableCities('</span></span><br><span class="line">            <span class="string">'id integer primary key autoincrement,'</span></span><br><span class="line">            <span class="string">'city_id integer not null unique,'</span> <span class="comment">// å¸‚ idï¼Œid å”¯ä¸€</span></span><br><span class="line">            <span class="string">'city_name text not null,'</span> <span class="comment">// å¸‚å</span></span><br><span class="line">            <span class="string">'province_id integer not null,'</span> <span class="comment">// å¯¹åº”çš„çœçš„ idï¼Œä½œä¸ºå¤–é”®åŒçœè¡¨å…³è”</span></span><br><span class="line">            <span class="string">'foreign key(province_id) references $_tableProvinces(province_id)'</span></span><br><span class="line">            <span class="string">')'</span>);</span><br><span class="line"></span><br><span class="line">        db.execute(<span class="string">'create table $_tableDistricts('</span></span><br><span class="line">            <span class="string">'id integer primary key autoincrement,'</span></span><br><span class="line">            <span class="string">'district_id integer not null unique,'</span> <span class="comment">// åŒº id</span></span><br><span class="line">            <span class="string">'district_name text not null,'</span> <span class="comment">// åŒºå</span></span><br><span class="line">            <span class="string">'weather_id text not null unique,'</span> <span class="comment">// æŸ¥è¯¢å¤©æ°”ç”¨çš„ idï¼Œä¾‹å¦‚ CN13579826ï¼Œid å”¯ä¸€</span></span><br><span class="line">            <span class="string">'city_id integer not null,'</span> <span class="comment">// å¯¹åº”å¸‚çš„ idï¼Œä½œä¸ºå¤–é”®åŒå¸‚è¡¨å…³è”</span></span><br><span class="line">            <span class="string">'foreign key(city_id) references $_tableCities(city_id)'</span></span><br><span class="line">            <span class="string">')'</span>);</span><br><span class="line">      &#125;, onUpgrade: (db, oldVersion, newVersion) &#123;&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// æ„å»ºå•ä¾‹</span></span><br><span class="line">  <span class="keyword">factory</span> DatabaseUtils() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">      _instance = DatabaseUtils._internal();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _instance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// æŸ¥è¯¢æ‰€æœ‰çš„çœï¼Œ`ProvinceModel` ä¸ºçœå¸‚æ¥å£è¿”å›æ•°æ®ç”Ÿæˆçš„ model ç±»</span></span><br><span class="line">  <span class="comment">/// æŸ¥çœ‹ `model/province_model.dart` æ–‡ä»¶</span></span><br><span class="line">  Future&lt;<span class="built_in">List</span>&lt;ProvinceModel&gt;&gt; queryAllProvinces() <span class="keyword">async</span> =&gt;</span><br><span class="line">      ProvinceModel.fromProvinceTableList(<span class="keyword">await</span> _db.rawQuery(<span class="string">'select province_id, province_name from $_tableProvinces'</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// æŸ¥è¯¢æŸä¸ªçœå†…çš„æ‰€æœ‰å¸‚</span></span><br><span class="line">  Future&lt;<span class="built_in">List</span>&lt;ProvinceModel&gt;&gt; queryAllCitiesInProvince(<span class="built_in">String</span> proid) <span class="keyword">async</span> =&gt; ProvinceModel.fromCityTableList(<span class="keyword">await</span> _db.rawQuery(</span><br><span class="line">        <span class="string">'select city_id, city_name from $_tableCities where province_id = ?'</span>,</span><br><span class="line">        [proid],</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// æŸ¥è¯¢æŸä¸ªå¸‚å†…çš„æ‰€æœ‰åŒºï¼Œ`DistrictModel` ä¸ºåŒºæ¥å£è¿”å›æ•°æ®ç”Ÿæˆçš„ model ç±»</span></span><br><span class="line">  <span class="comment">/// æŸ¥çœ‹ `model/district_model.dart` æ–‡ä»¶</span></span><br><span class="line">  Future&lt;<span class="built_in">List</span>&lt;DistrictModel&gt;&gt; queryAllDistrictsInCity(<span class="built_in">String</span> cityid) <span class="keyword">async</span> =&gt; DistrictModel.fromDistrictTableList(<span class="keyword">await</span> _db.rawQuery(</span><br><span class="line">        <span class="string">'select district_id, district_name, weather_id from $_tableDistricts where city_id = ?'</span>,</span><br><span class="line">        [cityid],</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// å°†æ‰€æœ‰çš„çœæ’å…¥æ•°æ®åº“</span></span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; insertProvinces(<span class="built_in">List</span>&lt;ProvinceModel&gt; provinces) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> batch = _db.batch();</span><br><span class="line">    provinces.forEach((p) =&gt; batch.rawInsert(</span><br><span class="line">          <span class="string">'insert or ignore into $_tableProvinces (province_id, province_name) values (?, ?)'</span>,</span><br><span class="line">          [p.id, p.name],</span><br><span class="line">        ));</span><br><span class="line">    batch.commit();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// å°†çœå¯¹åº”ä¸‹çš„æ‰€æœ‰å¸‚æ’å…¥æ•°æ®åº“</span></span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; insertCitiesInProvince(<span class="built_in">List</span>&lt;ProvinceModel&gt; cities, <span class="built_in">String</span> proid) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> batch = _db.batch();</span><br><span class="line">    cities.forEach((c) =&gt; batch.rawInsert(</span><br><span class="line">          <span class="string">'insert or ignore into $_tableCities (city_id, city_name, province_id) values (?, ?, ?)'</span>,</span><br><span class="line">          [c.id, c.name, proid],</span><br><span class="line">        ));</span><br><span class="line">    batch.commit();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// å°†å¸‚ä¸‹çš„æ‰€æœ‰åŒºæ’å…¥æ•°æ®åº“</span></span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; insertDistrictsInCity(<span class="built_in">List</span>&lt;DistrictModel&gt; districts, <span class="built_in">String</span> cityid) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> batch = _db.batch();</span><br><span class="line">    districts.forEach((d) =&gt; batch.rawInsert(</span><br><span class="line">          <span class="string">'insert or ignore into $_tableDistricts (district_id, district_name, weather_id, city_id) values (?, ?, ?, ?)'</span>,</span><br><span class="line">          [d.id, d.name, d.weatherId, cityid],</span><br><span class="line">        ));</span><br><span class="line">    batch.commit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰å®Œå…¨å±€ä½¿ç”¨çš„æ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨ <code>main</code> å‡½æ•°ä¸­è¿›è¡Œç›¸å…³çš„åˆå§‹åŒ–äº†</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// æŸ¥çœ‹ `main.dart` æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="comment">// åˆå§‹åŒ– fluro router</span></span><br><span class="line">  Router router = Router();</span><br><span class="line">  Routers.configureRouters(router);</span><br><span class="line">  Application.router = router;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ– http</span></span><br><span class="line">  Application.http = HttpUtils(baseUrl: WeatherApi.WEATHER_HOST);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ– db</span></span><br><span class="line">  Application.db = DatabaseUtils.instance;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¼ºåˆ¶ç«–å±ï¼Œå› ä¸ºè®¾ç½®ç«–å±ä¸º `Future` æ–¹æ³•ï¼Œé˜²æ­¢è®¾ç½®æ— æ•ˆå¯ç­‰è¿”å›å€¼åå†å¯åŠ¨ App</span></span><br><span class="line">  SystemChrome.setPreferredOrientations([DeviceOrientation.portraitDown, DeviceOrientation.portraitUp]).then((_) &#123;</span><br><span class="line">    runApp(WeatherApp()); <span class="comment">// App ç±»å¯æ”¾åœ¨åŒä¸ªæ–‡ä»¶ï¼Œä¸ªäººä¹ æƒ¯å•ç‹¬ä¸€ä¸ªæ–‡ä»¶å­˜æ”¾</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Platform.isAndroid) &#123;</span><br><span class="line">      SystemChrome.setSystemUIOverlayStyle(SystemUiOverlayStyle(statusBarColor: Colors.transparent));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeatherApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">            title: <span class="string">'Weather App'</span>,</span><br><span class="line">            onGenerateRoute: Application.router.generator, <span class="comment">// å°† fluro çš„è·¯ç”±è¿›è¡Œæ³¨å†Œ</span></span><br><span class="line">            debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">          );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–å®Œæ¯•ï¼Œæ¥ç€å°±å¯ä»¥è¿›è¡Œé¡µé¢çš„ç¼–å†™äº†ã€‚</p><h5 id="é¦–é¡µç¼–å†™"><a href="#é¦–é¡µç¼–å†™" class="headerlink" title="é¦–é¡µç¼–å†™"></a>é¦–é¡µç¼–å†™</h5><p>é¦–é¡µä¸»è¦æ˜¯ä¸ºäº†å¯¹ App çš„ä¸€ä¸ªå¤§æ¦‚å±•ç¤ºï¼Œæˆ–è€…æ˜¯ä¸€äº›å¹¿å‘Šçš„å±•ç¤ºï¼ŒåŒæ—¶ä¹Ÿç»™ä¸€äº›æ•°æ®åˆå§‹åŒ–æä¾›æ—¶é—´ï¼Œå½“ç”¨æˆ·è¿›å…¥åæœ‰æ›´å¥½çš„ä½“éªŒæ•ˆæœã€‚æˆ‘ä»¬åœ¨è¿™é‡Œå°±åšä¸€ä¸ªå›¾æ ‡çš„å±•ç¤º(å›¾æ ‡å¯è‡ªè¡Œåˆ°é¡¹ç›®ä¸­ <code>images</code> æ–‡ä»¶å¤¹æŸ¥æ‰¾)ï¼Œå»¶æ—¶ 5s åè·³è½¬ä¸‹ä¸ªé¡µé¢ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// æŸ¥çœ‹ `splash_page.dart` æ–‡ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SplashPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">/// å› ä¸ºå·²ç»å¼•å…¥äº† rxdartï¼Œè¿™é‡Œé€šè¿‡ rxdart.timer è¿›è¡Œå€’è®¡æ—¶</span></span><br><span class="line">    <span class="comment">/// å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ Futuer.delayed è¿›è¡Œå€’è®¡æ—¶</span></span><br><span class="line">    <span class="comment">/// 5s è®¡æ—¶ï¼Œå¦‚æœå·²ç»é€‰æ‹©åŸå¸‚ï¼Œè·³è½¬å¤©æ°”ç•Œé¢ï¼Œå¦åˆ™è¿›å…¥åŸå¸‚é€‰æ‹©</span></span><br><span class="line">    Observable.timer(<span class="number">0</span>, <span class="built_in">Duration</span>(milliseconds: <span class="number">5000</span>)).listen((_) &#123;</span><br><span class="line">      PreferenceUtils.instance.getString(PreferencesKey.WEATHER_CITY_ID)</span><br><span class="line">          .then((city) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰è¿˜æœªé€‰æ‹©åŸå¸‚ï¼Œåˆ™è¿›å…¥åŸå¸‚é€‰æ‹©é¡µï¼Œå¦åˆ™è·³è½¬å¤©æ°”è¯¦æƒ…é¡µ</span></span><br><span class="line">        <span class="comment">// replace: true å³ä¸º Navigator.pushReplacement æ–¹æ³•</span></span><br><span class="line">        Application.router.navigateTo(context, city.isEmpty </span><br><span class="line">                                      ? Routers.provinces </span><br><span class="line">                                      : Routers.generateWeatherRouterPath(city), </span><br><span class="line">                                                                        replace: <span class="keyword">true</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: Container(</span><br><span class="line">        alignment: Alignment.center,</span><br><span class="line">        color: Colors.white,</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            <span class="comment">// å±•ç¤ºå›¾æ ‡</span></span><br><span class="line">            Image.asset(Resource.pngSplash, width: <span class="number">200.0</span>, height: <span class="number">200.0</span>),</span><br><span class="line">            <span class="comment">// å±•ç¤ºæ–‡å­—æé†’ï¼Œç”¨ SizedBox è®¾ç½®åŒºåŸŸå¤§å°</span></span><br><span class="line">            SizedBox(</span><br><span class="line">                width: MediaQuery.of(context).size.width * <span class="number">0.7</span>,</span><br><span class="line">                child: Text(</span><br><span class="line">                  <span class="string">'æ‰€æœ‰å¤©æ°”æ•°æ®å‡ä¸ºæ¨¡æ‹Ÿæ•°æ®ï¼Œä»…ç”¨ä½œå­¦ä¹ ç›®çš„ä½¿ç”¨ï¼Œè¯·å‹¿å½“ä½œçœŸå®çš„å¤©æ°”é¢„æŠ¥è½¯ä»¶æ¥ä½¿ç”¨'</span>,</span><br><span class="line">                  textAlign: TextAlign.center,</span><br><span class="line">                  softWrap: <span class="keyword">true</span>,</span><br><span class="line">                  style: TextStyle(color: Colors.red[<span class="number">700</span>], fontSize: <span class="number">16.0</span>),</span><br><span class="line">                ))</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åŸå¸‚é€‰æ‹©é¡µé¢"><a href="#åŸå¸‚é€‰æ‹©é¡µé¢" class="headerlink" title="åŸå¸‚é€‰æ‹©é¡µé¢"></a>åŸå¸‚é€‰æ‹©é¡µé¢</h5><p>å½“é¦–æ¬¡è¿›å…¥çš„æ—¶å€™ï¼Œç”¨æˆ·è‚¯å®šæ²¡æœ‰é€‰æ‹©åŸå¸‚ï¼Œæ‰€ä»¥å…ˆç¼–å†™åŸå¸‚é€‰æ‹©åˆ—è¡¨é¡µé¢ï¼Œå› ä¸ºæ•´ä½“çš„é¡¹ç›®ä½¿ç”¨ BLoC åˆ†ç¦»ä¸šåŠ¡é€»è¾‘å’Œé¡µé¢ï¼Œæ‰€ä»¥å…ˆç¼–å†™æ•°æ®ç®¡ç†ç±»å§ï¼ŒæŠŠæ•°æ®è¯·æ±‚å’Œæ”¹å˜çš„ä¸šåŠ¡é€»è¾‘æ”¾åˆ°è¿™å—ï¼ŒBLoC çš„å®ç°åœ¨å‰é¢è®²è¿‡äº†ï¼Œè¿™è¾¹å°±ä¸é‡å¤æäº†ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// æŸ¥çœ‹ `provinces_bloc.dart` æ–‡ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProvincesBloc</span> <span class="keyword">extends</span> <span class="title">BaseBloc</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> _logger = Logger(<span class="string">'ProvincesBloc'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span>&lt;ProvinceModel&gt; _provinces = []; <span class="comment">// å…¨å›½çœ</span></span><br><span class="line">  <span class="built_in">List</span>&lt;ProvinceModel&gt; _cities = []; <span class="comment">// çœå†…å¸‚</span></span><br><span class="line">  <span class="built_in">List</span>&lt;DistrictModel&gt; _districts = []; <span class="comment">// å¸‚å†…åŒº</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span>&lt;ProvinceModel&gt; <span class="keyword">get</span> provinces =&gt; _provinces;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span>&lt;ProvinceModel&gt; <span class="keyword">get</span> cities =&gt; _cities;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span>&lt;DistrictModel&gt; <span class="keyword">get</span> districts =&gt; _districts;</span><br><span class="line"></span><br><span class="line">  BehaviorSubject&lt;<span class="built_in">List</span>&lt;ProvinceModel&gt;&gt; _provinceController = BehaviorSubject();</span><br><span class="line"></span><br><span class="line">  BehaviorSubject&lt;<span class="built_in">List</span>&lt;ProvinceModel&gt;&gt; _citiesController = BehaviorSubject();</span><br><span class="line"></span><br><span class="line">  BehaviorSubject&lt;<span class="built_in">List</span>&lt;DistrictModel&gt;&gt; _districtController = BehaviorSubject();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// streamï¼Œç”¨äº StreamBuilder çš„ stream å‚æ•°</span></span><br><span class="line">  Observable&lt;<span class="built_in">List</span>&lt;ProvinceModel&gt;&gt; <span class="keyword">get</span> provinceStream </span><br><span class="line">                                             =&gt; Observable(_provinceController.stream);</span><br><span class="line"></span><br><span class="line">  Observable&lt;<span class="built_in">List</span>&lt;ProvinceModel&gt;&gt; <span class="keyword">get</span> cityStream =&gt; Observable(_citiesController.stream);</span><br><span class="line"></span><br><span class="line">  Observable&lt;<span class="built_in">List</span>&lt;DistrictModel&gt;&gt; <span class="keyword">get</span> districtStream</span><br><span class="line">                                            =&gt; Observable(_districtController.stream);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// é€šçŸ¥åˆ·æ–°çœä»½åˆ—è¡¨</span></span><br><span class="line">  changeProvinces(<span class="built_in">List</span>&lt;ProvinceModel&gt; provinces) &#123;</span><br><span class="line">    _provinces.clear();</span><br><span class="line">    _provinces.addAll(provinces);</span><br><span class="line">    _provinceController.add(_provinces);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// é€šçŸ¥åˆ·æ–°åŸå¸‚åˆ—è¡¨</span></span><br><span class="line">  changeCities(<span class="built_in">List</span>&lt;ProvinceModel&gt; cities) &#123;</span><br><span class="line">    _cities.clear();</span><br><span class="line">    _cities.addAll(cities);</span><br><span class="line">    _citiesController.add(_cities);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// é€šçŸ¥åˆ·æ–°åŒºåˆ—è¡¨</span></span><br><span class="line">  changeDistricts(<span class="built_in">List</span>&lt;DistrictModel&gt; districts) &#123;</span><br><span class="line">    _districts.clear();</span><br><span class="line">    _districts.addAll(districts);</span><br><span class="line">    _districtController.add(_districts);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// è¯·æ±‚å…¨å›½çœ</span></span><br><span class="line">  Future&lt;<span class="built_in">List</span>&lt;ProvinceModel&gt;&gt; requestAllProvinces() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="keyword">await</span> Application.http.getRequest(WeatherApi.WEATHER_PROVINCE, </span><br><span class="line">                                           error: (msg) =&gt; _logger.log(msg, <span class="string">'province'</span>));</span><br><span class="line">    <span class="keyword">return</span> resp == <span class="keyword">null</span> || resp.data == <span class="keyword">null</span> ? [] : ProvinceModel.fromMapList(resp.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// è¯·æ±‚çœå†…åŸå¸‚</span></span><br><span class="line">  Future&lt;<span class="built_in">List</span>&lt;ProvinceModel&gt;&gt; requestAllCitiesInProvince(<span class="built_in">String</span> proid) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="keyword">await</span> Application.http</span><br><span class="line">        .getRequest(<span class="string">'<span class="subst">$&#123;WeatherApi.WEATHER_PROVINCE&#125;</span>/$proid'</span>, </span><br><span class="line">                                           error: (msg) =&gt; _logger.log(msg, <span class="string">'city'</span>));</span><br><span class="line">    <span class="keyword">return</span> resp == <span class="keyword">null</span> || resp.data == <span class="keyword">null</span> ? [] : ProvinceModel.fromMapList(resp.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// è¯·æ±‚å¸‚å†…çš„åŒº</span></span><br><span class="line">  Future&lt;<span class="built_in">List</span>&lt;DistrictModel&gt;&gt; requestAllDistricts(<span class="built_in">String</span> proid, <span class="built_in">String</span> cityid) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="keyword">await</span> Application.http</span><br><span class="line">        .getRequest(<span class="string">'<span class="subst">$&#123;WeatherApi.WEATHER_PROVINCE&#125;</span>/$proid/$cityid'</span>, </span><br><span class="line">                                           error: (msg) =&gt; _logger.log(msg, <span class="string">'district'</span>));</span><br><span class="line">    <span class="keyword">return</span> resp == <span class="keyword">null</span> || resp.data == <span class="keyword">null</span> ? [] : DistrictModel.fromMapList(resp.data);</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123; <span class="comment">// åŠæ—¶é”€æ¯</span></span><br><span class="line">    _provinceController?.close();</span><br><span class="line">    _citiesController?.close();</span><br><span class="line">    _districtController?.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™å®Œ BLoC éœ€è¦å¯¹å…¶è¿›è¡Œæ³¨å†Œï¼Œå› ä¸ºåŸå¸‚é€‰æ‹©ç›¸å¯¹è¿˜æ˜¯æ¯”è¾ƒé¢‘ç¹çš„ï¼Œæ‰€ä»¥å¯ä»¥æ”¾æœ€é¡¶å±‚è¿›è¡Œæ³¨å†Œ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span>  BlocProvider(</span><br><span class="line">      bloc: ProvincesBloc(), <span class="comment">// åŸå¸‚åˆ‡æ¢ BLoC</span></span><br><span class="line">      child: MaterialApp(</span><br><span class="line">        title: <span class="string">'Weather App'</span>,</span><br><span class="line">        onGenerateRoute: Application.router.generator,</span><br><span class="line">        debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br></pre></td></tr></table></figure><p>åŸå¸‚é€‰æ‹©å°±æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œç›´æ¥é€šè¿‡ <code>ListView</code> ç”Ÿæˆå³å¯ï¼Œå‰é¢è®² <code>ListView</code> çš„æ—¶å€™æåˆ°ï¼Œå°½å¯èƒ½å›ºå®š item çš„é«˜åº¦ï¼Œä¼šæé«˜ç»˜åˆ¶æ•ˆç‡</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// æŸ¥çœ‹ `provinces_page.dart` æ–‡ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProvinceListPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">var</span> _bloc = BlocProvider.of&lt;ProvincesBloc&gt;(context);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿›å…¥çš„æ—¶å€™å…ˆä½¿ç”¨æ•°æ®åº“çš„æ•°æ®å¡«å……ç•Œé¢</span></span><br><span class="line">    Application.db.queryAllProvinces().then((ps) =&gt; _bloc.changeProvinces(ps));</span><br><span class="line">    <span class="comment">// ç½‘ç»œæ•°æ®æ›´æ–°åˆ—è¡¨å¹¶åˆ·æ–°æ•°æ®åº“æ•°æ®</span></span><br><span class="line">    _bloc.requestAllProvinces().then((provinces) &#123;</span><br><span class="line">      _bloc.changeProvinces(provinces);</span><br><span class="line">      Application.db.insertProvinces(provinces);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'è¯·é€‰æ‹©çœä»½'</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Container(</span><br><span class="line">        color: Colors.black12,</span><br><span class="line">        alignment: Alignment.center,</span><br><span class="line">        <span class="comment">// çœåˆ—è¡¨é€‰æ‹©</span></span><br><span class="line">        child: StreamBuilder(</span><br><span class="line">          stream: _bloc.provinceStream,</span><br><span class="line">          initialData: _bloc.provinces,</span><br><span class="line">          builder: (_, AsyncSnapshot&lt;<span class="built_in">List</span>&lt;ProvinceModel&gt;&gt; snapshot) </span><br><span class="line">            =&gt; !snapshot.hasData || snapshot.data.isEmpty</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰çš„æ•°æ®æœªåŠ è½½åˆ™ç»™ä¸€ä¸ªåŠ è½½ï¼Œå¦åˆ™æ˜¾ç¤ºåˆ—è¡¨åŠ è½½</span></span><br><span class="line">              ? CupertinoActivityIndicator(radius: <span class="number">12.0</span>) </span><br><span class="line">              : ListView.builder(</span><br><span class="line">              physics: BouncingScrollPhysics(),</span><br><span class="line">              padding: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">12.0</span>),</span><br><span class="line">              itemBuilder: (_, index) =&gt; InkWell(</span><br><span class="line">                child: Container(</span><br><span class="line">                  alignment: Alignment.centerLeft,</span><br><span class="line">                  child: Text(snapshot.data[index].name, style: TextStyle(fontSize: <span class="number">18.0</span>, color: Colors.black)),</span><br><span class="line">                ),</span><br><span class="line">                onTap: () =&gt; Application.router.navigateTo(</span><br><span class="line">                    context,</span><br><span class="line">                    <span class="comment">// è·³è½¬ä¸‹å±‚çœå†…åŸå¸‚é€‰æ‹©ï¼Œéœ€è¦å°†å½“å‰çš„çœ id ä»¥åŠçœåä¼ å…¥</span></span><br><span class="line">                    Routers.</span><br><span class="line">                    generateProvinceRouterPath(snapshot.data[index].id, FluroConvertUtils.fluroCnParamsEncode(snapshot.data[index].name)),</span><br><span class="line">                    transition: TransitionType.fadeIn),</span><br><span class="line">              ),</span><br><span class="line">              itemExtent: <span class="number">50.0</span>,</span><br><span class="line">              itemCount: snapshot.data.length),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºå¸‚å’ŒåŒºçš„åˆ—è¡¨é€‰æ‹©ä¹Ÿç±»ä¼¼ï¼Œé™¤äº†æœ€åçš„ç‚¹å‡»ä¼šæœ‰äº›åŒºåˆ«é¡µé¢çš„å¸ƒå±€å‡ ä¹ä¸€è‡´ï¼Œè¿™è¾¹åªæä¸‹ç‚¹å‡»äº‹ä»¶</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// æŸ¥çœ‹ `cities_page.dart` æ–‡ä»¶</span></span><br><span class="line">Application.router.navigateTo(</span><br><span class="line">                                    context,</span><br><span class="line">                                    <span class="comment">// è·³è½¬ä¸‹å±‚çœå†…åŸå¸‚é€‰æ‹©</span></span><br><span class="line">                                    Routers.generateProvinceRouterPath(</span><br><span class="line">                                        snapshot.data[index].id, FluroConvertUtils.fluroCnParamsEncode(snapshot.data[index].name)),</span><br><span class="line">                                    transition: TransitionType.fadeIn),</span><br><span class="line">                              )</span><br><span class="line"><span class="comment">// è®¾ç½®ä¸ºå½“å‰åŒºï¼Œå¹¶æ¸…ç†è·¯ç”± stackï¼Œå¹¶å°†å¤©æ°”ç•Œé¢è®¾ç½®åˆ°æœ€ä¸Šå±‚</span></span><br><span class="line">onTap: () &#123;</span><br><span class="line"> PreferenceUtils.instance</span><br><span class="line">     .saveString(PreferencesKey.WEATHER_CITY_ID, snapshot.data[index].weatherId);</span><br><span class="line">    </span><br><span class="line">                                  Application.router.navigateTo(context, Routers.generateWeatherRouterPath(snapshot.data[index].weatherId),</span><br><span class="line">                                      transition: TransitionType.inFromRight, clearStack: <span class="keyword">true</span>);</span><br><span class="line">                                &#125;)</span><br></pre></td></tr></table></figure><h5 id="å¤©æ°”è¯¦æƒ…é¡µé¢"><a href="#å¤©æ°”è¯¦æƒ…é¡µé¢" class="headerlink" title="å¤©æ°”è¯¦æƒ…é¡µé¢"></a>å¤©æ°”è¯¦æƒ…é¡µé¢</h5><p>å¤©æ°”è¯¦æƒ…é¡µé¢ç›¸å¯¹éƒ¨ä»¶ä¼šå¤šç‚¹ï¼Œä¸ºäº†çœ‹ç€èˆ’æœä¸€ç‚¹ï¼Œè¿™é‡Œæ‹†æˆå¤šä¸ªéƒ¨åˆ†æ¥ç¼–å†™ï¼Œåœ¨è¿™ä¹‹å‰è¿˜æ˜¯å…ˆç¼–å†™æ•°æ®çš„ç®¡ç†ç±»ï¼Œå› ä¸ºå¤©æ°”è¯¦æƒ…æ¥å£è¿”å›çš„æ•°æ®åµŒå¥—å±‚æ¬¡æ¯”è¾ƒå¤šï¼Œå…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œä¸é€‚åˆç”¨ <code>database</code> æ¥åšæŒä¹…åŒ–ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨æ–‡ä»¶æŒä¹…åŒ–æ–¹å¼ã€‚å½“ç„¶æœ‰äº›å°ä¼™ä¼´ä¼šé—®å¹²å˜›ä¸ä½¿ç”¨ <code>shared_preferences</code> æ¥å­˜å‚¨ï¼Œç†è®ºä¸Šåº”è¯¥æ²¡æœ‰å¤ªå¤§çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸ªäººå»ºè®®ç›¸å¯¹å¤æ‚çš„æ•°æ®ä½¿ç”¨æ–‡ä»¶å­˜å‚¨ä¼šç›¸å¯¹æ¯”è¾ƒå¥½ç‚¹ï¼Œä¸€å®šè¦è¯´ä¸ªä¸ºä»€ä¹ˆï¼Œæˆ‘ä¹Ÿè¯´ä¸å‡ºæ¥ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// æŸ¥çœ‹ `weather_bloc.dart` æ–‡ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeatherBloc</span> <span class="keyword">extends</span> <span class="title">BaseBloc</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> _logger = Logger(<span class="string">'WeatherBloc'</span>);</span><br><span class="line"></span><br><span class="line">  WeatherModel _weather; <span class="comment">// å¤©æ°”æƒ…å†µ</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> _background = WeatherApi.DEFAULT_BACKGROUND; <span class="comment">// èƒŒæ™¯</span></span><br><span class="line"></span><br><span class="line">  WeatherModel <span class="keyword">get</span> weather =&gt; _weather;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String</span> <span class="keyword">get</span> background =&gt; _background;</span><br><span class="line"></span><br><span class="line">  BehaviorSubject&lt;WeatherModel&gt; _weatherController = BehaviorSubject();</span><br><span class="line"></span><br><span class="line">  BehaviorSubject&lt;<span class="built_in">String</span>&gt; _backgroundController = BehaviorSubject();</span><br><span class="line"></span><br><span class="line">  Observable&lt;WeatherModel&gt; <span class="keyword">get</span> weatherStream =&gt; Observable(_weatherController.stream);</span><br><span class="line"></span><br><span class="line">  Observable&lt;<span class="built_in">String</span>&gt; <span class="keyword">get</span> backgroundStream =&gt; Observable(_backgroundController.stream);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// æ›´æ–°å¤©æ°”æƒ…å†µ</span></span><br><span class="line">  updateWeather(WeatherModel weather) &#123;</span><br><span class="line">    _weather = weather;</span><br><span class="line">    _weatherController.add(_weather);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// æ›´æ–°å¤©æ°”èƒŒæ™¯</span></span><br><span class="line">  updateBackground(<span class="built_in">String</span> background) &#123;</span><br><span class="line">    _background = background;</span><br><span class="line">    _backgroundController.add(_background);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¯·æ±‚å¤©æ°”æƒ…å†µ</span></span><br><span class="line">  Future&lt;WeatherModel&gt; requestWeather(<span class="built_in">String</span> id) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="keyword">await</span> Application.http</span><br><span class="line">        .getRequest(WeatherApi.WEATHER_STATUS, </span><br><span class="line">                    params: &#123;<span class="string">'cityid'</span>: id, <span class="string">'key'</span>: WeatherApi.WEATHER_KEY&#125;, </span><br><span class="line">                    error: (msg) =&gt; _logger.log(msg, <span class="string">'weather'</span>));</span><br><span class="line">    <span class="comment">// è¯·æ±‚æ•°æ®æˆåŠŸåˆ™å†™å…¥åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (resp != <span class="keyword">null</span> &amp;&amp; resp.data != <span class="keyword">null</span>) &#123;</span><br><span class="line">      _writeIntoFile(json.encode(resp.data));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> WeatherModel.fromMap(resp.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;<span class="built_in">String</span>&gt; requestBackground() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="keyword">await</span> Application.http</span><br><span class="line">        .getRequest&lt;<span class="built_in">String</span>&gt;(WeatherApi.WEATHER_BACKGROUND, </span><br><span class="line">                            error: (msg) =&gt; _logger.log(msg, <span class="string">'background'</span>));</span><br><span class="line">    <span class="keyword">return</span> resp == <span class="keyword">null</span> || resp.data == <span class="keyword">null</span> ? WeatherApi.DEFAULT_BACKGROUND : resp.data;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–å­˜å‚¨æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  Future&lt;<span class="built_in">String</span>&gt; _getPath() <span class="keyword">async</span> =&gt; </span><br><span class="line">      <span class="string">'<span class="subst">$&#123;(await getApplicationDocumentsDirectory()).path&#125;</span>/weather.txt'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å†™å…¥åˆ°æ–‡ä»¶</span></span><br><span class="line">  _writeIntoFile(<span class="built_in">String</span> contents) <span class="keyword">async</span> &#123;</span><br><span class="line">    File file = File(<span class="keyword">await</span> _getPath());</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">await</span> file.exists()) file.deleteSync();</span><br><span class="line">    file.createSync();</span><br><span class="line">    file.writeAsString(contents);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ–‡ä»¶è¯»å–å­˜å‚¨ä¿¡æ¯ï¼Œå¦‚æœä¸å­˜åœ¨æ–‡ä»¶åˆ™è¿”å›ç©ºå­—ç¬¦ä¸² ''ï¼Œä¸æ¨èè¿”å› null</span></span><br><span class="line">  Future&lt;<span class="built_in">String</span>&gt; readWeatherFromFile() <span class="keyword">async</span> &#123;</span><br><span class="line">    File file = File(<span class="keyword">await</span> _getPath());</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">await</span> file.exists()) ? file.readAsString() : <span class="string">''</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _weatherController?.close();</span><br><span class="line">    _backgroundController?.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤©æ°”è¯¦æƒ…çš„åˆ·æ–°åªæœ‰å½“ä¸ªé¡µé¢ï¼Œæ‰€ä»¥ BLoC çš„æ³¨å†Œå€¼éœ€è¦åœ¨è·¯ç”±ä¸Šæ³¨å†Œå³å¯ï¼Œåœ¨ fluro å¯¹åº” handler ä¸­åŠ å…¥æ³¨å†Œ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Handler weatherHandler = Handler(handlerFunc: (_, params) &#123;</span><br><span class="line">  <span class="built_in">String</span> cityId = params[<span class="string">'city_id'</span>]?.first; <span class="comment">// è¿™ä¸ª id å¯ä»¥é€šè¿‡ BLoC è·å–ä¹Ÿå¯ä»¥</span></span><br><span class="line">  <span class="keyword">return</span> BlocProvider(child: WeatherPage(city: cityId), bloc: WeatherBloc());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±å¯ä»¥ç¼–å†™ç•Œé¢äº†ï¼Œå…ˆå®ç°æœ€å¤–å±‚çš„èƒŒæ™¯å›¾å˜åŒ–</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// æŸ¥çœ‹ `weather_page.dart` æ–‡ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeatherPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> city;</span><br><span class="line"></span><br><span class="line">  WeatherPage(&#123;Key key, <span class="keyword">this</span>.city&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">var</span> _bloc = BlocProvider.of&lt;WeatherBloc&gt;(context);</span><br><span class="line">    <span class="comment">// è¯·æ±‚èƒŒæ™¯å¹¶æ›´æ–°</span></span><br><span class="line">    _bloc.requestBackground().then((b) =&gt; _bloc.updateBackground(b));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…ˆè¯»å–æœ¬åœ°æ–‡ä»¶ç¼“å­˜è¿›è¡Œé¡µé¢å¡«å……</span></span><br><span class="line">    _bloc.readWeatherFromFile().then((s) &#123;</span><br><span class="line">      <span class="keyword">if</span> (s.isNotEmpty) &#123;</span><br><span class="line">        _bloc.updateWeather(WeatherModel.fromMap(json.decode(s)));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†è¯·æ±‚ç½‘ç»œæ›´æ–°æ•°æ®</span></span><br><span class="line">    _bloc.requestWeather(city).then((w) =&gt; _bloc.updateWeather(w));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: StreamBuilder(</span><br><span class="line">          stream: _bloc.backgroundStream,</span><br><span class="line">          initialData: _bloc.background,</span><br><span class="line">          builder: (_, AsyncSnapshot&lt;<span class="built_in">String</span>&gt; themeSnapshot) =&gt; Container(</span><br><span class="line">                padding: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">12.0</span>, vertical: <span class="number">20.0</span>),</span><br><span class="line">                alignment: Alignment.center,</span><br><span class="line">                decoration: BoxDecoration(</span><br><span class="line">                  color: Colors.black12,</span><br><span class="line">                  image: DecorationImage(</span><br><span class="line">                      image: NetworkImage(themeSnapshot.data), fit: BoxFit.cover),</span><br><span class="line">                ),</span><br><span class="line">                child: <span class="comment">// å…·ä½“å†…éƒ¨å¸ƒå±€é€šè¿‡æ‹†åˆ†å°éƒ¨ä»¶å®ç°</span></span><br><span class="line">              )),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¡µé¢æœ€é¡¶éƒ¨æ˜¯æ˜¾ç¤ºä¸¤ä¸ªæŒ‰é’®ï¼Œä¸€ä¸ªè·³è½¬åŸå¸‚é€‰æ‹©ï¼Œä¸€ä¸ªè·³è½¬è®¾ç½®é¡µé¢ï¼Œæ˜¾ç¤ºå½“å‰çš„åŸå¸‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FollowedHeader</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> AsyncSnapshot&lt;WeatherModel&gt; snapshot; <span class="comment">// snapshot é€šè¿‡ä¸Šå±‚ä¼ å…¥</span></span><br><span class="line"></span><br><span class="line">  FollowedHeader(&#123;Key key, <span class="keyword">this</span>.snapshot&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Row(</span><br><span class="line">      mainAxisAlignment: MainAxisAlignment.spaceBetween,</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        <span class="comment">// åŸå¸‚é€‰æ‹©é¡µé¢è·³è½¬æŒ‰é’®</span></span><br><span class="line">        IconButton(</span><br><span class="line">            icon: Icon(Icons.home, color: Colors.white, size: <span class="number">32.0</span>),</span><br><span class="line">            onPressed: () =&gt; Application.router.</span><br><span class="line">            navigateTo(context, Routers.provinces, </span><br><span class="line">                       transition: TransitionType.inFromLeft)),</span><br><span class="line">        <span class="comment">// å½“å‰åŸå¸‚</span></span><br><span class="line">        Text(<span class="string">'<span class="subst">$&#123;snapshot.data.heWeather[<span class="number">0</span>].basic.location&#125;</span>'</span>, </span><br><span class="line">             style: TextStyle(fontSize: <span class="number">28.0</span>, color: Colors.white)),</span><br><span class="line">        <span class="comment">// è®¾ç½®é¡µé¢è·³è½¬æŒ‰é’®</span></span><br><span class="line">        IconButton(</span><br><span class="line">            icon: Icon(Icons.settings, color: Colors.white, size: <span class="number">32.0</span>),</span><br><span class="line">            onPressed: () =&gt; Application.router</span><br><span class="line">            .navigateTo(context, Routers.settings, </span><br><span class="line">                        transition: TransitionType.inFromRight))</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æ˜¯å½“å‰çš„å¤©æ°”è¯¦æƒ…éƒ¨åˆ†</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CurrentWeatherState</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> AsyncSnapshot&lt;WeatherModel&gt; snapshot;</span><br><span class="line"></span><br><span class="line">  CurrentWeatherState(&#123;Key key, <span class="keyword">this</span>.snapshot&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">var</span> _now = snapshot.data.heWeather[<span class="number">0</span>].now;</span><br><span class="line">    <span class="keyword">var</span> _update = snapshot.data.heWeather[<span class="number">0</span>].update.loc.split(<span class="string">' '</span>).last;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      crossAxisAlignment: CrossAxisAlignment.end,</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        <span class="comment">// å½“å‰çš„æ¸©åº¦</span></span><br><span class="line">        Text(<span class="string">'<span class="subst">$&#123;_now.tmp&#125;</span>â„ƒ'</span>, style: TextStyle(fontSize: <span class="number">50.0</span>, color: Colors.white)),</span><br><span class="line">        <span class="comment">// å½“å‰çš„å¤©æ°”çŠ¶å†µ</span></span><br><span class="line">        Text(<span class="string">'<span class="subst">$&#123;_now.condTxt&#125;</span>'</span>, style: TextStyle(fontSize: <span class="number">24.0</span>, color: Colors.white)),</span><br><span class="line">        Row( <span class="comment">// åˆ·æ–°çš„æ—¶é—´</span></span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.end,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Icon(Icons.refresh, size: <span class="number">16.0</span>, color: Colors.white),</span><br><span class="line">            Padding(padding: <span class="keyword">const</span> EdgeInsets.only(left: <span class="number">4.0</span>)),</span><br><span class="line">            Text(_update, style: TextStyle(fontSize: <span class="number">12.0</span>, color: Colors.white))</span><br><span class="line">          ],</span><br><span class="line">        )</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªå¤©æ°”é¢„æŠ¥çš„åˆ—è¡¨å—ï¼Œä»¥ä¸ºæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå½“ç„¶å¯ä»¥é€šè¿‡ <code>Cloumn</code> æ¥å®ç°ï¼Œä½†æ˜¯å‰é¢æœ‰æåˆ°è¿‡ä¸€ä¸ªåˆ—è¡¨ã€Œç²˜åˆå‰‚ã€â€”- <code>CustomScrollView</code>ï¼Œæ‰€ä»¥è¿™é‡Œçš„æ•´ä½“è¿æ¥æœ€åä¼šé€šè¿‡ <code>CustomScrollView</code> æ¥å®ç°ï¼Œé‚£ä¹ˆä½ å¯ä»¥æ”¾å¿ƒåœ¨æœ€ä¸Šå±‚å®¹å™¨çš„ <code>child</code> å±æ€§åŠ ä¸Š <code>CustomScrollView</code> äº†ã€‚æ¥ç€æ¥å®ç°è¿™å—é¢„æŠ¥æ¨¡å—</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeatherForecast</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> AsyncSnapshot&lt;WeatherModel&gt; snapshot;</span><br><span class="line"></span><br><span class="line">  WeatherForecast(&#123;Key key, <span class="keyword">this</span>.snapshot&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">var</span> _forecastList = snapshot.data.heWeather[<span class="number">0</span>].dailyForecasts; <span class="comment">// è·å–å¤©æ°”é¢„æŠ¥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> SliverFixedExtentList(</span><br><span class="line">        delegate: SliverChildBuilderDelegate(</span><br><span class="line">          (_, index) =&gt; Container(</span><br><span class="line">              color: Colors.black54, <span class="comment">// å¤–å±‚è®¾ç½®èƒŒæ™¯è‰²ï¼Œé˜²æ­¢è¢«æœ€å¤–å±‚å›¾ç‰‡èƒŒæ™¯é®æŒ¡æ–‡å­—</span></span><br><span class="line">              padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">12.0</span>),</span><br><span class="line">              alignment: Alignment.centerLeft,</span><br><span class="line">              child: index == <span class="number">0</span> <span class="comment">// å½“ç¬¬ä¸€ä¸ª item æƒ…å†µï¼Œæ˜¾ç¤º â€˜é¢„æŠ¥â€™</span></span><br><span class="line">                  ? Text(<span class="string">'é¢„æŠ¥'</span>, style: TextStyle(fontSize: <span class="number">24.0</span>, color: Colors.white))</span><br><span class="line">                  : Row(</span><br><span class="line">                      mainAxisAlignment: MainAxisAlignment.spaceBetween,</span><br><span class="line">                      crossAxisAlignment: CrossAxisAlignment.center,</span><br><span class="line">                      children: &lt;Widget&gt;[</span><br><span class="line">                        Text(_forecastList[index - <span class="number">1</span>].date,  <span class="comment">// é¢„æŠ¥çš„æ—¥æœŸ</span></span><br><span class="line">                             style: TextStyle(fontSize: <span class="number">16.0</span>, color: Colors.white)),</span><br><span class="line">                        Expanded( <span class="comment">// å¤©æ°”æƒ…å†µï¼Œè¿™è¾¹é€šè¿‡ expanded è¿›è¡Œå ä½ï¼Œå¹¶å±…ä¸­æ˜¾ç¤º</span></span><br><span class="line">                            child: Center(child: Text(_forecastList[index - <span class="number">1</span>].cond.txtD, </span><br><span class="line">                                                      style: TextStyle(fontSize: <span class="number">16.0</span>,                                                                  color: Colors.white))),</span><br><span class="line">                            flex: <span class="number">2</span>),</span><br><span class="line">                        Expanded(</span><br><span class="line">                            child: Row( <span class="comment">// æœ€é«˜æ¸©åº¦ï¼Œæœ€ä½æ¸©åº¦</span></span><br><span class="line">                              mainAxisAlignment: MainAxisAlignment.spaceBetween,</span><br><span class="line">                              children: &lt;Widget&gt;[</span><br><span class="line">                                Text(_forecastList[index - <span class="number">1</span>].tmp.max, </span><br><span class="line">                                     style: TextStyle(fontSize: <span class="number">16.0</span>, </span><br><span class="line">                                                      color: Colors.white)),</span><br><span class="line">                                Text(_forecastList[index - <span class="number">1</span>].tmp.min, </span><br><span class="line">                                     style: TextStyle(fontSize: <span class="number">16.0</span>, </span><br><span class="line">                                                      color: Colors.white)),</span><br><span class="line">                              ],</span><br><span class="line">                            ),</span><br><span class="line">                            flex: <span class="number">1</span>)</span><br><span class="line">                      ],</span><br><span class="line">                    )),</span><br><span class="line">          childCount: _forecastList.length + <span class="number">1</span>, <span class="comment">// è¿™ä¸ªæ•°é‡éœ€è¦ +1ï¼Œå› ä¸ºæœ‰ä¸ªæ ‡é¢˜éœ€è¦ä¸€ä¸ªæ•°é‡</span></span><br><span class="line">        ),</span><br><span class="line">        itemExtent: <span class="number">50.0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æ˜¯ç©ºæ°”è´¨é‡æŠ¥å‘Šï¼Œä¸€ä¸ªæ ‡é¢˜ï¼Œä¸‹é¢ç”±ä¸¤ä¸ªå¸ƒå±€è¿›è¡Œå¹³åˆ†</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AirQuality</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> AsyncSnapshot&lt;WeatherModel&gt; snapshot;</span><br><span class="line"></span><br><span class="line">  AirQuality(&#123;Key key, <span class="keyword">this</span>.snapshot&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">var</span> quality = snapshot.data.heWeather[<span class="number">0</span>].aqi.city;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">        padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">12.0</span>),</span><br><span class="line">        color: Colors.black54,</span><br><span class="line">        alignment: Alignment.centerLeft,</span><br><span class="line">        child: Column(</span><br><span class="line">          crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            <span class="comment">// æ ‡é¢˜</span></span><br><span class="line">            Padding(padding: <span class="keyword">const</span> EdgeInsets.only(bottom: <span class="number">20.0</span>), child: </span><br><span class="line">                    Text(<span class="string">'ç©ºæ°”è´¨é‡'</span>, style: TextStyle(fontSize: <span class="number">24.0</span>, </span><br><span class="line">                                                  color: Colors.white))),</span><br><span class="line">            Row(</span><br><span class="line">              children: &lt;Widget&gt;[</span><br><span class="line">                <span class="comment">// é€šè¿‡ expanded è¿›è¡Œå¹³åˆ†æ¨ªå‘è·ç¦»</span></span><br><span class="line">                Expanded(</span><br><span class="line">                    child: Center(</span><br><span class="line">                  <span class="comment">// å†…éƒ¨å±…ä¸­æ˜¾ç¤º</span></span><br><span class="line">                  child: Column(</span><br><span class="line">                    children: &lt;Widget&gt;[</span><br><span class="line">                      Text(<span class="string">'<span class="subst">$&#123;quality.aqi&#125;</span>'</span>, style: </span><br><span class="line">                           TextStyle(fontSize: <span class="number">40.0</span>, color: Colors.white)),</span><br><span class="line">                      Text(<span class="string">'AQI æŒ‡æ•°'</span>, style: </span><br><span class="line">                           TextStyle(fontSize: <span class="number">20.0</span>, color: Colors.white)),</span><br><span class="line">                    ],</span><br><span class="line">                  ),</span><br><span class="line">                )),</span><br><span class="line">                Expanded(</span><br><span class="line">                    child: Center(</span><br><span class="line">                  child: Column(</span><br><span class="line">                    children: &lt;Widget&gt;[</span><br><span class="line">                      Text(<span class="string">'<span class="subst">$&#123;quality.pm25&#125;</span>'</span>, style: </span><br><span class="line">                           TextStyle(fontSize: <span class="number">40.0</span>, color: Colors.white)),</span><br><span class="line">                      Text(<span class="string">'PM2.5 æŒ‡æ•°'</span>, style: </span><br><span class="line">                           TextStyle(fontSize: <span class="number">20.0</span>, color: Colors.white)),</span><br><span class="line">                    ],</span><br><span class="line">                  ),</span><br><span class="line">                )),</span><br><span class="line">              ],</span><br><span class="line">            )</span><br><span class="line">          ],</span><br><span class="line">        ));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯ç”Ÿæ´»è´¨é‡æ¨¡å—ï¼Œçœ‹ç€ä¹Ÿæ˜¯ä¸ªåˆ—è¡¨ï¼Œä½†æ˜¯åå°è¿”å›çš„ä¸æ˜¯åˆ—è¡¨ï¼Œè€Œæ˜¯æ ¹æ®ä¸åŒå­—æ®µè·å–ä¸åŒè´¨é‡æŒ‡æ•°ï¼Œå› ä¸ºå¸ƒå±€ç±»ä¼¼ï¼Œæ‰€ä»¥å¯ä»¥å¯¹å…¶è¿›è¡Œå°è£…å†æ•´ä½“è°ƒç”¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LifeSuggestions</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> AsyncSnapshot&lt;WeatherModel&gt; snapshot;</span><br><span class="line"></span><br><span class="line">  LifeSuggestions(&#123;Key key, <span class="keyword">this</span>.snapshot&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç”Ÿæ´»æŒ‡æ•°å°è£…</span></span><br><span class="line">  Widget _suggestionWidget(<span class="built_in">String</span> content) =&gt;</span><br><span class="line">      Padding(padding: <span class="keyword">const</span> EdgeInsets.only(top: <span class="number">20.0</span>), child: </span><br><span class="line">              Text(content, style: TextStyle(color: Colors.white, fontSize: <span class="number">16.0</span>)));</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">var</span> _suggestion = snapshot.data.heWeather[<span class="number">0</span>].suggestion;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">12.0</span>),</span><br><span class="line">      color: Colors.black54,</span><br><span class="line">      alignment: Alignment.centerLeft,</span><br><span class="line">      child: Column(</span><br><span class="line">        crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          Text(<span class="string">'ç”Ÿæ´»å»ºè®®'</span>, style: TextStyle(fontSize: <span class="number">24.0</span>, color: Colors.white)),</span><br><span class="line">          _suggestionWidget(<span class="string">'èˆ’é€‚åº¦ï¼š<span class="subst">$&#123;_suggestion.comf.brf&#125;</span>\n<span class="subst">$&#123;_suggestion.comf.txt&#125;</span>'</span>),</span><br><span class="line">          _suggestionWidget(<span class="string">'æ´—è½¦æŒ‡æ•°ï¼š<span class="subst">$&#123;_suggestion.cw.brf&#125;</span>\n<span class="subst">$&#123;_suggestion.cw.txt&#125;</span>'</span>),</span><br><span class="line">          _suggestionWidget(<span class="string">'è¿åŠ¨æŒ‡æ•°ï¼š</span></span><br><span class="line"><span class="string">                                <span class="subst">$&#123;_suggestion.sport.brf&#125;</span>\n<span class="subst">$&#123;_suggestion.sport.txt&#125;</span>'</span>),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰çš„åˆ†æ¨¡å—éƒ½å·²ç»ç¼–å†™å®Œæˆï¼Œå‰©ä¸‹å°±æ˜¯é€šè¿‡ç²˜åˆå‰‚è¿›è¡Œç»„è£…äº†</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">child: StreamBuilder(</span><br><span class="line">                    initialData: _bloc.weather,</span><br><span class="line">                    stream: _bloc.weatherStream,</span><br><span class="line">                    builder: (_, AsyncSnapshot&lt;WeatherModel&gt; snapshot) =&gt; !snapshot.hasData</span><br><span class="line">                        ? CupertinoActivityIndicator(radius: <span class="number">12.0</span>)</span><br><span class="line">                        : SafeArea(</span><br><span class="line">                            child: RefreshIndicator(</span><br><span class="line">                                child: CustomScrollView(</span><br><span class="line">                                  physics: BouncingScrollPhysics(),</span><br><span class="line">                                  slivers: &lt;Widget&gt;[</span><br><span class="line">                                    SliverToBoxAdapter(child: FollowedHeader(snapshot: snapshot)),</span><br><span class="line">                                    <span class="comment">// å®æ—¶å¤©æ°”</span></span><br><span class="line">                                    SliverPadding(</span><br><span class="line">                                      padding: <span class="keyword">const</span> EdgeInsets.symmetric(vertical: <span class="number">30.0</span>),</span><br><span class="line">                                      sliver: SliverToBoxAdapter(</span><br><span class="line">                                        child: CurrentWeatherState(snapshot: snapshot, city: city),</span><br><span class="line">                                      ),</span><br><span class="line">                                    ),</span><br><span class="line">                                    <span class="comment">// å¤©æ°”é¢„æŠ¥</span></span><br><span class="line">                                    WeatherForecast(snapshot: snapshot),</span><br><span class="line">                                    <span class="comment">// ç©ºæ°”è´¨é‡</span></span><br><span class="line">                                    SliverPadding(</span><br><span class="line">                                      padding: <span class="keyword">const</span> EdgeInsets.symmetric(vertical: <span class="number">30.0</span>),</span><br><span class="line">                                      sliver: SliverToBoxAdapter(child: AirQuality(snapshot: snapshot)),</span><br><span class="line">                                    ),</span><br><span class="line">                                    <span class="comment">// ç”Ÿæ´»å»ºè®®</span></span><br><span class="line">                                    SliverToBoxAdapter(child: LifeSuggestions(snapshot: snapshot))</span><br><span class="line">                                  ],</span><br><span class="line">                                ),</span><br><span class="line">                                onRefresh: () <span class="keyword">async</span> &#123;</span><br><span class="line">                                  _bloc.requestWeather(city).then((w) =&gt; _bloc.updateWeather(w));</span><br><span class="line">                                  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                                &#125;),</span><br><span class="line">                          )),</span><br></pre></td></tr></table></figure><p>æœ€åå°±å‰©ä¸‹è®¾ç½®é¡µçš„å…¨å±€ä¸»é¢˜åˆ‡æ¢äº†</p><h5 id="è®¾ç½®é¡µå…¨å±€ä¸»é¢˜åˆ‡æ¢"><a href="#è®¾ç½®é¡µå…¨å±€ä¸»é¢˜åˆ‡æ¢" class="headerlink" title="è®¾ç½®é¡µå…¨å±€ä¸»é¢˜åˆ‡æ¢"></a>è®¾ç½®é¡µå…¨å±€ä¸»é¢˜åˆ‡æ¢</h5><p>æ—¢ç„¶æåˆ°äº†æ•°æ®çš„åˆ‡æ¢ï¼Œé‚£è‚¯å®šå°±æ¶‰åŠ BLoC æ¯«æ— ç–‘é—®äº†ï¼Œè¿˜æ˜¯ç…§å¸¸ç¼–å†™ç®¡ç†ç±»</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// æŸ¥çœ‹ `setting_bloc.dart` æ–‡ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SettingBloc</span> <span class="keyword">extends</span> <span class="title">BaseBloc</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// æ‰€æœ‰ä¸»é¢˜è‰²åˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> themeColors = [Colors.blue, Colors.red, Colors.green, </span><br><span class="line">                              Colors.deepOrange, Colors.pink, Colors.purple];</span><br><span class="line"></span><br><span class="line">  Color _color = themeColors[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  Color <span class="keyword">get</span> color =&gt; _color;</span><br><span class="line"></span><br><span class="line">  BehaviorSubject&lt;Color&gt; _colorController = BehaviorSubject();</span><br><span class="line"></span><br><span class="line">  Observable&lt;Color&gt; <span class="keyword">get</span> colorStream =&gt; Observable(_colorController.stream);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// åˆ‡æ¢ä¸»é¢˜é€šçŸ¥åˆ·æ–°</span></span><br><span class="line">  switchTheme(<span class="built_in">int</span> themeIndex) &#123;</span><br><span class="line">    _color = themeColors[themeIndex];</span><br><span class="line">    _colorController.add(_color);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _colorController?.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ˜¯å…¨å±€çš„åˆ‡æ¢ï¼Œé‚£ä¹ˆè¿™ä¸ª BLoC è‚¯å®šéœ€è¦åœ¨æœ€é¡¶å±‚è¿›è¡Œæ³¨å†Œï¼Œè¿™è¾¹å°±ä¸è´´ä»£ç äº†ï¼ŒåŒ <code>ProvinceBloc</code> ä¸€è‡´ã€‚æ¥ç€ç¼–å†™ç•Œé¢ï¼Œè®¾ç½®ç•Œé¢å› ä¸ºæœ‰ <code>GridView</code> å’Œå…¶ä»–éƒ¨ä»¶ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦ç”¨ <code>CustomScrollView</code> ä½œä¸ºç²˜åˆå‰‚ï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ <code>Wrap</code> ä»£æ›¿ <code>GridView</code> æ¥å®ç°ç½‘æ ¼ï¼Œå°±ä¸éœ€è¦ç”¨ <code>CustomScrollView</code>ï¼Œä½¿ç”¨ <code>Column</code> å³å¯ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SettingsPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">var</span> _bloc = BlocProvider.of&lt;SettingBloc&gt;(context);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> StreamBuilder(</span><br><span class="line">        stream: _bloc.colorStream,</span><br><span class="line">        initialData: _bloc.color,</span><br><span class="line">        <span class="comment">// Theme æ˜¯ Flutter è‡ªå¸¦çš„ä¸€ä¸ªè®¾ç½®ä¸»é¢˜çš„éƒ¨ä»¶ï¼Œé‡Œé¢å¯ä»¥è®¾ç½®å¤šç§é¢œè‰²ï¼Œ</span></span><br><span class="line">        <span class="comment">// é€šè¿‡æ¥æ”¶åˆ° color çš„å˜åŒ–ï¼Œæ”¹å˜ä¸»é¢˜è‰²ï¼Œå…¶ä»–é¡µé¢ä¹Ÿå¦‚æ­¤è®¾ç½®ï¼Œå°ä¼™ä¼´å¯ä»¥è‡ªå·±æ·»åŠ </span></span><br><span class="line">        builder: (_, AsyncSnapshot&lt;Color&gt; snapshot) =&gt; Theme(</span><br><span class="line">            <span class="comment">// IconThemeData ç”¨äºè®¾ç½®æŒ‰é’®çš„ä¸»é¢˜è‰²</span></span><br><span class="line">              data: ThemeData(primarySwatch: snapshot.data, iconTheme: IconThemeData(color: snapshot.data)),</span><br><span class="line">              child: Scaffold(</span><br><span class="line">                appBar: AppBar(</span><br><span class="line">                  title: Text(<span class="string">'è®¾ç½®'</span>),</span><br><span class="line">                ),</span><br><span class="line">                body: Container(</span><br><span class="line">                  color: Colors.black12,</span><br><span class="line">                  padding: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">12.0</span>, vertical: <span class="number">20.0</span>),</span><br><span class="line">                  child: CustomScrollView(</span><br><span class="line">                    slivers: &lt;Widget&gt;[</span><br><span class="line">                      SliverPadding(</span><br><span class="line">                        padding: <span class="keyword">const</span> EdgeInsets.only(right: <span class="number">12.0</span>),</span><br><span class="line">                        sliver: SliverToBoxAdapter(</span><br><span class="line">                            child: Row(</span><br><span class="line">                          mainAxisAlignment: MainAxisAlignment.spaceBetween,</span><br><span class="line">                          crossAxisAlignment: CrossAxisAlignment.center,</span><br><span class="line">                          children: &lt;Widget&gt;[</span><br><span class="line">                            Text(<span class="string">'å½“å‰ä¸»é¢˜è‰²ï¼š'</span>, style: TextStyle(fontSize: <span class="number">16.0</span>, </span><br><span class="line">                                                            color: snapshot.data)),</span><br><span class="line">                            Container(width: <span class="number">20.0</span>, height: <span class="number">20.0</span>, color: snapshot.data)</span><br><span class="line">                          ],</span><br><span class="line">                        )),</span><br><span class="line">                      ),</span><br><span class="line">                      SliverPadding(padding: <span class="keyword">const</span> EdgeInsets.symmetric(vertical: <span class="number">15.0</span>)),</span><br><span class="line">                      SliverGrid(</span><br><span class="line">                          delegate: SliverChildBuilderDelegate(</span><br><span class="line">                              (_, index) =&gt; InkWell(</span><br><span class="line">                                    child: Container(color: SettingBloc.themeColors[index]),</span><br><span class="line">                                    onTap: () &#123;</span><br><span class="line">                                        <span class="comment">// é€‰æ‹©åè¿›è¡Œä¿å­˜ï¼Œå½“ä¸‹æ¬¡è¿›å…¥çš„æ—¶å€™ç›´æ¥ä½¿ç”¨è¯¥ä¸»é¢˜è‰²</span></span><br><span class="line">                                        <span class="comment">// åŒæ—¶åˆ‡æ¢ä¸»é¢˜è‰²</span></span><br><span class="line">                                      _bloc.switchTheme(index);</span><br><span class="line">                                      PreferenceUtils.instance.saveInteger(PreferencesKey.THEME_COLOR_INDEX, index);</span><br><span class="line">                                    &#125;,</span><br><span class="line">                                  ),</span><br><span class="line">                              childCount: SettingBloc.themeColors.length),</span><br><span class="line">                          gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(crossAxisCount: <span class="number">3</span>, mainAxisSpacing: <span class="number">20.0</span>, crossAxisSpacing: <span class="number">20.0</span>)),</span><br><span class="line">                    ],</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            ));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå…¨å±€çš„ä¸»é¢˜åˆ‡æ¢ä¹Ÿå®ç°äº†ã€‚</p><p>ç¼–å†™å®Œä»£ç ï¼Œéœ€è¦æ‰“åŒ…å•Šï¼ŒAndroid ä¸‹çš„æ‰“åŒ…å¤§å®¶è‚¯å®šæ²¡é—®é¢˜ï¼Œè¿™é‡Œè®²ä¸‹ flutter ä¸‹å¦‚ä½•æ‰“åŒ… apkï¼Œipa å› ä¸ºæ²¡æœ‰ mac æ‰€ä»¥ä½ ä»¬æ‡‚çš„ã€‚</p><h5 id="apk-æ–‡ä»¶æ‰“åŒ…"><a href="#apk-æ–‡ä»¶æ‰“åŒ…" class="headerlink" title="apk æ–‡ä»¶æ‰“åŒ…"></a>apk æ–‡ä»¶æ‰“åŒ…</h5><ol><li><p>åˆ›å»º jks æ–‡ä»¶ï¼Œå¦‚æœå·²ç»å­˜åœ¨å¯å¿½ç•¥è¿™æ­¥ä»ç¬¬äºŒæ­¥å¼€å§‹ã€‚æ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥</p><p><code>keytool -genkey -v -keystore [ä½ çš„ç­¾åæ–‡ä»¶è·¯å¾„].jks -keyalg RSA -keysize 2048 -validity 10000 -alias key</code></p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527153900.png" alt></p><p>ç„¶åè¾“å…¥å¯†ç ä»¥åŠä¸€äº›åŸºæœ¬ä¿¡æ¯å°±å¯ä»¥åˆ›å»ºæˆåŠŸäº†</p></li><li><p>åœ¨é¡¹ç›®çš„ <code>android</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>key.properties</code> æ–‡ä»¶ï¼Œé‡Œé¢è¿›è¡Œå¦‚ä¸‹é…ç½®</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">storePassword=&lt;password from previous step&gt;</span><br><span class="line">keyPassword=&lt;password from previous step&gt;</span><br><span class="line">keyAlias=key</span><br><span class="line">storeFile=&lt;[ä½ çš„ç­¾åæ–‡ä»¶è·¯å¾„].jks&gt;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨ <code>android/app</code> ä¸‹çš„ <code>build.gradle</code> ä¸­è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">apply from: <span class="string">"$flutterRoot/packages/flutter_tools/gradle/flutter.gradle"</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// å¢åŠ å¦‚ä¸‹éƒ¨åˆ†ä»£ç </span></span><br><span class="line">def keystorePropertiesFile = rootProject.file(<span class="string">"key.properties"</span>)</span><br><span class="line">def keystoreProperties = <span class="keyword">new</span> Properties()</span><br><span class="line">keystoreProperties.load(<span class="keyword">new</span> FileInputStream(keystorePropertiesFile))</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">    defaultConfigs&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¢åŠ å¦‚ä¸‹ä»£ç </span></span><br><span class="line">    signingConfigs &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            keyAlias keystoreProperties[<span class="string">'keyAlias'</span>]</span><br><span class="line">            keyPassword keystoreProperties[<span class="string">'keyPassword'</span>]</span><br><span class="line">            storeFile file(keystoreProperties[<span class="string">'storeFile'</span>])</span><br><span class="line">            storePassword keystoreProperties[<span class="string">'storePassword'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    buildTypes&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å†æ¬¡æ‰“å¼€ç»ˆç«¯è¿è¡Œ <code>flutter build apk</code> ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª apk æ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„ä¸º</p><p><code>[ä½ çš„é¡¹ç›®åœ°å€]\build\app\outputs\apk\release</code></p></li><li><p>é€šè¿‡ <code>flutter install</code> å°±å¯ä»¥å°†æ­£å¼åŒ…è¿è¡Œåˆ°æ‰‹æœºä¸Š</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è®²å®Œäº†å¸¸ç”¨çš„éƒ¨ä»¶å’Œç½‘ç»œè¯·æ±‚åï¼Œå·®ä¸å¤šè¯¥è¿›å…¥æ•´ä½“å®æˆ˜äº†ï¼Œè¿™é‡Œæˆ‘ä»¬å°†å†™ä¸€ä¸ªæ¯”è¾ƒç†Ÿæ‚‰çš„é¡¹ç›®ï¼Œéƒ­ç¥çš„ cool weatherã€‚é¡¹ç›®å°†ä½¿ç”¨ fluro å®ç°è·¯ç”±ç®¡ç†ï¼Œdio å®ç°ç½‘ç»œè¯·æ±‚ï¼Œrxdart å®ç° BLoC è¿›è¡ŒçŠ¶æ€ç®¡ç†å’Œé€»è¾‘åˆ†ç¦»ï¼Œä½¿ç”¨æ–‡ä»¶ï¼Œshared_preferencesï¼Œsqflite å®ç°æœ¬åœ°çš„æ•°æ®æŒä¹…åŒ–ã€‚è¿™è¾¹å…ˆç»™å‡ºé¡¹ç›®çš„åœ°å€ï¼š&lt;a href=&quot;https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fkukyxs%2Fflutter_weather&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;flutter_weather&lt;/a&gt;ï¼Œä»¥åŠæœ€åå®ç°çš„æ•ˆæœå›¾ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;One&lt;/th&gt;
&lt;th&gt;Two&lt;/th&gt;
&lt;th&gt;Three&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527153406.png&quot; alt&gt;&lt;/td&gt;
&lt;td&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/2888797-50e81d7c4da87e57.gif&quot; alt&gt;&lt;/td&gt;
&lt;td&gt;&lt;img src=&quot;https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/2888797-eb02699bb66b1535.gif&quot; alt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/categories/Android/Flutter/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutterå…¥é—¨æŒ‡å—(åä¸‰)ä¹‹ç½‘ç»œ</title>
    <link href="https://zhangmiao.cc/posts/d9e32c9b.html"/>
    <id>https://zhangmiao.cc/posts/d9e32c9b.html</id>
    <published>2019-04-28T07:24:59.000Z</published>
    <updated>2019-05-27T07:42:31.723Z</updated>
    
    <content type="html"><![CDATA[<p>å‰é¢è®²å®Œäº†å¸¸ç”¨çš„éƒ¨ä»¶ï¼Œ<code>BLoC</code> æ¨¡å¼ï¼Œæ•°æ®æŒä¹…åŒ–ç­‰å¸¸ç”¨çš„ï¼Œä»Šå¤©å†ä»‹ç»ä¸ªé‡å¤´æˆ â€”â€” ç½‘ç»œè¯·æ±‚</p><h4 id="HttpClient"><a href="#HttpClient" class="headerlink" title="HttpClient"></a>HttpClient</h4><p><code>HttpClient</code> æ˜¯ <code>dart</code> è‡ªå¸¦çš„ç½‘ç»œè¯·æ±‚æ–¹å¼ï¼Œåœ¨ <code>dart:io</code> åŒ…ä¸‹ã€‚ä½¿ç”¨ <code>HttpClient</code> ä½œä¸ºè¯·æ±‚åˆ†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</p><ol><li><p>åˆ›å»º HttpClient å®ä¾‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HttpClient client = HttpClient();</span><br></pre></td></tr></table></figure></li><li><p>æ‰“å¼€è¿æ¥ï¼Œå¹¶è®¾ç½®ä¸€äº›å¤´å‚æ•°ï¼Œè¯·æ±‚å‚æ•°ç­‰</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœ url ä¸­æ²¡æœ‰æŸ¥è¯¢å‚æ•°å¯ç›´æ¥åˆ›å»º</span></span><br><span class="line"><span class="built_in">Uri</span> uri = <span class="built_in">Uri</span>.parse(<span class="string">'https://www.xxx.com'</span>);</span><br><span class="line"><span class="comment">// å¦‚æœå­˜åœ¨æŸ¥è¯¢å‚æ•°åˆ™åœ¨ Uri ä¸­æ·»åŠ </span></span><br><span class="line"><span class="built_in">Uri</span> uri = <span class="built_in">Uri</span>(scheme: <span class="string">'https'</span>, host: <span class="string">'www.xxx.com'</span>, queryParameters: &#123;<span class="string">'a'</span>: <span class="string">'AAA'</span>&#125;);</span><br><span class="line"><span class="comment">// æ‰“å¼€è¿æ¥</span></span><br><span class="line">HttpClientRequest request = <span class="keyword">await</span> client.getUrl(uri);</span><br><span class="line">request.headers.add(<span class="string">'token'</span>, <span class="string">'Bear <span class="subst">$&#123;<span class="string">'x'</span> * <span class="number">20</span>&#125;</span>'</span>); <span class="comment">// æ·»åŠ å¤´éƒ¨ token ä¿¡æ¯</span></span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯ post æˆ–è€… put è¯·æ±‚ï¼Œé€šè¿‡ `add` æ·»åŠ è¯·æ±‚ä½“</span></span><br><span class="line"><span class="comment">// å› ä¸º `add` æ–¹æ³•éœ€è¦ä¼ å…¥ `List&lt;int&gt;` å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ utf8.encode è¿›è¡Œç¼–ç </span></span><br><span class="line">request.add(utf8.encode(<span class="string">'&#123;"a": "aaa"&#125;'</span>));</span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ æµçš„æ–¹å¼è¿›è¡Œæ·»åŠ </span></span><br><span class="line">request.addStream(input);</span><br></pre></td></tr></table></figure></li><li><p>è¿æ¥æœåŠ¡å™¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½® request åé€šè¿‡ request.close() è·å–ä¸€ä¸ªå“åº”å¯¹è±¡ HttpClientResponseï¼Œ</span></span><br><span class="line"><span class="comment">// åŒ…æ‹¬å“åº”å¤´ï¼Œå“åº”å†…å®¹ç­‰</span></span><br><span class="line">HttpClientResponse response = <span class="keyword">await</span> request.close();</span><br></pre></td></tr></table></figure></li><li><p>è¯»å–æœåŠ¡å™¨å“åº”å†…å®¹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span> responseBody = <span class="keyword">await</span> response.transform(utf8.decoder).join();</span><br></pre></td></tr></table></figure></li><li><p>å…³é—­å®ä¾‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client.close();</span><br></pre></td></tr></table></figure></li></ol><a id="more"></a><p>ä¾‹å¦‚æˆ‘ä»¬è¦å»è¯·æ±‚ <code>Bird.so</code> çš„é¦–é¡µå¹¶æ˜¾ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå®ç°</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">_httpClientRequest() <span class="keyword">async</span> &#123;</span><br><span class="line">    HttpClient client;</span><br><span class="line">    <span class="comment">// try catch finally ç”¨äºæ•è·è¯·æ±‚è¿‡ç¨‹ä¸­å‘ç”Ÿçš„å¼‚å¸¸ï¼Œåœ¨ finally ä¸­è®¾ç½®ä¿è¯ client èƒ½å¤Ÿå…³é—­</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      client = HttpClient();</span><br><span class="line">      HttpClientRequest request = <span class="keyword">await</span> client.getUrl(<span class="built_in">Uri</span>.parse(_BIRD_SO_URL));</span><br><span class="line">      HttpClientResponse response = <span class="keyword">await</span> request.close();</span><br><span class="line">      <span class="built_in">String</span> strResponse = <span class="keyword">await</span> response.transform(utf8.decoder).join();</span><br><span class="line">      setState(() =&gt; _netBack = strResponse);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;e.toString()&#125;</span>'</span>);</span><br><span class="line">      setState(() =&gt; _netBack = <span class="string">'Fail'</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      client.close();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æœ€åå®ç°çš„æ•ˆæœ</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/2888797-1042230799d843a8.gif" alt></p><p>å¾ˆæ˜¾ç„¶ï¼Œç”¨ <code>HttpClient</code> è¯·æ±‚ç›¸å¯¹æ¥è¯´æ˜¯ä¸ªéå¸¸éº»çƒ¦çš„è¿‡ç¨‹ï¼Œå¦‚æœè¦æ¶‰åŠåˆ°æ–‡æœ¬ä¸Šä¼ ä¹‹ç±»çš„ï¼Œé‚£ä¹ˆå°±ä¼šæ›´éº»çƒ¦äº†ï¼Œæ‰€ä»¥è¿™è¾¹å¼•å…¥ä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„æ’ä»¶ <code>dio</code>ï¼Œå†™æœ¬æ–‡çš„æ—¶å€™ç‰ˆæœ¬ä¸º <code>2.1.0</code></p><h4 id="Dio"><a href="#Dio" class="headerlink" title="Dio"></a>Dio</h4><p>dio æ˜¯ä¸ªéå¸¸å¼ºå¤§çš„ç½‘ç»œè¯·æ±‚åº“ï¼Œä»–çš„æ–¹å¼ç±»ä¼¼ <code>OkHttp</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŸ¥çœ‹<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fflutterchina%2Fdio%2Fblob%2Fmaster%2FREADME-ZH.md" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼Œä½¿ç”¨æ–¹å¼éå¸¸ç®€å•ï¼Œåˆ›å»ºä¸€ä¸ª <code>Dio</code> å®ä¾‹ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡ <code>get</code>ï¼Œ<code>post</code> ç­‰æ–¹å¼å‘èµ·è¯·æ±‚ï¼Œè¿”å› <code>Future&lt;Response&gt;</code>ï¼Œè€Œä¸”æ”¯æŒå¤šä¸ªå¹¶å‘è¯·æ±‚ï¼Œå¯ä»¥è®¾ç½®è¿”å›å“åº”çš„ç±»å‹ï¼Œç›‘å¬ä¸Šä¼ ä¸‹è½½è¿›åº¦ç­‰ç­‰ï¼Œçœ‹ç€å°±å¾ˆç»™åŠ›ã€‚å¯¹äºç®€å•çš„æ–¹å¼ï¼Œè¿™è¾¹å°±ä¸åšå¤ªå¤šä»‹ç»ï¼Œä¸»è¦è®²ä¸‹æ‹¦æˆªå™¨ï¼Œä¹Ÿæ˜¯éå¸¸ç»™åŠ›çš„ä¸€éƒ¨åˆ†ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦è¯·æ±‚è¿™ä¹ˆä¸ªæ¥å£ <code>https://randomuser.me/api/</code></p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527152811.png" alt></p><p>è¿™ä¸ªæ¥å£é€šè¿‡ <code>get</code> è¯·æ±‚ï¼Œå¯ä»¥åŠ å…¥ä»»æ„çš„æŸ¥è¯¢å‚æ•°ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªè¯·æ±‚åŠ è§£å¯†çš„è¿‡ç¨‹ï¼Œå¦‚æœæ¯æ¬¡éƒ½åœ¨ä¸Šä¼ å‚æ•°æˆ–è€…è¿”å›è¯·æ±‚çš„æ—¶å€™å»åŠ å¯†ï¼Œè§£å¯†çš„è¯ï¼Œå°±åšäº†éå¸¸å¤šæ— ç”¨åŠŸäº†ï¼Œé‚£ä¹ˆè¿™æ—¶å€™æ‹¦æˆªå™¨å°±æ´¾ä¸Šç”¨åœºäº†ã€‚å…ˆå®šä¹‰ä¸‹åŠ è§£å¯†çš„è§„åˆ™ï¼Œä¸Šä¼ çš„å‚æ•°ç»Ÿä¸€è½¬ä¸ºå°å†™ï¼Œä¸å­˜åœ¨å¤§å†™ï¼Œè¯·æ±‚å›çš„æ•°æ®ï¼Œä¸èƒ½å«æœ‰ <code>info</code> å­—æ®µã€‚çœ‹ä¸‹å¦‚ä½•å®ç°</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">_dioRequest() <span class="keyword">async</span> &#123;</span><br><span class="line">    BaseOptions options = BaseOptions(connectTimeout: <span class="number">5000</span>, receiveTimeout: <span class="number">60000</span>);</span><br><span class="line">    Dio dio = Dio(options);</span><br><span class="line">    </span><br><span class="line">    dio.interceptors.add(InterceptorsWrapper(onRequest: (opt) &#123;</span><br><span class="line">      <span class="comment">// è·å–æŸ¥è¯¢çš„å‚æ•°</span></span><br><span class="line">      <span class="built_in">Map</span> params = opt.queryParameters;</span><br><span class="line">      <span class="comment">// å°†æ‰€æœ‰çš„å‚æ•°è½¬ä¸ºå°å†™ï¼Œå› ä¸ºæŸ¥è¯¢å‚æ•°é€šè¿‡ map å½¢å¼ä¸Šä¼ </span></span><br><span class="line">      params.forEach((key, value) =&gt; </span><br><span class="line">                       opt.queryParameters[key] = <span class="string">'$value'</span>.toLowerCase());</span><br><span class="line">      <span class="comment">// è¿™è¾¹è¿˜å¯ä»¥åšäº›åˆ«çš„æ“ä½œï¼Œä¾‹å¦‚éœ€è¦ token è¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯ï¼Œåˆ™é€šè¿‡å¤´éƒ¨è¿›è¡Œæ·»åŠ </span></span><br><span class="line">      <span class="comment">// opt.headers['authorization'] = 'token';</span></span><br><span class="line">      <span class="comment">// åœ¨å®˜ç½‘ä¸­ï¼Œæä¾›äº† lock å’Œ unlock çš„å†™æ³•ï¼Œè¢« lock åï¼Œæ¥ä¸‹æ¥çš„è¯·æ±‚ä¼šè¿›å…¥é˜Ÿåˆ—ç­‰å¾…ï¼Œ</span></span><br><span class="line">      <span class="comment">// ç›´åˆ° unlock åæ‰èƒ½ç»§ç»­ï¼Œå¯ä»¥ç”¨äºå‡ ä¸ªè¯·æ±‚ï¼Œåç»­çš„éœ€è¦ç”¨åˆ°å‰é¢çš„è¿”å›å€¼çš„æƒ…å†µä½¿ç”¨</span></span><br><span class="line">        </span><br><span class="line">      <span class="comment">// è¿”å›ä¿®æ”¹åçš„ RequestOptions</span></span><br><span class="line">      <span class="keyword">return</span> opt;</span><br><span class="line">    &#125;, onResponse: (resp) &#123;</span><br><span class="line">      <span class="comment">// è¿”å›å“åº”ä½“åï¼Œå°† info å­—æ®µçš„å†…å®¹åˆ‡é™¤ï¼Œå¹¶å°† json æ‹¼æ¥å®Œæˆ</span></span><br><span class="line">      resp.data = <span class="string">'<span class="subst">$&#123;<span class="string">'<span class="subst">$&#123;resp.data&#125;</span>'</span>.split(<span class="string">', info'</span>).first&#125;</span>&#125;'</span>;</span><br><span class="line">      <span class="keyword">return</span> resp;</span><br><span class="line">    &#125;, onError: (error) &#123;</span><br><span class="line">      <span class="comment">// å‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒ</span></span><br><span class="line">      <span class="keyword">return</span> error;</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹æ‰“å°çš„ç»“æœ</span></span><br><span class="line">    Response response = <span class="keyword">await</span> dio.<span class="keyword">get</span>(_USER_ME_URL, queryParameters: &#123;<span class="string">'a'</span>: <span class="string">'AAA'</span>, <span class="string">'b'</span>: <span class="string">'BbBbBb'</span>&#125;);</span><br><span class="line">    <span class="built_in">print</span>(response.data);</span><br><span class="line">    <span class="built_in">print</span>(response.request.headers);</span><br><span class="line">    <span class="built_in">print</span>(response.request.queryParameters);</span><br><span class="line">    setState(() =&gt; _netBack = response.data.toString()); <span class="comment">// ç•Œé¢æ˜¾ç¤º response.data</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸‹æœ€åçš„æ˜¾ç¤ºä¿¡æ¯</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527152843.png" alt></p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527152854.png" alt></p><p>è¯·æ±‚ä½“çš„å¤´éƒ¨æˆåŠŸåŠ ä¸Šäº† <code>authorization</code> å‚æ•°ï¼Œè¯·æ±‚çš„å‚æ•°å…¨éƒ¨å˜ä¸ºå°å†™ï¼Œè¿”å›çš„ä¿¡æ¯ä¹ŸæŠŠ info å­—æ®µå€¼å»é™¤ã€‚åœ¨å¾ˆå¤šæ—¶å€™ï¼Œè¯·æ±‚æ¥å£åï¼Œéœ€è¦å°† json è½¬æ¢æˆ pojo ç±»æ¥å¤„ç†ï¼Œå¯ä»¥é€šè¿‡ <code>json_serializable</code> è¿™ä¸ªä¸‰æ–¹æ’ä»¶å®ç°ï¼Œè¿™è¾¹æä¾›æ–‡ç«  <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fjuejin.im%2Fpost%2F5b5f00e7e51d45190571172f" target="_blank" rel="noopener">Flutter Jsonè‡ªåŠ¨ååºåˆ—åŒ–</a>ï¼Œå½“ç„¶è¿™ç§æ–¹å¼æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™é‡Œæ¨èä¸ª <code>Android Studio</code> ä¸‹çš„æ’ä»¶ <code>dart_json_format</code> ç›´æ¥æœç´¢å°±å¯ä»¥ï¼Œå¦‚æœç”¨çš„æ˜¯ <code>Vitual Code</code> æˆ–è€…åˆ«çš„ä¸æ˜¯ <code>JetBrains</code> ç³»åˆ—çš„ï¼Œè¿™é‡Œæœ‰ä¸ªè½¬æ¢çš„ç½‘å€ <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fjaviercbk.github.io%2Fjson_to_dart" target="_blank" rel="noopener">JsonToDart</a>ã€‚</p><p><em>ä»¥ä¸Šä»£ç æŸ¥çœ‹ http_main.dart æ–‡ä»¶</em></p><h4 id="å®è·µä¸€ä¸‹ä¸‹"><a href="#å®è·µä¸€ä¸‹ä¸‹" class="headerlink" title="å®è·µä¸€ä¸‹ä¸‹"></a>å®è·µä¸€ä¸‹ä¸‹</h4><p>ä¸çŸ¥é“å°ä¼™è¿˜è®°å¾—å‰é¢è®²çš„ <code>BLoC</code> æ²¡æœ‰ï¼Œå¿˜äº†å¯ä»¥æŸ¥çœ‹ <a href="https://zhangmiao.cc/posts/d121323a.html">Flutter çŠ¶æ€ç®¡ç†åŠ BLoC</a>ï¼Œè¿™é‡Œç»“åˆ <code>BLoC</code> å’Œ <code>Dio</code> å®ç°ç•Œé¢å’Œé€»è¾‘åˆ†ç¦»çš„å°ä¾‹å­ï¼Œæ¥å£ä½¿ç”¨å‰é¢æåˆ°çš„ <code>https://randomuser.me/api/</code> æ¥å£ã€‚ç½‘ç»œåº”è¯¥æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œæ‰€ä»¥å¯¹å…¶è¿›è¡Œä¸€äº›å°è£…è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œè¿™è¾¹æä¾›ä¸‹æˆ‘è‡ªå·±å°è£…çš„æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:dio/dio.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨äºé”™è¯¯ä¿¡æ¯å›è°ƒ</span></span><br><span class="line"><span class="keyword">typedef</span> ErrorCallback = <span class="keyword">void</span> <span class="built_in">Function</span>(<span class="built_in">String</span> msg);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpUtils</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> GET = <span class="string">'get'</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> POST = <span class="string">'post'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> Dio _dio;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> HttpUtils _instance;</span><br><span class="line"></span><br><span class="line">  Dio <span class="keyword">get</span> hp =&gt; _dio;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// dio å¯ä»¥åœ¨ BaseOptions ä¸­æŒ‡å®šåŸŸå baseUrlï¼Œ</span></span><br><span class="line">  <span class="comment">// åç»­æ¥å£å°±ä¸éœ€è¦å†æ·»åŠ åŸŸåäº†</span></span><br><span class="line">  <span class="comment">// å¦‚æœè¯·æ±‚çš„æ¥å£åŸŸåå‘ç”Ÿäº†å˜åŒ–ï¼Œåªè¦æŠŠå…¨éƒ¨ url å†™å…¨ï¼Œå°±ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°çš„åŸŸå</span></span><br><span class="line">  HttpUtils._internal(<span class="built_in">String</span> base) &#123;</span><br><span class="line">    <span class="comment">// ç”Ÿæˆä¸€ä¸ªå•ä¾‹ï¼Œé˜²æ­¢å¤šæ¬¡æ‰“å¼€å…³é—­é€ æˆå¼€é”€</span></span><br><span class="line">    _dio = Dio(BaseOptions(baseUrl: base, connectTimeout: <span class="number">10000</span>, receiveTimeout: <span class="number">10000</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> HttpUtils(<span class="built_in">String</span> base) &#123;</span><br><span class="line">    <span class="keyword">if</span> (_instance == <span class="keyword">null</span>) _instance = HttpUtils._internal(base);</span><br><span class="line">    <span class="keyword">return</span> _instance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line">  addInterceptor(<span class="built_in">List</span>&lt;InterceptorsWrapper&gt; interceptors) &#123;</span><br><span class="line">    _dio.interceptors.clear();</span><br><span class="line">    _dio.interceptors.addAll(interceptors);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;Response&lt;T&gt;&gt; getRequest&lt;T&gt;(url, &#123;<span class="built_in">Map</span> params, ErrorCallback callback&#125;) =&gt;</span><br><span class="line">      _request(url, GET, params: params, callback: callback);</span><br><span class="line"></span><br><span class="line">  Future&lt;Response&lt;T&gt;&gt; postRequest&lt;T&gt;(url, &#123;<span class="built_in">Map</span> params, ErrorCallback callback&#125;) =&gt;</span><br><span class="line">      _request(url, POST, params: params, callback: callback);</span><br><span class="line"></span><br><span class="line">  Future&lt;Response&gt; download(url, path, &#123;ProgressCallback receive, CancelToken token&#125;) =&gt;</span><br><span class="line">      _dio.download(url, path, onReceiveProgress: receive, cancelToken: token);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// T å¯ä»¥æŒ‡å®šè¿”å›çš„ç±»å‹ï¼ŒString æˆ–è€… Map&lt;String, dynamic&gt;</span></span><br><span class="line">  Future&lt;Response&lt;T&gt;&gt; _request&lt;T&gt;(</span><br><span class="line">    url,</span><br><span class="line">    <span class="built_in">String</span> method, &#123;</span><br><span class="line">    <span class="built_in">Map</span> params, <span class="comment">// ä¸Šä¼ çš„å‚æ•°</span></span><br><span class="line">    Options opt,</span><br><span class="line">    ErrorCallback callback, <span class="comment">// é”™è¯¯å›è°ƒ</span></span><br><span class="line">    ProgressCallback send, <span class="comment">// ä¸Šä¼ è¿›åº¦ç›‘å¬</span></span><br><span class="line">    ProgressCallback receive, <span class="comment">// ä¸‹è½½ç›‘å¬</span></span><br><span class="line">    CancelToken token, <span class="comment">// ç”¨äºå–æ¶ˆçš„ tokenï¼Œå¯ä»¥å¤šä¸ªè¯·æ±‚ç»‘å®šä¸€ä¸ª token</span></span><br><span class="line">  &#125;) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Response&lt;T&gt; rep;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (method == GET) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸æ˜¯é‡æ–°åˆ›å»º Dio å®ä¾‹ï¼Œget æ–¹æ³•ä½¿ç”¨ queryParams ä¼šå‡ºé”™ï¼Œä¸æ‡‚åŸå› ï¼Œä½¿ç”¨æ‹¼æ¥æ²¡æœ‰é—®é¢˜</span></span><br><span class="line">        <span class="keyword">if</span> (params != <span class="keyword">null</span> &amp;&amp; params.isNotEmpty) &#123;</span><br><span class="line">          <span class="keyword">var</span> sb = <span class="built_in">StringBuffer</span>(<span class="string">'?'</span>);</span><br><span class="line">          params.forEach((key, value) &#123;</span><br><span class="line">            sb.write(<span class="string">'$key=$value&amp;'</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="comment">// get è¯·æ±‚ä¸‹æ‹¼æ¥è·¯å¾„</span></span><br><span class="line">          url += sb.toString().substring(<span class="number">0</span>, sb.length - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        rep = <span class="keyword">await</span> _dio.<span class="keyword">get</span>(url, options: opt, onReceiveProgress: receive, cancelToken: token);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method == POST) &#123;</span><br><span class="line">        <span class="comment">// post å‚æ•°æ”¾è¯·æ±‚ä½“</span></span><br><span class="line">        rep = params == <span class="keyword">null</span></span><br><span class="line">            ? <span class="keyword">await</span> _dio.post(url, options: opt, cancelToken: token, onSendProgress: send, onReceiveProgress: receive)</span><br><span class="line">            : <span class="keyword">await</span> _dio.post(url,</span><br><span class="line">                data: params, options: opt, cancelToken: token, onSendProgress: send, onReceiveProgress: receive);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœ statusCode ä¸æ˜¯ 200 åˆ™é”™è¯¯å›è°ƒï¼Œè¿”å›ç©ºçš„ Response</span></span><br><span class="line">      <span class="keyword">if</span> (rep.statusCode != <span class="number">200</span> &amp;&amp; callback != <span class="keyword">null</span>) &#123;</span><br><span class="line">        callback(<span class="string">'network error, and code is <span class="subst">$&#123;rep.statusCode&#125;</span>'</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> rep;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">if</span> (callback != <span class="keyword">null</span>) &#123;</span><br><span class="line">        callback(<span class="string">'network error, catch error: <span class="subst">$&#123;e.toString()&#125;</span>'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°è£…åå°±å¯ä»¥æ„‰å¿«çš„è°ƒç”¨äº†ï¼Œå¦‚æœæœ‰åˆ«çš„è¯·æ±‚æ–¹å¼åæœŸå¯ä»¥ç»§ç»­æ‰©å±•ã€‚ç»§ç»­çœ‹ä»£ç ï¼Œåˆ›å»ºä¸€ä¸ª <code>application.dart</code> æ–‡ä»¶ï¼Œç”¨äºå­˜æ”¾å…¨å±€å‚æ•°</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> HttpUtils http;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¶åœ¨ <code>main()</code> æ–¹æ³•ä¸­è¿›è¡Œåˆå§‹åŒ–ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥ä½¿ç”¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  Application.http = HttpUtils(<span class="string">'https://randomuser.me'</span>);</span><br><span class="line">  </span><br><span class="line">  runApp(DemoApp());</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€æ˜çŠ¶æ€æ </span></span><br><span class="line">  <span class="keyword">if</span> (Platform.isAndroid) &#123;</span><br><span class="line">      SystemChrome.setSystemUIOverlayStyle(SystemUiOverlayStyle(statusBarColor: Colors.transparent));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸‹æœ€åçš„å®ç°æ•ˆæœå§ï¼Œåˆšè¿›å…¥æ²¡æœ‰æ•°æ®åˆ™é€šè¿‡è½¬åœˆåœˆæç¤ºï¼ŒåŠ è½½å®Œæ•°æ®åï¼Œç‚¹å‡»å¤´åƒæ›´æ¢ä¸‹ä¸ª</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/2888797-cbe4a21cc6b3b828.gif" alt></p><p>å®ç° <code>BLoC</code> éœ€è¦æœ‰ä¸€ä¸ªç®¡ç†ç±»</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserBloc</span> <span class="keyword">extends</span> <span class="title">BaseBloc</span> </span>&#123;</span><br><span class="line">  RandomUserModel _user;</span><br><span class="line"></span><br><span class="line">  RandomUserModel <span class="keyword">get</span> user =&gt; _user;</span><br><span class="line"></span><br><span class="line">  BehaviorSubject&lt;RandomUserModel&gt; _controller = BehaviorSubject();</span><br><span class="line"></span><br><span class="line">  Observable&lt;RandomUserModel&gt; <span class="keyword">get</span> stream =&gt; Observable(_controller.stream);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç½‘ç»œè¯·æ±‚è·å–æ–°çš„æ•°æ®ï¼Œå¹¶æ›´æ–°</span></span><br><span class="line">  updateUserInfo() &#123;</span><br><span class="line">    Application.http.getRequest(<span class="string">'/api'</span>).then((response) &#123;</span><br><span class="line">      <span class="comment">// RandomUserModel å°±æ˜¯æ¥å£è¿”å›çš„ json è½¬æˆçš„ model ç±»</span></span><br><span class="line">      RandomUserModel model = RandomUserModel.fromMap(response.data);</span><br><span class="line">      _user = model;</span><br><span class="line">      <span class="comment">// add åˆ° controller é€šçŸ¥ä¿®æ”¹</span></span><br><span class="line">      _controller.add(model);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _controller?.close(); <span class="comment">// åŠæ—¶é”€æ¯</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¾ç½®å¥½ç®¡ç†ç±»åï¼Œå°±å¯ä»¥æ¥ç¼–å†™ç•Œé¢äº†ï¼Œç•Œé¢ä¹Ÿæ¯”è¾ƒç®€å•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserPageDemo</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å°†é¦–å­—æ¯å¤§å†™</span></span><br><span class="line">  <span class="built_in">String</span> _upperFirst(<span class="built_in">String</span> content) &#123;</span><br><span class="line">    <span class="keyword">assert</span>(content != <span class="keyword">null</span> &amp;&amp; content.isNotEmpty);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'<span class="subst">$&#123;content.substring(<span class="number">0</span>, <span class="number">1</span>).toUpperCase()&#125;</span><span class="subst">$&#123;content.substring(<span class="number">1</span>)&#125;</span>'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ°å€ä¿¡æ¯é€šç”¨éƒ¨ä»¶</span></span><br><span class="line">  Widget _userLocation(<span class="built_in">String</span> info) =&gt; Padding(</span><br><span class="line">      padding: <span class="keyword">const</span> EdgeInsets.only(top: <span class="number">4.0</span>),</span><br><span class="line">      child: Text(info, style: TextStyle(color: Colors.white, fontSize: <span class="number">16.0</span>)));</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    UserBloc _bloc = BlocProvider.of&lt;UserBloc&gt;(context);</span><br><span class="line">    _bloc.updateUserInfo();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      <span class="comment">// StreamBuilder æ¥å—æ›´æ–°æ•°æ®çš„ stream</span></span><br><span class="line">      body: StreamBuilder(</span><br><span class="line">          builder: (_, AsyncSnapshot&lt;RandomUserModel&gt; snapshot) =&gt; Container(</span><br><span class="line">                alignment: Alignment.center,</span><br><span class="line">                decoration: BoxDecoration(</span><br><span class="line">                    gradient: LinearGradient(</span><br><span class="line">                        begin: Alignment.topCenter,</span><br><span class="line">                        end: Alignment.bottomCenter,</span><br><span class="line">                        colors: [Colors.blue[<span class="number">600</span>], Colors.blue[<span class="number">400</span>]])),</span><br><span class="line">                child: !snapshot.hasData</span><br><span class="line">                    ? CupertinoActivityIndicator(radius: <span class="number">12.0</span>)</span><br><span class="line">                    : Column(mainAxisAlignment: MainAxisAlignment.center, children: &lt;Widget&gt;[</span><br><span class="line">                        InkWell( <span class="comment">// ç”¨äºåˆ‡æ¢æ•°æ®</span></span><br><span class="line">                            child: ClipOval( <span class="comment">// åœ†å½¢å¤´åƒ</span></span><br><span class="line">                              child: FadeInImage.assetNetwork(</span><br><span class="line">                                  placeholder: <span class="string">'images/ava_default.png'</span>, image: snapshot.data.results[<span class="number">0</span>].picture.large),</span><br><span class="line">                            ),</span><br><span class="line">                            onTap: () =&gt; _bloc.updateUserInfo()), <span class="comment">// æ›´æ–°æ•°æ®</span></span><br><span class="line">                        Padding(</span><br><span class="line">                          padding: <span class="keyword">const</span> EdgeInsets.only(top: <span class="number">20.0</span>),</span><br><span class="line">                          child: Text(</span><br><span class="line">                              <span class="string">'<span class="subst">$&#123;_upperFirst(snapshot.data.results[<span class="number">0</span>].name.first)&#125;</span> <span class="subst">$&#123;_upperFirst(snapshot.data.results[<span class="number">0</span>].name.last)&#125;</span>'</span>,</span><br><span class="line">                              style: TextStyle(color: Colors.white, fontSize: <span class="number">24.0</span>)),</span><br><span class="line">                        ),</span><br><span class="line">                        Text(<span class="string">'<span class="subst">$&#123;snapshot.data.results[<span class="number">0</span>].email&#125;</span>'</span>,</span><br><span class="line">                            style: TextStyle(color: Colors.white, fontSize: <span class="number">18.0</span>)),</span><br><span class="line">                        _userLocation(<span class="string">'<span class="subst">$&#123;snapshot.data.results[<span class="number">0</span>].location.street&#125;</span>'</span>),</span><br><span class="line">                        _userLocation(<span class="string">'<span class="subst">$&#123;_upperFirst(snapshot.data.results[<span class="number">0</span>].location.city)&#125;</span>'</span>),</span><br><span class="line">                        _userLocation(<span class="string">'<span class="subst">$&#123;_upperFirst(snapshot.data.results[<span class="number">0</span>].location.state)&#125;</span>'</span>),</span><br><span class="line">                      ]),</span><br><span class="line">              ),</span><br><span class="line">          initialData: _bloc.user, <span class="comment">// æ³¨å…¥åˆå§‹å€¼</span></span><br><span class="line">          stream: _bloc.stream), <span class="comment">// æ³¨å…¥æ›´æ–° stream</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>ä»¥ä¸Šä»£ç æŸ¥çœ‹ bloc_network åŒ…ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</em></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰é¢è®²å®Œäº†å¸¸ç”¨çš„éƒ¨ä»¶ï¼Œ&lt;code&gt;BLoC&lt;/code&gt; æ¨¡å¼ï¼Œæ•°æ®æŒä¹…åŒ–ç­‰å¸¸ç”¨çš„ï¼Œä»Šå¤©å†ä»‹ç»ä¸ªé‡å¤´æˆ â€”â€” ç½‘ç»œè¯·æ±‚&lt;/p&gt;
&lt;h4 id=&quot;HttpClient&quot;&gt;&lt;a href=&quot;#HttpClient&quot; class=&quot;headerlink&quot; title=&quot;HttpClient&quot;&gt;&lt;/a&gt;HttpClient&lt;/h4&gt;&lt;p&gt;&lt;code&gt;HttpClient&lt;/code&gt; æ˜¯ &lt;code&gt;dart&lt;/code&gt; è‡ªå¸¦çš„ç½‘ç»œè¯·æ±‚æ–¹å¼ï¼Œåœ¨ &lt;code&gt;dart:io&lt;/code&gt; åŒ…ä¸‹ã€‚ä½¿ç”¨ &lt;code&gt;HttpClient&lt;/code&gt; ä½œä¸ºè¯·æ±‚åˆ†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;åˆ›å»º HttpClient å®ä¾‹&lt;/p&gt;
&lt;figure class=&quot;highlight dart&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;HttpClient client = HttpClient();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æ‰“å¼€è¿æ¥ï¼Œå¹¶è®¾ç½®ä¸€äº›å¤´å‚æ•°ï¼Œè¯·æ±‚å‚æ•°ç­‰&lt;/p&gt;
&lt;figure class=&quot;highlight dart&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å¦‚æœ url ä¸­æ²¡æœ‰æŸ¥è¯¢å‚æ•°å¯ç›´æ¥åˆ›å»º&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Uri&lt;/span&gt; uri = &lt;span class=&quot;built_in&quot;&gt;Uri&lt;/span&gt;.parse(&lt;span class=&quot;string&quot;&gt;&#39;https://www.xxx.com&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å¦‚æœå­˜åœ¨æŸ¥è¯¢å‚æ•°åˆ™åœ¨ Uri ä¸­æ·»åŠ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Uri&lt;/span&gt; uri = &lt;span class=&quot;built_in&quot;&gt;Uri&lt;/span&gt;(scheme: &lt;span class=&quot;string&quot;&gt;&#39;https&#39;&lt;/span&gt;, host: &lt;span class=&quot;string&quot;&gt;&#39;www.xxx.com&#39;&lt;/span&gt;, queryParameters: &amp;#123;&lt;span class=&quot;string&quot;&gt;&#39;a&#39;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&#39;AAA&#39;&lt;/span&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// æ‰“å¼€è¿æ¥&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HttpClientRequest request = &lt;span class=&quot;keyword&quot;&gt;await&lt;/span&gt; client.getUrl(uri);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;request.headers.add(&lt;span class=&quot;string&quot;&gt;&#39;token&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;Bear &lt;span class=&quot;subst&quot;&gt;$&amp;#123;&lt;span class=&quot;string&quot;&gt;&#39;x&#39;&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;&amp;#125;&lt;/span&gt;&#39;&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;// æ·»åŠ å¤´éƒ¨ token ä¿¡æ¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å¦‚æœæ˜¯ post æˆ–è€… put è¯·æ±‚ï¼Œé€šè¿‡ `add` æ·»åŠ è¯·æ±‚ä½“&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å› ä¸º `add` æ–¹æ³•éœ€è¦ä¼ å…¥ `List&amp;lt;int&amp;gt;` å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ utf8.encode è¿›è¡Œç¼–ç &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;request.add(utf8.encode(&lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;&quot;a&quot;: &quot;aaa&quot;&amp;#125;&#39;&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ æµçš„æ–¹å¼è¿›è¡Œæ·»åŠ &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;request.addStream(input);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;è¿æ¥æœåŠ¡å™¨&lt;/p&gt;
&lt;figure class=&quot;highlight dart&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è®¾ç½® request åé€šè¿‡ request.close() è·å–ä¸€ä¸ªå“åº”å¯¹è±¡ HttpClientResponseï¼Œ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// åŒ…æ‹¬å“åº”å¤´ï¼Œå“åº”å†…å®¹ç­‰&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HttpClientResponse response = &lt;span class=&quot;keyword&quot;&gt;await&lt;/span&gt; request.close();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;è¯»å–æœåŠ¡å™¨å“åº”å†…å®¹&lt;/p&gt;
&lt;figure class=&quot;highlight dart&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt; responseBody = &lt;span class=&quot;keyword&quot;&gt;await&lt;/span&gt; response.transform(utf8.decoder).join();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å…³é—­å®ä¾‹&lt;/p&gt;
&lt;figure class=&quot;highlight dart&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;client.close();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/categories/Android/Flutter/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutterå…¥é—¨æŒ‡å—(åäºŒ)ä¹‹æ•°æ®æŒä¹…åŒ–</title>
    <link href="https://zhangmiao.cc/posts/6358b348.html"/>
    <id>https://zhangmiao.cc/posts/6358b348.html</id>
    <published>2019-04-28T07:18:47.000Z</published>
    <updated>2019-05-27T07:25:16.938Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸ŠèŠ‚è®²äº†çŠ¶æ€ç®¡ç†ï¼Œä½†æ˜¯å½“ <code>App</code> é‡å¯åï¼Œæ•°æ®å°±éƒ½ä¸¢å¤±äº†ï¼Œè¿™æ ·å°±æ¯”è¾ƒå°´å°¬äº†ï¼Œä»€ä¹ˆéƒ½è¦é‡æ¥ï¼Œæ‰€ä»¥è¿™èŠ‚æˆ‘ä»¬æ¥è®²ä¸‹æ•°æ®æŒä¹…åŒ–ã€‚æ•°æ®æŒä¹…åŒ–ä¸»è¦æœ‰å¦‚ä¸‹æ–¹å¼</p><ul><li>æ–‡ä»¶è¯»å†™</li><li><code>shared_preferences</code> å­˜å‚¨</li><li>æ•°æ®åº“å­˜å‚¨</li></ul><p>æŒä¹…åŒ–çš„å®ç°éƒ½éœ€è¦é€šè¿‡ä¸‰æ–¹æ’ä»¶æ¥å®ç°ï¼Œæ¥ç€ä¼šæ…¢æ…¢ä»‹ç»ä¸‰ç§å®ç°æ–¹å¼</p><a id="more"></a><h4 id="æ–‡ä»¶è¯»å†™-IO-æ“ä½œ"><a href="#æ–‡ä»¶è¯»å†™-IO-æ“ä½œ" class="headerlink" title="æ–‡ä»¶è¯»å†™/ IO æ“ä½œ"></a>æ–‡ä»¶è¯»å†™/ IO æ“ä½œ</h4><p>æ–‡ä»¶è¯»å†™éœ€è¦ <code>path_provider</code> æ’ä»¶ï¼Œå†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæœ€æ–°ç‰ˆæœ¬æ˜¯ <code>0.5.0+1</code>ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥æ ¹æ®å®˜ç½‘æœ€æ–°çš„ç‰ˆæœ¬è¿›è¡Œæ›¿æ¢ï¼Œå¯¼å…¥åæˆ‘ä»¬å°±å¯ä»¥æ¥çœ‹ä¸‹å¦‚ä½•å®ç°æ–‡ä»¶çš„è¯»å†™äº†ã€‚<code>path_provider</code> çš„æºç æ¯”è¾ƒç®€å•ï¼Œè¿™è¾¹å°±ä¸å•ç‹¬æ‹å‡ºæ¥è¯´äº†ï¼Œå¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ã€‚<code>path_provider</code> ç”¨äºè·å–æ‰‹æœºçš„å­˜å‚¨æ–‡ä»¶ä½ç½®ï¼Œä¸€å…±æœ‰ä¸‰ä¸ªæ–¹æ³•</p><ul><li><code>getTemporaryDirectory</code> ä¸´æ—¶ç›®å½•ï¼Œåœ¨ Android ä¸­å¯¹åº”çš„æ–¹æ³•ä¸º <code>getCacheDir</code>ï¼Œè€Œåœ¨ iOS ä¸­å¯¹åº”ä¸º <code>NSCachesDirectory</code>ï¼Œå¯ä»¥é€šè¿‡ç³»ç»Ÿæ£€æµ‹å¹¶æ¸…é™¤</li><li><code>getApplicationDocumentsDirectory</code> ç¼“å­˜ç›®å½•ï¼Œåœ¨ Android ä¸­å¯¹åº”ä¸º <code>AppData</code> æ–‡ä»¶å¤¹ï¼Œåœ¨ iOS ä¸­å¯¹åº”ä¸º  <code>NSDocumentsDirectory</code>ï¼Œåªæœ‰å½“ App è¢«åˆ é™¤æ‰èƒ½è¢«åˆ é™¤</li><li><code>getExternalStorageDirectory</code> å¤–éƒ¨å­˜å‚¨ç›®å½•ï¼Œåªæœ‰åœ¨ Android ä¸­æœ‰æ•ˆï¼Œåœ¨ iOS è°ƒç”¨ä¼šæŠ›å‡º <code>UnsupportedError</code> å¼‚å¸¸ï¼Œä¸è¿‡ Android åœ¨å†™å…¥å‰è®°å¾—å…ˆç”³è¯·æƒé™å“Ÿï¼Œå¦åˆ™ä¹Ÿæ˜¯ä¸è¡Œæ»´ã€‚</li></ul><p>è¯»å†™æ–‡ä»¶æ“ä½œéœ€è¦é€šè¿‡ <code>Dart</code> çš„ <code>IO</code> æ“ä½œå®Œæˆï¼Œè¿™è¾¹å°ä¼™ä¼´ä»¬å¯ä»¥è‡ªå·±çœ‹æ–‡æ¡£ <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fapi.dartlang.org%2Fstable%2F2.2.0%2Fdart-io%2FFile-class.html" target="_blank" rel="noopener">File class</a>ï¼Œæ¥ç€æˆ‘ä»¬å°±ç›´æ¥é€šè¿‡ä¾‹å­æ¥çœ‹æ–‡ä»¶å®ç°æ•°æ®æŒä¹…åŒ–ã€‚å…ˆçœ‹ä¸‹æ•ˆæœå§ï¼Œæœ€ç»ˆé‡å¯ App åï¼Œæ•°æ®ä¹Ÿèƒ½æ­£å¸¸è¯»å–æ˜¾ç¤ºï¼Œè¯´æ˜æ•°æ®è¢«ä¿å­˜ä¸‹æ¥äº†</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/2888797-7a9977c10ad33aff.gif" alt></p><p>çœ‹ä¸‹å®ç°çš„ä»£ç ï¼Œå› ä¸ºä¼šæ¶‰åŠåˆ°å¤šç§æ–¹å¼ï¼Œæ‰€ä»¥è¿™è¾¹æˆ‘æŠŠè§†å›¾æŠ½å–å‡ºæ¥å®ç°</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">Widget _fileIoPart() &#123;</span><br><span class="line">    <span class="keyword">return</span> Card(</span><br><span class="line">      margin: <span class="keyword">const</span> EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">      shape: RoundedRectangleBorder(borderRadius: BorderRadius.all(Radius.circular(<span class="number">8.0</span>))),</span><br><span class="line">      child: Column(children: &lt;Widget&gt;[</span><br><span class="line">        Padding(</span><br><span class="line">          padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">12.0</span>),</span><br><span class="line">          child: Text(<span class="string">'File IO'</span>, style: TextStyle(fontSize: <span class="number">20.0</span>, color: Theme.of(context).primaryColor)),</span><br><span class="line">        ),</span><br><span class="line">        <span class="comment">// RadioList æ˜¯å•é€‰æŒ‰é’®éƒ¨ä»¶ï¼Œé€šè¿‡é€‰æ‹©ä¸åŒçš„æƒ…å†µï¼Œåˆ›å»ºä¸åŒç›®å½•çš„æ–‡ä»¶</span></span><br><span class="line">        RadioListTile(</span><br><span class="line">            value: _radioText[<span class="number">0</span>],</span><br><span class="line">            title: Text(_radioText[<span class="number">0</span>]),</span><br><span class="line">            subtitle: Text(_radioDescriptions[<span class="number">0</span>]),</span><br><span class="line">            groupValue: _currentValue,</span><br><span class="line">            onChanged: ((value) &#123;</span><br><span class="line">              setState(() =&gt; _currentValue = value);</span><br><span class="line">            &#125;)),</span><br><span class="line">        RadioListTile(</span><br><span class="line">            value: _radioText[<span class="number">1</span>],</span><br><span class="line">            title: Text(_radioText[<span class="number">1</span>]),</span><br><span class="line">            subtitle: Text(_radioDescriptions[<span class="number">1</span>]),</span><br><span class="line">            groupValue: _currentValue,</span><br><span class="line">            onChanged: ((value) &#123;</span><br><span class="line">              setState(() =&gt; _currentValue = value);</span><br><span class="line">            &#125;)),</span><br><span class="line">        RadioListTile(</span><br><span class="line">            value: _radioText[<span class="number">2</span>],</span><br><span class="line">            title: Text(_radioText[<span class="number">2</span>]),</span><br><span class="line">            subtitle: Text(_radioDescriptions[<span class="number">2</span>]),</span><br><span class="line">            groupValue: _currentValue,</span><br><span class="line">            onChanged: ((value) &#123;</span><br><span class="line">              setState(() =&gt; _currentValue = value);</span><br><span class="line">            &#125;)),</span><br><span class="line">        Padding(</span><br><span class="line">          padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">12.0</span>),</span><br><span class="line">          <span class="comment">// ç”¨äºå†™å…¥æ–‡æœ¬ä¿¡æ¯</span></span><br><span class="line">          child: TextField(</span><br><span class="line">            controller: _editController,</span><br><span class="line">            decoration: InputDecoration(labelText: <span class="string">'è¾“å…¥å­˜å‚¨çš„æ–‡æœ¬å†…å®¹'</span>, icon: Icon(Icons.text_fields)),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        Container(</span><br><span class="line">          margin: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">12.0</span>),</span><br><span class="line">          width: MediaQuery.of(context).size.width,</span><br><span class="line">          child: RaisedButton(</span><br><span class="line">            onPressed: _writeTextIntoFile,</span><br><span class="line">            child: Text(<span class="string">'å†™å…¥æ–‡ä»¶ä¿¡æ¯'</span>),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        Padding(</span><br><span class="line">          padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">12.0</span>),</span><br><span class="line">          child: Row(</span><br><span class="line">            crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">            mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">            children: &lt;Widget&gt;[Text(<span class="string">'æ–‡ä»¶å†…å®¹ï¼š'</span>), Expanded(child: Text(_fileContent, softWrap: <span class="keyword">true</span>))],</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        Container(</span><br><span class="line">          margin: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">12.0</span>),</span><br><span class="line">          width: MediaQuery.of(context).size.width,</span><br><span class="line">          child: RaisedButton(</span><br><span class="line">            onPressed: _readTextFromFile,</span><br><span class="line">            child: Text(<span class="string">'è¯»å–æ–‡ä»¶ä¿¡æ¯'</span>),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ]),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å…³é”®çš„éƒ¨åˆ†åœ¨äº <code>_writeTextIntoFile</code> å’Œ <code>_readTextFromFile</code> ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ã€‚çœ‹ä¸‹å®ç°çš„ä»£ç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœå†™å…¥å¤–éƒ¨å†…å­˜éœ€è¦è¯»å†™æƒé™ï¼Œè¿™è¾¹ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹æ’ä»¶ `permission_handler`</span></span><br><span class="line"> <span class="keyword">void</span> _writeTextIntoFile() <span class="keyword">async</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (_currentValue == _radioText[<span class="number">2</span>]) &#123;</span><br><span class="line">     PermissionStatus status = <span class="keyword">await</span> PermissionHandler().checkPermissionStatus(PermissionGroup.storage);</span><br><span class="line">     <span class="keyword">if</span> (status == PermissionStatus.granted) <span class="comment">// å¦‚æœæ˜¯å†™å…¥å¤–éƒ¨å­˜å‚¨ï¼Œåˆ™æ£€æµ‹æƒé™çŠ¶æ€ï¼ŒåŒæ„åˆ™å†™å…¥</span></span><br><span class="line">       _writeContent();</span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span> (status == PermissionStatus.disabled) <span class="comment">// æ‹’ç»äº†æç¤ºæ‰‹åŠ¨æ‰“å¼€</span></span><br><span class="line">       Fluttertoast.showToast(msg: <span class="string">'æœªæ‰“å¼€ç›¸å…³æƒé™'</span>);</span><br><span class="line">     <span class="keyword">else</span> <span class="comment">// æœªåŒæ„åˆ™ä¸»åŠ¨ç”³è¯·æƒé™</span></span><br><span class="line">       PermissionHandler().requestPermissions([PermissionGroup.storage]);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="comment">// ä¸æ˜¯å†™å…¥å¤–éƒ¨å­˜å‚¨ç›´æ¥å†™å…¥æ–‡ä»¶</span></span><br><span class="line">     _writeContent();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–‡æœ¬å†™å…¥æ–‡ä»¶ </span></span><br><span class="line"> <span class="keyword">void</span> _writeContent() <span class="keyword">async</span> &#123;</span><br><span class="line">   <span class="comment">// å†™å…¥æ–‡æœ¬æ“ä½œ</span></span><br><span class="line">   <span class="keyword">var</span> text = _editController.value.text; <span class="comment">// è·å–æ–‡æœ¬æ¡†çš„å†…å®¹</span></span><br><span class="line">   File file = File(<span class="keyword">await</span> _getFilePath()); <span class="comment">// è·å–ç›¸åº”çš„æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (text == <span class="keyword">null</span> || text.isEmpty) &#123;</span><br><span class="line">     Fluttertoast.showToast(msg: <span class="string">'è¯·è¾“å…¥å†…å®¹'</span>); <span class="comment">// å†…å®¹ä¸ºç©ºï¼Œåˆ™ä¸å†™å…¥å¹¶æé†’</span></span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="comment">// å†…å®¹ä¸ç©ºï¼Œåˆ™åˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå­˜åœ¨å…ˆåˆ é™¤ï¼Œé‡æ–°åˆ›å»ºåå†™å…¥ä¿¡æ¯</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">await</span> file.exists()) file.deleteSync();</span><br><span class="line">     file.createSync(); <span class="comment">// createSync æ˜¯ä¸€ä¸ªåŒæ­¥çš„åˆ›å»ºè¿‡ç¨‹</span></span><br><span class="line">     file.writeAsStringSync(text); <span class="comment">// writeAsStringSync æ˜¯åŒæ­¥å†™å…¥çš„è¿‡ç¨‹</span></span><br><span class="line">     _editController.clear(); <span class="comment">// å†™å…¥æ–‡ä»¶åæ¸…ç©ºè¾“å…¥æ¡†ä¿¡æ¯</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// è¯»å–æ–‡æœ¬æ“ä½œ</span></span><br><span class="line"> <span class="keyword">void</span> _readTextFromFile() <span class="keyword">async</span> &#123;</span><br><span class="line">   File file = File(<span class="keyword">await</span> _getFilePath());</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">await</span> file.exists()) &#123;</span><br><span class="line">     setState(() =&gt; _fileContent = file.readAsStringSync()); <span class="comment">// æ–‡ä»¶å­˜åœ¨åˆ™ç›´æ¥æ˜¾ç¤ºæ–‡æœ¬ä¿¡æ¯</span></span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     setState(() =&gt; _fileContent = <span class="string">''</span>); <span class="comment">// æ–‡ä»¶ä¸å­˜åœ¨åˆ™æ¸…ç©ºæ˜¾ç¤ºæ–‡æœ¬ä¿¡æ¯ï¼Œå¹¶æç¤º</span></span><br><span class="line">     Fluttertoast.showToast(msg: <span class="string">'æ–‡ä»¶è¿˜æœªåˆ›å»ºï¼Œè¯·å…ˆé€šè¿‡å†™å…¥ä¿¡æ¯æ¥åˆ›å»ºæ–‡ä»¶'</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºå¤–éƒ¨å­˜å‚¨çš„æ–‡ä»¶éœ€è¦æ¶‰åŠåˆ°æƒé™é—®é¢˜ï¼Œè€Œä¸” iOS ä¹Ÿä¸æ”¯æŒï¼Œæ‰€ä»¥å¦‚æœéœ€è¦ä½¿ç”¨æ–‡ä»¶æ¥æŒä¹…åŒ–æ•°æ®çš„è¯ï¼Œå°½é‡ä½¿ç”¨å¦å¤–ä¸¤ç§ã€‚å› ä¸ºåœ¨ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¿å­˜çš„æ•°æ®ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥è¿™è¾¹å°±ä¸å¾—ä¸è¯´å¦å¤–ä¸€ç§æ›´æ–¹ä¾¿çš„æŒä¹…åŒ–æ–¹å¼äº† <code>shared_preferences</code></p><h4 id="SharedPreferences"><a href="#SharedPreferences" class="headerlink" title="SharedPreferences"></a>SharedPreferences</h4><p>å†™ Android çš„å°ä¼™ä¼´å¯¹è¿™ä¸ªåº”è¯¥ä¸é™Œç”Ÿäº†ï¼Œä½†æ˜¯ <code>Flutter</code> å¹¶æ²¡æœ‰è‡ªå¸¦çš„ <code>shared_preferences</code> åŠŸèƒ½ï¼Œéœ€è¦ç¬¬ä¸‰æ–¹æ’ä»¶æ¥å®ç°ï¼Œå¼•å…¥ <code>shared_preferences</code> æ’ä»¶ï¼Œå†™æ–‡ç« çš„æ—¶å€™æœ€æ–°ç‰ˆæœ¬æ˜¯ <code>^0.5.1+2</code>ï¼Œè¿˜æ˜¯å…ˆçœ‹ä¸‹æœ€åçš„æ•ˆæœ</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/2888797-6cbe9d19584b96b4.gif" alt></p><p>ä»£ç çš„å®ç°ç›¸å¯¹æ¯”è¾ƒç®€å•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">Widget _sharedPart() &#123;</span><br><span class="line">    <span class="keyword">return</span> Card(</span><br><span class="line">        margin: <span class="keyword">const</span> EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">        shape: RoundedRectangleBorder(borderRadius: BorderRadius.all(Radius.circular(<span class="number">8.0</span>))),</span><br><span class="line">        child: Column(</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Padding(</span><br><span class="line">              padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">12.0</span>),</span><br><span class="line">              child:</span><br><span class="line">                  Text(<span class="string">'Shared Preferences'</span>, style: TextStyle(fontSize: <span class="number">20.0</span>, color: Theme.of(context).primaryColor)),</span><br><span class="line">            ),</span><br><span class="line">            Padding(</span><br><span class="line">              padding: <span class="keyword">const</span> EdgeInsets.fromLTRB(<span class="number">12.0</span>, <span class="number">0</span>, <span class="number">12.0</span>, <span class="number">12.0</span>),</span><br><span class="line">              <span class="comment">// ç”¨äºè®¾ç½® key ä¿¡æ¯</span></span><br><span class="line">              child: TextField(</span><br><span class="line">                controller: _shareKeyController,</span><br><span class="line">                decoration: InputDecoration(labelText: <span class="string">'è¾“å…¥ share å­˜å‚¨çš„ key'</span>, icon: Icon(Icons.lock_outline)),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            Padding(</span><br><span class="line">              padding: <span class="keyword">const</span> EdgeInsets.fromLTRB(<span class="number">12.0</span>, <span class="number">0</span>, <span class="number">12.0</span>, <span class="number">12.0</span>),</span><br><span class="line">              <span class="comment">// ç”¨äºå†™å…¥æ–‡æœ¬ä¿¡æ¯</span></span><br><span class="line">              child: TextField(</span><br><span class="line">                controller: _shareValueController,</span><br><span class="line">                decoration: InputDecoration(labelText: <span class="string">'è¾“å…¥ share å­˜å‚¨çš„ value'</span>, icon: Icon(Icons.text_fields)),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            Container(</span><br><span class="line">              margin: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">12.0</span>),</span><br><span class="line">              width: MediaQuery.of(context).size.width,</span><br><span class="line">              child: RaisedButton(</span><br><span class="line">                onPressed: _writeIntoShare,</span><br><span class="line">                child: Text(<span class="string">'å†™å…¥ share'</span>),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            Padding(</span><br><span class="line">              padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">12.0</span>),</span><br><span class="line">              child: Row(</span><br><span class="line">                crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">                mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">                children: &lt;Widget&gt;[Text(<span class="string">'share å­˜å‚¨å†…å®¹ï¼š'</span>), Expanded(child: Text(_shareContent, softWrap: <span class="keyword">true</span>))],</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            Container(</span><br><span class="line">              margin: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">12.0</span>),</span><br><span class="line">              width: MediaQuery.of(context).size.width,</span><br><span class="line">              child: RaisedButton(</span><br><span class="line">                onPressed: _readFromShare,</span><br><span class="line">                child: Text(<span class="string">'è¯»å– share'</span>),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å®ç°çš„å…³é”®éƒ¨åˆ†å°±æ˜¯æ–¹æ³• <code>_writeIntoShare</code> å’Œ <code>_readFromShare</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _writeIntoShare() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> shareKey = _shareKeyController.value.text;</span><br><span class="line">    <span class="keyword">var</span> shareContent = _shareValueController.value.text;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (shareKey == <span class="keyword">null</span> || shareKey.isEmpty) &#123;</span><br><span class="line">      Fluttertoast.showToast(msg: <span class="string">'è¯·è¾“å…¥ key'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shareContent == <span class="keyword">null</span> || shareContent.isEmpty) &#123;</span><br><span class="line">      Fluttertoast.showToast(msg: <span class="string">'è¯·è¾“å…¥ä¿å­˜çš„å†…å®¹'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// é€šè¿‡ `getInstance` è·å– `shared_preferences` å•ä¾‹</span></span><br><span class="line">      <span class="keyword">var</span> sp = <span class="keyword">await</span> SharedPreferences.getInstance();</span><br><span class="line">      <span class="comment">// sp èƒ½ä¿å­˜çš„æ•°æ®ç±»å‹åŒ…æ‹¬ `int`, `String`, `bool`, `double`, `StringList`</span></span><br><span class="line">      sp.setString(shareKey, shareContent);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _readFromShare() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> shareKey = _shareKeyController.value.text;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (shareKey == <span class="keyword">null</span> || shareKey.isEmpty) &#123;</span><br><span class="line">      Fluttertoast.showToast(msg: <span class="string">'è¯·è¾“å…¥ key'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> sp = <span class="keyword">await</span> SharedPreferences.getInstance();</span><br><span class="line">      <span class="comment">// æ•°æ®è¯»å–çš„ç±»å‹åŒå†™å…¥ç±»å‹ï¼Œå¦‚æœä¼ å…¥çš„ key ä¸å­˜åœ¨åˆ™è¿”å› null</span></span><br><span class="line">      <span class="keyword">var</span> value = sp.getString(shareKey);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">        Fluttertoast.showToast(msg: <span class="string">'æœªæ‰¾åˆ°è¯¥ key'</span>);</span><br><span class="line">        setState(() =&gt; _shareContent = <span class="string">''</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setState(() =&gt; _shareContent = value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ç§æ•°æ®æŒä¹…åŒ–çš„æ–¹å¼ä¸»è¦ç”¨äºå­˜å‚¨ç›¸å¯¹ç®€å•ï¼Œå…³ç³»ä¸å¤æ‚çš„æ•°æ®ï¼Œå¦‚æœæ¶‰åŠåˆ°å¤§é‡çš„ï¼Œä¸”å­—æ®µä¹‹é—´æœ‰å…³ç³»çš„æƒ…å†µå°±éœ€è¦é€šè¿‡æ•°æ®åº“æ¥å®ç°äº†ï¼ŒAndroid å’Œ iOS éƒ½è‡ªå¸¦ sqlite æ•°æ®åº“ã€‚</p><p><em>ä»¥ä¸Šä»£ç æŸ¥çœ‹ data_persistence_main.dart æ–‡ä»¶</em></p><h4 id="Sqflite"><a href="#Sqflite" class="headerlink" title="Sqflite"></a>Sqflite</h4><p><code>Flutter</code> å®ç°æ•°æ®åº“å­˜å‚¨éœ€è¦é€šè¿‡æ’ä»¶ <code>sqflite</code> æ¥å®ç°ï¼Œå†™æ–‡ç« çš„æ—¶å€™æœ€æ–°çš„ç‰ˆæœ¬æ˜¯ <code>sqflite 1.1.3</code>ï¼Œä½†æ˜¯è¯¥ç‰ˆæœ¬éœ€è¦ <code>flutter 1.2</code> ä»¥ä¸Šæ‰è¡Œï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©çš„æ˜¯ <code>sqflite 1.1.0</code>ï¼Œå°ä¼™ä¼´å¯ä»¥æ ¹æ®è‡ªå·±çš„ <code>flutter</code> ç‰ˆæœ¬é€‰æ‹©ç›¸åº”çš„ <code>sqflite</code> ç‰ˆæœ¬</p><p>sqflite çš„åŸºæœ¬æ“ä½œè¯­å¥ï¼Œåœ¨<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Ftekartik%2Fsqflite%2Fblob%2Fmaster%2Fsqflite%2FREADME.md" target="_blank" rel="noopener">æ–‡æ¡£ä¸­</a>å·²ç»å†™å¾—éå¸¸æ˜ç™½äº†ï¼Œæ‰€ä»¥å°±ä¸æ¬è¿äº†ï¼Œè¿™è¾¹ç›´æ¥è®²ä¸‹å¯¹äºæ•°æ®åº“çš„ä¸€äº›å°è£…å¤„ç†å§ï¼Œå› ä¸ºæ‰“å¼€æ•°æ®åº“æ˜¯ä¸€ä¸ªå¾ˆæ¶ˆè€—èµ„æºçš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œæ‰€ä»¥å‘¢ï¼Œæ¨èå®ç°å•ä¾‹ä¼šæ¯”è¾ƒå¥½ã€‚ä¾‹å¦‚æˆ‘ä»¬è¦å®ç°ä¸€ä¸ª <code>student</code> å­˜å‚¨è¡¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DatabaseUtils</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> _tableStudent = <span class="string">'student'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> Database _database; <span class="comment">// åˆ›å»ºå•ä¾‹ï¼Œé˜²æ­¢é‡å¤æ‰“å¼€æ¶ˆè€—å†…å­˜</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> DatabaseUtils _instance;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> DatabaseUtils <span class="keyword">get</span> instance =&gt; _instance;</span><br><span class="line"></span><br><span class="line">  DatabaseUtils._internal() &#123;</span><br><span class="line">    getDatabasesPath().then((path) <span class="keyword">async</span> &#123;</span><br><span class="line">      _database = <span class="keyword">await</span> openDatabase(join(path, <span class="string">'demo.db'</span>), version: <span class="number">2</span>, onCreate: (db, version) &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ•°æ®åº“çš„æ—¶å€™åœ¨è¿™è¾¹è°ƒç”¨</span></span><br><span class="line">        db.execute(<span class="string">'create table $_tableStudent '</span></span><br><span class="line">            <span class="string">'id integer primary key autoincrement,'</span></span><br><span class="line">            <span class="string">'name text not null,'</span></span><br><span class="line">            <span class="string">'age integer not null default 0,'</span></span><br><span class="line">            <span class="string">'gender integer not null default 0'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–°å‡çº§å¢åŠ çš„å­—æ®µ</span></span><br><span class="line">        db.execute(<span class="string">'alter table $_tableStudent add column birthday text'</span>);</span><br><span class="line">      &#125;, onUpgrade: (db, oldVersion, newVersion) &#123;</span><br><span class="line">        <span class="comment">// æ›´æ–°å‡çº§æ•°æ®åº“çš„æ—¶å€™åœ¨è¿™æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> (oldVersion == <span class="number">1</span>) db.execute(<span class="string">'alter table $_tableStudent add column birthday text'</span>);</span><br><span class="line">      &#125;, onOpen: (db) &#123;</span><br><span class="line">        <span class="comment">// æ‰“å¼€æ•°æ®åº“æ—¶å€™çš„å›è°ƒ</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'<span class="subst">$&#123;db.path&#125;</span>'</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">factory</span> DatabaseUtils() &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰çš„å•ä¾‹å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸å†åˆ›å»ºï¼Œå¦åˆ™é‡æ–°åˆ›å»ºï¼Œfactory å…³é”®è¯çœ‹ç¬¬ä¸€ç« </span></span><br><span class="line">    <span class="keyword">if</span> (_instance == <span class="keyword">null</span>) _instance = DatabaseUtils._internal();</span><br><span class="line">    <span class="keyword">return</span> _instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¯¹æ•°æ®åº“çš„æ“ä½œå°±å®Œå…¨è€ƒéªŒä½ çš„ <code>SQL</code> çš„æŒæ¡ç¨‹åº¦äº†ï¼Œä½†æ˜¯åƒä¸‡è®°ä½ï¼Œsqlite ä¸­çš„ç±»å‹åªæœ‰ï¼Œæ•´å‹ <code>integer</code> ï¼Œå­—ç¬¦ç±»å‹ <code>text</code>ï¼Œæµ®ç‚¹ç±»å‹ <code>real</code>ï¼ŒäºŒè¿›åˆ¶ <code>blob</code>ã€‚æ•°æ®åº“çš„å…·ä½“ä¾‹å­ä¼šç­‰åˆ°æœ€åçš„å®é™…é¡¹ç›®ä¸­å±•ç¤ºï¼ŒåŸè°…æˆ‘ä¸æ‡‚å¦‚ä½•å±•ç¤ºä¸€ä¸ªç•Œé¢ç»™ä½ æ“ä½œï¼Œå®ç°æ•°æ®åº“çš„å„ç§åŠŸèƒ½ã€‚</p><p><em>è¯¥éƒ¨åˆ†ä»£ç æŸ¥çœ‹ db_util.dart æ–‡ä»¶</em>ï¼Œé‡Œé¢æœ‰ä¸€äº›åŸºæœ¬çš„æ“ä½œå†™æ³•ï¼Œå°ä¼™ä¼´å¯è‡ªè¡ŒæŸ¥çœ‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸ŠèŠ‚è®²äº†çŠ¶æ€ç®¡ç†ï¼Œä½†æ˜¯å½“ &lt;code&gt;App&lt;/code&gt; é‡å¯åï¼Œæ•°æ®å°±éƒ½ä¸¢å¤±äº†ï¼Œè¿™æ ·å°±æ¯”è¾ƒå°´å°¬äº†ï¼Œä»€ä¹ˆéƒ½è¦é‡æ¥ï¼Œæ‰€ä»¥è¿™èŠ‚æˆ‘ä»¬æ¥è®²ä¸‹æ•°æ®æŒä¹…åŒ–ã€‚æ•°æ®æŒä¹…åŒ–ä¸»è¦æœ‰å¦‚ä¸‹æ–¹å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ä»¶è¯»å†™&lt;/li&gt;
&lt;li&gt;&lt;code&gt;shared_preferences&lt;/code&gt; å­˜å‚¨&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“å­˜å‚¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æŒä¹…åŒ–çš„å®ç°éƒ½éœ€è¦é€šè¿‡ä¸‰æ–¹æ’ä»¶æ¥å®ç°ï¼Œæ¥ç€ä¼šæ…¢æ…¢ä»‹ç»ä¸‰ç§å®ç°æ–¹å¼&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/categories/Android/Flutter/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutterå…¥é—¨æŒ‡å—(åä¸€)ä¹‹çŠ¶æ€ç®¡ç†ï¼ŒBLoC</title>
    <link href="https://zhangmiao.cc/posts/d121323a.html"/>
    <id>https://zhangmiao.cc/posts/d121323a.html</id>
    <published>2019-04-27T07:07:53.000Z</published>
    <updated>2019-05-27T07:12:22.212Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h4><p>åœ¨ <code>dart</code> éƒ¨åˆ†è®°å¾—åˆ†äº«è¿‡ <code>Stream</code> çš„æ–‡ç« é“¾æ¥ï¼Œä½†æ˜¯æˆ‘çŸ¥é“ä½ ä»¬è‚¯å®šæ²¡å‡ ä¸ªæ„¿æ„çœ‹çš„ï¼Œæ‰€ä»¥è¿™é‡Œå†æä¸‹ã€‚è¿˜æ˜¯å¾—ä»æºç å¼€å§‹â€¦å› ä¸ºæºç çš„æ³¨é‡Šæ¯”è¾ƒé•¿ï¼Œå°±ä¸è´´æ³¨é‡Šäº†ï¼Œå¯ä»¥è‡ªå·±çœ‹ï¼Œæˆ‘è¿™è¾¹å°±æå–ä¸€äº›å…³é”®ä¿¡æ¯ã€‚</p><p><code>Stream</code> æ˜¯ <code>Dart</code> æä¾›çš„ä¸€ç§æ•°æ®æµè®¢é˜…ç®¡ç†çš„â€å·¥å…·â€ï¼Œæ„Ÿè§‰æœ‰ç‚¹åƒ <code>Android</code> ä¸­çš„ <code>EventBus</code> æˆ–è€… <code>RxBus</code>ï¼Œ<code>Stream</code> å¯ä»¥æ¥æ”¶ä»»ä½•å¯¹è±¡ï¼ŒåŒ…æ‹¬æ˜¯å¦å¤–ä¸€ä¸ª <code>Stream</code>ï¼Œæ¥æ”¶çš„å¯¹è±¡é€šè¿‡ <code>StreamController</code> çš„ <code>sink</code> è¿›è¡Œæ·»åŠ ï¼Œç„¶åé€šè¿‡ <code>StreamController</code> å‘é€ç»™ <code>Stream</code>ï¼Œé€šè¿‡ <code>listen</code> è¿›è¡Œç›‘å¬ï¼Œ<code>listen</code> ä¼šè¿”å›ä¸€ä¸ª <code>StreamSubscription</code> å¯¹è±¡ï¼Œ<code>StreamSubscription</code> å¯ä»¥æ“ä½œå¯¹æ•°æ®æµçš„ç›‘å¬ï¼Œä¾‹å¦‚ <code>pause</code>ï¼Œ<code>resume</code>ï¼Œ<code>cancel</code> ç­‰ã€‚</p><p><code>Stream</code> åˆ†ä¸¤ç§ç±»å‹ï¼š</p><ol><li><code>Single-subscription Stream</code>ï¼šå•è®¢é˜… streamï¼Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸåªå…è®¸æœ‰ä¸€ä¸ªç›‘å¬ï¼Œå¦‚æœè¯¥ç›‘å¬ cancel äº†ï¼Œä¹Ÿä¸èƒ½å†æ·»åŠ å¦ä¸€ä¸ªç›‘å¬ï¼Œè€Œä¸”åªæœ‰å½“æœ‰ç›‘å¬äº†ï¼Œæ‰ä¼šå‘é€æ•°æ®ï¼Œä¸»è¦ç”¨äºæ–‡ä»¶ <code>IO</code> æµçš„è¯»å–ç­‰ã€‚</li><li><code>Broadcast Stream</code>ï¼šå¹¿æ’­è®¢é˜… streamï¼Œå…è®¸æœ‰å¤šä¸ªç›‘å¬ï¼Œå½“æ·»åŠ äº†ç›‘å¬åï¼Œå¦‚æœæµä¸­æœ‰æ•°æ®å­˜åœ¨å°±å¯ä»¥ç›‘å¬åˆ°æ•°æ®ï¼Œè¿™ç§ç±»å‹ï¼Œä¸ç®¡æ˜¯å¦æœ‰ç›‘å¬ï¼Œåªè¦æœ‰æ•°æ®å°±ä¼šå‘é€ï¼Œç”¨äºéœ€è¦å¤šä¸ªç›‘å¬çš„æƒ…å†µã€‚</li></ol><a id="more"></a><p>è¿˜æ˜¯çœ‹ä¸‹ä¾‹å­ä¼šæ¯”è¾ƒç›´è§‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_StreamHomeState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">StreamHome</span>&gt; </span>&#123;</span><br><span class="line">  StreamController _controller = StreamController();  <span class="comment">// åˆ›å»ºå•è®¢é˜…ç±»å‹ `StreamController`</span></span><br><span class="line">  Sink _sink;</span><br><span class="line">  StreamSubscription _subscription;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line"></span><br><span class="line">    _sink = _controller.sink; <span class="comment">// _sink ç”¨äºæ·»åŠ æ•°æ®</span></span><br><span class="line">    <span class="comment">// _controller.stream ä¼šè¿”å›ä¸€ä¸ªå•è®¢é˜… streamï¼Œ</span></span><br><span class="line">    <span class="comment">// é€šè¿‡ listen è¿”å› StreamSubscriptionï¼Œç”¨äºæ“ä½œæµçš„ç›‘å¬æ“ä½œ</span></span><br><span class="line">    _subscription = _controller.stream.listen((data) =&gt; <span class="built_in">print</span>(<span class="string">'Listener: $data'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ æ•°æ®ï¼Œstream ä¼šé€šè¿‡ `listen` æ–¹æ³•æ‰“å°</span></span><br><span class="line">    _sink.add(<span class="string">'A'</span>);</span><br><span class="line">    _sink.add(<span class="number">11</span>);</span><br><span class="line">    _sink.add(<span class="number">11.16</span>);</span><br><span class="line">    _sink.add([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">    _sink.add(&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">    <span class="comment">// æœ€åè¦é‡Šæ”¾èµ„æº...</span></span><br><span class="line">    _sink.close();</span><br><span class="line">    _controller.close();</span><br><span class="line">    _subscription.cancel();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: Container(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸‹æ§åˆ¶å°çš„è¾“å‡ºï¼š</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527150910.png" alt></p><p>æœç„¶æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½æ‰“å°å‡ºæ¥äº†ï¼Œå‰é¢æœ‰è¯´è¿‡ï¼Œå•è®¢é˜…çš„ stream åªæœ‰å½“ <code>listen</code> åæ‰ä¼šå‘é€æ•°æ®ï¼Œä¸è¯•è¯•æˆ‘è¿˜æ˜¯ä¸ç›¸ä¿¡çš„ï¼Œæˆ‘ä»¬æŠŠ <code>_sink.add</code> æ”¾åˆ° <code>listen</code> å‰é¢å»æ‰§è¡Œï¼Œå†çœ‹æ§åˆ¶å°çš„æ‰“å°ç»“æœã€‚å±…ç„¶çœŸçš„æ˜¯ä¸€æ ·çš„ï¼ŒGoogle ç²‘ç²‘æœç„¶è¯šä¸æ¬ºæˆ‘ã€‚æ¥ç€è¯•ä¸‹ <code>pause</code>ï¼Œ<code>resume</code> æ–¹æ³•ï¼Œçœ‹ä¸‹æ•°æ®å¦‚ä½•ç›‘å¬ï¼Œä¿®æ”¹ä»£ç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">_sink = _controller.sink;</span><br><span class="line">_subscription = _controller.stream.listen((data) =&gt; <span class="built_in">print</span>(<span class="string">'Listener: $data'</span>));</span><br><span class="line">_sink.add(<span class="string">'A'</span>);</span><br><span class="line">_subscription.pause(); <span class="comment">// æš‚åœç›‘å¬</span></span><br><span class="line">_sink.add(<span class="number">11</span>);</span><br><span class="line">_sink.add(<span class="number">11.16</span>);</span><br><span class="line">_subscription.resume(); <span class="comment">// æ¢å¤ç›‘å¬</span></span><br><span class="line">_sink.add([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">_sink.add(&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;);</span><br></pre></td></tr></table></figure><p>å†çœ‹æ§åˆ¶å°çš„æ‰“å°ï¼Œä½ ä»¬å¯ä»¥å…ˆçŒœä¸‹æ˜¯ä»€ä¹ˆç»“æœï¼Œæˆ‘çŒœå¤§éƒ¨åˆ†äººéƒ½ä¼šè§‰å¾—åº”è¯¥æ˜¯ä¸ä¼šæœ‰ 11 å’Œ 11.16 æ‰“å°å‡ºæ¥äº†ã€‚ç„¶é¹…äº‹å®å¹¶éè¿™æ ·ï¼Œæ‰“å°çš„ç»“æœå¹¶æœªå‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨ <code>pause</code> æ–¹æ³•åï¼Œstream è¢«å µä½äº†ï¼Œæ•°æ®ä¸ç»§ç»­å‘é€äº†ã€‚</p><p>æ¥ä¸‹æ¥çœ‹ä¸‹å¹¿æ’­è®¢é˜… streamï¼Œå¯¹ä»£ç åšä¸‹ä¿®æ”¹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">StreamController _controller = StreamController.broadcast();</span><br><span class="line">  Sink _sink;</span><br><span class="line">  StreamSubscription _subscription;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line"></span><br><span class="line">    _sink = _controller.sink;</span><br><span class="line"></span><br><span class="line">    _sink.add(<span class="string">'A'</span>);</span><br><span class="line">    _subscription = _controller.stream.listen((data) =&gt; <span class="built_in">print</span>(<span class="string">'Listener: $data'</span>));</span><br><span class="line"></span><br><span class="line">    _sink.add(<span class="number">11</span>);</span><br><span class="line">    _subscription.pause();</span><br><span class="line">    _sink.add(<span class="number">11.16</span>);</span><br><span class="line">    _subscription.resume();</span><br><span class="line"></span><br><span class="line">    _sink.add([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">    _sink.add(&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†çœ‹ä¸‹æ§åˆ¶å°çš„æ‰“å°ï¼š</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527150935.png" alt></p><p>ä½ çŒœå¯¹ç­”æ¡ˆäº†å—ï¼Œè¿™è¾¹åšä¸‹å°æ€»ç»“ï¼š</p><p><strong>å•è®¢é˜… Stream åªæœ‰å½“å­˜åœ¨ç›‘å¬çš„æ—¶å€™ï¼Œæ‰å‘é€æ•°æ®ï¼Œå¹¿æ’­è®¢é˜… Stream åˆ™ä¸è€ƒè™‘è¿™ç‚¹ï¼Œæœ‰æ•°æ®å°±å‘é€ï¼›å½“ç›‘å¬è°ƒç”¨ pause ä»¥åï¼Œä¸ç®¡å“ªç§ç±»å‹çš„ stream éƒ½ä¼šåœæ­¢å‘é€æ•°æ®ï¼Œå½“ resume ä¹‹åï¼ŒæŠŠå‰é¢å­˜ç€çš„æ•°æ®éƒ½å‘é€å‡ºå»ã€‚</strong></p><p>sink å¯ä»¥æ¥å—ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ³›å‹å¯¹ä¼ å…¥çš„æ•°æ®è¿›è¡Œé™åˆ¶ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯¹ <code>StreamController</code> è¿›è¡Œç±»å‹æŒ‡å®š <code>StreamController&lt;int&gt; _controller = StreamController.broadcast();</code> å› ä¸ºæ²¡æœ‰å¯¹ <code>Sink</code> çš„ç±»å‹è¿›è¡Œé™åˆ¶ï¼Œè¿˜æ˜¯å¯ä»¥æ·»åŠ é™¤äº† <code>int</code> å¤–çš„ç±»å‹å‚æ•°ï¼Œä½†æ˜¯è¿è¡Œçš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œ<code>_controller</code> å¯¹ä½ ä¼ å…¥çš„å‚æ•°åšäº†ç±»å‹åˆ¤å®šï¼Œæ‹’ç»è¿›å…¥ã€‚</p><p><code>Stream</code> ä¸­è¿˜æä¾›äº†å¾ˆå¤š <code>StremTransformer</code>ï¼Œç”¨äºå¯¹ç›‘å¬åˆ°çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚æˆ‘ä»¬å‘é€ 0~19 çš„ 20 ä¸ªæ•°æ®ï¼Œåªæ¥å—å¤§äº 10 çš„å‰ 5 ä¸ªæ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥å¯¹ stream å¦‚ä¸‹æ“ä½œ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">_subscription = _controller.stream</span><br><span class="line">    .where((value) =&gt; value &gt; <span class="number">10</span>)</span><br><span class="line">    .take(<span class="number">5</span>)</span><br><span class="line">    .listen((data) =&gt; <span class="built_in">print</span>(<span class="string">'Listen: $data'</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">List</span>.generate(<span class="number">20</span>, (index) =&gt; _sink.add(index));</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ‰“å°å‡ºæ¥çš„æ•°æ®å¦‚ä¸‹å›¾</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/20190527150951.png" alt></p><p>é™¤äº† <code>where</code>ï¼Œ<code>take</code> è¿˜æœ‰å¾ˆå¤š <code>Transformer</code>ï¼Œ ä¾‹å¦‚ <code>map</code>ï¼Œ<code>skip</code> ç­‰ç­‰ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥è‡ªè¡Œç ”ç©¶ã€‚äº†è§£äº† <code>Stream</code> çš„åŸºæœ¬å±æ€§åï¼Œå°±å¯ä»¥ç»§ç»­å¾€ä¸‹äº†~</p><h4 id="StreamBuilder"><a href="#StreamBuilder" class="headerlink" title="StreamBuilder"></a>StreamBuilder</h4><p>å‰é¢æåˆ°äº† stream é€šè¿‡ <code>listen</code> è¿›è¡Œç›‘å¬æ•°æ®çš„å˜åŒ–ï¼Œ<code>Flutter</code> å°±ä¸ºæˆ‘ä»¬æä¾›äº†è¿™ä¹ˆä¸ªéƒ¨ä»¶ <code>StreamBuilder</code> ä¸“é—¨ç”¨äºç›‘å¬ stream çš„å˜åŒ–ï¼Œç„¶åè‡ªåŠ¨åˆ·æ–°é‡å»ºã€‚æ¥ç€æ¥çœ‹ä¸‹æºç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> StreamBuilder(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">    <span class="keyword">this</span>.initialData, <span class="comment">// åˆå§‹æ•°æ®ï¼Œä¸ä¼ å…¥åˆ™ä¸º null</span></span><br><span class="line">    Stream&lt;T&gt; stream,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.builder</span><br><span class="line">  &#125;) : <span class="keyword">assert</span>(builder != <span class="keyword">null</span>),</span><br><span class="line">       <span class="keyword">super</span>(key: key, stream: stream);</span><br><span class="line"></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line">AsyncSnapshot&lt;T&gt; initial() =&gt; AsyncSnapshot&lt;T&gt;.withData(ConnectionState.none, initialData);</span><br></pre></td></tr></table></figure><p><code>StreamBuilder</code> å¿…é¡»ä¼ å…¥ä¸€ä¸ª <code>AsyncWidgetBuilder</code> å‚æ•°ï¼Œåˆå§‹å€¼ <code>initialData</code> å¯ä¸ºç©ºï¼Œ <code>stream</code> ç”¨äºç›‘å¬æ•°æ®å˜åŒ–ï¼Œ<code>initial</code> æ–¹æ³•çš„è°ƒç”¨åœ¨å…¶çˆ¶ç±» <code>StremBuilderBase</code> ä¸­ï¼Œæ¥ç€çœ‹ä¸‹ <code>StreamBuilderBaseState</code> çš„æºç ï¼Œè¿™é‡Œæˆ‘åˆ é™¤ä¸€äº›ä¸å¿…è¦çš„æºç ï¼Œæ–¹ä¾¿æŸ¥çœ‹ï¼Œå®Œæ•´çš„æºç å¯è‡ªè¡ŒæŸ¥çœ‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_StreamBuilderBaseState</span>&lt;<span class="title">T</span>, <span class="title">S</span>&gt; <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">StreamBuilderBase</span>&lt;<span class="title">T</span>, <span class="title">S</span>&gt;&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _summary = widget.initial(); <span class="comment">// é€šè¿‡ä¼ å…¥çš„åˆå§‹å€¼ç”Ÿæˆé»˜è®¤å€¼ï¼Œå¦‚æœæ²¡æœ‰ä¼ å…¥åˆ™ä¼šæ˜¯ null</span></span><br><span class="line">    _subscribe(); <span class="comment">// æ³¨å†Œä¼ å…¥çš„ streamï¼Œç”¨äºç›‘å¬å˜åŒ–</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// _summary ä¸ºç›‘å¬åˆ°çš„æ•°æ®</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) =&gt; widget.build(context, _summary);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">void</span> _subscribe() &#123;</span><br><span class="line">    <span class="keyword">if</span> (widget.stream != <span class="keyword">null</span>) &#123; </span><br><span class="line">      <span class="comment">// stream é€šè¿‡å¤–éƒ¨ä¼ å…¥ï¼Œå¯¹æ•°æ®çš„å˜åŒ–è¿›è¡Œç›‘å¬ï¼Œ</span></span><br><span class="line">      <span class="comment">// åœ¨ä¸åŒå›è°ƒä¸­ï¼Œé€šè¿‡ setState è¿›è¡Œæ›´æ–° _summary</span></span><br><span class="line">      <span class="comment">// å½“ _summary æ›´æ–°åï¼Œç”±äºè°ƒç”¨äº† setStateï¼Œé‡æ–°è°ƒç”¨ build æ–¹æ³•ï¼Œå°†æœ€æ–°çš„ _summary ä¼ é€’å‡ºå»</span></span><br><span class="line">      _subscription = widget.stream.listen((T data) &#123;</span><br><span class="line">        setState(() &#123; </span><br><span class="line">          _summary = widget.afterData(_summary, data); </span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;, onError: (<span class="built_in">Object</span> error) &#123;</span><br><span class="line">        setState(() &#123;</span><br><span class="line">          _summary = widget.afterError(_summary, error);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;, onDone: () &#123;</span><br><span class="line">        setState(() &#123;</span><br><span class="line">          _summary = widget.afterDone(_summary);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">      _summary = widget.afterConnected(_summary); <span class="comment">// </span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¹‹å‰æ›´æ–°æ•°æ®éƒ½éœ€è¦é€šè¿‡ <code>setState</code> è¿›è¡Œæ›´æ–°ï¼Œè¿™é‡Œäº†è§£å®Œäº† <code>stream</code>ï¼Œæˆ‘ä»¬å°±ä¸ä½¿ç”¨ <code>setState</code> æ›´æ–°ï¼Œä½¿ç”¨ <code>Stream</code> æ¥æ›´æ–°</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_StreamHomeState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">StreamHome</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// å®šä¹‰ä¸€ä¸ªå…¨å±€çš„ `StreamController`</span></span><br><span class="line">  StreamController&lt;<span class="built_in">int</span>&gt; _controller = StreamController.broadcast();</span><br><span class="line">  <span class="comment">// `sink` ç”¨äºä¼ å…¥æ–°çš„æ•°æ®</span></span><br><span class="line">  Sink&lt;<span class="built_in">int</span>&gt; _sink;</span><br><span class="line">  <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _sink = _controller.sink;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">    <span class="comment">// éœ€è¦é”€æ¯èµ„æº</span></span><br><span class="line">    _sink.close();</span><br><span class="line">    _controller.close();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: SafeArea(</span><br><span class="line">          child: Container(</span><br><span class="line">        alignment: Alignment.center,</span><br><span class="line">        child: StreamBuilder(</span><br><span class="line">          builder: (_, snapshot) =&gt; Text(<span class="string">'<span class="subst">$&#123;snapshot.data&#125;</span>'</span>, style: TextStyle(fontSize: <span class="number">24.0</span>)),</span><br><span class="line">          stream: _controller.stream, <span class="comment">// stream åœ¨ StreamBuilder é”€æ¯çš„æ—¶å€™ä¼šè‡ªåŠ¨é”€æ¯</span></span><br><span class="line">          initialData: _counter,</span><br><span class="line">        ),</span><br><span class="line">      )),</span><br><span class="line">      <span class="comment">// é€šè¿‡ `sink` ä¼ å…¥æ–°çš„æ•°æ®ï¼Œå»é€šçŸ¥ `stream` æ›´æ–°åˆ° builder ä¸­</span></span><br><span class="line">      floatingActionButton: FloatingActionButton(</span><br><span class="line">        onPressed: () =&gt; _sink.add(_counter++),</span><br><span class="line">        child: Icon(Icons.add),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå½“ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ï¼Œå°±ä¼šåˆ·æ–°ç•Œé¢ä¸Šçš„å€¼ï¼Œé€šè¿‡ä¸Šé¢çš„æºç åˆ†æï¼Œ<code>StreamBuilder</code> ä¹Ÿæ˜¯é€šè¿‡ <code>setState</code> æ–¹æ³•è¿›è¡Œåˆ·æ–°ï¼Œé‚£ä¹ˆä¸¤ç§æ–¹æ³•å­°ä¼˜å­°åŠ£å‘¢ï¼Œå½“ç„¶æ˜¯é€šè¿‡ <code>Stream</code> å•¦ï¼Œè¿™ä¸æ˜¯åºŸè¯å—ã€‚<strong>å› ä¸ºé€šè¿‡è°ƒç”¨ setState åˆ·æ–°çš„è¯ï¼Œä¼šæŠŠæ•´ä¸ªç•Œé¢éƒ½è¿›è¡Œé‡æ„ï¼Œä½†æ˜¯é€šè¿‡ StreamBuilder çš„è¯ï¼Œåªåˆ·æ–°å…¶ builderï¼Œè¿™æ ·æ•ˆç‡å°±æ›´é«˜äº†</strong>ï¼Œæœ€åçœ‹å°æ•ˆæœå§ï¼Œæ‰€è°“æœ‰å›¾æœ‰çœŸç›¸å˜›</p><p><img src="https://raw.githubusercontent.com/zhangmiaocc/blogImageResource/master/img/2888797-31cb9b8c3a99abaf.gif" alt></p><p>è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬æ‘’å¼ƒäº† <code>setState</code> æ–¹æ³•ï¼Œé‚£ä¹ˆä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬è¯•è¯•æŠŠ <code>StatefulWidget</code> æ›¿æ¢æˆ <code>StatelessWidget</code> å§ï¼Œè€Œä¸”<strong>å®˜æ–¹ä¹Ÿæ¨èä½¿ç”¨ StatelessWidget æ›¿æ¢ StatefulWidget</strong>ï¼Œè¿™é‡Œå°±éœ€è¦æä¸‹ <code>BLoC</code> æ¨¡å¼äº†ã€‚</p><h4 id="BLoC"><a href="#BLoC" class="headerlink" title="BLoC"></a>BLoC</h4><p>è¯´å®è¯ï¼Œç°åœ¨ Google ä¸‹ ã€Œflutter blocã€èƒ½æœåˆ°å¾ˆå¤šæ–‡ç« ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡ <code>InheritedWidget</code> æ¥å®ç°çš„ï¼Œä¾‹å¦‚è¿™ç¯‡<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fjuejin.im%2Fpost%2F5bb6f344f265da0aa664d68a" target="_blank" rel="noopener">Flutter | çŠ¶æ€ç®¡ç†æ¢ç´¢ç¯‡â€”â€”BLoC(ä¸‰)</a>ï¼Œä½†æ˜¯ <code>InheritedWidget</code> æ²¡æœ‰æä¾› <code>dispose</code> æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šå­˜åœ¨ <code>StreamController</code> ä¸èƒ½åŠæ—¶é”€æ¯ç­‰é—®é¢˜ï¼Œæ‰€ä»¥ï¼Œå‚è€ƒäº†ä¸€ç¯‡å›½å¤–çš„æ–‡ç« ï¼Œ<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.didierboelens.com%2F2018%2F08%2Freactive-programming---streams---bloc%2F" target="_blank" rel="noopener">Reactive Programming - Streams - BLoC</a> è¿™é‡Œé€šè¿‡ä½¿ç”¨ <code>StatefulWidget</code> æ¥å®ç°ï¼Œå½“è¯¥éƒ¨ä»¶é”€æ¯çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨å…¶ <code>dispose</code> æ–¹æ³•ä¸­åŠæ—¶é”€æ¯ <code>StreamController</code>ï¼Œè¿™é‡Œæˆ‘è¿˜æ˜¯å…ˆå½“ä¸ªæ¬è¿å·¥ï¼Œæ¬ä¸‹å¤§ä½¬ä¸ºæˆ‘ä»¬å®ç°å¥½çš„åŸºç±»</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseBloc</span> </span>&#123;</span><br><span class="line">  <span class="keyword">void</span> dispose(); <span class="comment">// è¯¥æ–¹æ³•ç”¨äºåŠæ—¶é”€æ¯èµ„æº</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlocProvider</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">BaseBloc</span>&gt; <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Widget child; <span class="comment">// è¿™ä¸ª `widget` åœ¨ stream æ¥æ”¶åˆ°é€šçŸ¥çš„æ—¶å€™åˆ·æ–°</span></span><br><span class="line">  <span class="keyword">final</span> T bloc; </span><br><span class="line">  </span><br><span class="line">  BlocProvider(&#123;Key key, <span class="meta">@required</span> <span class="keyword">this</span>.child, <span class="meta">@required</span> <span class="keyword">this</span>.bloc&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _BlocProviderState&lt;T&gt; createState() =&gt; _BlocProviderState&lt;T&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¯¥æ–¹æ³•ç”¨äºè¿”å› Bloc å®ä¾‹</span></span><br><span class="line">  <span class="keyword">static</span> T of&lt;T <span class="keyword">extends</span> BaseBloc&gt;(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">final</span> type = _typeOf&lt;BlocProvider&lt;T&gt;&gt;(); <span class="comment">// è·å–å½“å‰ Bloc çš„ç±»å‹</span></span><br><span class="line">    <span class="comment">// é€šè¿‡ç±»å‹è·å–ç›¸åº”çš„ Providerï¼Œå†é€šè¿‡ Provider è·å– bloc å®ä¾‹</span></span><br><span class="line">    BlocProvider&lt;T&gt; provider = context.ancestorWidgetOfExactType(type); </span><br><span class="line">    <span class="keyword">return</span> provider.bloc; </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">Type</span> _typeOf&lt;T&gt;() =&gt; T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_BlocProviderState</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">BlocProvider</span>&lt;<span class="title">BaseBloc</span>&gt;&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    widget.bloc.dispose(); <span class="comment">// åŠæ—¶é”€æ¯èµ„æº</span></span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> widget.child;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬å¯¹å‰é¢çš„ä¾‹å­ä½¿ç”¨ <code>BLoC</code> è¿›è¡Œä¿®æ”¹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª <code>Bloc</code> ç±»ï¼Œç”¨äºä¿®æ”¹ count çš„å€¼</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterBloc</span> <span class="keyword">extends</span> <span class="title">BaseBloc</span> </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _count = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">int</span> <span class="keyword">get</span> count =&gt; _count;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// stream</span></span><br><span class="line">  StreamController&lt;<span class="built_in">int</span>&gt; _countController = StreamController.broadcast();</span><br><span class="line"></span><br><span class="line">  Stream&lt;<span class="built_in">int</span>&gt; <span class="keyword">get</span> countStream =&gt; _countController.stream; <span class="comment">// ç”¨äº StreamBuilder çš„ stream</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> dispatch(<span class="built_in">int</span> value) &#123;</span><br><span class="line">    _count = value;</span><br><span class="line">    _countController.sink.add(_count); <span class="comment">// ç”¨äºé€šçŸ¥ä¿®æ”¹å€¼</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _countController.close(); <span class="comment">// æ³¨é”€èµ„æº</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨ <code>Bloc</code> å‰ï¼Œéœ€è¦åœ¨æœ€ä¸Šå±‚çš„å®¹å™¨ä¸­è¿›è¡Œæ³¨å†Œï¼Œä¹Ÿå°±æ˜¯ <code>MaterialApp</code> ä¸­</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() =&gt; runApp(StreamApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreamApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œå¯¹åˆ›å»ºçš„ bloc ç±»è¿›è¡Œæ³¨å†Œï¼Œå¦‚æœè¯´æœ‰å¤šä¸ª bloc ç±»çš„è¯ï¼Œå¯ä»¥é€šè¿‡ child è¿›è¡ŒåµŒå¥—æ³¨å†Œå³å¯</span></span><br><span class="line">    <span class="comment">// æ”¾åœ¨æœ€é¡¶å±‚ï¼Œå¯ä»¥å…¨å±€è°ƒç”¨ï¼Œå½“ App å…³é—­åï¼Œé”€æ¯æ‰€æœ‰çš„ Bloc èµ„æºï¼Œ</span></span><br><span class="line">    <span class="comment">// ä¹Ÿå¯ä»¥åœ¨è·¯ç”±è·³è½¬çš„æ—¶å€™è¿›è¡Œæ³¨å†Œï¼Œè‡³äºåœ¨å“ªé‡Œæ³¨å†Œï¼Œå®Œå…¨çœ‹éœ€æ±‚</span></span><br><span class="line">    <span class="comment">// ä¾‹å¦‚å®ç°ä¸»é¢˜è‰²çš„åˆ‡æ¢ï¼Œåˆ™éœ€è¦åœ¨å…¨å±€å®šä¹‰ï¼Œå½“åˆ‡æ¢ä¸»é¢˜è‰²çš„æ—¶å€™å…¨å±€åˆ‡æ¢</span></span><br><span class="line">    <span class="comment">// åˆæ¯”å¦‚åªæœ‰æŸä¸ªæˆ–è€…æŸå‡ ä¸ªç‰¹æ®Šç•Œé¢è°ƒç”¨ï¼Œé‚£ä¹ˆå®Œå…¨å¯ä»¥é€šè¿‡åœ¨è·¯ç”±è·³è½¬çš„æ—¶å€™æ³¨å†Œ</span></span><br><span class="line">    <span class="keyword">return</span> BlocProvider(  </span><br><span class="line">        child: MaterialApp(</span><br><span class="line">          debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">          home: StreamHome(),</span><br><span class="line">        ),</span><br><span class="line">        bloc: CounterBloc());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreamHome</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// è·å–æ³¨å†Œçš„ blocï¼Œå¿…é¡»å…ˆæ³¨å†Œï¼Œå†å»æŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">final</span> CounterBloc _bloc = BlocProvider.of&lt;CounterBloc&gt;(context); </span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: SafeArea(</span><br><span class="line">          child: Container(</span><br><span class="line">        alignment: Alignment.center,</span><br><span class="line">        child: StreamBuilder(</span><br><span class="line">          initialData: _bloc.count,</span><br><span class="line">          stream: _bloc.countStream,</span><br><span class="line">          builder: (_, snapshot) =&gt; Text(<span class="string">'<span class="subst">$&#123;snapshot.data&#125;</span>'</span>, style: TextStyle(fontSize: <span class="number">20.0</span>)),</span><br><span class="line">        ),</span><br><span class="line">      )),</span><br><span class="line">      floatingActionButton:</span><br><span class="line">          <span class="comment">// é€šè¿‡ bloc ä¸­çš„ dispatch æ–¹æ³•è¿›è¡Œå€¼çš„ä¿®æ”¹ï¼Œé€šçŸ¥ stream åˆ·æ–°ç•Œé¢</span></span><br><span class="line">          FloatingActionButton(onPressed: () =&gt; </span><br><span class="line">                               _bloc.dispatch(_bloc.count + <span class="number">1</span>), child: Icon(Icons.add)),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°è¿è¡Œåï¼ŒæŸ¥çœ‹æ•ˆæœè¿˜æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æˆåŠŸçš„å¯¹ <code>StatefulWidget</code> è¿›è¡Œäº†æ›¿æ¢</p><p>å†ç»§ç»­è®²ä¹‹å‰ï¼Œå…ˆæ€»ç»“ä¸‹ <code>Bloc</code></p><p>â€‹    <strong>1. æˆåŠŸçš„æŠŠé¡µé¢å’Œé€»è¾‘åˆ†ç¦»å¼€äº†ï¼Œé¡µé¢åªå±•ç¤ºæ•°æ®ï¼Œé€»è¾‘é€šè¿‡ BLoC è¿›è¡Œå¤„ç†</strong></p><p>â€‹    <strong>2. å‡å°‘äº† setState æ–¹æ³•çš„ä½¿ç”¨ï¼Œæé«˜äº†æ€§èƒ½</strong></p><p>â€‹    <strong>3. å®ç°äº†çŠ¶æ€ç®¡ç†</strong></p><h4 id="RxDart"><a href="#RxDart" class="headerlink" title="RxDart"></a>RxDart</h4><p>å› ä¸ºä¸Šé¢çš„å‚è€ƒæ–‡ç« ä¸­æåˆ°äº† <code>RxDart</code>ï¼Œä¸ªäººè§‰å¾—æœ‰å¿…è¦äº†è§£ä¸‹ï¼Œå½“ç„¶ç›®å‰ä¹Ÿæœ‰å¾ˆå¤šæ–‡ç« ä»‹ç» <code>RxDart</code>ï¼Œæ‰€ä»¥æˆ‘å°±è®²ä¸‹å’Œ <code>BLoC</code> æœ‰ç‚¹å…³ç³»çš„éƒ¨åˆ†å§ã€‚<code>RxDart</code> éœ€è¦é€šè¿‡å¼•å…¥æ’ä»¶çš„æ–¹å¼å¼•å…¥(<code>rxdart: ^0.21.0</code>)</p><p>å¦‚æœéœ€è¦æŸ¥çœ‹è¯¦ç»†çš„å†…å®¹ï¼Œæˆ‘è¿™é‡Œæä¾›å‡ ç¯‡æ–‡ç« é“¾æ¥</p><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FReactiveX%2Frxdart" target="_blank" rel="noopener">RxDart æ–‡æ¡£</a></p><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.burkharts.net%2Fapps%2Fblog%2Frxdart-magical-transformations-of-streams%2F" target="_blank" rel="noopener">RxDart: Magical transformations of Streams</a></p><p>å…¶å® RxDart å°±æ˜¯å¯¹ Stream çš„è¿›ä¸€æ­¥åˆ†è£…ï¼ŒRxDart æä¾›äº†ä¸‰ç§ Subjectï¼Œå…¶åŠŸèƒ½ç±»ä¼¼ Stream ä¸­çš„å•è®¢é˜… stream å’Œ å¹¿æ’­ streamã€‚</p><ol><li><p><code>PublishSubject</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// PublishSubject is, by default, a broadcast (aka hot) controller, in order</span></span><br><span class="line"><span class="comment">/// to fulfill the Rx Subject contract. This means the Subject's `stream` can</span></span><br><span class="line"><span class="comment">/// be listened to multiple times.</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡æ³¨é‡Šå¯ä»¥å‘ç° <code>PuslishSubject</code> ä¸å¯è¢«å¤šæ¬¡è®¢é˜…ï¼Œå°½ç®¡å®ç°æ˜¯é€šè¿‡ <code>StreamController&lt;T&gt;.broadcast</code> æ–¹å¼å®ç°ï¼Œå…¶å®ä¸‰ç§éƒ½æ˜¯é€šè¿‡ <code>broadcast</code> æ–¹å¼å®ç°çš„ï¼Œæ‰€ä»¥å®ç°çš„åŠŸèƒ½å°±æ˜¯ç±»ä¼¼ <code>Single-subscription Stream</code> çš„åŠŸèƒ½ã€‚</p></li><li><p><code>BehaviorSubject</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// BehaviorSubject is, by default, a broadcast (aka hot) controller, in order</span></span><br><span class="line"><span class="comment">/// to fulfill the Rx Subject contract. This means the Subject's `stream` can</span></span><br><span class="line"><span class="comment">/// be listened to multiple times.</span></span><br></pre></td></tr></table></figure><p><code>BehaviorSubject</code> å¯ä»¥è¢«å¤šæ¬¡è®¢é˜…ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±æ˜¯å®ç°äº† <code>Broadcast Stream</code> åŠŸèƒ½ã€‚</p></li><li><p><code>ReplaySubject</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// ReplaySubject is, by default, a broadcast (aka hot) controller, in order</span></span><br><span class="line"><span class="comment">/// to fulfill the Rx Subject contract. This means the Subject's `stream` can</span></span><br><span class="line"><span class="comment">/// be listened to multiple times.</span></span><br></pre></td></tr></table></figure><p><code>ReplaySubject</code> å…¶å®ä¹Ÿæ˜¯å®ç° <code>Broadcast Stream</code> åŠŸèƒ½ï¼Œé‚£ä¹ˆå®ƒå’Œ <code>BehaviorSubject</code> çš„åŒºåˆ«åœ¨å“ªå‘¢ï¼Œåˆ«æ€¥ï¼Œç­‰æˆ‘æ…¢æ…¢è®²ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// As items are added to the subject, the ReplaySubject will store them.</span></span><br><span class="line"><span class="comment">/// When the stream is listened to, those recorded items will be emitted to</span></span><br><span class="line"><span class="comment">/// the listener.</span></span><br></pre></td></tr></table></figure><p>å½“æœ‰æ•°æ®æ·»åŠ äº†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ç›‘å¬çš„æ—¶å€™ï¼Œå®ƒä¼šå°†æ•°æ®å­˜å‚¨ä¸‹æ¥ï¼Œç­‰åˆ°æœ‰ç›‘å¬äº†ï¼Œå†å‘é€å‡ºå»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>ReplaySubject</code> å®ç°äº† <code>Brodacast Stream</code> çš„å¤šè®¢é˜…åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº† <code>Single-subscription Stream</code> çš„å­˜å‚¨æ•°æ®çš„åŠŸèƒ½ï¼Œæ¯æ¬¡æ·»åŠ äº†æ–°çš„ç›‘å¬ï¼Œéƒ½èƒ½å¤Ÿè·å–åˆ°å…¨éƒ¨çš„æ•°æ®ã€‚å½“ç„¶ï¼Œè¿™è¿˜ä¸æ˜¯å®ƒçš„å…¨éƒ¨åŠŸèƒ½ï¼Œå®ƒè¿˜å¯ä»¥è®¾ç½®æœ€å¤§çš„ç›‘å¬æ•°é‡ï¼Œä¼šåªç›‘å¬æœ€æ–°çš„å‡ ä¸ªæ•°æ®ï¼Œåœ¨æ³¨é‡Šä¸­ï¼Œæä¾›äº†è¿™ä¹ˆä¸¤ä¸ªä¾‹å­ï¼Œå¯ä»¥çœ‹ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// ### Example </span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     final subject = new ReplaySubject&lt;int&gt;();</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     subject.add(1);</span></span><br><span class="line"><span class="comment">///     subject.add(2);</span></span><br><span class="line"><span class="comment">///     subject.add(3);</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     subject.stream.listen(print); // prints 1, 2, 3</span></span><br><span class="line"><span class="comment">///     subject.stream.listen(print); // prints 1, 2, 3</span></span><br><span class="line"><span class="comment">///     subject.stream.listen(print); // prints 1, 2, 3</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// ### Example with maxSize</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     final subject = new ReplaySubject&lt;int&gt;(maxSize: 2); // å®ç°ç›‘å¬æ•°é‡é™åˆ¶</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     subject.add(1);</span></span><br><span class="line"><span class="comment">///     subject.add(2);</span></span><br><span class="line"><span class="comment">///     subject.add(3);</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">///     subject.stream.listen(print); // prints 2, 3</span></span><br><span class="line"><span class="comment">///     subject.stream.listen(print); // prints 2, 3</span></span><br><span class="line"><span class="comment">///     subject.stream.listen(print); // prints 2, 3</span></span><br></pre></td></tr></table></figure></li></ol><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>RxDart</code> å¯¹å‰é¢ä½¿ç”¨ <code>Stream</code> å®ç°çš„ä¾‹å­è¿›è¡Œæ›¿æ¢ï¼Œæœ€ç®€å•çš„å…¶å®åªéœ€è¦ä½¿ç”¨ <code>BehaviorSubject</code> æ›¿æ¢ <code>StreamController.broadcast()</code> å°±å¯ä»¥äº†ï¼Œåˆ«çš„éƒ½ä¸éœ€è¦å˜åŒ–ã€‚ä½†æ˜¯ <code>RxDart</code> æœ‰è‡ªå·±çš„å˜é‡ï¼Œè¿˜æ˜¯æŒ‰ç…§ <code>RxDart</code> çš„æ–¹å¼æ¥</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»§æ‰¿è‡ª StreamControllerï¼Œæ‰€ä»¥ StreamController æ‹¥æœ‰çš„å±æ€§éƒ½æœ‰</span></span><br><span class="line">BehaviorSubject&lt;<span class="built_in">int</span>&gt; _countController = BehaviorSubject();</span><br><span class="line"><span class="comment">//  StreamController&lt;int&gt; _countController = StreamController.broadcast();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§æ‰¿è‡ª Streamï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ç”¨ä¹‹å‰ stream çš„å†™æ³•ä¹Ÿæ²¡é—®é¢˜ï¼Œä½†æ˜¯è¿™æ ·å°±æœ‰ç‚¹ä¸ RxDart äº†</span></span><br><span class="line">Observable&lt;<span class="built_in">int</span>&gt; <span class="keyword">get</span> countStream =&gt; Observable(_countController.stream);</span><br><span class="line"><span class="comment">//  Stream&lt;int&gt; get countStream =&gt; _countController.stream;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> dispatch(<span class="built_in">int</span> value) &#123;</span><br><span class="line">  _count = value;</span><br><span class="line">  <span class="comment">// ç›´æ¥æä¾›äº† add æ–¹æ³•ï¼Œä¸éœ€è¦é€šè¿‡ sink æ¥æ·»åŠ </span></span><br><span class="line">  _countController.add(_count);</span><br><span class="line"><span class="comment">//    _countController.sink.add(_count);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œè¿˜æ˜¯èƒ½è¿‡å®ç°ç›¸åŒçš„æ•ˆæœã€‚å¦‚æœè¯´è¦åœ¨ <code>RxDart</code> å’Œ <code>Stream</code> ä¸¤ç§å®ç°æ–¹å¼ä¸­é€‰æ‹©ä¸€ç§ï¼Œä¸ªäººæ›´åå‘äº <code>RxDart</code>ï¼Œå› ä¸ºå®ƒå¯¹ <code>Stream</code> è¿›è¡Œäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œæä¾›äº†æ›´å¤šæ›´æ–¹ä¾¿çš„æ•°æ®è½¬æ¢æ–¹æ³•ï¼Œè€Œä¸”é“¾å¼çš„å†™æ³•çœŸçš„å¾ˆèˆ’æœï¼Œç”¨è¿‡äº†å°±åœä¸ä¸‹æ¥ï¼Œå…·ä½“çš„æ–¹æ³•ä»‹ç»å¯ä»¥å‚è€ƒä¸Šé¢æä¾›çš„é“¾æ¥ã€‚</p><h4 id="Provide"><a href="#Provide" class="headerlink" title="Provide"></a>Provide</h4><p>è¯´å®è¯è‡ªå·±å°è£… <code>BLoC</code> æ¥å®ç°åˆ†ç¦»é€»è¾‘å’Œç•Œé¢ï¼Œç›¸å¯¹è¿˜æ˜¯æœ‰ç‚¹éš¾åº¦çš„ï¼Œè¿™è¾¹å¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹æ¥å®ç°ï¼Œè¿™è¾¹æ¨è Google ç²‘ç²‘çš„åº“ï¼Œ<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fgoogle%2Fflutter-provide" target="_blank" rel="noopener">flutter_provide</a>ï¼Œçœ‹ä¸‹å®˜æ–¹å¯¹å…³é”®éƒ¨ä»¶å’Œé™æ€æ–¹æ³•çš„ä»‹ç»</p><blockquote><ul><li><code>Provide&lt;T&gt;</code> - Widget used to obtain values from a <code>ProviderNode</code> higher up in the widget tree and rebuild on change. The <code>Provide&lt;T&gt;</code>widget should only be used with <code>Stream</code>s or <code>Listenable</code>s. Equivalent to <code>ScopedModelDescendant</code> in <code>ScopedModel</code> </li><li><code>Provide.value&lt;T&gt;</code> - Static method used to get a value from a <code>ProviderNode</code> using the <code>BuildContext</code>. This will not rebuild on change. Similar to manually writing a static <code>.of()</code> method for an <code>InheritedWidget</code>.</li><li><code>Provide.stream&lt;T&gt;</code> - Static method used to get a <code>Stream</code> from a <code>ProviderNode</code>. Only works if either <code>T</code> is listenable, or if the <code>Provider</code>comes from a <code>Stream</code>.</li><li><code>Provider&lt;T&gt;</code> - A class that returns a typed value on demand. Stored in a <code>ProviderNode</code> to allow retrieval using <code>Provide</code>.</li><li><code>ProviderNode</code> - The equivalent of the <code>ScopedModel</code> widget. Contains <code>Providers</code> which can be found as an <code>InheritedWidget</code>.</li></ul></blockquote><p><code>Provide</code> è¿™ä¸ªéƒ¨ä»¶ä¸»è¦ç”¨äºä»ä¸Šå±‚çš„ <code>ProvideNode</code> ä¸­è·å–å€¼ï¼Œå½“å˜åŒ–çš„æ—¶å€™åˆ·æ–°é‡å»ºï¼Œåªèƒ½åŒ <code>Stream</code> å’Œ <code>Listenable</code>  ä¸€åŒä½¿ç”¨ï¼Œç±»ä¼¼äº <code>ScopeMode</code> ä¸­çš„ <code>ScopedModelDescendant</code>ã€‚<em>(è¿™ä¸ªéƒ¨ä»¶æ”¾åœ¨éœ€è¦çŠ¶æ€ç®¡ç†çš„éƒ¨ä»¶çš„ä¸Šå±‚ï¼Œä¾‹å¦‚æœ‰ä¸ª Text éœ€è¦ä¿®æ”¹çŠ¶æ€ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨å¤–å±‚æä¾›ä¸€ä¸ª Provide éƒ¨ä»¶ï¼Œé€šè¿‡å†…éƒ¨ builder å‚æ•°è¿”å› Text éƒ¨ä»¶)</em></p><p><code>Provide.value</code> æ˜¯ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºä» <code>ProvideNode</code> è·å–å€¼ï¼Œä½†æ˜¯å½“æ¥æ”¶çš„å€¼æ”¹å˜çš„æ—¶å€™ä¸ä¼šé‡å»ºã€‚ç±»ä¼¼äº <code>InheritedWidget</code> çš„é™æ€æ–¹æ³• <code>of</code>ã€‚<em>(è¿™ä¸ªæ–¹æ³•ç”¨äºè·å–æŒ‡å®šç±»å‹çš„ provideï¼Œæ¯ä¸ª provide éƒ½éœ€è¦æä¾›ä¸€ä¸ªæ•°æ®ç±»ï¼Œè¯¥ç±» with ChangeNotifierï¼Œå½“æ•°æ®å˜åŒ–çš„æ—¶å€™é€šè¿‡ notifyListeners é€šçŸ¥ provide å˜åŒ–ï¼Œè¿›è¡Œåˆ·æ–°é‡å»º)</em></p><p><code>Provide.stream</code> æ˜¯ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºä» <code>ProvideNode</code> è·å–ä¸€ä¸ª <code>stream</code>ï¼Œä»…åœ¨ T å¯è¢«ç›‘å¬ï¼Œæˆ–è€… Provide æ¥è‡ª stream çš„æƒ…å†µä¸‹æœ‰æ•ˆã€‚<em>(è¿™ä¸ªé€šå¸¸ç»“åˆ StreamBuilder ä½¿ç”¨ï¼ŒStreamBuilder åœ¨ä¸Šé¢å·²ç»æåˆ°ï¼Œå°±ä¸å¤šè¯´äº†)</em></p><p><code>Provider</code> æŒ‰éœ€è¦çš„ç±»å‹è¿”å›ç›¸å…³å€¼çš„ç±»ï¼Œå­˜å‚¨åœ¨ <code>ProviderNode</code> ä¸­æ–¹ä¾¿ <code>Provide</code> è¿›è¡Œæ£€ç´¢ã€‚<em>(è¿™ä¸ªç±»ä¸»è¦æ˜¯å°†æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„æ•°æ®ç±»é€šè¿‡ function ç­‰æ–¹æ³•è½¬æ¢æˆ Providerï¼Œå¹¶åœ¨ Providers ä¸­è¿›è¡Œæ³¨å†Œ)</em></p><p><code>ProvideNode</code> ç±»ä¼¼äº <code>ScopedModel</code> çš„ä¸€ä¸ªéƒ¨ä»¶ï¼ŒåŒ…å«æ‰€æœ‰èƒ½è¢«æŸ¥æ‰¾çš„ <code>Providers</code>ã€‚<em>(è¿™ä¸ªéœ€è¦æ”¾åœ¨é¡¶å±‚ï¼Œæ–¹ä¾¿ä¸‹é¢çš„å®¹å™¨è¿›è¡ŒæŸ¥æ‰¾ providerï¼Œåˆ·æ–°ç›¸åº”çš„éƒ¨ä»¶ï¼Œä¸€èˆ¬æ”¾åœ¨ MaterialApp ä¸Šå±‚)</em></p><p><em>è¿™è¾¹å†è¡¥å……ä¸€ä¸ªä¸ªäººè§‰å¾—å…³é”®çš„ç±» Providersï¼Œè¿™ä¸ªç±»ä¸»è¦ç”¨äºå­˜å‚¨å®šä¹‰çš„ Providerï¼Œä¸»è¦æ˜¯åœ¨å»ºç«‹ MaterialApp çš„æ—¶å€™å°†éœ€è¦ç”¨åˆ°çš„ Provider é€šè¿‡ provide æ–¹æ³•æ·»åŠ è¿›å»å­˜å‚¨èµ·æ¥ï¼Œç„¶ååœ¨ ProvideNode ä¸­æ³¨å†Œæ‰€æœ‰çš„ provider æ–¹ä¾¿ä¸‹å±‚å®¹å™¨è·å–å€¼ï¼Œå¹¶è°ƒç”¨ã€‚</em></p><p>è¯´é‚£ä¹ˆå¤šï¼Œè¿˜ä¸å¦‚ç›´æ¥çœ‹ä¸ªä¾‹å­ç›´æ¥ï¼Œä»£ç æ¥äº†~ï¼Œé¦–å…ˆéœ€è¦å»ºç«‹ä¸€ä¸ªç±»ä¼¼ <code>BLoC</code> ä¸­ç›‘å¬æ•°æ®å˜åŒ–çš„ <code>counter_bloc</code> ç±»çš„æ•°æ®ç®¡ç†ç±»ï¼Œæˆ‘ä»¬è¿™è¾¹å®šä¹‰ä¸º <code>count_provider</code> éœ€è¦æ··å…¥ <code>ChangeNotifier</code> ç±»</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CountProvider</span> <span class="title">with</span> <span class="title">ChangeNotifier</span> </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> _value = <span class="number">0</span>; <span class="comment">// å­˜å‚¨çš„æ•°æ®ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦ç®¡ç†çš„çŠ¶æ€å€¼</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> <span class="keyword">get</span> value =&gt; _value; <span class="comment">// è·å–çŠ¶æ€å€¼</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> changeValue(<span class="built_in">int</span> value) &#123;</span><br><span class="line">    _value = value;</span><br><span class="line">    notifyListeners(); <span class="comment">// å½“çŠ¶æ€å€¼å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œé€šè¿‡è¯¥æ–¹æ³•åˆ·æ–°é‡å»ºéƒ¨ä»¶</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åéœ€è¦å°†å®šä¹‰çš„ç±»æ³¨å†Œåˆ°å…¨å±€çš„ <code>Providers</code> ä¸­</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">final</span> providers = Providers()</span><br><span class="line">    <span class="comment">// å°†æˆ‘ä»¬åˆ›å»ºçš„æ•°æ®ç®¡ç†ç±»ï¼Œé€šè¿‡ Provider.function æ–¹æ³•è½¬æ¢æˆ Providerï¼Œ</span></span><br><span class="line">    <span class="comment">// ç„¶åæ·»åŠ åˆ° Providers ä¸­</span></span><br><span class="line">    ..provide(Provider.function((_) =&gt; CountProvider()));</span><br><span class="line">  <span class="comment">// åœ¨ App ä¸Šå±‚ï¼Œé€šè¿‡åŒ…è£¹ä¸€å±‚ ProvideNodeï¼Œå¹¶å°†æˆ‘ä»¬ç”Ÿæˆçš„ Providers å®ä¾‹</span></span><br><span class="line">  <span class="comment">// æ³¨å†Œåˆ° ProvideNode ä¸­å»ï¼Œè¿™æ ·æ•´ä¸ª App éƒ½å¯ä»¥é€šè¿‡ Provide.value æŸ¥æ‰¾ç›¸å…³çš„ Provider</span></span><br><span class="line">  <span class="comment">// æ‰¾åˆ° Provider åå°±å¯ä»¥æ‰¾åˆ°æˆ‘ä»¬çš„æ•°æ®ç®¡ç†ç±»</span></span><br><span class="line">  runApp(ProviderNode(child: StreamApp(), providers: providers));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€å°±æ˜¯æ›¿æ¢æˆ‘ä»¬çš„ç•Œé¢å®ç°äº†ï¼Œå‰é¢é€šè¿‡ <code>BLoC</code> å®ç°ï¼Œè¿™é‡Œæ›¿æ¢æˆ <code>Provide</code> æ¥å®ç°</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreamHome</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: SafeArea(</span><br><span class="line">          child: Container(</span><br><span class="line">        alignment: Alignment.center,</span><br><span class="line">        <span class="comment">// é€šè¿‡æŒ‡å®šç±»å‹ï¼Œè·å–ç‰¹å®šçš„ Provideï¼Œè¿™ä¸ª Provide ä¼šè¿”å›æˆ‘ä»¬çš„æ•°æ®ç®¡ç†ç±» provider</span></span><br><span class="line">        <span class="comment">// é€šè¿‡å†…éƒ¨å®šä¹‰çš„æ–¹æ³•ï¼Œè·å–åˆ°éœ€è¦å±•ç¤ºçš„å€¼</span></span><br><span class="line">        child: Provide&lt;CountProvider&gt;(builder: (_, widget, provider) =&gt; Text(<span class="string">'<span class="subst">$&#123;provider.value&#125;</span>'</span>)),</span><br><span class="line">      )),</span><br><span class="line">      floatingActionButton: FloatingActionButton(</span><br><span class="line">          onPressed: () =&gt;</span><br><span class="line">              <span class="comment">// é€šè¿‡ value æ–¹æ³•è·å–åˆ°æˆ‘ä»¬çš„æ•°æ®ç®¡ç†ç±» providerï¼Œ</span></span><br><span class="line">              <span class="comment">// é€šè¿‡è°ƒç”¨æ”¹å˜å€¼çš„æ–¹æ³•ï¼Œä¿®æ”¹å†…éƒ¨çš„å€¼ï¼Œå¹¶é€šçŸ¥ç•Œé¢åˆ·æ–°é‡å»º</span></span><br><span class="line">              Provide.value&lt;CountProvider&gt;(context).changeValue(</span><br><span class="line">                  Provide.value&lt;CountProvider&gt;(context).value + <span class="number">1</span>),</span><br><span class="line">          child: Icon(Icons.add))</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>æœ¬æ–‡ä»£ç æŸ¥çœ‹ bloc åŒ…åä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œéœ€è¦å•ç‹¬è¿è¡Œ stream_main.dart æ–‡ä»¶</em></p><p>æœ€åè¿è¡Œåè¿˜æ˜¯ä¸€æ ·çš„æ•ˆæœï¼Œä¹Ÿæ‘’å¼ƒäº† <code>StatefulWidget</code> éƒ¨ä»¶å’Œ <code>SetState</code> æ–¹æ³•ï¼Œå®ç°äº†é€»è¾‘å’Œç•Œé¢åˆ†ç¦»ã€‚ä½†æ˜¯ <code>Provide</code> æœ€ç»ˆè¿˜æ˜¯é€šè¿‡ <code>InheritedWidget</code> æ¥å®ç°ï¼Œå½“ç„¶åœ¨èµ„æºæ–¹é¢ Google çš„å¤§ä½¬ä»¬åšäº†ä¸€äº›ç›¸å…³çš„å¤„ç†ï¼Œè‡³äºå¦‚ä½•å¤„ç†ï¼Œè¿™è¾¹å°±ä¸å¤šè¯´äº†ã€‚ç›®å‰ <code>provide</code> çš„è¿™ä¸ªåº“è¿˜å­˜åœ¨ä¸€ç‚¹äº‰è®®çš„åœ°æ–¹ï¼Œå…·ä½“æŸ¥çœ‹ <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fgoogle%2Fflutter-provide%2Fissues%2F3" target="_blank" rel="noopener">issue#3</a>ï¼Œä½†æ˜¯ç›®å‰æ¥çœ‹å¹¶æ²¡æœ‰å¤ªå¤§çš„å½±å“ã€‚å½“ç„¶ä½ ä¸æ”¾å¿ƒçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>Scoped_model</code> æˆ–è€…ä¸Šé¢çš„ <code>Bloc</code> æ¨¡å¼ï¼ŒGoogle åœ¨æ–‡æ¡£ä¹Ÿæœ‰ç›¸å…³çš„æ³¨æ˜</p><blockquote><p>If you must choose a package today, itâ€™s safer to go with <code>package:scoped_model</code> than with this package.</p></blockquote><p>è¿™ç¯‡æ¦‚å¿µæ€§çš„æ¯”è¾ƒå¤šï¼Œä½†æ˜¯ç­‰ç†è§£äº†ä»¥åï¼Œå¯¹äºä»¥åçš„å¼€å‘è¿˜æ˜¯éå¸¸æœ‰åˆ©çš„ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;Stream&quot;&gt;&lt;a href=&quot;#Stream&quot; class=&quot;headerlink&quot; title=&quot;Stream&quot;&gt;&lt;/a&gt;Stream&lt;/h4&gt;&lt;p&gt;åœ¨ &lt;code&gt;dart&lt;/code&gt; éƒ¨åˆ†è®°å¾—åˆ†äº«è¿‡ &lt;code&gt;Stream&lt;/code&gt; çš„æ–‡ç« é“¾æ¥ï¼Œä½†æ˜¯æˆ‘çŸ¥é“ä½ ä»¬è‚¯å®šæ²¡å‡ ä¸ªæ„¿æ„çœ‹çš„ï¼Œæ‰€ä»¥è¿™é‡Œå†æä¸‹ã€‚è¿˜æ˜¯å¾—ä»æºç å¼€å§‹â€¦å› ä¸ºæºç çš„æ³¨é‡Šæ¯”è¾ƒé•¿ï¼Œå°±ä¸è´´æ³¨é‡Šäº†ï¼Œå¯ä»¥è‡ªå·±çœ‹ï¼Œæˆ‘è¿™è¾¹å°±æå–ä¸€äº›å…³é”®ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Stream&lt;/code&gt; æ˜¯ &lt;code&gt;Dart&lt;/code&gt; æä¾›çš„ä¸€ç§æ•°æ®æµè®¢é˜…ç®¡ç†çš„â€å·¥å…·â€ï¼Œæ„Ÿè§‰æœ‰ç‚¹åƒ &lt;code&gt;Android&lt;/code&gt; ä¸­çš„ &lt;code&gt;EventBus&lt;/code&gt; æˆ–è€… &lt;code&gt;RxBus&lt;/code&gt;ï¼Œ&lt;code&gt;Stream&lt;/code&gt; å¯ä»¥æ¥æ”¶ä»»ä½•å¯¹è±¡ï¼ŒåŒ…æ‹¬æ˜¯å¦å¤–ä¸€ä¸ª &lt;code&gt;Stream&lt;/code&gt;ï¼Œæ¥æ”¶çš„å¯¹è±¡é€šè¿‡ &lt;code&gt;StreamController&lt;/code&gt; çš„ &lt;code&gt;sink&lt;/code&gt; è¿›è¡Œæ·»åŠ ï¼Œç„¶åé€šè¿‡ &lt;code&gt;StreamController&lt;/code&gt; å‘é€ç»™ &lt;code&gt;Stream&lt;/code&gt;ï¼Œé€šè¿‡ &lt;code&gt;listen&lt;/code&gt; è¿›è¡Œç›‘å¬ï¼Œ&lt;code&gt;listen&lt;/code&gt; ä¼šè¿”å›ä¸€ä¸ª &lt;code&gt;StreamSubscription&lt;/code&gt; å¯¹è±¡ï¼Œ&lt;code&gt;StreamSubscription&lt;/code&gt; å¯ä»¥æ“ä½œå¯¹æ•°æ®æµçš„ç›‘å¬ï¼Œä¾‹å¦‚ &lt;code&gt;pause&lt;/code&gt;ï¼Œ&lt;code&gt;resume&lt;/code&gt;ï¼Œ&lt;code&gt;cancel&lt;/code&gt; ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Stream&lt;/code&gt; åˆ†ä¸¤ç§ç±»å‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;Single-subscription Stream&lt;/code&gt;ï¼šå•è®¢é˜… streamï¼Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸåªå…è®¸æœ‰ä¸€ä¸ªç›‘å¬ï¼Œå¦‚æœè¯¥ç›‘å¬ cancel äº†ï¼Œä¹Ÿä¸èƒ½å†æ·»åŠ å¦ä¸€ä¸ªç›‘å¬ï¼Œè€Œä¸”åªæœ‰å½“æœ‰ç›‘å¬äº†ï¼Œæ‰ä¼šå‘é€æ•°æ®ï¼Œä¸»è¦ç”¨äºæ–‡ä»¶ &lt;code&gt;IO&lt;/code&gt; æµçš„è¯»å–ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Broadcast Stream&lt;/code&gt;ï¼šå¹¿æ’­è®¢é˜… streamï¼Œå…è®¸æœ‰å¤šä¸ªç›‘å¬ï¼Œå½“æ·»åŠ äº†ç›‘å¬åï¼Œå¦‚æœæµä¸­æœ‰æ•°æ®å­˜åœ¨å°±å¯ä»¥ç›‘å¬åˆ°æ•°æ®ï¼Œè¿™ç§ç±»å‹ï¼Œä¸ç®¡æ˜¯å¦æœ‰ç›‘å¬ï¼Œåªè¦æœ‰æ•°æ®å°±ä¼šå‘é€ï¼Œç”¨äºéœ€è¦å¤šä¸ªç›‘å¬çš„æƒ…å†µã€‚&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Android" scheme="https://zhangmiao.cc/categories/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/categories/Android/Flutter/"/>
    
    
      <category term="Android" scheme="https://zhangmiao.cc/tags/Android/"/>
    
      <category term="Flutter" scheme="https://zhangmiao.cc/tags/Flutter/"/>
    
  </entry>
  
</feed>
